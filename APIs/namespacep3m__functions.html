<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: p3m_functions Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespacep3m__functions.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">p3m_functions Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Cubic interpolation functions. </p>
<p>Date of creation: 2008.06.09 L. White</p>
<p>This module contains p3m interpolation routines.</p>
<p>p3m interpolation is performed by estimating the edge values and slopes and constructing a cubic polynomial. We then make sure that the edge values are bounded and continuous and we then modify the slopes to get a monotonic cubic curve. </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:af8700cc6f491ea22ec0cff6208dc2483"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacep3m__functions.html#af8700cc6f491ea22ec0cff6208dc2483">p3m_interpolation</a> (N, h, u, ppoly_E, ppoly_S, ppoly_coef, h_neglect)</td></tr>
<tr class="memdesc:af8700cc6f491ea22ec0cff6208dc2483"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up a piecewise cubic interpolation from cell averages and estimated edge slopes and values.  <a href="namespacep3m__functions.html#af8700cc6f491ea22ec0cff6208dc2483">More...</a><br /></td></tr>
<tr class="separator:af8700cc6f491ea22ec0cff6208dc2483"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab31ae8429b3676f925ae61510d7f047a"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacep3m__functions.html#ab31ae8429b3676f925ae61510d7f047a">p3m_limiter</a> (N, h, u, ppoly_E, ppoly_S, ppoly_coef, h_neglect)</td></tr>
<tr class="memdesc:ab31ae8429b3676f925ae61510d7f047a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adust a piecewise cubic reconstruction with a limiter that adjusts the edge values and slopes.  <a href="namespacep3m__functions.html#ab31ae8429b3676f925ae61510d7f047a">More...</a><br /></td></tr>
<tr class="separator:ab31ae8429b3676f925ae61510d7f047a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e82e1b678b123181ea3fde88cd14e3a"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacep3m__functions.html#a6e82e1b678b123181ea3fde88cd14e3a">p3m_boundary_extrapolation</a> (N, h, u, ppoly_E, ppoly_S, ppoly_coef, h_neglect, h_neglect_edge)</td></tr>
<tr class="memdesc:a6e82e1b678b123181ea3fde88cd14e3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the edge values and slopes at boundary cells as part of building a piecewise cubic sub-grid scale profiles.  <a href="namespacep3m__functions.html#a6e82e1b678b123181ea3fde88cd14e3a">More...</a><br /></td></tr>
<tr class="separator:a6e82e1b678b123181ea3fde88cd14e3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4668b1791bbeae193f0f301cf101f6b"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacep3m__functions.html#af4668b1791bbeae193f0f301cf101f6b">build_cubic_interpolant</a> (h, k, ppoly_E, ppoly_S, ppoly_coef)</td></tr>
<tr class="memdesc:af4668b1791bbeae193f0f301cf101f6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build cubic interpolant in cell k.  <a href="namespacep3m__functions.html#af4668b1791bbeae193f0f301cf101f6b">More...</a><br /></td></tr>
<tr class="separator:af4668b1791bbeae193f0f301cf101f6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2eaa8b32f092bbbb0e2cfcd78b0e700f"><td class="memItemLeft" align="right" valign="top">integer function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacep3m__functions.html#a2eaa8b32f092bbbb0e2cfcd78b0e700f">is_cubic_monotonic</a> (ppoly_coef, k)</td></tr>
<tr class="memdesc:a2eaa8b32f092bbbb0e2cfcd78b0e700f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether the cubic reconstruction in cell k is monotonic.  <a href="namespacep3m__functions.html#a2eaa8b32f092bbbb0e2cfcd78b0e700f">More...</a><br /></td></tr>
<tr class="separator:a2eaa8b32f092bbbb0e2cfcd78b0e700f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb96651fe725f11e90dec2b8509989b0"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacep3m__functions.html#adb96651fe725f11e90dec2b8509989b0">monotonize_cubic</a> (h, u0_l, u0_r, sigma_l, sigma_r, slope, u1_l, u1_r)</td></tr>
<tr class="memdesc:adb96651fe725f11e90dec2b8509989b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Monotonize a cubic curve by modifying the edge slopes.  <a href="namespacep3m__functions.html#adb96651fe725f11e90dec2b8509989b0">More...</a><br /></td></tr>
<tr class="separator:adb96651fe725f11e90dec2b8509989b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aedfe0a0f65453ca61b90d4c601747c90"><td class="memItemLeft" align="right" valign="top">real, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacep3m__functions.html#aedfe0a0f65453ca61b90d4c601747c90">hneglect_dflt</a> = 1.E-30</td></tr>
<tr class="memdesc:aedfe0a0f65453ca61b90d4c601747c90"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default value of a negligible cell thickness.  <a href="namespacep3m__functions.html#aedfe0a0f65453ca61b90d4c601747c90">More...</a><br /></td></tr>
<tr class="separator:aedfe0a0f65453ca61b90d4c601747c90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdb3a0dd6c75e81bbcb5f5c982c31e7b"><td class="memItemLeft" align="right" valign="top">real, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacep3m__functions.html#abdb3a0dd6c75e81bbcb5f5c982c31e7b">hneglect_edge_dflt</a> = 1.E-10</td></tr>
<tr class="memdesc:abdb3a0dd6c75e81bbcb5f5c982c31e7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default value of a negligible edge thickness.  <a href="namespacep3m__functions.html#abdb3a0dd6c75e81bbcb5f5c982c31e7b">More...</a><br /></td></tr>
<tr class="separator:abdb3a0dd6c75e81bbcb5f5c982c31e7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="af4668b1791bbeae193f0f301cf101f6b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4668b1791bbeae193f0f301cf101f6b">&#9670;&nbsp;</a></span>build_cubic_interpolant()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine p3m_functions::build_cubic_interpolant </td>
          <td>(</td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly_E</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly_S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>ppoly_coef</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Build cubic interpolant in cell k. </p>
<p>Given edge values and edge slopes, compute coefficients of cubic in cell k.</p>
<p>NOTE: edge values and slopes MUST have been properly calculated prior to calling this routine. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>cell widths (size N) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k</td><td>The index of the cell to work on </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly_e</td><td>Edge value of polynomial, with the same units as u. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly_s</td><td>Edge slope of polynomial, in the units of u over the units of h. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ppoly_coef</td><td>Coefficients of polynomial, mainly with the same units as u. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="P3M__functions_8F90_source.html#l00363">363</a> of file <a class="el" href="P3M__functions_8F90_source.html">P3M_functions.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:)</span>,   <span class="keywordtype">intent(in)</span>    :: h<span class="comment"> !&lt; cell widths (size N)</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span>    :: k<span class="comment"> !&lt; The index of the cell to work on</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(in)</span>    :: ppoly_E<span class="comment">    !&lt; Edge value of polynomial,</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">                                           !! with the same units as u.</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(in)</span>    :: ppoly_S<span class="comment">    !&lt; Edge slope of polynomial,</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">                                           !! in the units of u over the units of h.</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> :: ppoly_coef<span class="comment"> !&lt; Coefficients of polynomial, mainly</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">                                           !! with the same units as u.</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="keywordtype">  real</span>          :: u0_l, u0_r       <span class="comment">! edge values</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="keywordtype">  real</span>          :: u1_l, u1_r       <span class="comment">! edge slopes</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="keywordtype">  real</span>          :: h_c              <span class="comment">! cell width</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="keywordtype">  real</span>          :: a0, a1, a2, a3   <span class="comment">! cubic coefficients</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  h_c = h(k)</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  u0_l = ppoly_e(k,1)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  u0_r = ppoly_e(k,2)</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160; </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  u1_l = ppoly_s(k,1) * h_c</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  u1_r = ppoly_s(k,2) * h_c</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  a0 = u0_l</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  a1 = u1_l</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  a2 = 3.0 * ( u0_r - u0_l ) - u1_r - 2.0 * u1_l</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  a3 = u1_r + u1_l + 2.0 * ( u0_l - u0_r )</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  ppoly_coef(k,1) = a0</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  ppoly_coef(k,2) = a1</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  ppoly_coef(k,3) = a2</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  ppoly_coef(k,4) = a3</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="P3M__functions_8F90_source.html#l00206">p3m_boundary_extrapolation()</a>, and <a class="el" href="P3M__functions_8F90_source.html#l00066">p3m_limiter()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacep3m__functions_af4668b1791bbeae193f0f301cf101f6b_icgraph.svg" width="100%" height="437"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a2eaa8b32f092bbbb0e2cfcd78b0e700f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2eaa8b32f092bbbb0e2cfcd78b0e700f">&#9670;&nbsp;</a></span>is_cubic_monotonic()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer function p3m_functions::is_cubic_monotonic </td>
          <td>(</td>
          <td class="paramtype">real, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly_coef</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>k</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check whether the cubic reconstruction in cell k is monotonic. </p>
<p>This function checks whether the cubic curve in cell k is monotonic. If so, returns 1. Otherwise, returns 0.</p>
<p>The cubic is monotonic if the first derivative is single-signed in [0,1]. Hence, we check whether the roots (if any) lie inside this interval. If there is no root or if both roots lie outside this interval, the cubic is monotonic. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly_coef</td><td>Coefficients of cubic polynomial </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k</td><td>The index of the cell to work on </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="P3M__functions_8F90_source.html#l00407">407</a> of file <a class="el" href="P3M__functions_8F90_source.html">P3M_functions.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(in)</span> :: ppoly_coef<span class="comment"> !&lt; Coefficients of cubic polynomial</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span> :: k<span class="comment">  !&lt; The index of the cell to work on</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keywordtype">integer</span>       :: monotonic        <span class="comment">! boolean indicating if monotonic or not</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="keywordtype">  real</span>          :: a0, a1, a2, a3   <span class="comment">! cubic coefficients</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="keywordtype">  real</span>          :: a, b, c          <span class="comment">! coefficients of first derivative</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="keywordtype">  real</span>          :: xi_0, xi_1       <span class="comment">! roots of first derivative (if any !)</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="keywordtype">  real</span>          :: rho</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="keywordtype">  real</span>          :: eps</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="comment">! Define the radius of the ball around 0 and 1 in which all values are assumed</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="comment">! to be equal to 0 or 1, respectively</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  eps = 1e-14</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  a0 = ppoly_coef(k,1)</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  a1 = ppoly_coef(k,2)</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  a2 = ppoly_coef(k,3)</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  a3 = ppoly_coef(k,4)</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  a = a1</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  b = 2.0 * a2</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  c = 3.0 * a3</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160; </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  xi_0 = -1.0</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  xi_1 = -1.0</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160; </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  rho = b*b - 4.0*a*c</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">if</span> ( rho &gt;= 0.0 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">if</span> ( abs(c) &gt; 1e-15 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      xi_0 = 0.5 * ( -b - sqrt( rho ) ) / c</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      xi_1 = 0.5 * ( -b + sqrt( rho ) ) / c</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordflow">elseif</span> ( abs(b) &gt; 1e-15 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      xi_0 = - a / b</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      xi_1 = - a / b</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="comment">! If one of the roots of the first derivative lies in (0,1),</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">! the cubic is not monotonic.</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">if</span> ( ( (xi_0 &gt; eps) .AND. (xi_0 &lt; 1.0-eps) ) .OR. &amp;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;         ( (xi_1 &gt; eps) .AND. (xi_1 &lt; 1.0-eps) ) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      monotonic = 0</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      monotonic = 1</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keywordflow">else</span> <span class="comment">! there are no real roots --&gt; cubic is monotonic</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    monotonic = 1</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="comment">! Set the return value</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  is_cubic_monotonic = monotonic</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="P3M__functions_8F90_source.html#l00206">p3m_boundary_extrapolation()</a>, and <a class="el" href="P3M__functions_8F90_source.html#l00066">p3m_limiter()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacep3m__functions_a2eaa8b32f092bbbb0e2cfcd78b0e700f_icgraph.svg" width="100%" height="437"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="adb96651fe725f11e90dec2b8509989b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb96651fe725f11e90dec2b8509989b0">&#9670;&nbsp;</a></span>monotonize_cubic()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine p3m_functions::monotonize_cubic </td>
          <td>(</td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>u0_l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>u0_r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>sigma_l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>sigma_r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>slope</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(inout)&#160;</td>
          <td class="paramname"><em>u1_l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(inout)&#160;</td>
          <td class="paramname"><em>u1_r</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Monotonize a cubic curve by modifying the edge slopes. </p>
<p>This routine takes care of monotonizing a cubic on [0,1] by modifying the edge slopes. The edge values are NOT modified. The cubic is entirely determined by the four degrees of freedom u0_l, u0_r, u1_l and u1_r.</p>
<p>u1_l and u1_r are the edge slopes expressed in the GLOBAL coordinate system.</p>
<p>The monotonization occurs as follows. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>cell width </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u0_l</td><td>left edge value </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u0_r</td><td>right edge value </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sigma_l</td><td>left 2nd-order slopes </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sigma_r</td><td>right 2nd-order slopes </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slope</td><td>limited PLM slope </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">u1_l</td><td>left edge slopes </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">u1_r</td><td>right edge slopes </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="P3M__functions_8F90_source.html#l00490">490</a> of file <a class="el" href="P3M__functions_8F90_source.html">P3M_functions.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">intent(in)</span>      :: h<span class="comment">       !&lt; cell width</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">intent(in)</span>      :: u0_l<span class="comment">    !&lt; left edge value</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">intent(in)</span>      :: u0_r<span class="comment">    !&lt; right edge value</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">intent(in)</span>      :: sigma_l<span class="comment"> !&lt; left 2nd-order slopes</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">intent(in)</span>      :: sigma_r<span class="comment"> !&lt; right 2nd-order slopes</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">intent(in)</span>      :: slope<span class="comment">   !&lt; limited PLM slope</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">intent(inout)</span>   :: u1_l<span class="comment">    !&lt; left edge slopes</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">intent(inout)</span>   :: u1_r<span class="comment">    !&lt; right edge slopes</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordtype">integer</span>       :: found_ip</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="keywordtype">integer</span>       :: inflexion_l  <span class="comment">! bool telling if inflex. pt must be on left</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordtype">integer</span>       :: inflexion_r  <span class="comment">! bool telling if inflex. pt must be on right</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="keywordtype">  real</span>          :: eps</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="keywordtype">  real</span>          :: a1, a2, a3</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="keywordtype">  real</span>          :: u1_l_tmp     <span class="comment">! trial left edge slope</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordtype">  real</span>          :: u1_r_tmp     <span class="comment">! trial right edge slope</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="keywordtype">  real</span>          :: xi_ip        <span class="comment">! location of inflexion point</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="keywordtype">  real</span>          :: slope_ip     <span class="comment">! slope at inflexion point</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  eps = 1e-14</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  found_ip = 0</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  inflexion_l = 0</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  inflexion_r = 0</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="comment">! If the edge slopes are inconsistent w.r.t. the limited PLM slope,</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="comment">! set them to zero</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordflow">if</span> ( u1_l*slope &lt;= 0.0 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    u1_l = 0.0</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160; </div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordflow">if</span> ( u1_r*slope &lt;= 0.0 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    u1_r = 0.0</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="comment">! Compute the location of the inflexion point, which is the root</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="comment">! of the second derivative</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  a1 = h * u1_l</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  a2 = 3.0 * ( u0_r - u0_l ) - h*(u1_r + 2.0*u1_l)</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  a3 = h*(u1_r + u1_l) + 2.0*(u0_l - u0_r)</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="comment">! There is a possible root (and inflexion point) only if a3 is nonzero.</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="comment">! When a3 is zero, the second derivative of the cubic is constant (the</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="comment">! cubic degenerates into a parabola) and no inflexion point exists.</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordflow">if</span> ( a3 /= 0.0 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">! Location of inflexion point</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    xi_ip = - a2 / (3.0 * a3)</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="comment">! If the inflexion point lies in [0,1], change boolean value</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordflow">if</span> ( (xi_ip &gt;= 0.0) .AND. (xi_ip &lt;= 1.0) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      found_ip = 1</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="comment">! When there is an inflexion point within [0,1], check the slope</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="comment">! to see if it is consistent with the limited PLM slope. If not,</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="comment">! decide on which side we want to collapse the inflexion point.</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="comment">! If the inflexion point lies on one of the edges, the cubic is</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="comment">! guaranteed to be monotonic</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keywordflow">if</span> ( found_ip == 1 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    slope_ip = a1 + 2.0*a2*xi_ip + 3.0*a3*xi_ip*xi_ip</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160; </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">! Check whether slope is consistent</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">if</span> ( slope_ip*slope &lt; 0.0 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="keywordflow">if</span> ( abs(sigma_l) &lt; abs(sigma_r)  ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        inflexion_l = 1</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        inflexion_r = 1</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="keywordflow">  endif</span> <span class="comment">! found_ip</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="comment">! At this point, if the cubic is not monotonic, we know where the</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="comment">! inflexion point should lie. When the cubic is monotonic, both</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="comment">! &#39;inflexion_l&#39; and &#39;inflexion_r&#39; are set to 0 and nothing is to be done.</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="comment">! Move inflexion point on the left</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordflow">if</span> ( inflexion_l == 1 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    u1_l_tmp = 1.5*(u0_r-u0_l)/h - 0.5*u1_r</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    u1_r_tmp = 3.0*(u0_r-u0_l)/h - 2.0*u1_l</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160; </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordflow">if</span> ( (u1_l_tmp*slope &lt; 0.0) .AND. (u1_r_tmp*slope &lt; 0.0) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      u1_l = 0.0</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      u1_r = 3.0 * (u0_r - u0_l) / h</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">elseif</span> (u1_l_tmp*slope &lt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      u1_r = u1_r_tmp</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      u1_l = 1.5*(u0_r - u0_l)/h - 0.5*u1_r</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160; </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">elseif</span> (u1_r_tmp*slope &lt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      u1_l = u1_l_tmp</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      u1_r = 3.0*(u0_r - u0_l)/h - 2.0*u1_l</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      u1_l = u1_l_tmp</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      u1_r = u1_r_tmp</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160; </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="keywordflow">  endif</span> <span class="comment">! end treating case with inflexion point on the left</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160; </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="comment">! Move inflexion point on the right</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="keywordflow">if</span> ( inflexion_r == 1 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    u1_l_tmp = 3.0*(u0_r-u0_l)/h - 2.0*u1_r</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    u1_r_tmp = 1.5*(u0_r-u0_l)/h - 0.5*u1_l</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">if</span> ( (u1_l_tmp*slope &lt; 0.0) .AND. (u1_r_tmp*slope &lt; 0.0) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      u1_l = 3.0 * (u0_r - u0_l) / h</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      u1_r = 0.0</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">elseif</span> (u1_l_tmp*slope &lt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      u1_r = u1_r_tmp</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      u1_l = 3.0*(u0_r - u0_l)/h - 2.0*u1_r</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordflow">elseif</span> (u1_r_tmp*slope &lt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      u1_l = u1_l_tmp</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      u1_r = 1.5*(u0_r - u0_l)/h - 0.5*u1_l</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      u1_l = u1_l_tmp</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      u1_r = u1_r_tmp</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160; </div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="keywordflow">  endif</span> <span class="comment">! end treating case with inflexion point on the right</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keywordflow">if</span> ( abs(u1_l*h) &lt; eps ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    u1_l = 0.0</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="keywordflow">if</span> ( abs(u1_r*h) &lt; eps ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    u1_r = 0.0</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="P3M__functions_8F90_source.html#l00206">p3m_boundary_extrapolation()</a>, and <a class="el" href="P3M__functions_8F90_source.html#l00066">p3m_limiter()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacep3m__functions_adb96651fe725f11e90dec2b8509989b0_icgraph.svg" width="100%" height="437"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a6e82e1b678b123181ea3fde88cd14e3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e82e1b678b123181ea3fde88cd14e3a">&#9670;&nbsp;</a></span>p3m_boundary_extrapolation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public p3m_functions::p3m_boundary_extrapolation </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>ppoly_E</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>ppoly_S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>ppoly_coef</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>h_neglect</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>h_neglect_edge</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate the edge values and slopes at boundary cells as part of building a piecewise cubic sub-grid scale profiles. </p>
<p>The following explanations apply to the left boundary cell. The same reasoning holds for the right boundary cell.</p>
<p>A cubic needs to be built in the cell and requires four degrees of freedom, which are the edge values and slopes. The right edge values and slopes are taken to be that of the neighboring cell (i.e., the left edge value and slope of the neighboring cell). The left edge value and slope are determined by computing the parabola based on the cell average and the right edge value and slope. The resulting cubic is not necessarily monotonic and the slopes are subsequently modified to yield a monotonic cubic. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Number of cells </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>cell widths (size N) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u</td><td>cell averages (size N) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ppoly_e</td><td>Edge value of polynomial, with the same units as u. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ppoly_s</td><td>Edge slope of polynomial, in the units of u over the units of h. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ppoly_coef</td><td>Coefficients of polynomial, mainly with the same units as u. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_neglect</td><td>A negligibly small width for the purpose of cell reconstructions in the same units as h. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_neglect_edge</td><td>A negligibly small width for the purpose of finding edge values in the same units as h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="P3M__functions_8F90_source.html#l00206">206</a> of file <a class="el" href="P3M__functions_8F90_source.html">P3M_functions.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span>    :: N<span class="comment"> !&lt; Number of cells</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:)</span>,   <span class="keywordtype">intent(in)</span>    :: h<span class="comment"> !&lt; cell widths (size N)</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:)</span>,   <span class="keywordtype">intent(in)</span>    :: u<span class="comment"> !&lt; cell averages (size N)</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> :: ppoly_E<span class="comment"> !&lt; Edge value of polynomial,</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">                                           !! with the same units as u.</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> :: ppoly_S<span class="comment"> !&lt; Edge slope of polynomial,</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">                                           !! in the units of u over the units of h.</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> :: ppoly_coef<span class="comment"> !&lt; Coefficients of polynomial, mainly</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">                                           !! with the same units as u.</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="keywordtype">  real</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: h_neglect<span class="comment"> !&lt; A negligibly small width for the</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">                                          !! purpose of cell reconstructions</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">                                          !! in the same units as h.</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="keywordtype">  real</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: h_neglect_edge<span class="comment"> !&lt; A negligibly small width</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">                                          !! for the purpose of finding edge values</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">                                          !! in the same units as h.</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordtype">integer</span> :: i0, i1</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordtype">integer</span> :: monotonic</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="keywordtype">  real</span>    :: u0, u1</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keywordtype">  real</span>    :: h0, h1</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="keywordtype">  real</span>    :: b, c, d</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="keywordtype">  real</span>    :: u0_l, u0_r</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keywordtype">  real</span>    :: u1_l, u1_r</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="keywordtype">  real</span>    :: slope</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="keywordtype">  real</span>    :: hNeglect, hNeglect_edge</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  hneglect = hneglect_dflt ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(h_neglect)) hneglect = h_neglect</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  hneglect_edge = hneglect_edge_dflt</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(h_neglect_edge)) hneglect_edge = h_neglect_edge</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="comment">! ----- Left boundary -----</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  i0 = 1</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  i1 = 2</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  h0 = h(i0) + hneglect_edge</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  h1 = h(i1) + hneglect_edge</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  u0 = u(i0)</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  u1 = u(i1)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="comment">! Compute the left edge slope in neighboring cell and express it in</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">! the global coordinate system</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  b = ppoly_coef(i1,2)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  u1_r = b / h1     <span class="comment">! derivative evaluated at xi = 0.0, expressed w.r.t. x</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="comment">! Limit the right slope by the PLM limited slope</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  slope = 2.0 * ( u1 - u0 ) / ( h0 + hneglect )</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keywordflow">if</span> ( abs(u1_r) &gt; abs(slope) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    u1_r = slope</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">! The right edge value in the boundary cell is taken to be the left</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="comment">! edge value in the neighboring cell</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  u0_r = ppoly_e(i1,1)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="comment">! Given the right edge value and slope, we determine the left</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="comment">! edge value and slope by computing the parabola as determined by</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="comment">! the right edge value and slope and the boundary cell average</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  u0_l = 3.0 * u0 + 0.5 * h0*u1_r - 2.0 * u0_r</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  u1_l = ( - 6.0 * u0 - 2.0 * h0*u1_r + 6.0 * u0_r) / ( h0 + hneglect )</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="comment">! Check whether the edge values are monotonic. For example, if the left edge</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="comment">! value is larger than the right edge value while the slope is positive, the</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="comment">! edge values are inconsistent and we need to modify the left edge value</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordflow">if</span> ( (u0_r-u0_l) * slope &lt; 0.0 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    u0_l = u0_r</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    u1_l = 0.0</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    u1_r = 0.0</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="comment">! Store edge values and slope, build cubic and check monotonicity</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  ppoly_e(i0,1) = u0_l</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  ppoly_e(i0,2) = u0_r</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  ppoly_s(i0,1) = u1_l</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  ppoly_s(i0,2) = u1_r</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="comment">! Store edge values and slope, build cubic and check monotonicity</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keyword">call </span>build_cubic_interpolant( h, i0, ppoly_e, ppoly_s, ppoly_coef )</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  monotonic = is_cubic_monotonic( ppoly_coef, i0 )</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordflow">if</span> ( monotonic == 0 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keyword">call </span>monotonize_cubic( h0, u0_l, u0_r, 0.0, slope, slope, u1_l, u1_r )</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">! Rebuild cubic after monotonization</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    ppoly_s(i0,1) = u1_l</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    ppoly_s(i0,2) = u1_r</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keyword">call </span>build_cubic_interpolant( h, i0, ppoly_e, ppoly_s, ppoly_coef )</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="comment">! ----- Right boundary -----</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  i0 = n-1</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  i1 = n</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  h0 = h(i0) + hneglect_edge</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  h1 = h(i1) + hneglect_edge</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  u0 = u(i0)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  u1 = u(i1)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="comment">! Compute the right edge slope in neighboring cell and express it in</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="comment">! the global coordinate system</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  b = ppoly_coef(i0,2)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  c = ppoly_coef(i0,3)</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  d = ppoly_coef(i0,4)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  u1_l = (b + 2*c + 3*d) / ( h0 + hneglect ) <span class="comment">! derivative evaluated at xi = 1.0</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="comment">! Limit the left slope by the PLM limited slope</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  slope = 2.0 * ( u1 - u0 ) / ( h1 + hneglect )</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keywordflow">if</span> ( abs(u1_l) &gt; abs(slope) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    u1_l = slope</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="comment">! The left edge value in the boundary cell is taken to be the right</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="comment">! edge value in the neighboring cell</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  u0_l = ppoly_e(i0,2)</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="comment">! Given the left edge value and slope, we determine the right</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="comment">! edge value and slope by computing the parabola as determined by</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="comment">! the left edge value and slope and the boundary cell average</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  u0_r = 3.0 * u1 - 0.5 * h1*u1_l - 2.0 * u0_l</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  u1_r = ( 6.0 * u1 - 2.0 * h1*u1_l - 6.0 * u0_l) / ( h1 + hneglect )</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="comment">! Check whether the edge values are monotonic. For example, if the right edge</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="comment">! value is smaller than the left edge value while the slope is positive, the</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="comment">! edge values are inconsistent and we need to modify the right edge value</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordflow">if</span> ( (u0_r-u0_l) * slope &lt; 0.0 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    u0_r = u0_l</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    u1_l = 0.0</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    u1_r = 0.0</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="comment">! Store edge values and slope, build cubic and check monotonicity</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  ppoly_e(i1,1) = u0_l</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  ppoly_e(i1,2) = u0_r</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  ppoly_s(i1,1) = u1_l</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  ppoly_s(i1,2) = u1_r</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keyword">call </span>build_cubic_interpolant( h, i1, ppoly_e, ppoly_s, ppoly_coef )</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  monotonic = is_cubic_monotonic( ppoly_coef, i1 )</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keywordflow">if</span> ( monotonic == 0 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keyword">call </span>monotonize_cubic( h1, u0_l, u0_r, slope, 0.0, slope, u1_l, u1_r )</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">! Rebuild cubic after monotonization</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    ppoly_s(i1,1) = u1_l</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    ppoly_s(i1,2) = u1_r</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keyword">call </span>build_cubic_interpolant( h, i1, ppoly_e, ppoly_s, ppoly_coef )</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="P3M__functions_8F90_source.html#l00363">build_cubic_interpolant()</a>, <a class="el" href="P3M__functions_8F90_source.html#l00013">hneglect_dflt</a>, <a class="el" href="P3M__functions_8F90_source.html#l00014">hneglect_edge_dflt</a>, <a class="el" href="P3M__functions_8F90_source.html#l00407">is_cubic_monotonic()</a>, and <a class="el" href="P3M__functions_8F90_source.html#l00490">monotonize_cubic()</a>.</p>

<p class="reference">Referenced by <a class="el" href="regrid__interp_8F90_source.html#l00077">regrid_interp::regridding_set_ppolys()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacep3m__functions_a6e82e1b678b123181ea3fde88cd14e3a_cgraph.svg" width="430" height="183"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacep3m__functions_a6e82e1b678b123181ea3fde88cd14e3a_icgraph.svg" width="100%" height="437"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="af8700cc6f491ea22ec0cff6208dc2483"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8700cc6f491ea22ec0cff6208dc2483">&#9670;&nbsp;</a></span>p3m_interpolation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public p3m_functions::p3m_interpolation </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>ppoly_E</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>ppoly_S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>ppoly_coef</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>h_neglect</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set up a piecewise cubic interpolation from cell averages and estimated edge slopes and values. </p>
<p>Cubic interpolation between edges.</p>
<p>The edge values and slopes MUST have been estimated prior to calling this routine.</p>
<p>It is assumed that the size of the array 'u' is equal to the number of cells defining 'grid' and 'ppoly'. No consistency check is performed here. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Number of cells </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>cell widths (size N) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u</td><td>cell averages (size N) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ppoly_e</td><td>Edge value of polynomial, with the same units as u. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ppoly_s</td><td>Edge slope of polynomial, in the units of u over the units of h. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ppoly_coef</td><td>Coefficients of polynomial, mainly with the same units as u. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_neglect</td><td>A negligibly small width for the purpose of cell reconstructions in the same units as h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="P3M__functions_8F90_source.html#l00030">30</a> of file <a class="el" href="P3M__functions_8F90_source.html">P3M_functions.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span>    :: N<span class="comment"> !&lt; Number of cells</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:)</span>,   <span class="keywordtype">intent(in)</span>    :: h<span class="comment"> !&lt; cell widths (size N)</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:)</span>,   <span class="keywordtype">intent(in)</span>    :: u<span class="comment"> !&lt; cell averages (size N)</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> :: ppoly_E<span class="comment">   !&lt; Edge value of polynomial,</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">                                           !! with the same units as u.</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> :: ppoly_S<span class="comment">   !&lt; Edge slope of polynomial,</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">                                           !! in the units of u over the units of h.</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> :: ppoly_coef<span class="comment"> !&lt; Coefficients of polynomial, mainly</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">                                           !! with the same units as u.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keywordtype">  real</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: h_neglect<span class="comment"> !&lt; A negligibly small width for the</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">                                          !! purpose of cell reconstructions</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">                                          !! in the same units as h.</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="comment">! Call the limiter for p3m, which takes care of everything from</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="comment">! computing the coefficients of the cubic to monotonizing it.</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="comment">! This routine could be called directly instead of having to call</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="comment">! &#39;P3M_interpolation&#39; first but we do that to provide an homogeneous</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="comment">! interface.</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keyword">call </span>p3m_limiter( n, h, u, ppoly_e, ppoly_s, ppoly_coef, h_neglect )</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="P3M__functions_8F90_source.html#l00066">p3m_limiter()</a>.</p>

<p class="reference">Referenced by <a class="el" href="regrid__interp_8F90_source.html#l00077">regrid_interp::regridding_set_ppolys()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacep3m__functions_af8700cc6f491ea22ec0cff6208dc2483_cgraph.svg" width="592" height="330"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacep3m__functions_af8700cc6f491ea22ec0cff6208dc2483_icgraph.svg" width="100%" height="437"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ab31ae8429b3676f925ae61510d7f047a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab31ae8429b3676f925ae61510d7f047a">&#9670;&nbsp;</a></span>p3m_limiter()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine p3m_functions::p3m_limiter </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>ppoly_E</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>ppoly_S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>ppoly_coef</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>h_neglect</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adust a piecewise cubic reconstruction with a limiter that adjusts the edge values and slopes. </p>
<p>The p3m limiter operates as follows:</p>
<ol type="1">
<li>Edge values are bounded</li>
<li>Discontinuous edge values are systematically averaged</li>
<li>Loop on cells and do the following a. Build cubic curve b. Check if cubic curve is monotonic c. If not, monotonize cubic curve and rebuild it</li>
</ol>
<p>Step 3 of the monotonization process leaves all edge values unchanged. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Number of cells </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>cell widths (size N) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u</td><td>cell averages (size N) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ppoly_e</td><td>Edge value of polynomial, with the same units as u. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ppoly_s</td><td>Edge slope of polynomial, in the units of u over the units of h. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ppoly_coef</td><td>Coefficients of polynomial </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_neglect</td><td>A negligibly small width for the purpose of cell reconstructions in the same units as h. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="P3M__functions_8F90_source.html#l00066">66</a> of file <a class="el" href="P3M__functions_8F90_source.html">P3M_functions.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span>    :: N<span class="comment"> !&lt; Number of cells</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:)</span>,   <span class="keywordtype">intent(in)</span>    :: h<span class="comment"> !&lt; cell widths (size N)</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:)</span>,   <span class="keywordtype">intent(in)</span>    :: u<span class="comment"> !&lt; cell averages (size N)</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> :: ppoly_E<span class="comment">  !&lt; Edge value of polynomial,</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">                                           !! with the same units as u.</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> :: ppoly_S<span class="comment">  !&lt; Edge slope of polynomial,</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">                                           !! in the units of u over the units of h.</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> :: ppoly_coef<span class="comment"> !&lt; Coefficients of polynomial</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="keywordtype">  real</span>,       <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: h_neglect<span class="comment"> !&lt; A negligibly small width for</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">                                           !! the purpose of cell reconstructions</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">                                           !! in the same units as h.</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keywordtype">integer</span> :: k            <span class="comment">! loop index</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordtype">integer</span> :: monotonic    <span class="comment">! boolean indicating whether the cubic is monotonic</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="keywordtype">  real</span>    :: u0_l, u0_r   <span class="comment">! edge values</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="keywordtype">  real</span>    :: u1_l, u1_r   <span class="comment">! edge slopes</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="keywordtype">  real</span>    :: u_l, u_c, u_r        <span class="comment">! left, center and right cell averages</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keywordtype">  real</span>    :: h_l, h_c, h_r        <span class="comment">! left, center and right cell widths</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="keywordtype">  real</span>    :: sigma_l, sigma_c, sigma_r    <span class="comment">! left, center and right</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                                          <span class="comment">! van Leer slopes</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keywordtype">  real</span>    :: slope        <span class="comment">! retained PLM slope</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="keywordtype">  real</span>    :: eps</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keywordtype">  real</span>    :: hNeglect</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  hneglect = hneglect_dflt ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(h_neglect)) hneglect = h_neglect</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  eps = 1e-10</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="comment">! 1. Bound edge values (boundary cells are assumed to be local extrema)</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keyword">call </span>bound_edge_values( n, h, u, ppoly_e, hneglect )</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">! 2. Systematically average discontinuous edge values</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keyword">call </span>average_discontinuous_edge_values( n, ppoly_e )</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">! 3. Loop on cells and do the following</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">!     (a) Build cubic curve</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">!     (b) Check if cubic curve is monotonic</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">!     (c) If not, monotonize cubic curve and rebuild it</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordflow">do</span> k = 1,n</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">! Get edge values, edge slopes and cell width</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    u0_l = ppoly_e(k,1)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    u0_r = ppoly_e(k,2)</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    u1_l = ppoly_s(k,1)</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    u1_r = ppoly_s(k,2)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">! Get cell widths and cell averages (boundary cells are assumed to</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">! be local extrema for the sake of slopes)</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    u_c = u(k)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    h_c = h(k)</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">if</span> ( k == 1 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      h_l = h(k)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      u_l = u(k)</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      h_l = h(k-1)</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      u_l = u(k-1)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">if</span> ( k == n ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      h_r = h(k)</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      u_r = u(k)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      h_r = h(k+1)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      u_r = u(k+1)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">! Compute limited slope</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    sigma_l = 2.0 * ( u_c - u_l ) / ( h_c + hneglect )</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    sigma_c = 2.0 * ( u_r - u_l ) / ( h_l + 2.0*h_c + h_r + hneglect )</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    sigma_r = 2.0 * ( u_r - u_c ) / ( h_c + hneglect )</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">if</span> ( (sigma_l * sigma_r) &gt; 0.0 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      slope = sign( min(abs(sigma_l),abs(sigma_c),abs(sigma_r)), sigma_c )</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      slope = 0.0</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">! If the slopes are close to zero in machine precision and in absolute</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">! value, we set the slope to zero. This prevents asymmetric representation</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">! near extrema.  These expressions are both nondimensional.</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">if</span> ( abs(u1_l*h_c) &lt; eps ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      u1_l = 0.0</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">if</span> ( abs(u1_r*h_c) &lt; eps ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      u1_r = 0.0</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">! The edge slopes are limited from above by the respective</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">! one-sided slopes</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> ( abs(u1_l) &gt; abs(sigma_l) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      u1_l = sigma_l</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">if</span> ( abs(u1_r) &gt; abs(sigma_r) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      u1_r = sigma_r</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">! Build cubic interpolant (compute the coefficients)</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keyword">call </span>build_cubic_interpolant( h, k, ppoly_e, ppoly_s, ppoly_coef )</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">! Check whether cubic is monotonic</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    monotonic = is_cubic_monotonic( ppoly_coef, k )</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">! If cubic is not monotonic, monotonize it by modifiying the</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">! edge slopes, store the new edge slopes and recompute the</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">! cubic coefficients</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">if</span> ( monotonic == 0 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="keyword">call </span>monotonize_cubic( h_c, u0_l, u0_r, sigma_l, sigma_r, slope, u1_l, u1_r )</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">! Store edge slopes</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    ppoly_s(k,1) = u1_l</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    ppoly_s(k,2) = u1_r</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">! Recompute coefficients of cubic</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keyword">call </span>build_cubic_interpolant( h, k, ppoly_e, ppoly_s, ppoly_coef )</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="keywordflow">  enddo</span> <span class="comment">! loop on cells</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="regrid__edge__values_8F90_source.html#l00144">regrid_edge_values::average_discontinuous_edge_values()</a>, <a class="el" href="regrid__edge__values_8F90_source.html#l00048">regrid_edge_values::bound_edge_values()</a>, <a class="el" href="P3M__functions_8F90_source.html#l00363">build_cubic_interpolant()</a>, <a class="el" href="P3M__functions_8F90_source.html#l00013">hneglect_dflt</a>, <a class="el" href="P3M__functions_8F90_source.html#l00407">is_cubic_monotonic()</a>, and <a class="el" href="P3M__functions_8F90_source.html#l00490">monotonize_cubic()</a>.</p>

<p class="reference">Referenced by <a class="el" href="P3M__functions_8F90_source.html#l00030">p3m_interpolation()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacep3m__functions_ab31ae8429b3676f925ae61510d7f047a_cgraph.svg" width="398" height="330"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacep3m__functions_ab31ae8429b3676f925ae61510d7f047a_icgraph.svg" width="100%" height="437"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aedfe0a0f65453ca61b90d4c601747c90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aedfe0a0f65453ca61b90d4c601747c90">&#9670;&nbsp;</a></span>hneglect_dflt</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real, parameter p3m_functions::hneglect_dflt = 1.E-30</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Default value of a negligible cell thickness. </p>

<p class="definition">Definition at line <a class="el" href="P3M__functions_8F90_source.html#l00013">13</a> of file <a class="el" href="P3M__functions_8F90_source.html">P3M_functions.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keywordtype">real</span>, <span class="keywordtype">parameter</span> :: hNeglect_dflt = 1.e-30 <span class="comment">!&lt; Default value of a negligible cell thickness</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="P3M__functions_8F90_source.html#l00206">p3m_boundary_extrapolation()</a>, and <a class="el" href="P3M__functions_8F90_source.html#l00066">p3m_limiter()</a>.</p>

</div>
</div>
<a id="abdb3a0dd6c75e81bbcb5f5c982c31e7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abdb3a0dd6c75e81bbcb5f5c982c31e7b">&#9670;&nbsp;</a></span>hneglect_edge_dflt</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real, parameter p3m_functions::hneglect_edge_dflt = 1.E-10</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Default value of a negligible edge thickness. </p>

<p class="definition">Definition at line <a class="el" href="P3M__functions_8F90_source.html#l00014">14</a> of file <a class="el" href="P3M__functions_8F90_source.html">P3M_functions.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keywordtype">real</span>, <span class="keywordtype">parameter</span> :: hNeglect_edge_dflt = 1.e-10 <span class="comment">!&lt; Default value of a negligible edge thickness</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="P3M__functions_8F90_source.html#l00206">p3m_boundary_extrapolation()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacep3m__functions.html">p3m_functions</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
