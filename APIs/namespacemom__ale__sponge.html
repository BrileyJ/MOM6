<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_ale_sponge Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespacemom__ale__sponge.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">mom_ale_sponge Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This module contains the routines used to apply sponge layers when using the ALE mode. </p>
<p>Applying sponges requires the following:</p><ol type="1">
<li>initialize_ALE_sponge</li>
<li>set_up_ALE_sponge_field (tracers) and set_up_ALE_sponge_vel_field (vel)</li>
<li>apply_ALE_sponge</li>
<li>init_ALE_sponge_diags (not being used for now)</li>
<li>ALE_sponge_end (not being used for now) </li>
</ol>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__ale__sponge_1_1ale__sponge__cs.html">ale_sponge_cs</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">ALE sponge control structure.  <a href="structmom__ale__sponge_1_1ale__sponge__cs.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">interface &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interfacemom__ale__sponge_1_1initialize__ale__sponge.html">initialize_ale_sponge</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ddetermine the number of points which are within sponges in this computational domain.  <a href="interfacemom__ale__sponge_1_1initialize__ale__sponge.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__ale__sponge_1_1p2d.html">p2d</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A structure for creating arrays of pointers to 2D arrays with extra gridding information.  <a href="structmom__ale__sponge_1_1p2d.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__ale__sponge_1_1p3d.html">p3d</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A structure for creating arrays of pointers to 3D arrays with extra gridding information.  <a href="structmom__ale__sponge_1_1p3d.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">interface &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interfacemom__ale__sponge_1_1set__up__ale__sponge__field.html">set_up_ale_sponge_field</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store the reference profile at h points for a variable.  <a href="interfacemom__ale__sponge_1_1set__up__ale__sponge__field.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">interface &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interfacemom__ale__sponge_1_1set__up__ale__sponge__vel__field.html">set_up_ale_sponge_vel_field</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine stores the reference profile at u and v points for a vector.  <a href="interfacemom__ale__sponge_1_1set__up__ale__sponge__vel__field.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a15129d167423dc162d22ef7cf4742651"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ale__sponge.html#a15129d167423dc162d22ef7cf4742651">initialize_ale_sponge_fixed</a> (Iresttime, G, param_file, CS, data_h, nz_data)</td></tr>
<tr class="memdesc:a15129d167423dc162d22ef7cf4742651"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine determines the number of points which are within sponges in this computational domain. Only points that have positive values of Iresttime and which mask2dT indicates are ocean points are included in the sponges. It also stores the target interface heights.  <a href="namespacemom__ale__sponge.html#a15129d167423dc162d22ef7cf4742651">More...</a><br /></td></tr>
<tr class="separator:a15129d167423dc162d22ef7cf4742651"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30b98598d25129c9fbb6e7c4b3480e7a"><td class="memItemLeft" align="right" valign="top">integer function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ale__sponge.html#a30b98598d25129c9fbb6e7c4b3480e7a">get_ale_sponge_nz_data</a> (CS)</td></tr>
<tr class="memdesc:a30b98598d25129c9fbb6e7c4b3480e7a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the number of layers in the data with a fixed ALE sponge, or 0 if there are no sponge columns on this PE.  <a href="namespacemom__ale__sponge.html#a30b98598d25129c9fbb6e7c4b3480e7a">More...</a><br /></td></tr>
<tr class="separator:a30b98598d25129c9fbb6e7c4b3480e7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56eb18da6c1d40f6abb544e5b7114293"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ale__sponge.html#a56eb18da6c1d40f6abb544e5b7114293">get_ale_sponge_thicknesses</a> (G, data_h, sponge_mask, CS)</td></tr>
<tr class="memdesc:a56eb18da6c1d40f6abb544e5b7114293"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the thicknesses used for the data with a fixed ALE sponge.  <a href="namespacemom__ale__sponge.html#a56eb18da6c1d40f6abb544e5b7114293">More...</a><br /></td></tr>
<tr class="separator:a56eb18da6c1d40f6abb544e5b7114293"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0febb96fb2fd40a72580d078ca023098"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ale__sponge.html#a0febb96fb2fd40a72580d078ca023098">initialize_ale_sponge_varying</a> (Iresttime, G, param_file, CS)</td></tr>
<tr class="memdesc:a0febb96fb2fd40a72580d078ca023098"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine determines the number of points which are to be restoref in the computational domain. Only points that have positive values of Iresttime and which mask2dT indicates are ocean points are included in the sponges.  <a href="namespacemom__ale__sponge.html#a0febb96fb2fd40a72580d078ca023098">More...</a><br /></td></tr>
<tr class="separator:a0febb96fb2fd40a72580d078ca023098"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed1ab3e7a8063222f1c9b0d3d2336cbe"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ale__sponge.html#aed1ab3e7a8063222f1c9b0d3d2336cbe">init_ale_sponge_diags</a> (Time, G, diag, CS)</td></tr>
<tr class="memdesc:aed1ab3e7a8063222f1c9b0d3d2336cbe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize diagnostics for the ALE_sponge module.  <a href="namespacemom__ale__sponge.html#aed1ab3e7a8063222f1c9b0d3d2336cbe">More...</a><br /></td></tr>
<tr class="separator:aed1ab3e7a8063222f1c9b0d3d2336cbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b00598b2cf45b865f56515ed5d2ed0a"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ale__sponge.html#a7b00598b2cf45b865f56515ed5d2ed0a">set_up_ale_sponge_field_fixed</a> (sp_val, G, f_ptr, CS)</td></tr>
<tr class="memdesc:a7b00598b2cf45b865f56515ed5d2ed0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine stores the reference profile at h points for the variable whose address is given by f_ptr.  <a href="namespacemom__ale__sponge.html#a7b00598b2cf45b865f56515ed5d2ed0a">More...</a><br /></td></tr>
<tr class="separator:a7b00598b2cf45b865f56515ed5d2ed0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5222905f5cfddd07b77e05428e88dd85"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ale__sponge.html#a5222905f5cfddd07b77e05428e88dd85">set_up_ale_sponge_field_varying</a> (filename, fieldname, Time, G, GV, US, f_ptr, CS)</td></tr>
<tr class="memdesc:a5222905f5cfddd07b77e05428e88dd85"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine stores the reference profile at h points for the variable whose address is given by filename and fieldname.  <a href="namespacemom__ale__sponge.html#a5222905f5cfddd07b77e05428e88dd85">More...</a><br /></td></tr>
<tr class="separator:a5222905f5cfddd07b77e05428e88dd85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6eb21c5a149d573ba0d67fdb3a932115"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ale__sponge.html#a6eb21c5a149d573ba0d67fdb3a932115">set_up_ale_sponge_vel_field_fixed</a> (u_val, v_val, G, u_ptr, v_ptr, CS)</td></tr>
<tr class="memdesc:a6eb21c5a149d573ba0d67fdb3a932115"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine stores the reference profile at u and v points for the variable whose address is given by u_ptr and v_ptr.  <a href="namespacemom__ale__sponge.html#a6eb21c5a149d573ba0d67fdb3a932115">More...</a><br /></td></tr>
<tr class="separator:a6eb21c5a149d573ba0d67fdb3a932115"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a551051d11b239eeef807fb88ab31aba6"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ale__sponge.html#a551051d11b239eeef807fb88ab31aba6">set_up_ale_sponge_vel_field_varying</a> (filename_u, fieldname_u, filename_v, fieldname_v, Time, G, US, CS, u_ptr, v_ptr)</td></tr>
<tr class="memdesc:a551051d11b239eeef807fb88ab31aba6"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine stores the reference profile at uand v points for the variable whose address is given by u_ptr and v_ptr.  <a href="namespacemom__ale__sponge.html#a551051d11b239eeef807fb88ab31aba6">More...</a><br /></td></tr>
<tr class="separator:a551051d11b239eeef807fb88ab31aba6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f297a8680a56b92ad1ac4e09f375d05"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ale__sponge.html#a1f297a8680a56b92ad1ac4e09f375d05">apply_ale_sponge</a> (h, dt, G, GV, US, CS, Time)</td></tr>
<tr class="memdesc:a1f297a8680a56b92ad1ac4e09f375d05"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine applies damping to the layers thicknesses, temp, salt and a variety of tracers for every column where there is damping.  <a href="namespacemom__ale__sponge.html#a1f297a8680a56b92ad1ac4e09f375d05">More...</a><br /></td></tr>
<tr class="separator:a1f297a8680a56b92ad1ac4e09f375d05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada4339e461d4b916fc4585ed6fa1482c"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ale__sponge.html#ada4339e461d4b916fc4585ed6fa1482c">ale_sponge_end</a> (CS)</td></tr>
<tr class="memdesc:ada4339e461d4b916fc4585ed6fa1482c"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine deallocates any memory associated with the ALE_sponge module.  <a href="namespacemom__ale__sponge.html#ada4339e461d4b916fc4585ed6fa1482c">More...</a><br /></td></tr>
<tr class="separator:ada4339e461d4b916fc4585ed6fa1482c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ada4339e461d4b916fc4585ed6fa1482c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada4339e461d4b916fc4585ed6fa1482c">&#9670;&nbsp;</a></span>ale_sponge_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_ale_sponge::ale_sponge_end </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__ale__sponge_1_1ale__sponge__cs.html">ale_sponge_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine deallocates any memory associated with the ALE_sponge module. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cs</td><td>A pointer to the control structure that is set by a previous call to initialize_sponge. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00970">970</a> of file <a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keywordtype">type</span>(ALE_sponge_CS), <span class="keywordtype">pointer</span> :: CS<span class="comment"> !&lt; A pointer to the control structure that is</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment">                                     !! set by a previous call to initialize_sponge.</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160; </div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="keywordtype">integer</span> :: m</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160; </div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%col_i)) <span class="keyword">deallocate</span>(cs%col_i)</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%col_i_u)) <span class="keyword">deallocate</span>(cs%col_i_u)</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%col_i_v)) <span class="keyword">deallocate</span>(cs%col_i_v)</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%col_j)) <span class="keyword">deallocate</span>(cs%col_j)</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%col_j_u)) <span class="keyword">deallocate</span>(cs%col_j_u)</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%col_j_v)) <span class="keyword">deallocate</span>(cs%col_j_v)</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160; </div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%Iresttime_col)) <span class="keyword">deallocate</span>(cs%Iresttime_col)</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%Iresttime_col_u)) <span class="keyword">deallocate</span>(cs%Iresttime_col_u)</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%Iresttime_col_v)) <span class="keyword">deallocate</span>(cs%Iresttime_col_v)</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160; </div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="keywordflow">do</span> m=1,cs%fldno</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%Ref_val(cs%fldno)%p)) <span class="keyword">deallocate</span>(cs%Ref_val(cs%fldno)%p)</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160; </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="keyword">deallocate</span>(cs)</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="a1f297a8680a56b92ad1ac4e09f375d05"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f297a8680a56b92ad1ac4e09f375d05">&#9670;&nbsp;</a></span>apply_ale_sponge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_ale_sponge::apply_ale_sponge </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ale__sponge_1_1ale__sponge__cs.html">ale_sponge_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in), optional&#160;</td>
          <td class="paramname"><em>Time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine applies damping to the layers thicknesses, temp, salt and a variety of tracers for every column where there is damping. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>The ocean's grid structure (in). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Layer thickness [H ~&gt; m or kg m-2] (in) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>The amount of time covered by this call [T ~&gt; s]. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>A pointer to the control structure for this module that is set by a previous call to initialize_sponge (in). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>The current model date </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00756">756</a> of file <a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),     <span class="keywordtype">intent(inout)</span> :: G<span class="comment">  !&lt; The ocean&#39;s grid structure (in).</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type),   <span class="keywordtype">intent(in)</span>    :: GV<span class="comment"> !&lt; ocean vertical grid structure</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),     <span class="keywordtype">intent(in)</span>    :: US<span class="comment"> !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                             <span class="keywordtype">intent(inout)</span> :: h<span class="comment">  !&lt; Layer thickness [H ~&gt; m or kg m-2] (in)</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="keywordtype">  real</span>,                      <span class="keywordtype">intent(in)</span>    :: dt<span class="comment"> !&lt; The amount of time covered by this call [T ~&gt; s].</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <span class="keywordtype">type</span>(ALE_sponge_CS),       <span class="keywordtype">pointer</span>       :: CS<span class="comment"> !&lt; A pointer to the control structure for this module</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">                                                 !! that is set by a previous call to initialize_sponge (in).</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="keywordtype">type</span>(time_type), <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: Time<span class="comment"> !&lt; The current model date</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="keywordtype">  real</span> :: damp                                  <span class="comment">! The timestep times the local damping coefficient [nondim].</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="keywordtype">  real</span> :: I1pdamp                               <span class="comment">! I1pdamp is 1/(1 + damp). [nondim].</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="keywordtype">  real</span> :: m_to_Z                                <span class="comment">! A unit conversion factor from m to Z.</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span> :: tmp_val2   <span class="comment">! data values on the original grid</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZK_(G))</span> :: tmp_val1          <span class="comment">! data values remapped to model grid</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="keywordtype">  real</span> :: hu(SZIB_(G), SZJ_(G), SZK_(G))        <span class="comment">! A temporary array for h at u pts</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="keywordtype">  real</span> :: hv(SZI_(G), SZJB_(G), SZK_(G))        <span class="comment">! A temporary array for h at v pts</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: sp_val <span class="comment">! A temporary array for fields</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: mask_z <span class="comment">! A temporary array for field mask at h pts</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: hsrc       <span class="comment">! Source thicknesses [Z ~&gt; m].</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="comment">! Local variables for ALE remapping</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: tmpT1d</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="keywordtype">integer</span> :: c, m, nkmb, i, j, k, is, ie, js, je, nz, nz_data</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="keywordtype">integer</span> :: col, total_sponge_cols</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">target</span> :: z_in, z_edges_in</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="keywordtype">  real</span> :: missing_value</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="keywordtype">  real</span> :: h_neglect, h_neglect_edge</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="keywordtype">  real</span> :: zTopOfCell, zBottomOfCell <span class="comment">! Heights [Z ~&gt; m].</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <span class="keywordtype">integer</span> :: nPoints</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160; </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="keywordflow">if</span> (gv%Boussinesq) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    h_neglect = gv%m_to_H*1.0e-30 ; h_neglect_edge = gv%m_to_H*1.0e-10</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    h_neglect = gv%kg_m2_to_H*1.0e-30 ; h_neglect_edge = gv%kg_m2_to_H*1.0e-10</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160; </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="keywordflow">if</span> (cs%time_varying_sponges) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="keywordflow">if</span> (.not. <span class="keyword">present</span>(time)) &amp;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;apply_ALE_sponge: No time information provided&quot;</span>)</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="keywordflow">do</span> m=1,cs%fldno</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;       nz_data = cs%Ref_val(m)%nz_data</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;       <span class="keyword">allocate</span>(sp_val(g%isd:g%ied,g%jsd:g%jed,1:nz_data))</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;       <span class="keyword">allocate</span>(mask_z(g%isd:g%ied,g%jsd:g%jed,1:nz_data))</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;       sp_val(:,:,:)=0.0</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;       mask_z(:,:,:)=0.0</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;       <span class="keyword">call </span>horiz_interp_and_extrap_tracer(cs%Ref_val(m)%id,time, 1.0,g,sp_val,mask_z,z_in,z_edges_in, &amp;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                      missing_value,.true., .false.,.false.,spongeongrid=cs%SpongeDataOngrid, m_to_z=us%m_to_Z)</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;       <span class="keyword">allocate</span>( hsrc(nz_data) )</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;       <span class="keyword">allocate</span>( tmpt1d(nz_data) )</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;       <span class="keywordflow">do</span> c=1,cs%num_col</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;          i = cs%col_i(c) ; j = cs%col_j(c)</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;          cs%Ref_val(m)%p(1:nz_data,c) = sp_val(i,j,1:nz_data)</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;          <span class="comment">! Build the source grid</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;          ztopofcell = 0. ; zbottomofcell = 0. ; npoints = 0; hsrc(:) = 0.0; tmpt1d(:) = -99.9</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;          <span class="keywordflow">do</span> k=1,nz_data</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;             <span class="keywordflow">if</span> (mask_z(cs%col_i(c),cs%col_j(c),k) == 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                zbottomofcell = -min( z_edges_in(k+1), g%bathyT(cs%col_i(c),cs%col_j(c)) )</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                tmpt1d(k) = sp_val(cs%col_i(c),cs%col_j(c),k)</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;             <span class="keywordflow">elseif</span> (k&gt;1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                zbottomofcell = -g%bathyT(cs%col_i(c),cs%col_j(c))</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                tmpt1d(k) = tmpt1d(k-1)</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;             <span class="keywordflow">else</span> <span class="comment">! This next block should only ever be reached over land</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                tmpt1d(k) = -99.9</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;             hsrc(k) = ztopofcell - zbottomofcell</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;             <span class="keywordflow">if</span> (hsrc(k)&gt;0.) npoints = npoints + 1</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;             ztopofcell = zbottomofcell <span class="comment">! Bottom becomes top for next value of k</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;          <span class="comment">! In case data is deeper than model</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;          hsrc(nz_data) = hsrc(nz_data) + ( ztopofcell + g%bathyT(cs%col_i(c),cs%col_j(c)) )</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;          cs%Ref_val(cs%fldno)%h(1:nz_data,c) = gv%Z_to_H*hsrc(1:nz_data)</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;          cs%Ref_val(cs%fldno)%p(1:nz_data,c) = tmpt1d(1:nz_data)</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;          <span class="keywordflow">do</span> k=2,nz_data</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;             <span class="comment">!          if (mask_z(i,j,k)==0.) &amp;</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;             <span class="keywordflow">if</span> (cs%Ref_val(m)%h(k,c) &lt;= 0.001*gv%m_to_H) &amp;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                  <span class="comment">! some confusion here about why the masks are not correct returning from horiz_interp</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                  <span class="comment">! reverting to using a minimum thickness criteria</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                  cs%Ref_val(m)%p(k,c) = cs%Ref_val(m)%p(k-1,c)</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      <span class="keyword">deallocate</span>(sp_val, mask_z, hsrc, tmpt1d)</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    nz_data = cs%nz_data</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; </div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keyword">allocate</span>(tmp_val2(nz_data))</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="keywordflow">do</span> m=1,cs%fldno</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="keywordflow">do</span> c=1,cs%num_col</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">! c is an index for the next 3 lines but a multiplier for the rest of the loop</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">! Therefore we use c as per C code and increment the index where necessary.</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      i = cs%col_i(c) ; j = cs%col_j(c)</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      damp = dt * cs%Iresttime_col(c)</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      i1pdamp = 1.0 / (1.0 + damp)</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      tmp_val2(1:nz_data) = cs%Ref_val(m)%p(1:nz_data,c)</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <span class="keywordflow">if</span> (cs%time_varying_sponges) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keyword">call </span>remapping_core_h(cs%remap_cs, nz_data, cs%Ref_val(m)%h(1:nz_data,c), tmp_val2, &amp;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                              cs%nz, h(i,j,:), tmp_val1, h_neglect, h_neglect_edge)</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <span class="keyword">call </span>remapping_core_h(cs%remap_cs,nz_data, cs%Ref_h%p(1:nz_data,c), tmp_val2, &amp;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                              cs%nz, h(i,j,:), tmp_val1, h_neglect, h_neglect_edge)</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      <span class="comment">!Backward Euler method</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      cs%var(m)%p(i,j,1:cs%nz) = i1pdamp * (cs%var(m)%p(i,j,1:cs%nz) + tmp_val1 * damp)</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="comment">! for debugging</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="comment">!c=CS%num_col</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="comment">!do m=1,CS%fldno</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="comment">!   write(*,*) &#39;APPLY SPONGE,m,CS%Ref_h(:,c),h(i,j,:),tmp_val2,tmp_val1&#39;,&amp;</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="comment">!               m,CS%Ref_h(:,c),h(i,j,:),tmp_val2,tmp_val1</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="comment">!enddo</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160; </div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="keywordflow">if</span> (cs%sponge_uv) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="comment">! u points</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="keywordflow">do</span> j=cs%jsc,cs%jec; <span class="keywordflow">do</span> i=cs%iscB,cs%iecB; <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      hu(i,j,k) = 0.5 * (h(i,j,k) + h(i+1,j,k))</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordflow">if</span> (cs%time_varying_sponges) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      <span class="keywordflow">if</span> (.not. <span class="keyword">present</span>(time)) &amp;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;         <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;apply_ALE_sponge: No time information provided&quot;</span>)</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160; </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      nz_data = cs%Ref_val_u%nz_data</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      <span class="keyword">allocate</span>(sp_val(g%isdB:g%iedB,g%jsd:g%jed,1:nz_data))</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      <span class="keyword">allocate</span>(mask_z(g%isdB:g%iedB,g%jsd:g%jed,1:nz_data))</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      <span class="comment">! Interpolate from the external horizontal grid and in time</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <span class="keyword">call </span>horiz_interp_and_extrap_tracer(cs%Ref_val_u%id,time, 1.0,g,sp_val,mask_z,z_in,z_edges_in, &amp;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                                          missing_value, .true., .false., .false., m_to_z=us%m_to_Z)</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment">!     call pass_var(sp_val,G%Domain)</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment">!     call pass_var(mask_z,G%Domain)</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <span class="keywordflow">do</span> c=1,cs%num_col</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="comment">! c is an index for the next 3 lines but a multiplier for the rest of the loop</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="comment">! Therefore we use c as per C code and increment the index where necessary.</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        i = cs%col_i(c) ; j = cs%col_j(c)</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        cs%Ref_val_u%p(1:nz_data,c) = sp_val(i,j,1:nz_data)</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <span class="keyword">deallocate</span> (sp_val, mask_z)</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160; </div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      nz_data = cs%Ref_val_v%nz_data</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="keyword">allocate</span>(sp_val(g%isd:g%ied,g%jsdB:g%jedB,1:nz_data))</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <span class="keyword">allocate</span>(mask_z(g%isd:g%ied,g%jsdB:g%jedB,1:nz_data))</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <span class="comment">! Interpolate from the external horizontal grid and in time</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <span class="keyword">call </span>horiz_interp_and_extrap_tracer(cs%Ref_val_v%id,time, 1.0,g,sp_val,mask_z,z_in,z_edges_in, &amp;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                                          missing_value, .true., .false., .false., m_to_z=us%m_to_Z)</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160; </div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment">!     call pass_var(sp_val,G%Domain)</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment">!     call pass_var(mask_z,G%Domain)</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160; </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      <span class="keywordflow">do</span> c=1,cs%num_col</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="comment">! c is an index for the next 3 lines but a multiplier for the rest of the loop</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="comment">! Therefore we use c as per C code and increment the index where necessary.</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        i = cs%col_i(c) ; j = cs%col_j(c)</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        cs%Ref_val_v%p(1:nz_data,c) = sp_val(i,j,1:nz_data)</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160; </div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <span class="keyword">deallocate</span> (sp_val, mask_z)</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160; </div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      nz_data = cs%nz_data</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160; </div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordflow">do</span> c=1,cs%num_col_u</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      i = cs%col_i_u(c) ; j = cs%col_j_u(c)</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      damp = dt * cs%Iresttime_col_u(c)</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      i1pdamp = 1.0 / (1.0 + damp)</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <span class="keywordflow">if</span> (cs%time_varying_sponges) nz_data = cs%Ref_val(m)%nz_data</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      tmp_val2(1:nz_data) = cs%Ref_val_u%p(1:nz_data,c)</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <span class="keywordflow">if</span> (cs%time_varying_sponges) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="keyword">call </span>remapping_core_h(cs%remap_cs, nz_data, cs%Ref_val_u%h(:,c), tmp_val2, &amp;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                 cs%nz, hu(i,j,:), tmp_val1, h_neglect, h_neglect_edge)</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="keyword">call </span>remapping_core_h(cs%remap_cs, nz_data, cs%Ref_hu%p(:,c), tmp_val2, &amp;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                 cs%nz, hu(i,j,:), tmp_val1, h_neglect, h_neglect_edge)</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      <span class="comment">!Backward Euler method</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      cs%var_u%p(i,j,:) = i1pdamp * (cs%var_u%p(i,j,:) + tmp_val1 * damp)</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160; </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="comment">! v points</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordflow">do</span> j=cs%jscB,cs%jecB; <span class="keywordflow">do</span> i=cs%isc,cs%iec; <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      hv(i,j,k) = 0.5 * (h(i,j,k) + h(i,j+1,k))</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160; </div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keywordflow">do</span> c=1,cs%num_col_v</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      i = cs%col_i_v(c) ; j = cs%col_j_v(c)</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      damp = dt * cs%Iresttime_col_v(c)</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      i1pdamp = 1.0 / (1.0 + damp)</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      tmp_val2(1:nz_data) = cs%Ref_val_v%p(1:nz_data,c)</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      <span class="keywordflow">if</span> (cs%time_varying_sponges) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="keyword">call </span>remapping_core_h(cs%remap_cs, cs%nz_data, cs%Ref_val_v%h(:,c), tmp_val2, &amp;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                 cs%nz, hv(i,j,:), tmp_val1, h_neglect, h_neglect_edge)</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="keyword">call </span>remapping_core_h(cs%remap_cs, cs%nz_data, cs%Ref_hv%p(:,c), tmp_val2, &amp;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                 cs%nz, hv(i,j,:), tmp_val1, h_neglect, h_neglect_edge)</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;      <span class="comment">!Backward Euler method</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      cs%var_v%p(i,j,:) = i1pdamp * (cs%var_v%p(i,j,:) + tmp_val1 * damp)</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160; </div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="keyword">deallocate</span>(tmp_val2)</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l00188">mom_remapping::remapping_core_h()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__diabatic__driver_8F90_source.html#l01229">mom_diabatic_driver::diabatic_ale()</a>, and <a class="el" href="MOM__diabatic__driver_8F90_source.html#l00446">mom_diabatic_driver::diabatic_ale_legacy()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__ale__sponge_a1f297a8680a56b92ad1ac4e09f375d05_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__ale__sponge_a1f297a8680a56b92ad1ac4e09f375d05_icgraph.svg" width="556" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a30b98598d25129c9fbb6e7c4b3480e7a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30b98598d25129c9fbb6e7c4b3480e7a">&#9670;&nbsp;</a></span>get_ale_sponge_nz_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public mom_ale_sponge::get_ale_sponge_nz_data </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__ale__sponge_1_1ale__sponge__cs.html">ale_sponge_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the number of layers in the data with a fixed ALE sponge, or 0 if there are no sponge columns on this PE. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cs</td><td>A pointer that is set to point to the control structure for the ALE_sponge module. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of layers in the fixed sponge data. </dd></dl>

<p class="definition">Definition at line <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00326">326</a> of file <a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordtype">type</span>(ALE_sponge_CS),   <span class="keywordtype">pointer</span>       :: CS<span class="comment"> !&lt; A pointer that is set to point to the control</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">                                             !! structure for the ALE_sponge module.</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordtype">integer</span> :: get_ALE_sponge_nz_data<span class="comment">  !&lt; The number of layers in the fixed sponge data.</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160; </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    get_ale_sponge_nz_data = cs%nz_data</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    get_ale_sponge_nz_data = 0</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="keywordflow">  endif</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="RGC__tracer_8F90_source.html#l00156">rgc_tracer::initialize_rgc_tracer()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__ale__sponge_a30b98598d25129c9fbb6e7c4b3480e7a_icgraph.svg" width="344" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a56eb18da6c1d40f6abb544e5b7114293"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56eb18da6c1d40f6abb544e5b7114293">&#9670;&nbsp;</a></span>get_ale_sponge_thicknesses()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_ale_sponge::get_ale_sponge_thicknesses </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:,:), intent(inout), allocatable&#160;</td>
          <td class="paramname"><em>data_h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, dimension(szi_(g),szj_(g)), intent(out)&#160;</td>
          <td class="paramname"><em>sponge_mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ale__sponge_1_1ale__sponge__cs.html">ale_sponge_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the thicknesses used for the data with a fixed ALE sponge. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure (in). </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">data_h</td><td>The thicknesses of the sponge input layers [H ~&gt; m or kg m-2]. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">sponge_mask</td><td>A logical mask that is true where </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>A pointer that is set to point to the control structure for the ALE_sponge module. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00339">339</a> of file <a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type), <span class="keywordtype">intent(in)</span>    :: G<span class="comment"> !&lt; The ocean&#39;s grid structure (in).</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span>, &amp;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                         <span class="keywordtype">intent(inout)</span> :: data_h<span class="comment"> !&lt; The thicknesses of the sponge input layers [H ~&gt; m or kg m-2].</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>, &amp;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                         <span class="keywordtype">intent(out)</span>   :: sponge_mask<span class="comment"> !&lt; A logical mask that is true where</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">                                                 !! sponges are being applied.</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordtype">type</span>(ALE_sponge_CS),   <span class="keywordtype">pointer</span>       :: CS<span class="comment"> !&lt; A pointer that is set to point to the control</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">                                             !! structure for the ALE_sponge module.</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keywordtype">integer</span> :: c, i, j, k</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(data_h)) <span class="keyword">call </span>mom_error(fatal, &amp;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="stringliteral">&quot;get_ALE_sponge_thicknesses called with an allocated data_h.&quot;</span>)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">! There are no sponge points on this PE.</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keyword">allocate</span>(data_h(g%isd:g%ied,g%jsd:g%jed,1)) ; data_h(:,:,:) = -1.0</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    sponge_mask(:,:) = .false.</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keyword">allocate</span>(data_h(g%isd:g%ied,g%jsd:g%jed,cs%nz_data)) ; data_h(:,:,:) = -1.0</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  sponge_mask(:,:) = .false.</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordflow">do</span> c=1,cs%num_col</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    i = cs%col_i(c) ; j = cs%col_j(c)</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    sponge_mask(i,j) = .true.</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">do</span> k=1,cs%nz_data</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      data_h(i,j,k) = cs%Ref_h%p(k,c)</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__ale__sponge_a56eb18da6c1d40f6abb544e5b7114293_cgraph.svg" width="562" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aed1ab3e7a8063222f1c9b0d3d2336cbe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed1ab3e7a8063222f1c9b0d3d2336cbe">&#9670;&nbsp;</a></span>init_ale_sponge_diags()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_ale_sponge::init_ale_sponge_diags </td>
          <td>(</td>
          <td class="paramtype">type(time_type), intent(in), target&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diag_ctrl), intent(inout), target&#160;</td>
          <td class="paramname"><em>diag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ale__sponge_1_1ale__sponge__cs.html">ale_sponge_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize diagnostics for the ALE_sponge module. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>The current model time </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">diag</td><td>A structure that is used to regulate diagnostic output. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>ALE sponge control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00519">519</a> of file <a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keywordtype">type</span>(time_type), <span class="keywordtype">target</span>, <span class="keywordtype">intent(in)</span>    :: Time<span class="comment"> !&lt; The current model time</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),   <span class="keywordtype">intent(in)</span>    :: G<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl), <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: diag<span class="comment"> !&lt; A structure that is used to regulate diagnostic</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">                                                 !! output.</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keywordtype">type</span>(ALE_sponge_CS),     <span class="keywordtype">pointer</span>       :: CS<span class="comment">   !&lt; ALE sponge control structure</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  cs%diag =&gt; diag</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM_8F90_source.html#l01506">mom::initialize_mom()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__ale__sponge_aed1ab3e7a8063222f1c9b0d3d2336cbe_icgraph.svg" width="486" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a15129d167423dc162d22ef7cf4742651"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15129d167423dc162d22ef7cf4742651">&#9670;&nbsp;</a></span>initialize_ale_sponge_fixed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_ale_sponge::initialize_ale_sponge_fixed </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>Iresttime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ale__sponge_1_1ale__sponge__cs.html">ale_sponge_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),nz_data), intent(in)&#160;</td>
          <td class="paramname"><em>data_h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nz_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine determines the number of points which are within sponges in this computational domain. Only points that have positive values of Iresttime and which mask2dT indicates are ocean points are included in the sponges. It also stores the target interface heights. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nz_data</td><td>The total number of sponge input layers. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">iresttime</td><td>The inverse of the restoring time [s-1]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure indicating the open file to parse for model parameter values. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>A pointer that is set to point to the control structure for this module (in/out). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data_h</td><td>The thicknesses of the sponge input layers [H ~&gt; m or kg m-2]. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00141">141</a> of file <a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),            <span class="keywordtype">intent(in)</span> :: G<span class="comment"> !&lt; The ocean&#39;s grid structure.</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordtype">integer</span>,                          <span class="keywordtype">intent(in)</span> :: nz_data<span class="comment"> !&lt; The total number of sponge input layers.</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>, <span class="keywordtype">intent(in)</span> :: Iresttime<span class="comment"> !&lt; The inverse of the restoring time [s-1].</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordtype">type</span>(param_file_type),            <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; A structure indicating the open file</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">                                                             !! to parse for model parameter values.</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordtype">type</span>(ALE_sponge_CS),              <span class="keywordtype">pointer</span>    :: CS<span class="comment"> !&lt; A pointer that is set to point to the control</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">                                                     !! structure for this module (in/out).</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),nz_data)</span>, <span class="keywordtype">intent(in)</span> :: data_h<span class="comment"> !&lt; The thicknesses of the sponge</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">                                                     !! input layers [H ~&gt; m or kg m-2].</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;MOM_sponge&quot;</span>  <span class="comment">! This module&#39;s name.</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordtype">logical</span> :: use_sponge</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: data_hu<span class="comment"> !&lt; thickness at u points [H ~&gt; m or kg m-2]</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: data_hv<span class="comment"> !&lt; thickness at v points [H ~&gt; m or kg m-2]</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:)</span> :: Iresttime_u<span class="comment"> !&lt; inverse of the restoring time at u points [s-1]</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:)</span> :: Iresttime_v<span class="comment"> !&lt; inverse of the restoring time at v points [s-1]</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordtype">logical</span> :: bndExtrapolation = .true. <span class="comment">! If true, extrapolate boundaries</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, col, total_sponge_cols, total_sponge_cols_u, total_sponge_cols_v</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordtype">character(len=10)</span>  :: remapScheme</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;initialize_sponge called with an associated &quot;</span>// &amp;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                            <span class="stringliteral">&quot;control structure.&quot;</span>)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">! Set default, read and log parameters</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keyword">call </span>log_version(param_file, mdl, version, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE&quot;</span>, use_sponge, &amp;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                 <span class="stringliteral">&quot;If true, sponges may be applied anywhere in the domain. &quot;</span>//&amp;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                 <span class="stringliteral">&quot;The exact location and properties of those sponges are &quot;</span>//&amp;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                 <span class="stringliteral">&quot;specified from MOM_initialization.F90.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordflow">if</span> (.not.use_sponge) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keyword">allocate</span>(cs)</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE_UV&quot;</span>, cs%sponge_uv, &amp;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                 <span class="stringliteral">&quot;Apply sponges in u and v, in addition to tracers.&quot;</span>, &amp;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                 default=.false.)</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;REMAPPING_SCHEME&quot;</span>, remapscheme, &amp;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                 <span class="stringliteral">&quot;This sets the reconstruction scheme used &quot;</span>//&amp;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                 <span class="stringliteral">&quot; for vertical remapping for all variables.&quot;</span>, &amp;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                 default=<span class="stringliteral">&quot;PLM&quot;</span>, do_not_log=.true.)</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;BOUNDARY_EXTRAPOLATION&quot;</span>, bndextrapolation, &amp;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                 <span class="stringliteral">&quot;When defined, a proper high-order reconstruction &quot;</span>//&amp;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                 <span class="stringliteral">&quot;scheme is used within boundary cells rather &quot;</span>//&amp;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                 <span class="stringliteral">&quot;than PCM. E.g., if PPM is used for remapping, a &quot;</span>//&amp;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                 <span class="stringliteral">&quot;PPM reconstruction will also be used within boundary cells.&quot;</span>, &amp;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                 default=.false., do_not_log=.true.)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  cs%time_varying_sponges = .false.</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  cs%nz = g%ke</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  cs%isc = g%isc ; cs%iec = g%iec ; cs%jsc = g%jsc ; cs%jec = g%jec</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  cs%isd = g%isd ; cs%ied = g%ied ; cs%jsd = g%jsd ; cs%jed = g%jed</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  cs%iscB = g%iscB ; cs%iecB = g%iecB; cs%jscB = g%jscB ; cs%jecB = g%jecB</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="comment">! number of columns to be restored</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  cs%num_col = 0 ; cs%fldno = 0</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">do</span> j=g%jsc,g%jec ; <span class="keywordflow">do</span> i=g%isc,g%iec</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">if</span> ((iresttime(i,j)&gt;0.0) .and. (g%mask2dT(i,j)&gt;0)) &amp;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      cs%num_col = cs%num_col + 1</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordflow">if</span> (cs%num_col &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keyword">allocate</span>(cs%Iresttime_col(cs%num_col)) ; cs%Iresttime_col = 0.0</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keyword">allocate</span>(cs%col_i(cs%num_col))         ; cs%col_i = 0</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keyword">allocate</span>(cs%col_j(cs%num_col))         ; cs%col_j = 0</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">! pass indices, restoring time to the CS structure</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    col = 1</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">do</span> j=g%jsc,g%jec ; <span class="keywordflow">do</span> i=g%isc,g%iec</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordflow">if</span> ((iresttime(i,j)&gt;0.0) .and. (g%mask2dT(i,j)&gt;0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        cs%col_i(col) = i ; cs%col_j(col) = j</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        cs%Iresttime_col(col) = g%US%T_to_s*iresttime(i,j)</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        col = col +1</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">! same for total number of arbritary layers and correspondent data</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    cs%nz_data = nz_data</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keyword">allocate</span>(cs%Ref_h%p(cs%nz_data,cs%num_col))</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">do</span> col=1,cs%num_col ; <span class="keywordflow">do</span> k=1,cs%nz_data</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      cs%Ref_h%p(k,col) = data_h(cs%col_i(col),cs%col_j(col),k)</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  total_sponge_cols = cs%num_col</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keyword">call </span>sum_across_pes(total_sponge_cols)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">! Call the constructor for remapping control structure</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keyword">call </span>initialize_remapping(cs%remap_cs, remapscheme, boundary_extrapolation=bndextrapolation)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;!Total sponge columns at h points&quot;</span>, total_sponge_cols, &amp;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                 <span class="stringliteral">&quot;The total number of columns where sponges are applied at h points.&quot;</span>)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordflow">if</span> (cs%sponge_uv) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keyword">allocate</span>(data_hu(g%isdB:g%iedB,g%jsd:g%jed,nz_data)); data_hu(:,:,:)=0.0</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keyword">allocate</span>(data_hv(g%isd:g%ied,g%jsdB:g%jedB,nz_data)); data_hv(:,:,:)=0.0</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keyword">allocate</span>(iresttime_u(g%isdB:g%iedB,g%jsd:g%jed)); iresttime_u(:,:)=0.0</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keyword">allocate</span>(iresttime_v(g%isd:g%ied,g%jsdB:g%jedB)); iresttime_v(:,:)=0.0</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">! u points</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    cs%num_col_u = 0 ; <span class="comment">!CS%fldno_u = 0</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">do</span> j=cs%jsc,cs%jec; <span class="keywordflow">do</span> i=cs%iscB,cs%iecB</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;       data_hu(i,j,:) = 0.5 * (data_h(i,j,:) + data_h(i+1,j,:))</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;       iresttime_u(i,j) = 0.5 * (iresttime(i,j) + iresttime(i+1,j))</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;       <span class="keywordflow">if</span> ((iresttime_u(i,j)&gt;0.0) .and. (g%mask2dCu(i,j)&gt;0)) &amp;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;          cs%num_col_u = cs%num_col_u + 1</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">if</span> (cs%num_col_u &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;       <span class="keyword">allocate</span>(cs%Iresttime_col_u(cs%num_col_u)) ; cs%Iresttime_col_u = 0.0</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;       <span class="keyword">allocate</span>(cs%col_i_u(cs%num_col_u))         ; cs%col_i_u = 0</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;       <span class="keyword">allocate</span>(cs%col_j_u(cs%num_col_u))         ; cs%col_j_u = 0</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;       <span class="comment">! pass indices, restoring time to the CS structure</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;       col = 1</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;       <span class="keywordflow">do</span> j=cs%jsc,cs%jec ; <span class="keywordflow">do</span> i=cs%iscB,cs%iecB</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;         <span class="keywordflow">if</span> ((iresttime_u(i,j)&gt;0.0) .and. (g%mask2dCu(i,j)&gt;0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;           cs%col_i_u(col) = i ; cs%col_j_u(col) = j</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;           cs%Iresttime_col_u(col) = g%US%T_to_s*iresttime_u(i,j)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;           col = col +1</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="keywordflow">       enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;       <span class="comment">! same for total number of arbritary layers and correspondent data</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;       <span class="keyword">allocate</span>(cs%Ref_hu%p(cs%nz_data,cs%num_col_u))</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;       <span class="keywordflow">do</span> col=1,cs%num_col_u ; <span class="keywordflow">do</span> k=1,cs%nz_data</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;         cs%Ref_hu%p(k,col) = data_hu(cs%col_i_u(col),cs%col_j_u(col),k)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="keywordflow">       enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    total_sponge_cols_u = cs%num_col_u</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keyword">call </span>sum_across_pes(total_sponge_cols_u)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;!Total sponge columns at u points&quot;</span>, total_sponge_cols_u, &amp;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <span class="stringliteral">&quot;The total number of columns where sponges are applied at u points.&quot;</span>)</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">! v points</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    cs%num_col_v = 0 ; <span class="comment">!CS%fldno_v = 0</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">do</span> j=cs%jscB,cs%jecB; <span class="keywordflow">do</span> i=cs%isc,cs%iec</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      data_hv(i,j,:) = 0.5 * (data_h(i,j,:) + data_h(i,j+1,:))</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      iresttime_v(i,j) = 0.5 * (iresttime(i,j) + iresttime(i,j+1))</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keywordflow">if</span> ((iresttime_v(i,j)&gt;0.0) .and. (g%mask2dCv(i,j)&gt;0)) &amp;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        cs%num_col_v = cs%num_col_v + 1</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span> (cs%num_col_v &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keyword">allocate</span>(cs%Iresttime_col_v(cs%num_col_v)) ; cs%Iresttime_col_v = 0.0</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="keyword">allocate</span>(cs%col_i_v(cs%num_col_v))         ; cs%col_i_v = 0</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="keyword">allocate</span>(cs%col_j_v(cs%num_col_v))         ; cs%col_j_v = 0</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="comment">! pass indices, restoring time to the CS structure</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      col = 1</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="keywordflow">do</span> j=cs%jscB,cs%jecB ; <span class="keywordflow">do</span> i=cs%isc,cs%iec</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">if</span> ((iresttime_v(i,j)&gt;0.0) .and. (g%mask2dCv(i,j)&gt;0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;          cs%col_i_v(col) = i ; cs%col_j_v(col) = j</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;          cs%Iresttime_col_v(col) = g%US%T_to_s*iresttime_v(i,j)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;          col = col +1</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="comment">! same for total number of arbritary layers and correspondent data</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keyword">allocate</span>(cs%Ref_hv%p(cs%nz_data,cs%num_col_v))</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">do</span> col=1,cs%num_col_v ; <span class="keywordflow">do</span> k=1,cs%nz_data</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        cs%Ref_hv%p(k,col) = data_hv(cs%col_i_v(col),cs%col_j_v(col),k)</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    total_sponge_cols_v = cs%num_col_v</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keyword">call </span>sum_across_pes(total_sponge_cols_v)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;!Total sponge columns at v points&quot;</span>, total_sponge_cols_v, &amp;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                 <span class="stringliteral">&quot;The total number of columns where sponges are applied at v points.&quot;</span>)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l01547">mom_remapping::initialize_remapping()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__ale__sponge_a15129d167423dc162d22ef7cf4742651_cgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a0febb96fb2fd40a72580d078ca023098"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0febb96fb2fd40a72580d078ca023098">&#9670;&nbsp;</a></span>initialize_ale_sponge_varying()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_ale_sponge::initialize_ale_sponge_varying </td>
          <td>(</td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed), intent(in)&#160;</td>
          <td class="paramname"><em>Iresttime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ale__sponge_1_1ale__sponge__cs.html">ale_sponge_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This subroutine determines the number of points which are to be restoref in the computational domain. Only points that have positive values of Iresttime and which mask2dT indicates are ocean points are included in the sponges. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">iresttime</td><td>The inverse of the restoring time [s-1]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure indicating the open file to parse for model parameter values. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>A pointer that is set to point to the control structure for this module (in/out). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00376">376</a> of file <a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),            <span class="keywordtype">intent(in)</span> :: G<span class="comment"> !&lt; The ocean&#39;s grid structure.</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>, <span class="keywordtype">intent(in)</span> :: Iresttime<span class="comment"> !&lt; The inverse of the restoring time [s-1].</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordtype">type</span>(param_file_type),            <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; A structure indicating the open file to parse</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">                                                             !! for model parameter values.</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordtype">type</span>(ALE_sponge_CS),              <span class="keywordtype">pointer</span>    :: CS<span class="comment"> !&lt; A pointer that is set to point to the control</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">                                                     !! structure for this module (in/out).</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;MOM_sponge&quot;</span>  <span class="comment">! This module&#39;s name.</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordtype">logical</span> :: use_sponge</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:)</span> :: Iresttime_u<span class="comment"> !&lt; inverse of the restoring time at u points [s-1]</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:)</span> :: Iresttime_v<span class="comment"> !&lt; inverse of the restoring time at v points [s-1]</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordtype">logical</span> :: bndExtrapolation = .true. <span class="comment">! If true, extrapolate boundaries</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordtype">logical</span> :: spongeDataOngrid = .false.</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, col, total_sponge_cols, total_sponge_cols_u, total_sponge_cols_v</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordtype">character(len=10)</span>  :: remapScheme</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;initialize_sponge called with an associated &quot;</span>// &amp;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                            <span class="stringliteral">&quot;control structure.&quot;</span>)</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">! Set default, read and log parameters</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keyword">call </span>log_version(param_file, mdl, version, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE&quot;</span>, use_sponge, &amp;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                 <span class="stringliteral">&quot;If true, sponges may be applied anywhere in the domain. &quot;</span>//&amp;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                 <span class="stringliteral">&quot;The exact location and properties of those sponges are &quot;</span>//&amp;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                 <span class="stringliteral">&quot;specified from MOM_initialization.F90.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="keywordflow">if</span> (.not.use_sponge) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keyword">allocate</span>(cs)</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE_UV&quot;</span>, cs%sponge_uv, &amp;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                 <span class="stringliteral">&quot;Apply sponges in u and v, in addition to tracers.&quot;</span>, &amp;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                 default=.false.)</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;REMAPPING_SCHEME&quot;</span>, remapscheme, &amp;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                 <span class="stringliteral">&quot;This sets the reconstruction scheme used &quot;</span>//&amp;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                 <span class="stringliteral">&quot; for vertical remapping for all variables.&quot;</span>, &amp;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                 default=<span class="stringliteral">&quot;PLM&quot;</span>, do_not_log=.true.)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;BOUNDARY_EXTRAPOLATION&quot;</span>, bndextrapolation, &amp;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                 <span class="stringliteral">&quot;When defined, a proper high-order reconstruction &quot;</span>//&amp;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                 <span class="stringliteral">&quot;scheme is used within boundary cells rather &quot;</span>//&amp;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                 <span class="stringliteral">&quot;than PCM. E.g., if PPM is used for remapping, a &quot;</span>//&amp;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                 <span class="stringliteral">&quot;PPM reconstruction will also be used within boundary cells.&quot;</span>, &amp;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                 default=.false., do_not_log=.true.)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE_DATA_ONGRID&quot;</span>, cs%spongeDataOngrid, &amp;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                 <span class="stringliteral">&quot;When defined, the incoming sponge data are &quot;</span>//&amp;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                 <span class="stringliteral">&quot;assumed to be on the model grid &quot;</span> , &amp;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                 default=.false.)</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  cs%time_varying_sponges = .true.</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  cs%nz = g%ke</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  cs%isc = g%isc ; cs%iec = g%iec ; cs%jsc = g%jsc ; cs%jec = g%jec</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  cs%isd = g%isd ; cs%ied = g%ied ; cs%jsd = g%jsd ; cs%jed = g%jed</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  cs%iscB = g%iscB ; cs%iecB = g%iecB; cs%jscB = g%jscB ; cs%jecB = g%jecB</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="comment">! number of columns to be restored</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  cs%num_col = 0 ; cs%fldno = 0</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordflow">do</span> j=g%jsc,g%jec ; <span class="keywordflow">do</span> i=g%isc,g%iec</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">if</span> ((iresttime(i,j)&gt;0.0) .and. (g%mask2dT(i,j)&gt;0)) &amp;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      cs%num_col = cs%num_col + 1</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordflow">if</span> (cs%num_col &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keyword">allocate</span>(cs%Iresttime_col(cs%num_col)) ; cs%Iresttime_col = 0.0</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keyword">allocate</span>(cs%col_i(cs%num_col))         ; cs%col_i = 0</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keyword">allocate</span>(cs%col_j(cs%num_col))         ; cs%col_j = 0</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">! pass indices, restoring time to the CS structure</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    col = 1</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">do</span> j=g%jsc,g%jec ; <span class="keywordflow">do</span> i=g%isc,g%iec</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordflow">if</span> ((iresttime(i,j)&gt;0.0) .and. (g%mask2dT(i,j)&gt;0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        cs%col_i(col) = i ; cs%col_j(col) = j</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        cs%Iresttime_col(col) = g%US%T_to_s*iresttime(i,j)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        col = col +1</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  total_sponge_cols = cs%num_col</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keyword">call </span>sum_across_pes(total_sponge_cols)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">! Call the constructor for remapping control structure</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keyword">call </span>initialize_remapping(cs%remap_cs, remapscheme, boundary_extrapolation=bndextrapolation)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;!Total sponge columns at h points&quot;</span>, total_sponge_cols, &amp;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                 <span class="stringliteral">&quot;The total number of columns where sponges are applied at h points.&quot;</span>)</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordflow">if</span> (cs%sponge_uv) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keyword">allocate</span>(iresttime_u(g%isdB:g%iedB,g%jsd:g%jed)); iresttime_u(:,:)=0.0</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keyword">allocate</span>(iresttime_v(g%isd:g%ied,g%jsdB:g%jedB)); iresttime_v(:,:)=0.0</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="comment">! u points</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    cs%num_col_u = 0 ; <span class="comment">!CS%fldno_u = 0</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">do</span> j=cs%jsc,cs%jec; <span class="keywordflow">do</span> i=cs%iscB,cs%iecB</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      iresttime_u(i,j) = 0.5 * (iresttime(i,j) + iresttime(i+1,j))</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keywordflow">if</span> ((iresttime_u(i,j)&gt;0.0) .and. (g%mask2dCu(i,j)&gt;0)) &amp;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        cs%num_col_u = cs%num_col_u + 1</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">if</span> (cs%num_col_u &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <span class="keyword">allocate</span>(cs%Iresttime_col_u(cs%num_col_u)) ; cs%Iresttime_col_u = 0.0</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <span class="keyword">allocate</span>(cs%col_i_u(cs%num_col_u))         ; cs%col_i_u = 0</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keyword">allocate</span>(cs%col_j_u(cs%num_col_u))         ; cs%col_j_u = 0</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="comment">! pass indices, restoring time to the CS structure</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      col = 1</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="keywordflow">do</span> j=cs%jsc,cs%jec ; <span class="keywordflow">do</span> i=cs%iscB,cs%iecB</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">if</span> ((iresttime_u(i,j)&gt;0.0) .and. (g%mask2dCu(i,j)&gt;0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;          cs%col_i_u(col) = i ; cs%col_j_u(col) = j</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;          cs%Iresttime_col_u(col) = g%US%T_to_s*iresttime_u(i,j)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;          col = col +1</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <span class="comment">! same for total number of arbritary layers and correspondent data</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    total_sponge_cols_u = cs%num_col_u</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keyword">call </span>sum_across_pes(total_sponge_cols_u)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;!Total sponge columns at u points&quot;</span>, total_sponge_cols_u, &amp;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                <span class="stringliteral">&quot;The total number of columns where sponges are applied at u points.&quot;</span>)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="comment">! v points</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    cs%num_col_v = 0 ; <span class="comment">!CS%fldno_v = 0</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">do</span> j=cs%jscB,cs%jecB; <span class="keywordflow">do</span> i=cs%isc,cs%iec</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      iresttime_v(i,j) = 0.5 * (iresttime(i,j) + iresttime(i,j+1))</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <span class="keywordflow">if</span> ((iresttime_v(i,j)&gt;0.0) .and. (g%mask2dCv(i,j)&gt;0)) &amp;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        cs%num_col_v = cs%num_col_v + 1</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">if</span> (cs%num_col_v &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="keyword">allocate</span>(cs%Iresttime_col_v(cs%num_col_v)) ; cs%Iresttime_col_v = 0.0</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="keyword">allocate</span>(cs%col_i_v(cs%num_col_v))         ; cs%col_i_v = 0</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="keyword">allocate</span>(cs%col_j_v(cs%num_col_v))         ; cs%col_j_v = 0</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="comment">! pass indices, restoring time to the CS structure</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      col = 1</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="keywordflow">do</span> j=cs%jscB,cs%jecB ; <span class="keywordflow">do</span> i=cs%isc,cs%iec</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">if</span> ((iresttime_v(i,j)&gt;0.0) .and. (g%mask2dCv(i,j)&gt;0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;          cs%col_i_v(col) = i ; cs%col_j_v(col) = j</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;          cs%Iresttime_col_v(col) = g%US%T_to_s*iresttime_v(i,j)</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;          col = col +1</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    total_sponge_cols_v = cs%num_col_v</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keyword">call </span>sum_across_pes(total_sponge_cols_v)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;!Total sponge columns at v points&quot;</span>, total_sponge_cols_v, &amp;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                <span class="stringliteral">&quot;The total number of columns where sponges are applied at v points.&quot;</span>)</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l01547">mom_remapping::initialize_remapping()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__ale__sponge_a0febb96fb2fd40a72580d078ca023098_cgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a7b00598b2cf45b865f56515ed5d2ed0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b00598b2cf45b865f56515ed5d2ed0a">&#9670;&nbsp;</a></span>set_up_ale_sponge_field_fixed()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_ale_sponge::set_up_ale_sponge_field_fixed </td>
          <td>(</td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,cs%nz_data), intent(in)&#160;</td>
          <td class="paramname"><em>sp_val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in), target&#160;</td>
          <td class="paramname"><em>f_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ale__sponge_1_1ale__sponge__cs.html">ale_sponge_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This subroutine stores the reference profile at h points for the variable whose address is given by f_ptr. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Grid structure </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>ALE sponge control structure (in/out). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sp_val</td><td>Field to be used in the sponge, it has arbitrary number of layers. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">f_ptr</td><td>Pointer to the field to be damped </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00534">534</a> of file <a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type), <span class="keywordtype">intent(in)</span> :: G<span class="comment">  !&lt; Grid structure</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <span class="keywordtype">type</span>(ALE_sponge_CS),   <span class="keywordtype">pointer</span>    :: CS<span class="comment"> !&lt; ALE sponge control structure (in/out).</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),CS%nz_data)</span>, &amp;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                         <span class="keywordtype">intent(in)</span> :: sp_val<span class="comment"> !&lt; Field to be used in the sponge, it has arbitrary number of layers.</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                 <span class="keywordtype">target</span>, <span class="keywordtype">intent(in)</span> :: f_ptr<span class="comment"> !&lt; Pointer to the field to be damped</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="keywordtype">integer</span> :: j, k, col</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keywordtype">character(len=256)</span> :: mesg <span class="comment">! String for error messages</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160; </div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  cs%fldno = cs%fldno + 1</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="keywordflow">if</span> (cs%fldno &gt; max_fields_) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;Increase MAX_FIELDS_ to at least &quot;,I3,&quot; in MOM_memory.h or decrease &amp;</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="stringliteral"></span><span class="stringliteral">           &amp;the number of fields to be damped in the call to &amp;</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="stringliteral"></span><span class="stringliteral">           &amp;initialize_sponge.&quot; )&#39;</span>) cs%fldno</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;set_up_ALE_sponge_field: &quot;</span>//mesg)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="comment">! stores the reference profile</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="keyword">allocate</span>(cs%Ref_val(cs%fldno)%p(cs%nz_data,cs%num_col))</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  cs%Ref_val(cs%fldno)%p(:,:) = 0.0</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordflow">do</span> col=1,cs%num_col</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">do</span> k=1,cs%nz_data</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      cs%Ref_val(cs%fldno)%p(k,col) = sp_val(cs%col_i(col),cs%col_j(col),k)</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  cs%var(cs%fldno)%p =&gt; f_ptr</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__ale__sponge_a7b00598b2cf45b865f56515ed5d2ed0a_cgraph.svg" width="572" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a5222905f5cfddd07b77e05428e88dd85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5222905f5cfddd07b77e05428e88dd85">&#9670;&nbsp;</a></span>set_up_ale_sponge_field_varying()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_ale_sponge::set_up_ale_sponge_field_varying </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>fieldname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in), target&#160;</td>
          <td class="paramname"><em>f_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ale__sponge_1_1ale__sponge__cs.html">ale_sponge_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This subroutine stores the reference profile at h points for the variable whose address is given by filename and fieldname. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">filename</td><td>The name of the file with the time varying field data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldname</td><td>The name of the field in the file with the time varying field data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>The current model time </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Grid structure (in). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">f_ptr</td><td>Pointer to the field to be damped (in). </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>Sponge control structure (in/out). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00571">571</a> of file <a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keywordtype">character(len=*)</span>,        <span class="keywordtype">intent(in)</span> :: filename<span class="comment"> !&lt; The name of the file with the</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">                                                  !! time varying field data</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="keywordtype">character(len=*)</span>,        <span class="keywordtype">intent(in)</span> :: fieldname<span class="comment"> !&lt; The name of the field in the file</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">                                                  !! with the time varying field data</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keywordtype">type</span>(time_type),         <span class="keywordtype">intent(in)</span> :: Time<span class="comment">  !&lt; The current model time</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),   <span class="keywordtype">intent(in)</span> :: G<span class="comment">     !&lt; Grid structure (in).</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type), <span class="keywordtype">intent(in)</span> :: GV<span class="comment">    !&lt; ocean vertical grid structure</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),   <span class="keywordtype">intent(in)</span>    :: US<span class="comment">         !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                   <span class="keywordtype">target</span>, <span class="keywordtype">intent(in)</span> :: f_ptr<span class="comment"> !&lt; Pointer to the field to be damped (in).</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordtype">type</span>(ALE_sponge_CS),     <span class="keywordtype">pointer</span>    :: CS<span class="comment">    !&lt; Sponge control structure (in/out).</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: sp_val<span class="comment"> !&lt; Field to be used in the sponge</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: mask_z<span class="comment"> !&lt; Field mask for the sponge data</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">target</span> :: z_in, z_edges_in <span class="comment">! Heights [Z ~&gt; m].</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="keywordtype">  real</span> :: missing_value</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="keywordtype">integer</span> :: j, k, col</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="keywordtype">integer</span> :: isd,ied,jsd,jed</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="keywordtype">integer</span> :: nPoints</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(4)</span> :: fld_sz</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keywordtype">integer</span> :: nz_data<span class="comment"> !&lt; the number of vertical levels in this input field</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  <span class="keywordtype">character(len=256)</span> :: mesg <span class="comment">! String for error messages</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="comment">! Local variables for ALE remapping</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: tmpT1d</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="keywordtype">  real</span> :: zTopOfCell, zBottomOfCell <span class="comment">! Heights [Z ~&gt; m].</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="keywordtype">type</span>(remapping_CS) :: remapCS <span class="comment">! Remapping parameters and work arrays</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="comment">! initialize time interpolator module</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="keyword">call </span>time_interp_external_init()</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  isd = g%isd; ied = g%ied; jsd = g%jsd; jed = g%jed</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  cs%fldno = cs%fldno + 1</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keywordflow">if</span> (cs%fldno &gt; max_fields_) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;Increase MAX_FIELDS_ to at least &quot;,I3,&quot; in MOM_memory.h or decrease &amp;</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="stringliteral"></span><span class="stringliteral">           &amp;the number of fields to be damped in the call to &amp;</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="stringliteral"></span><span class="stringliteral">           &amp;initialize_sponge.&quot; )&#39;</span>) cs%fldno</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;set_up_ALE_sponge_field: &quot;</span>//mesg)</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="comment">! get a unique time interp id for this field. If sponge data is ongrid, then setup</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="comment">! to only read on the computational domain</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="keywordflow">if</span> (cs%spongeDataOngrid) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    cs%Ref_val(cs%fldno)%id = init_external_field(filename, fieldname,domain=g%Domain%mpp_domain)</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    cs%Ref_val(cs%fldno)%id = init_external_field(filename, fieldname)</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  fld_sz(1:4)=-1</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  fld_sz = get_external_field_size(cs%Ref_val(cs%fldno)%id)</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  nz_data = fld_sz(3)</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  cs%Ref_val(cs%fldno)%nz_data = nz_data <span class="comment">!&lt; individual sponge fields may reside on a different vertical grid</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  cs%Ref_val(cs%fldno)%num_tlevs = fld_sz(4)</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="comment">! initializes the target profile array for this field</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="comment">! for all columns which will be masked</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="keyword">allocate</span>(cs%Ref_val(cs%fldno)%p(nz_data,cs%num_col))</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  cs%Ref_val(cs%fldno)%p(:,:) = 0.0</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="keyword">allocate</span>( cs%Ref_val(cs%fldno)%h(nz_data,cs%num_col) )</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  cs%Ref_val(cs%fldno)%h(:,:) = 0.0</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  cs%var(cs%fldno)%p =&gt; f_ptr</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__ale__sponge_a5222905f5cfddd07b77e05428e88dd85_cgraph.svg" width="540" height="67"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a6eb21c5a149d573ba0d67fdb3a932115"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6eb21c5a149d573ba0d67fdb3a932115">&#9670;&nbsp;</a></span>set_up_ale_sponge_vel_field_fixed()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_ale_sponge::set_up_ale_sponge_vel_field_fixed </td>
          <td>(</td>
          <td class="paramtype">real, dimension( g %isdb: g %iedb, g %jsd: g %jed,cs%nz_data), intent(in)&#160;</td>
          <td class="paramname"><em>u_val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsdb: g %jedb,cs%nz_data), intent(in)&#160;</td>
          <td class="paramname"><em>v_val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isdb: g %iedb, g %jsd: g %jed, g %ke), intent(in), target&#160;</td>
          <td class="paramname"><em>u_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsdb: g %jedb, g %ke), intent(in), target&#160;</td>
          <td class="paramname"><em>v_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ale__sponge_1_1ale__sponge__cs.html">ale_sponge_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This subroutine stores the reference profile at u and v points for the variable whose address is given by u_ptr and v_ptr. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Grid structure (in). </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>Sponge structure (in/out). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u_val</td><td>u field to be used in the sponge, it has arbritary number of layers. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v_val</td><td>v field to be used in the sponge, it has arbritary number of layers. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u_ptr</td><td>u pointer to the field to be damped </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v_ptr</td><td>v pointer to the field to be damped </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00636">636</a> of file <a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type), <span class="keywordtype">intent(in)</span> :: G<span class="comment">  !&lt; Grid structure (in).</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="keywordtype">type</span>(ALE_sponge_CS),   <span class="keywordtype">pointer</span>    :: CS<span class="comment"> !&lt; Sponge structure (in/out).</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),CS%nz_data)</span>, &amp;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                         <span class="keywordtype">intent(in)</span> :: u_val<span class="comment"> !&lt; u field to be used in the sponge, it has arbritary number of layers.</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),CS%nz_data)</span>, &amp;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                         <span class="keywordtype">intent(in)</span> :: v_val<span class="comment"> !&lt; v field to be used in the sponge, it has arbritary number of layers.</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">target</span>, <span class="keywordtype">intent(in)</span> :: u_ptr<span class="comment"> !&lt; u pointer to the field to be damped</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">target</span>, <span class="keywordtype">intent(in)</span> :: v_ptr<span class="comment"> !&lt; v pointer to the field to be damped</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160; </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="keywordtype">integer</span> :: j, k, col</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="keywordtype">character(len=256)</span> :: mesg <span class="comment">! String for error messages</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="comment">! stores the reference profile</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keyword">allocate</span>(cs%Ref_val_u%p(cs%nz_data,cs%num_col_u))</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  cs%Ref_val_u%p(:,:) = 0.0</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="keywordflow">do</span> col=1,cs%num_col_u</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">do</span> k=1,cs%nz_data</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      cs%Ref_val_u%p(k,col) = u_val(cs%col_i_u(col),cs%col_j_u(col),k)</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  cs%var_u%p =&gt; u_ptr</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="keyword">allocate</span>(cs%Ref_val_v%p(cs%nz_data,cs%num_col_v))</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  cs%Ref_val_v%p(:,:) = 0.0</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <span class="keywordflow">do</span> col=1,cs%num_col_v</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">do</span> k=1,cs%nz_data</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      cs%Ref_val_v%p(k,col) = v_val(cs%col_i_v(col),cs%col_j_v(col),k)</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  cs%var_v%p =&gt; v_ptr</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="a551051d11b239eeef807fb88ab31aba6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a551051d11b239eeef807fb88ab31aba6">&#9670;&nbsp;</a></span>set_up_ale_sponge_vel_field_varying()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_ale_sponge::set_up_ale_sponge_vel_field_varying </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>filename_u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>fieldname_u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>filename_v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>fieldname_v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ale__sponge_1_1ale__sponge__cs.html">ale_sponge_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isdb: g %iedb, g %jsd: g %jed, g %ke), intent(in), target&#160;</td>
          <td class="paramname"><em>u_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsdb: g %jedb, g %ke), intent(in), target&#160;</td>
          <td class="paramname"><em>v_ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This subroutine stores the reference profile at uand v points for the variable whose address is given by u_ptr and v_ptr. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">filename_u</td><td>File name for u field </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldname_u</td><td>Name of u variable in file </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">filename_v</td><td>File name for v field </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldname_v</td><td>Name of v variable in file </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>Model time </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>Ocean grid (in) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>Sponge structure (in/out). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u_ptr</td><td>u pointer to the field to be damped (in). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v_ptr</td><td>v pointer to the field to be damped (in). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00674">674</a> of file <a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>    :: filename_u<span class="comment">  !&lt; File name for u field</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>    :: fieldname_u<span class="comment"> !&lt; Name of u variable in file</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>    :: filename_v<span class="comment">  !&lt; File name for v field</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>    :: fieldname_v<span class="comment"> !&lt; Name of v variable in file</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="keywordtype">type</span>(time_type),  <span class="keywordtype">intent(in)</span>    :: Time<span class="comment">        !&lt; Model time</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type), <span class="keywordtype">intent(inout)</span> :: G<span class="comment">      !&lt; Ocean grid (in)</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type), <span class="keywordtype">intent(in)</span>    :: US<span class="comment">     !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="keywordtype">type</span>(ALE_sponge_CS), <span class="keywordtype">pointer</span>    :: CS<span class="comment">          !&lt; Sponge structure (in/out).</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">target</span>, <span class="keywordtype">intent(in)</span> :: u_ptr<span class="comment"> !&lt; u pointer to the field to be damped (in).</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">target</span>, <span class="keywordtype">intent(in)</span> :: v_ptr<span class="comment"> !&lt; v pointer to the field to be damped (in).</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: u_val<span class="comment"> !&lt; U field to be used in the sponge.</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: mask_u<span class="comment"> !&lt; U field mask for the sponge data.</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: v_val<span class="comment"> !&lt; V field to be used in the sponge.</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: mask_v<span class="comment"> !&lt; V field mask for the sponge data.</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">target</span> :: z_in, z_edges_in</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="keywordtype">  real</span> :: missing_value</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordtype">integer</span> :: j, k, col</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  <span class="keywordtype">integer</span> :: isdB, iedB, jsdB, jedB</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(4)</span> :: fld_sz</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="keywordtype">character(len=256)</span> :: mesg <span class="comment">! String for error messages</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160; </div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160; </div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  isd = g%isd; ied = g%ied; jsd = g%jsd; jed = g%jed</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  isdb = g%isdB; iedb = g%iedB; jsdb = g%jsdB; jedb = g%jedB</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="comment">! get a unique id for this field which will allow us to return an array</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="comment">! containing time-interpolated values from an external file corresponding</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="comment">! to the current model date.</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  cs%Ref_val_u%id = init_external_field(filename_u, fieldname_u)</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  fld_sz(1:4)=-1</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  fld_sz = get_external_field_size(cs%Ref_val_u%id)</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  cs%Ref_val_u%nz_data = fld_sz(3)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  cs%Ref_val_u%num_tlevs = fld_sz(4)</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  cs%Ref_val_v%id = init_external_field(filename_v, fieldname_v)</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  fld_sz(1:4)=-1</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  fld_sz = get_external_field_size(cs%Ref_val_v%id)</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  cs%Ref_val_v%nz_data = fld_sz(3)</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  cs%Ref_val_v%num_tlevs = fld_sz(4)</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keyword">allocate</span>( u_val(isdb:iedb,jsd:jed, fld_sz(3)) )</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keyword">allocate</span>( mask_u(isdb:iedb,jsd:jed, fld_sz(3)) )</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="keyword">allocate</span>( v_val(isd:ied,jsdb:jedb, fld_sz(3)) )</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="keyword">allocate</span>( mask_v(isd:ied,jsdb:jedb, fld_sz(3)) )</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="comment">! Interpolate external file data to the model grid</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="comment">! I am hard-wiring this call to assume that the input grid is zonally re-entrant</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="comment">! In the future, this should be generalized using an interface to return the</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="comment">! modulo attribute of the zonal axis (mjh).</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keyword">call </span>horiz_interp_and_extrap_tracer(cs%Ref_val_u%id,time, 1.0,g,u_val,mask_u,z_in,z_edges_in,&amp;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                                     missing_value,.true.,.false.,.false., m_to_z=us%m_to_Z)</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="comment">!!! TODO: add a velocity interface! (mjh)</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <span class="comment">! Interpolate external file data to the model grid</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <span class="comment">! I am hard-wiring this call to assume that the input grid is zonally re-entrant</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="comment">! In the future, this should be generalized using an interface to return the</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <span class="comment">! modulo attribute of the zonal axis (mjh).</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <span class="keyword">call </span>horiz_interp_and_extrap_tracer(cs%Ref_val_v%id,time, 1.0,g,v_val,mask_v,z_in,z_edges_in, &amp;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                                     missing_value,.true.,.false.,.false., m_to_z=us%m_to_Z)</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <span class="comment">! stores the reference profile</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="keyword">allocate</span>(cs%Ref_val_u%p(fld_sz(3),cs%num_col_u))</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  cs%Ref_val_u%p(:,:) = 0.0</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="keywordflow">do</span> col=1,cs%num_col_u</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keywordflow">do</span> k=1,fld_sz(3)</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      cs%Ref_val_u%p(k,col) = u_val(cs%col_i_u(col),cs%col_j_u(col),k)</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  cs%var_u%p =&gt; u_ptr</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="keyword">allocate</span>(cs%Ref_val_v%p(fld_sz(3),cs%num_col_v))</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  cs%Ref_val_v%p(:,:) = 0.0</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  <span class="keywordflow">do</span> col=1,cs%num_col_v</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordflow">do</span> k=1,fld_sz(3)</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      cs%Ref_val_v%p(k,col) = v_val(cs%col_i_v(col),cs%col_j_v(col),k)</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  cs%var_v%p =&gt; v_ptr</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemom__ale__sponge.html">mom_ale_sponge</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
