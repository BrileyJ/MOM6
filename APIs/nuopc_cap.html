<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: NUOPC Cap</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('nuopc_cap.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">NUOPC Cap </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Overview">Overview</a><ul><li class="level2"><a href="#CapSubroutines">Cap Subroutines</a></li>
</ul>
</li>
<li class="level1"><a href="#UnderlyingModelInterfaces">Underlying Model Interfaces</a><ul><li class="level2"><a href="#DomainCreation">Domain Creation</a></li>
<li class="level2"><a href="#Initialization">Initialization</a></li>
<li class="level2"><a href="#Run">Run</a><ul><li class="level3"><a href="#VectorRotations">Vector Rotations</a></li>
</ul>
</li>
<li class="level2"><a href="#Finalization">Finalization</a></li>
</ul>
</li>
<li class="level1"><a href="#ModelFields">Model Fields</a><ul><li class="level2"><a href="#ImportFields">Import Fields</a></li>
<li class="level2"><a href="#ExportField">Export Fields</a></li>
<li class="level2"><a href="#MemoryManagement">Memory Management</a></li>
<li class="level2"><a href="#IO">I/O</a></li>
</ul>
</li>
<li class="level1"><a href="#RuntimeConfiguration">Runtime Configuration</a></li>
</ul>
</div>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Fei Liu (<a href="#" onclick="location.href='mai'+'lto:'+'fei'+'.l'+'iu@'+'gm'+'ail'+'.c'+'om'; return false;">fei.l<span style="display: none;">.nosp@m.</span>iu@g<span style="display: none;">.nosp@m.</span>mail.<span style="display: none;">.nosp@m.</span>com</a>) </dd></dl>
<dl class="section date"><dt>Date</dt><dd>5/10/13 Original documentation </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Rocky Dunlap (<a href="#" onclick="location.href='mai'+'lto:'+'roc'+'ky'+'.du'+'nl'+'ap@'+'no'+'aa.'+'go'+'v'; return false;">rocky<span style="display: none;">.nosp@m.</span>.dun<span style="display: none;">.nosp@m.</span>lap@n<span style="display: none;">.nosp@m.</span>oaa.<span style="display: none;">.nosp@m.</span>gov</a>) </dd></dl>
<dl class="section date"><dt>Date</dt><dd>1/12/17 Moved to doxygen </dd>
<dd>
2/28/19 Rewrote for unified cap</dd></dl>
<h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p><b>This MOM cap has been tested with MOM6.</b></p>
<p>This document describes the MOM NUOPC "cap", which is a light weight software layer that is required when the <a href="https://github.com/NOAA-GFDL/MOM6/tree/dev/master">MOM ocean model</a> is used in <a href="http://www.earthsystemcog.org/projects/nuopc">National Unified Operation Prediction Capability</a> (NUOPC) coupled systems. Also see the <a href="https://github.com/NOAA-GFDL/MOM6-Examples/wiki">MOM wiki</a> for more documentation.</p>
<p>NUOPC is a software layer built on top of the <a href="https://www.earthsystemcog.org/projects/esmf">Earth System Modeling Framework</a> (ESMF). ESMF is a high-performance modeling framework that provides data structures, interfaces, and operations suited for building coupled models from a set of components. NUOPC refines the capabilities of ESMF by providing a more precise definition of what it means for a model to be a component and how components should interact and share data in a coupled system. The NUOPC Layer software is designed to work with typical high-performance models in the Earth sciences domain, most of which are written in Fortran and are based on a distributed memory model of parallelism (MPI).</p>
<p>A NUOPC "cap" is a Fortran module that serves as the interface to a model when it's used in a NUOPC-based coupled system. The term "cap" is used because it is a light weight software layer that sits on top of model code, making calls into it and exposing model data structures in a standard way.</p>
<p>The MOM cap package includes the cap code itself (MOM_cap.F90, MOM_cap_methods.F90 and MOM_cap_time.F90), a set of time utilities (<a class="el" href="time__utils_8F90.html">time_utils.F90</a>) for converting between ESMF and FMS time type and two modules MOM_ocean_model_nuopc.F90 and MOM_surface_forcing_nuopc.F90. MOM_surface_forcing_nuopc.F90 converts the input ESMF data (import data) to a MOM-specific data type (surface_forcing_CS). MOM_ocean_model_nuopc.F90 contains routines for initialization, update and finalization of the ocean model state.</p>
<h2><a class="anchor" id="CapSubroutines"></a>
Cap Subroutines</h2>
<p>The MOM cap modules contains a set of subroutines that are required by NUOPC. These subroutines are called by the NUOPC infrastructure according to a predefined calling sequence. Some subroutines are called during initialization of the coupled system, some during the run of the coupled system, and some during finalization of the coupled system.</p>
<p>The initialization sequence is the most complex and is governed by the NUOPC technical rules. Details about the initialization sequence can be found in the <a href="http://www.earthsystemmodeling.org/esmf_releases/last_built/NUOPC_refdoc/">NUOPC Reference Manual</a>. The cap requires beta snapshot ESMF v8.0.0bs16 or later.</p>
<p>The following table summarizes the NUOPC-required subroutines that appear in the MOM cap. The "Phase" column says whether the subroutine is called during the initialization, run, or finalize part of the coupled system run.</p>
<table class="doxtable">
<tr>
<th>Phase </th><th>MOM Cap Subroutine </th><th>Description </th></tr>
<tr>
<td>Init </td><td>InitializeP0 </td><td>Sets the Initialize Phase Definition (IPD) version to use </td></tr>
<tr>
<td>Init </td><td>InitializeAdvertise </td><td>Advertises standard names of import and export fields </td></tr>
<tr>
<td>Init </td><td>InitializeRealize </td><td>Creates an ESMF_Grid or ESMF_Mesh as well as ESMF_Fields for import and export fields </td></tr>
<tr>
<td>Run </td><td>ModelAdvance </td><td>Advances the model by a timestep </td></tr>
<tr>
<td>Final </td><td>Finalize </td><td>Cleans up </td></tr>
</table>
<h1><a class="anchor" id="UnderlyingModelInterfaces"></a>
Underlying Model Interfaces</h1>
<h2><a class="anchor" id="DomainCreation"></a>
Domain Creation</h2>
<p>The cap can accomodate a MOM tripolar grid which is represented either as a 2D <code>ESMF_Grid</code> or as a 1D <code>ESMF_Mesh</code>. Other MOM grids (e.g. a bipolar grid) can be represented as a 1d <code>ESMF_Mesh</code> only. Coupling fields are placed on either the <code>ESMF_Grid</code> or <code>ESMF_Mesh</code>. Note that for either the <code>ESMF_Grid</code> or <code>ESMF_Mesh</code> representation, the fields are translated into a 2D MOM specific surface boundary type and the distinction between the two is no longer there. Calls related to creating the grid are located in the InitializeRealize subroutine, which is called by the NUOPC infrastructure during the intialization sequence.</p>
<p>The cap determines parameters for setting up the grid by calling subroutines in the <code>mpp_domains_mod</code> module. The global domain size is determined by calling <code>mpp_get_global_domain()</code>. A check is in place to ensure that there is only a single tile in the domain (the cap is currently limited to one tile; multi-tile mosaics are not supported). The decomposition across processors is determined via calls to <code>mpp_get_compute_domains()</code> (to retrieve decomposition block indices) and <code>mpp_get_pelist()</code> (to determine how blocks are assigned to processors).</p>
<p>The <code>ESMF_Grid</code> is created in several steps:</p><ul>
<li>an <code>ESMF_DELayout</code> is created based on the pelist from MOM</li>
<li>an <code>ESMF_DistGrid</code> is created over the global index space. Connections are set up so that the index space is periodic in the first dimension and has a fold at the top for the bipole. The decompostion blocks are also passed in along with the <code>ESMF_DELayout</code> mentioned above.</li>
<li>an <code>ESMF_Grid</code> is then created by passing in the above <code>ESMF_DistGrid</code>.</li>
<li>masks, areas, center (tlat, tlon), and corner (ulat, ulon) coordinates are then added to the <code>ESMF_Grid</code> by retrieving those fields from the MOM datatype <code>ocean_grid</code> elements.</li>
</ul>
<p>The <code>ESMF_Mesh</code> is also created in several steps:</p><ul>
<li>the target mesh is generated offline.</li>
<li>a temporary mesh is created from an input file specified by the config variable <code>mesh_ocn</code>. the mesh has a distribution that is automatically generated by ESMF when reading in the mesh</li>
<li>an <code>ESMF_DistGrid</code> is created from the global index space for the computational domain.</li>
<li>the final <code>ESMF_Mesh</code> is then created by distributing the temporary mesh using the created <code>ESMF_DistGrid</code>.</li>
</ul>
<h2><a class="anchor" id="Initialization"></a>
Initialization</h2>
<p>During the InitializeAdvertise phase, calls are made to MOM's native initialization subroutines, including <code>fms_init()</code>, <code>constants_init()</code>, <code>field_manager_init()</code>, <code>diag_manager_init()</code>, and <code>set_calendar_type()</code>. The MPI communicator is pulled in through the ESMF VM object for the MOM component. The dt and start time are set from parameters from the incoming ESMF clock with calls to <code>set_time()</code> and <code>set_date().</code></p>
<h2><a class="anchor" id="Run"></a>
Run</h2>
<p>The ModelAdvance subroutine is called by the NUOPC infrastructure when it's time for MOM to advance in time. During this subroutine, there is a call into the MOM update routine: </p><pre class="fragment"> call update_ocean_model(Ice_ocean_boundary, Ocean_state, Ocean_public, Time, Time_step_coupled)
</pre><p>Priori to the call to <code><a class="el" href="namespacemom__ocean__model__mct.html#a422ba42ca07c0bf28ec5113aba4f1e96" title="update_ocean_model uses the forcing in Ice_ocean_boundary to advance the ocean model&#39;s state from the...">update_ocean_model()</a></code>, the cap performs these steps</p><ul>
<li>the <code>Time</code> and <code>Time_step_coupled</code> parameters, based on FMS types, are derived from the incoming ESMF clock</li>
<li>diagnostics are optionally written to files <code>field_ocn_import_*</code>, one for each import field</li>
<li>mom_import is called and translates to the ESMF input data to a MOM specific data type<ul>
<li>momentum flux vectors are rotated to internal grid</li>
</ul>
</li>
</ul>
<p>After the call to <code><a class="el" href="namespacemom__ocean__model__mct.html#a422ba42ca07c0bf28ec5113aba4f1e96" title="update_ocean_model uses the forcing in Ice_ocean_boundary to advance the ocean model&#39;s state from the...">update_ocean_model()</a></code>, the cap performs these steps:</p><ul>
<li>mom_export is called<ul>
<li>the <code>ocean_mask</code> export is set to match that of the internal MOM mask</li>
<li>the <code>freezing_melting_potential</code> export is converted from J m-2 to W m-2 by dividing by the coupling interval</li>
<li>vector rotations are applied to the <code>ocean_current_zonal</code> and <code>ocean_current_merid</code> exports, back to lat-lon grid</li>
<li>diagnostics are optionally written to files <code>field_ocn_export_*</code>, one for each export field</li>
<li>optionally, a call is made to <code><a class="el" href="namespacemom__ocean__model__mct.html#adb431f3c4f9de3b5f06acdb92428eeb2" title="This subroutine writes out the ocean model restart file.">ocean_model_restart()</a></code> at the interval <code>restart_interval</code></li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="VectorRotations"></a>
Vector Rotations</h3>
<p>Vector rotations are applied to incoming momentum fluxes (from regular lat-lon to tripolar grid) and outgoing ocean currents (from tripolar to regular lat-lon). The rotation angles are provided from the native MOM grid by a call to <code>get_ocean_grid(Ocean_grid)</code>. The cosine and sine of the rotation angle are: </p><pre class="fragment">ocean_grid%cos_rot(i,j)
ocean_grid%sin_rot(i,j)
</pre><p>The rotation of momentum flux from regular lat-lon to tripolar is: </p><p class="formulaDsp">
\[ \begin{bmatrix} \tau_x&#39; \\ \tau_y&#39; \end{bmatrix} = \begin{bmatrix} cos \theta &amp; sin \theta \\ -sin \theta &amp; cos \theta \end{bmatrix} * \begin{bmatrix} \tau_x \\ \tau_y \end{bmatrix} \]
</p>
<p>The rotation of ocean current from tripolar to regular lat-lon is: </p><p class="formulaDsp">
\[ \begin{bmatrix} u&#39; \\ v&#39; \end{bmatrix} = \begin{bmatrix} cos \theta &amp; -sin \theta \\ sin \theta &amp; cos \theta \end{bmatrix} * \begin{bmatrix} u \\ v \end{bmatrix} \]
</p>
 <h2><a class="anchor" id="Finalization"></a>
Finalization</h2>
<p>NUOPC infrastructure calls ocean_model_finalize at the end of the run. This subroutine is a hook to call into MOM's native shutdown procedures: </p><pre class="fragment">call ocean_model_end (ocean_public, ocean_State, Time)
call diag_manager_end(Time )
call field_manager_end
call fms_io_exit
call fms_end
</pre><h1><a class="anchor" id="ModelFields"></a>
Model Fields</h1>
<p>The following tables list the import and export fields currently set up in the MOM cap.</p>
<h2><a class="anchor" id="ImportFields"></a>
Import Fields</h2>
<table class="doxtable">
<tr>
<th>Standard Name </th><th>Units </th><th>Model Variable </th><th>Description </th><th>Notes </th></tr>
<tr>
<td>inst_pres_height_surface </td><td>Pa </td><td>p </td><td>pressure of overlying sea ice and atmosphere </td><td></td></tr>
<tr>
<td>mass_of_overlying_sea_ice </td><td>kg </td><td>mi </td><td>mass of overlying sea ice </td><td></td></tr>
<tr>
<td>seaice_melt_heat </td><td>W m-2 </td><td>seaice_melt_heat </td><td>sea ice and snow melt heat flux </td><td></td></tr>
<tr>
<td>seaice_melt </td><td>kg m-2 s-1 </td><td>seaice_melt </td><td>water flux due to sea ice and snow melting </td><td></td></tr>
<tr>
<td>mean_calving_heat_flx </td><td>W m-2 </td><td>calving_hflx </td><td>heat flux, relative to 0C, of frozen land water into ocean </td><td></td></tr>
<tr>
<td>mean_calving_rate </td><td>kg m-2 s-1 </td><td>calving </td><td>mass flux of frozen runoff </td><td></td></tr>
<tr>
<td>mean_evap_rate </td><td>kg m-2 s-1 </td><td>q_flux </td><td>specific humidity flux </td><td></td></tr>
<tr>
<td>mean_fprec_rate </td><td>kg m-2 s-1 </td><td>fprec </td><td>mass flux of frozen precip </td><td></td></tr>
<tr>
<td>mean_merid_moment_flx </td><td>Pa </td><td>v_flux </td><td>j-directed wind stress into ocean </td><td><a class="el" href="nuopc_cap.html#VectorRotations">vector rotation</a> applied - lat-lon to tripolar  </td></tr>
<tr>
<td>mean_net_lw_flx </td><td>W m-2 </td><td>lw_flux </td><td>long wave radiation </td><td></td></tr>
<tr>
<td>mean_net_sw_ir_dif_flx </td><td>W m-2 </td><td>sw_flux_nir_dif </td><td>diffuse near IR shortwave radiation </td><td></td></tr>
<tr>
<td>mean_net_sw_ir_dir_flx </td><td>W m-2 </td><td>sw_flux_nir_dir </td><td>direct near IR shortwave radiation </td><td></td></tr>
<tr>
<td>mean_net_sw_vis_dif_flx </td><td>W m-2 </td><td>sw_flux_vis_dif </td><td>diffuse visible shortware radiation </td><td></td></tr>
<tr>
<td>mean_net_sw_vis_dir_flx </td><td>W m-2 </td><td>sw_flux_vis_dir </td><td>direct visible shortware radiation </td><td></td></tr>
<tr>
<td>mean_prec_rate </td><td>kg m-2 s-1 </td><td>lprec </td><td>mass flux of liquid precip </td><td></td></tr>
<tr>
<td>mean_runoff_heat_flx </td><td>W m-2 </td><td>runoff_hflx </td><td>heat flux, relative to 0C, of liquid land water into ocean </td><td></td></tr>
<tr>
<td>mean_runoff_rate </td><td>kg m-2 s-1 </td><td>runoff </td><td>mass flux of liquid runoff </td><td></td></tr>
<tr>
<td>mean_salt_rate </td><td>kg m-2 s-1 </td><td>salt_flux </td><td>salt flux </td><td></td></tr>
<tr>
<td>mean_sensi_heat_flx </td><td>W m-2 </td><td>t_flux </td><td>sensible heat flux into ocean </td><td></td></tr>
<tr>
<td>mean_zonal_moment_flx </td><td>Pa </td><td>u_flux </td><td>i-directed wind stress into ocean </td><td><a class="el" href="nuopc_cap.html#VectorRotations">vector rotation</a> applied - lat-lon to tripolar  </td></tr>
</table>
<h2><a class="anchor" id="ExportField"></a>
Export Fields</h2>
<p>Export fields are populated from the <code>ocean_public</code> parameter (type <code>ocean_public_type</code>) after the call to <code><a class="el" href="namespacemom__ocean__model__mct.html#a422ba42ca07c0bf28ec5113aba4f1e96" title="update_ocean_model uses the forcing in Ice_ocean_boundary to advance the ocean model&#39;s state from the...">update_ocean_model()</a></code>.</p>
<table class="doxtable">
<tr>
<th>Standard Name </th><th>Units </th><th>Model Variable </th><th>Description </th><th>Notes  </th></tr>
<tr>
<td>freezing_melting_potential </td><td>W m-2 </td><td>combination of frazil and melt_potential </td><td>cap converts model units (J m-2) to (W m-2) for export </td><td></td></tr>
<tr>
<td>ocean_mask </td><td></td><td></td><td>ocean mask </td><td></td></tr>
<tr>
<td>ocn_current_merid </td><td>m s-1 </td><td>v_surf </td><td>j-directed surface velocity on u-cell </td><td><a class="el" href="nuopc_cap.html#VectorRotations">vector rotation</a> applied - tripolar to lat-lon  </td></tr>
<tr>
<td>ocn_current_zonal </td><td>m s-1 </td><td>u_surf </td><td>i-directed surface velocity on u-cell </td><td><a class="el" href="nuopc_cap.html#VectorRotations">vector rotation</a> applied - tripolar to lat-lon  </td></tr>
<tr>
<td>s_surf </td><td>psu </td><td>s_surf </td><td>sea surface salinity on t-cell </td><td></td></tr>
<tr>
<td>sea_surface_temperature </td><td>K </td><td>t_surf </td><td>sea surface temperature on t-cell </td><td></td></tr>
<tr>
<td>sea_surface_slope_zonal </td><td>unitless </td><td>created from ssh </td><td>sea surface zonal slope </td><td></td></tr>
<tr>
<td>sea_surface_slope_merid </td><td>unitless </td><td>created from ssh </td><td>sea surface meridional slope </td><td></td></tr>
<tr>
<td>so_bldepth </td><td>m </td><td>obld </td><td>ocean surface boundary layer depth </td><td></td></tr>
</table>
<h2><a class="anchor" id="MemoryManagement"></a>
Memory Management</h2>
<p>The MOM cap has an internal state type with pointers to three types defined by MOM. There is also a small wrapper derived type required to associate an internal state instance with the ESMF/NUOPC component: </p><pre class="fragment">type ocean_internalstate_type
   type(ocean_public_type),       pointer :: ocean_public_type_ptr
   type(ocean_state_type),        pointer :: ocean_state_type_ptr
   type(ice_ocean_boundary_type), pointer :: ice_ocean_boundary_type_ptr
end type

type ocean_internalstate_wrapper
   type(ocean_internalstate_type), pointer :: ptr
end type
</pre><p>The member of type <code>ocean_public_type</code> stores ocean surface fields used during the coupling. The member of type <code>ocean_state_type</code> is required by the ocean driver, although its internals are private (not to be used by the coupling directly). This type is passed to the ocean init and update routines so that it can maintain state there if desired. The member of type <code>ice_ocean_boundary_type</code> is populated by this cap with incoming coupling fields from other components. These three derived types are allocated during the InitializeAdvertise phase. Also during that phase, the <code>ice_ocean_boundary</code> type members are all allocated using bounds retrieved from <code>mpp_get_compute_domain()</code>.</p>
<p>During the InitializeRealize phase, <code>ESMF_Field</code>s are created for each of the coupling fields in the <code>ice_ocean_boundary</code> and <code>ocean_public_type</code> members of the internal state. These fields directly reference into the members of the <code>ice_ocean_boundary</code> and <code>ocean_public_type</code> so that memory-to-memory copies are not required to move data from the cap's import and export states to the memory areas used internally by MOM.</p>
<h2><a class="anchor" id="IO"></a>
I/O</h2>
<p>The cap can optionally output coupling fields for diagnostic purposes if the ESMF attribute "DumpFields" has been set to "true". In this case the cap will write out NetCDF files with names "field_ocn_import_&lt;fieldname&gt;.nc" and "field_ocn_export_&lt;fieldname&gt;.nc". Additionally, calls will be made to the cap subroutine dumpMomInternal to write out model internal fields to files named "field_ocn_internal_&lt;fieldname&gt;.nc". In all cases these NetCDF files will contain a time series of field data.</p>
<h1><a class="anchor" id="RuntimeConfiguration"></a>
Runtime Configuration</h1>
<p>At runtime, the MOM cap can be configured with several options provided as ESMF attributes. Attributes can be set in the cap by the NUOPC Driver above this cap, or in some systems ESMF attributes are set by reading in from a configuration file. The available attributes are:</p>
<ul>
<li><code>DumpFields</code> - when set to "true", write out diagnostic NetCDF files for import/export/internal fields</li>
<li><code>ProfileMemory</code> - when set to "true", write out memory usage information to the ESMF log files; this information is written when entering and leaving the ModelAdvance subroutine and before and after the call to <code><a class="el" href="namespacemom__ocean__model__mct.html#a422ba42ca07c0bf28ec5113aba4f1e96" title="update_ocean_model uses the forcing in Ice_ocean_boundary to advance the ocean model&#39;s state from the...">update_ocean_model()</a></code>.</li>
<li><code>restart_interval</code> - integer number of seconds indicating the interval at which to call <code><a class="el" href="namespacemom__ocean__model__mct.html#adb431f3c4f9de3b5f06acdb92428eeb2" title="This subroutine writes out the ocean model restart file.">ocean_model_restart()</a></code>; no restarts written if set to 0 </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
