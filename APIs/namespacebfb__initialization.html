<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: bfb_initialization Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespacebfb__initialization.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">bfb_initialization Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Initialization of the boundary-forced-basing configuration. </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a681cb69f1a6fe142e5baa6aee5f57060"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebfb__initialization.html#a681cb69f1a6fe142e5baa6aee5f57060">bfb_set_coord</a> (Rlay, g_prime, GV, param_file, eqn_of_state)</td></tr>
<tr class="memdesc:a681cb69f1a6fe142e5baa6aee5f57060"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine specifies the vertical coordinate in terms of temperature at the surface and at the bottom. This case is set up in such a way that the temperature of the topmost layer is equal to the SST at the southern edge of the domain. The temperatures are then converted to densities of the top and bottom layers and linearly interpolated for the intermediate layers.  <a href="namespacebfb__initialization.html#a681cb69f1a6fe142e5baa6aee5f57060">More...</a><br /></td></tr>
<tr class="separator:a681cb69f1a6fe142e5baa6aee5f57060"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1bf4c8e60817f03359d3fd31aab5a90"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebfb__initialization.html#af1bf4c8e60817f03359d3fd31aab5a90">bfb_initialize_sponges_southonly</a> (G, GV, US, use_temperature, tv, param_file, CSp, h)</td></tr>
<tr class="memdesc:af1bf4c8e60817f03359d3fd31aab5a90"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine sets up the sponges for the southern bouundary of the domain. Maximum damping occurs within 2 degrees lat of the boundary. The damping linearly decreases northward over the next 2 degrees.  <a href="namespacebfb__initialization.html#af1bf4c8e60817f03359d3fd31aab5a90">More...</a><br /></td></tr>
<tr class="separator:af1bf4c8e60817f03359d3fd31aab5a90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf4641a95e7aa3b9953db2b04a627c97"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebfb__initialization.html#acf4641a95e7aa3b9953db2b04a627c97">write_bfb_log</a> (param_file)</td></tr>
<tr class="memdesc:acf4641a95e7aa3b9953db2b04a627c97"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write output about the parameter values being used.  <a href="namespacebfb__initialization.html#acf4641a95e7aa3b9953db2b04a627c97">More...</a><br /></td></tr>
<tr class="separator:acf4641a95e7aa3b9953db2b04a627c97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a8e08501c7f85819406ff2e7f5cc6bb6b"><td class="memItemLeft" align="right" valign="top">logical&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacebfb__initialization.html#a8e08501c7f85819406ff2e7f5cc6bb6b">first_call</a> = .true.</td></tr>
<tr class="memdesc:a8e08501c7f85819406ff2e7f5cc6bb6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unsafe model variable.  <a href="namespacebfb__initialization.html#a8e08501c7f85819406ff2e7f5cc6bb6b">More...</a><br /></td></tr>
<tr class="separator:a8e08501c7f85819406ff2e7f5cc6bb6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="af1bf4c8e60817f03359d3fd31aab5a90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1bf4c8e60817f03359d3fd31aab5a90">&#9670;&nbsp;</a></span>bfb_initialize_sponges_southonly()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public bfb_initialization::bfb_initialize_sponges_southonly </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>use_temperature</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(sponge_cs), pointer&#160;</td>
          <td class="paramname"><em>CSp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( : ,  : ,  : ), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine sets up the sponges for the southern bouundary of the domain. Maximum damping occurs within 2 degrees lat of the boundary. The damping linearly decreases northward over the next 2 degrees. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use_temperature</td><td>If true, temperature and salinity are used as state variables. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>A structure pointing to various thermodynamic variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure to parse for run-time parameters </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">csp</td><td>A pointer to the sponge control structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thicknesses [H ~&gt; m or kg m-2] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="BFB__initialization_8F90_source.html#l00080">80</a> of file <a class="el" href="BFB__initialization_8F90_source.html">BFB_initialization.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),   <span class="keywordtype">intent(in)</span> :: G<span class="comment">  !&lt; The ocean&#39;s grid structure</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type), <span class="keywordtype">intent(in)</span> :: GV<span class="comment"> !&lt; The ocean&#39;s vertical grid structure.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),   <span class="keywordtype">intent(in)</span> :: US<span class="comment"> !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordtype">logical</span>,                 <span class="keywordtype">intent(in)</span> :: use_temperature<span class="comment"> !&lt; If true, temperature and salinity are used as</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">                                            !! state variables.</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),   <span class="keywordtype">intent(in)</span> :: tv<span class="comment">   !&lt; A structure pointing to various thermodynamic variables</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; A structure to parse for run-time parameters</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordtype">type</span>(sponge_CS),         <span class="keywordtype">pointer</span>    :: CSp<span class="comment">  !&lt; A pointer to the sponge control structure</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(NIMEM_, NJMEM_, NKMEM_)</span>, &amp;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                           <span class="keywordtype">intent(in)</span> :: h<span class="comment">    !&lt; Layer thicknesses [H ~&gt; m or kg m-2]</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="keywordtype">  real</span> :: eta(SZI_(G),SZJ_(G),SZK_(G)+1) <span class="comment">! A temporary array for eta, in depth units [Z ~&gt; m].</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="keywordtype">  real</span> :: Idamp(SZI_(G),SZJ_(G))    <span class="comment">! The inverse damping rate [s-1].</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="keywordtype">  real</span> :: H0(SZK_(G))               <span class="comment">! Resting layer thicknesses in depth units [Z ~&gt; m].</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="keywordtype">  real</span> :: min_depth                 <span class="comment">! The minimum ocean depth in depth units [Z ~&gt; m].</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="keywordtype">  real</span> :: damp, e_dense, damp_new, slat, wlon, lenlat, lenlon, nlat</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;BFB_initialize_sponges_southonly&quot;</span> <span class="comment">! This subroutine&#39;s name.</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, isd, ied, jsd, jed, nz</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  isd = g%isd ; ied = g%ied ; jsd = g%jsd ; jed = g%jed</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  eta(:,:,:) = 0.0 ; idamp(:,:) = 0.0</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">!  Here the inverse damping time [s-1], is set. Set Idamp to 0     !</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">!  wherever there is no sponge, and the subroutines that are called  !</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">!  will automatically set up the sponges only where Idamp is positive!</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">!  and mask2dT is 1.                                                   !</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">!   Set up sponges for DOME configuration</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;MINIMUM_DEPTH&quot;</span>, min_depth, &amp;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                 <span class="stringliteral">&quot;The minimum depth of the ocean.&quot;</span>, units=<span class="stringliteral">&quot;m&quot;</span>, default=0.0, scale=us%m_to_Z)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SOUTHLAT&quot;</span>, slat, &amp;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                 <span class="stringliteral">&quot;The southern latitude of the domain.&quot;</span>, units=<span class="stringliteral">&quot;degrees&quot;</span>)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;LENLAT&quot;</span>, lenlat, &amp;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                 <span class="stringliteral">&quot;The latitudinal length of the domain.&quot;</span>, units=<span class="stringliteral">&quot;degrees&quot;</span>)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;WESTLON&quot;</span>, wlon, &amp;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                 <span class="stringliteral">&quot;The western longitude of the domain.&quot;</span>, units=<span class="stringliteral">&quot;degrees&quot;</span>, default=0.0)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;LENLON&quot;</span>, lenlon, &amp;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                 <span class="stringliteral">&quot;The longitudinal length of the domain.&quot;</span>, units=<span class="stringliteral">&quot;degrees&quot;</span>)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  nlat = slat + lenlat</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordflow">do</span> k=1,nz ; h0(k) = -g%max_depth * real(k-1) / real(nz) ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">! Use for meridional thickness profile initialization</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">!  do k=1,nz ; H0(k) = -G%max_depth * real(k-1) / real(nz-1) ; enddo</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keywordflow">do</span> i=is,ie; <span class="keywordflow">do</span> j=js,je</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">if</span> (g%geoLatT(i,j) &lt; slat+2.0) <span class="keywordflow">then</span> ; damp = 1.0</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">elseif</span> (g%geoLatT(i,j) &lt; slat+4.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;       damp_new = 1.0*(slat+4.0-g%geoLatT(i,j))/2.0</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">else</span> ; damp = 0.0</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">! These will be streched inside of apply_sponge, so they can be in</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">! depth space for Boussinesq or non-Boussinesq models.</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">! This section is used for uniform thickness initialization</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">do</span> k = 1,nz; eta(i,j,k) = h0(k);<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">! The below section is used for meridional temperature profile thickness initiation</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">! do k = 1,nz; eta(i,j,k) = H0(k); enddo</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">! if (G%geoLatT(i,j) &gt; 40.0) then</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">!   do k = 1,nz</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">!     eta(i,j,k) = -G%Angstrom_Z*(k-1)</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">!   enddo</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">! elseif (G%geoLatT(i,j) &gt; 20.0) then</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">!   do k = 1,nz</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="comment">!     eta(i,j,k) = min(H0(k) + (G%geoLatT(i,j) - 20.0)*(G%max_depth - nz*G%Angstrom_Z)/20.0, &amp;</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">!                      -(k-1)*G%Angstrom_Z)</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">!   enddo</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">! endif</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    eta(i,j,nz+1) = -g%max_depth</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> (g%bathyT(i,j) &gt; min_depth) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      idamp(i,j) = damp/86400.0</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">else</span> ; idamp(i,j) = 0.0 ;<span class="keywordflow"> endif</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">!  This call sets up the damping rates and interface heights.</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">!  This sets the inverse damping timescale fields in the sponges.    !</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keyword">call </span>initialize_sponge(idamp, eta, g, param_file, csp, gv)</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">!   Now register all of the fields which are damped in the sponge.   !</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">! By default, momentum is advected vertically within the sponge, but !</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">! momentum is typically not damped within the sponge.                !</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">if</span> (first_call) <span class="keyword">call </span>write_bfb_log(param_file)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="BFB__initialization_8F90_source.html#l00030">first_call</a>, <a class="el" href="MOM__sponge_8F90_source.html#l00089">mom_sponge::initialize_sponge()</a>, and <a class="el" href="BFB__initialization_8F90_source.html#l00174">write_bfb_log()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00124">mom_state_initialization::mom_initialize_state()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacebfb__initialization_af1bf4c8e60817f03359d3fd31aab5a90_cgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacebfb__initialization_af1bf4c8e60817f03359d3fd31aab5a90_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a681cb69f1a6fe142e5baa6aee5f57060"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a681cb69f1a6fe142e5baa6aee5f57060">&#9670;&nbsp;</a></span>bfb_set_coord()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public bfb_initialization::bfb_set_coord </td>
          <td>(</td>
          <td class="paramtype">real, dimension( : ), intent(out)&#160;</td>
          <td class="paramname"><em>Rlay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( : ), intent(out)&#160;</td>
          <td class="paramname"><em>g_prime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(eos_type), pointer&#160;</td>
          <td class="paramname"><em>eqn_of_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine specifies the vertical coordinate in terms of temperature at the surface and at the bottom. This case is set up in such a way that the temperature of the topmost layer is equal to the SST at the southern edge of the domain. The temperatures are then converted to densities of the top and bottom layers and linearly interpolated for the intermediate layers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">rlay</td><td>Layer potential density. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">g_prime</td><td>The reduced gravity at each interface [m2 Z-1 s-2 ~&gt; m s-2]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure to parse for run-time parameters </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">eqn_of_state</td><td>Integer that selects the equation of state. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="BFB__initialization_8F90_source.html#l00039">39</a> of file <a class="el" href="BFB__initialization_8F90_source.html">BFB_initialization.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(NKMEM_)</span>, <span class="keywordtype">intent(out)</span> :: Rlay<span class="comment"> !&lt; Layer potential density.</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(NKMEM_)</span>, <span class="keywordtype">intent(out)</span> :: g_prime<span class="comment"> !&lt; The reduced gravity at</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">                                                  !! each interface [m2 Z-1 s-2 ~&gt; m s-2].</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type), <span class="keywordtype">intent(in)</span>  :: GV<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span>  :: param_file<span class="comment"> !&lt; A structure to parse for run-time parameters</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordtype">type</span>(EOS_type),          <span class="keywordtype">pointer</span>     :: eqn_of_state<span class="comment"> !&lt; Integer that selects the</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">                                                     !! equation of state.</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keywordtype">  real</span>                                 :: drho_dt, SST_s, T_bot, rho_top, rho_bot</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordtype">integer</span>                              :: k, nz</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;BFB_set_coord&quot;</span> <span class="comment">! This subroutine&#39;s name.</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;DRHO_DT&quot;</span>, drho_dt, &amp;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;          <span class="stringliteral">&quot;Rate of change of density with temperature.&quot;</span>, &amp;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;           units=<span class="stringliteral">&quot;kg m-3 K-1&quot;</span>, default=-0.2)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SST_S&quot;</span>, sst_s, &amp;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;          <span class="stringliteral">&quot;SST at the suothern edge of the domain.&quot;</span>, units=<span class="stringliteral">&quot;C&quot;</span>, default=20.0)</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;T_BOT&quot;</span>, t_bot, &amp;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                 <span class="stringliteral">&quot;Bottom Temp&quot;</span>, units=<span class="stringliteral">&quot;C&quot;</span>, default=5.0)</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  rho_top = gv%rho0 + drho_dt*sst_s</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  rho_bot = gv%rho0 + drho_dt*t_bot</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  nz = gv%ke</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordflow">do</span> k = 1,nz</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    rlay(k) = (rho_bot - rho_top)/(nz-1)*real(k-1) + rho_top</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">if</span> (k &gt;1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      g_prime(k) = (rlay(k) - rlay(k-1)) * gv%g_Earth/gv%rho0</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      g_prime(k) = gv%g_Earth</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">!Rlay(:) = 0.0</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">!g_prime(:) = 0.0</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">if</span> (first_call) <span class="keyword">call </span>write_bfb_log(param_file)</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="BFB__initialization_8F90_source.html#l00030">first_call</a>, and <a class="el" href="BFB__initialization_8F90_source.html#l00174">write_bfb_log()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__coord__initialization_8F90_source.html#l00040">mom_coord_initialization::mom_initialize_coord()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacebfb__initialization_a681cb69f1a6fe142e5baa6aee5f57060_cgraph.svg" width="302" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacebfb__initialization_a681cb69f1a6fe142e5baa6aee5f57060_icgraph.svg" width="100%" height="378"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="acf4641a95e7aa3b9953db2b04a627c97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf4641a95e7aa3b9953db2b04a627c97">&#9670;&nbsp;</a></span>write_bfb_log()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine bfb_initialization::write_bfb_log </td>
          <td>(</td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Write output about the parameter values being used. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure indicating the open file to parse for model parameter values. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="BFB__initialization_8F90_source.html#l00174">174</a> of file <a class="el" href="BFB__initialization_8F90_source.html">BFB_initialization.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordtype">type</span>(param_file_type), <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; A structure indicating the</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">                                                  !! open file to parse for model</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">                                                  !! parameter values.</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;BFB_initialization&quot;</span> <span class="comment">! This module&#39;s name.</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keyword">call </span>log_version(param_file, mdl, version)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  first_call = .false.</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="BFB__initialization_8F90_source.html#l00030">first_call</a>.</p>

<p class="reference">Referenced by <a class="el" href="BFB__initialization_8F90_source.html#l00080">bfb_initialize_sponges_southonly()</a>, and <a class="el" href="BFB__initialization_8F90_source.html#l00039">bfb_set_coord()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacebfb__initialization_acf4641a95e7aa3b9953db2b04a627c97_icgraph.svg" width="100%" height="400"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a8e08501c7f85819406ff2e7f5cc6bb6b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e08501c7f85819406ff2e7f5cc6bb6b">&#9670;&nbsp;</a></span>first_call</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical bfb_initialization::first_call = .true.</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Unsafe model variable. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000007">Todo:</a></b></dt><dd>Remove this module variable </dd></dl>

<p class="definition">Definition at line <a class="el" href="BFB__initialization_8F90_source.html#l00030">30</a> of file <a class="el" href="BFB__initialization_8F90_source.html">BFB_initialization.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keywordtype">logical</span> :: first_call = .true.</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="BFB__initialization_8F90_source.html#l00080">bfb_initialize_sponges_southonly()</a>, <a class="el" href="BFB__initialization_8F90_source.html#l00039">bfb_set_coord()</a>, and <a class="el" href="BFB__initialization_8F90_source.html#l00174">write_bfb_log()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacebfb__initialization.html">bfb_initialization</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
