<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: oil_tracer Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespaceoil__tracer.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">oil_tracer Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A tracer package to mimic dissolved oil. </p>
<p>By Alistair Adcroft and Robert Hallberg, 2010 *</p>
<p>In the midst of the Deepwater Horizon oil spill, it became evident that models were needed to predict the long-term fate of dissolved oil in the open ocean. This tracer packages mimics the transport, dilution and decay of dissolved oil plumes in the ocean.</p>
<p>This tracer package was central to the simulations used by Adcroft et al., GRL 2010, to prove that the Deepwater Horizon spill was an important regional event, with implications for dissolved oxygen levels in the Gulf of Mexico, but not one that would directly impact the East Coast of the U.S. </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structoil__tracer_1_1oil__tracer__cs.html">oil_tracer_cs</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The control structure for the oil tracer package.  <a href="structoil__tracer_1_1oil__tracer__cs.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ae9bef348e3fea3af157e841a0c9f6aeb"><td class="memItemLeft" align="right" valign="top">logical function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceoil__tracer.html#ae9bef348e3fea3af157e841a0c9f6aeb">register_oil_tracer</a> (HI, GV, param_file, CS, tr_Reg, restart_CS)</td></tr>
<tr class="memdesc:ae9bef348e3fea3af157e841a0c9f6aeb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register oil tracer fields and subroutines to be used with MOM.  <a href="namespaceoil__tracer.html#ae9bef348e3fea3af157e841a0c9f6aeb">More...</a><br /></td></tr>
<tr class="separator:ae9bef348e3fea3af157e841a0c9f6aeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cb362789ef0ea593f8b7de22016a92e"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceoil__tracer.html#a3cb362789ef0ea593f8b7de22016a92e">initialize_oil_tracer</a> (restart, day, G, GV, US, h, diag, OBC, CS, sponge_CSp)</td></tr>
<tr class="memdesc:a3cb362789ef0ea593f8b7de22016a92e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the oil tracers and set up tracer output.  <a href="namespaceoil__tracer.html#a3cb362789ef0ea593f8b7de22016a92e">More...</a><br /></td></tr>
<tr class="separator:a3cb362789ef0ea593f8b7de22016a92e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16435914b962aacb079217f7c88d7b0a"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceoil__tracer.html#a16435914b962aacb079217f7c88d7b0a">oil_tracer_column_physics</a> (h_old, h_new, ea, eb, fluxes, dt, G, GV, CS, tv, evap_CFL_limit, minimum_forcing_depth)</td></tr>
<tr class="memdesc:a16435914b962aacb079217f7c88d7b0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply sources, sinks, diapycnal mixing and rising motions to the oil tracers.  <a href="namespaceoil__tracer.html#a16435914b962aacb079217f7c88d7b0a">More...</a><br /></td></tr>
<tr class="separator:a16435914b962aacb079217f7c88d7b0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8964b16549dba8fc850e4af15af8029"><td class="memItemLeft" align="right" valign="top">integer function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceoil__tracer.html#ac8964b16549dba8fc850e4af15af8029">oil_stock</a> (h, stocks, G, GV, CS, names, units, stock_index)</td></tr>
<tr class="memdesc:ac8964b16549dba8fc850e4af15af8029"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the mass-weighted integral of the oil tracer stocks, returning the number of stocks it has calculated. If the stock_index is present, only the stock corresponding to that coded index is returned.  <a href="namespaceoil__tracer.html#ac8964b16549dba8fc850e4af15af8029">More...</a><br /></td></tr>
<tr class="separator:ac8964b16549dba8fc850e4af15af8029"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ce7b2baccfc17f5c5ba0e52b9c44cc6"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceoil__tracer.html#a8ce7b2baccfc17f5c5ba0e52b9c44cc6">oil_tracer_surface_state</a> (state, h, G, CS)</td></tr>
<tr class="memdesc:a8ce7b2baccfc17f5c5ba0e52b9c44cc6"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine extracts the surface fields from this tracer package that are to be shared with the atmosphere in coupled configurations. This particular tracer package does not report anything back to the coupler.  <a href="namespaceoil__tracer.html#a8ce7b2baccfc17f5c5ba0e52b9c44cc6">More...</a><br /></td></tr>
<tr class="separator:a8ce7b2baccfc17f5c5ba0e52b9c44cc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a428f70692e0f8a537b73e24ada1e5357"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceoil__tracer.html#a428f70692e0f8a537b73e24ada1e5357">oil_tracer_end</a> (CS)</td></tr>
<tr class="memdesc:a428f70692e0f8a537b73e24ada1e5357"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deallocate memory associated with this tracer package.  <a href="namespaceoil__tracer.html#a428f70692e0f8a537b73e24ada1e5357">More...</a><br /></td></tr>
<tr class="separator:a428f70692e0f8a537b73e24ada1e5357"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a7d9cefa818e16dd56e1051c3bcff940f"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceoil__tracer.html#a7d9cefa818e16dd56e1051c3bcff940f">ntr_max</a> = 20</td></tr>
<tr class="memdesc:a7d9cefa818e16dd56e1051c3bcff940f"><td class="mdescLeft">&#160;</td><td class="mdescRight">the maximum number of tracers in this module.  <a href="namespaceoil__tracer.html#a7d9cefa818e16dd56e1051c3bcff940f">More...</a><br /></td></tr>
<tr class="separator:a7d9cefa818e16dd56e1051c3bcff940f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a3cb362789ef0ea593f8b7de22016a92e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cb362789ef0ea593f8b7de22016a92e">&#9670;&nbsp;</a></span>initialize_oil_tracer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public oil_tracer::initialize_oil_tracer </td>
          <td>(</td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>restart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in), target&#160;</td>
          <td class="paramname"><em>day</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diag_ctrl), intent(in), target&#160;</td>
          <td class="paramname"><em>diag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_obc_type), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structoil__tracer_1_1oil__tracer__cs.html">oil_tracer_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(sponge_cs), pointer&#160;</td>
          <td class="paramname"><em>sponge_CSp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the oil tracers and set up tracer output. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">restart</td><td>.true. if the fields have already been read from a restart file. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">day</td><td>Time of the start of the run. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thicknesses [H ~&gt; m or kg m-2] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">diag</td><td>A structure that is used to regulate diagnostic output. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>This open boundary condition type specifies whether, where, and what open boundary conditions are used. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>The control structure returned by a previous call to register_oil_tracer. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">sponge_csp</td><td>Pointer to the control structure for the sponges. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="oil__tracer_8F90_source.html#l00205">205</a> of file <a class="el" href="oil__tracer_8F90_source.html">oil_tracer.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordtype">logical</span>,                            <span class="keywordtype">intent(in)</span> :: restart<span class="comment"> !&lt; .true. if the fields have already</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">                                                         !! been read from a restart file.</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordtype">type</span>(time_type),            <span class="keywordtype">target</span>, <span class="keywordtype">intent(in)</span> :: day<span class="comment">  !&lt; Time of the start of the run.</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),              <span class="keywordtype">intent(in)</span> :: G<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type),            <span class="keywordtype">intent(in)</span> :: GV<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),              <span class="keywordtype">intent(in)</span> :: US<span class="comment">   !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                                      <span class="keywordtype">intent(in)</span> :: h<span class="comment">    !&lt; Layer thicknesses [H ~&gt; m or kg m-2]</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl),            <span class="keywordtype">target</span>, <span class="keywordtype">intent(in)</span> :: diag<span class="comment"> !&lt; A structure that is used to regulate</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">                                                         !! diagnostic output.</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),               <span class="keywordtype">pointer</span>    :: OBC<span class="comment">  !&lt; This open boundary condition type specifies</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">                                                         !! whether, where, and what open boundary</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">                                                         !! conditions are used.</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordtype">type</span>(oil_tracer_CS),                <span class="keywordtype">pointer</span>    :: CS<span class="comment"> !&lt; The control structure returned by a previous</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">                                                       !! call to register_oil_tracer.</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keywordtype">type</span>(sponge_CS),                    <span class="keywordtype">pointer</span>    :: sponge_CSp<span class="comment"> !&lt; Pointer to the control structure for the sponges.</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordtype">character(len=16)</span> :: name     <span class="comment">! A variable&#39;s name in a NetCDF file.</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordtype">character(len=72)</span> :: longname <span class="comment">! The long name of that variable.</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordtype">character(len=48)</span> :: units    <span class="comment">! The dimensions of the variable.</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="keywordtype">character(len=48)</span> :: flux_units <span class="comment">! The units for age tracer fluxes, either</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                <span class="comment">! years m3 s-1 or years kg s-1.</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordtype">logical</span> :: OK</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, isd, ied, jsd, jed, nz, m</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="keywordtype">integer</span> :: IsdB, IedB, JsdB, JedB</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordflow">if</span> (cs%ntr &lt; 1) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = gv%ke</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  isd = g%isd ; ied = g%ied ; jsd = g%jsd ; jed = g%jed</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  isdb = g%IsdB ; iedb = g%IedB ; jsdb = g%JsdB ; jedb = g%JedB</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="comment">! Establish location of source</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordflow">do</span> j=g%jsdB+1,g%jed ; <span class="keywordflow">do</span> i=g%isdB+1,g%ied</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">! This test for i,j index is specific to a lat/lon (non-rotated grid).</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">! and needs to be generalized to work properly on the tri-polar grid.</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">if</span> (cs%oil_source_longitude&lt;g%geoLonBu(i,j) .and. &amp;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        cs%oil_source_longitude&gt;=g%geoLonBu(i-1,j) .and. &amp;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        cs%oil_source_latitude&lt;g%geoLatBu(i,j) .and. &amp;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        cs%oil_source_latitude&gt;=g%geoLatBu(i,j-1) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      cs%oil_source_i=i</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      cs%oil_source_j=j</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  cs%Time =&gt; day</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  cs%diag =&gt; diag</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordflow">do</span> m=1,cs%ntr</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keyword">call </span>query_vardesc(cs%tr_desc(m), name=name, caller=<span class="stringliteral">&quot;initialize_oil_tracer&quot;</span>)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">if</span> ((.not.restart) .or. (cs%oil_may_reinit .and. .not. &amp;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        query_initialized(cs%tr(:,:,:,m), name, cs%restart_CSp))) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="keywordflow">if</span> (len_trim(cs%IC_file) &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="comment">!  Read the tracer concentrations from a netcdf file.</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">if</span> (.not.file_exists(cs%IC_file, g%Domain)) &amp;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;          <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;initialize_oil_tracer: &quot;</span>// &amp;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                                 <span class="stringliteral">&quot;Unable to open &quot;</span>//cs%IC_file)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">if</span> (cs%Z_IC_file) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;          ok = tracer_z_init(cs%tr(:,:,:,m), h, cs%IC_file, name, &amp;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                             g, us, -1e34, 0.0) <span class="comment">! CS%land_val(m))</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;          <span class="keywordflow">if</span> (.not.ok) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            ok = tracer_z_init(cs%tr(:,:,:,m), h, cs%IC_file, &amp;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                     trim(name), g, us, -1e34, 0.0) <span class="comment">! CS%land_val(m))</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="keywordflow">if</span> (.not.ok) <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;initialize_oil_tracer: &quot;</span>//&amp;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                    <span class="stringliteral">&quot;Unable to read &quot;</span>//trim(name)//<span class="stringliteral">&quot; from &quot;</span>//&amp;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                    trim(cs%IC_file)//<span class="stringliteral">&quot;.&quot;</span>)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;          <span class="keyword">call </span>mom_read_data(cs%IC_file, trim(name), cs%tr(:,:,:,m), g%Domain)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;          <span class="keywordflow">if</span> (g%mask2dT(i,j) &lt; 0.5) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            cs%tr(i,j,k,m) = cs%land_val(m)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            cs%tr(i,j,k,m) = cs%IC_val(m)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="keywordflow">    endif</span> <span class="comment">! restart</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="keywordflow">  enddo</span> <span class="comment">! Tracer loop</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">! Put something here...</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>, <a class="el" href="MOM__io_8F90_source.html#l00699">mom_io::query_vardesc()</a>, and <a class="el" href="MOM__tracer__Z__init_8F90_source.html#l00031">mom_tracer_z_init::tracer_z_init()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespaceoil__tracer_a3cb362789ef0ea593f8b7de22016a92e_cgraph.svg" width="100%" height="539"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ac8964b16549dba8fc850e4af15af8029"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8964b16549dba8fc850e4af15af8029">&#9670;&nbsp;</a></span>oil_stock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public oil_tracer::oil_stock </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>stocks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structoil__tracer_1_1oil__tracer__cs.html">oil_tracer_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>names</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>units</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional&#160;</td>
          <td class="paramname"><em>stock_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate the mass-weighted integral of the oil tracer stocks, returning the number of stocks it has calculated. If the stock_index is present, only the stock corresponding to that coded index is returned. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thicknesses [H ~&gt; m or kg m-2] </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">stocks</td><td>the mass-weighted integrated amount of each tracer, in kg times concentration units [kg conc]. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>The control structure returned by a previous call to register_oil_tracer. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">names</td><td>the names of the stocks calculated. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">units</td><td>the units of the stocks calculated. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">stock_index</td><td>the coded index of a specific stock being sought. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of stocks calculated here. </dd></dl>

<p class="definition">Definition at line <a class="el" href="oil__tracer_8F90_source.html#l00406">406</a> of file <a class="el" href="oil__tracer_8F90_source.html">oil_tracer.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),              <span class="keywordtype">intent(in)</span>    :: G<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type),            <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span> :: h<span class="comment">    !&lt; Layer thicknesses [H ~&gt; m or kg m-2]</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:)</span>,                 <span class="keywordtype">intent(out)</span>   :: stocks<span class="comment"> !&lt; the mass-weighted integrated amount of each</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">                                                              !! tracer, in kg times concentration units [kg conc].</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keywordtype">type</span>(oil_tracer_CS),                <span class="keywordtype">pointer</span>       :: CS<span class="comment">   !&lt; The control structure returned by a previous</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">                                                            !! call to register_oil_tracer.</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">dimension(:)</span>,     <span class="keywordtype">intent(out)</span>   :: names<span class="comment">  !&lt; the names of the stocks calculated.</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">dimension(:)</span>,     <span class="keywordtype">intent(out)</span>   :: units<span class="comment">  !&lt; the units of the stocks calculated.</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">optional</span>,                  <span class="keywordtype">intent(in)</span>    :: stock_index<span class="comment"> !&lt; the coded index of a specific stock</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">                                                                   !! being sought.</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordtype">integer</span>                                           :: oil_stock<span class="comment"> !&lt; The number of stocks calculated here.</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">! This function calculates the mass-weighted integral of all tracer stocks,</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">! returning the number of stocks it has calculated.  If the stock_index</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">! is present, only the stock corresponding to that coded index is returned.</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz, m</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = gv%ke</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  oil_stock = 0</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keywordflow">if</span> (cs%ntr &lt; 1) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(stock_index)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (stock_index &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="comment">! Check whether this stock is available from this routine.</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="comment">! No stocks from this routine are being checked yet.  Return 0.</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="keywordflow">  endif</span> ;<span class="keywordflow"> endif</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <span class="keywordflow">do</span> m=1,cs%ntr</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keyword">call </span>query_vardesc(cs%tr_desc(m), name=names(m), units=units(m), caller=<span class="stringliteral">&quot;oil_stock&quot;</span>)</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    units(m) = trim(units(m))//<span class="stringliteral">&quot; kg&quot;</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    stocks(m) = 0.0</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      stocks(m) = stocks(m) + cs%tr(i,j,k,m) * &amp;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                             (g%mask2dT(i,j) * g%US%L_to_m**2*g%areaT(i,j) * h(i,j,k))</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    stocks(m) = gv%H_to_kg_m2 * stocks(m)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  oil_stock = cs%ntr</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__io_8F90_source.html#l00699">mom_io::query_vardesc()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__tracer__flow__control_8F90_source.html#l00574">mom_tracer_flow_control::call_tracer_stocks()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespaceoil__tracer_ac8964b16549dba8fc850e4af15af8029_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespaceoil__tracer_ac8964b16549dba8fc850e4af15af8029_icgraph.svg" width="598" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a16435914b962aacb079217f7c88d7b0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16435914b962aacb079217f7c88d7b0a">&#9670;&nbsp;</a></span>oil_tracer_column_physics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public oil_tracer::oil_tracer_column_physics </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>h_old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>h_new</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>ea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>eb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(forcing), intent(in)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structoil__tracer_1_1oil__tracer__cs.html">oil_tracer_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>evap_CFL_limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>minimum_forcing_depth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Apply sources, sinks, diapycnal mixing and rising motions to the oil tracers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_old</td><td>Layer thickness before entrainment [H ~&gt; m or kg m-2]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_new</td><td>Layer thickness after entrainment [H ~&gt; m or kg m-2]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ea</td><td>an array to which the amount of fluid entrained </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eb</td><td>an array to which the amount of fluid entrained </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fluxes</td><td>A structure containing pointers to thermodynamic and tracer forcing fields. Unused fields have NULL ptrs. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>The amount of time covered by this call [s] </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>The control structure returned by a previous call to register_oil_tracer. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>A structure pointing to various thermodynamic variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">evap_cfl_limit</td><td>Limit on the fraction of the water that can be fluxed out of the top layer in a timestep [nondim] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">minimum_forcing_depth</td><td>The smallest depth over which fluxes can be applied [m] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="oil__tracer_8F90_source.html#l00300">300</a> of file <a class="el" href="oil__tracer_8F90_source.html">oil_tracer.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),   <span class="keywordtype">intent(in)</span> :: G<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type), <span class="keywordtype">intent(in)</span> :: GV<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                           <span class="keywordtype">intent(in)</span> :: h_old<span class="comment"> !&lt; Layer thickness before entrainment [H ~&gt; m or kg m-2].</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                           <span class="keywordtype">intent(in)</span> :: h_new<span class="comment"> !&lt; Layer thickness after entrainment [H ~&gt; m or kg m-2].</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                           <span class="keywordtype">intent(in)</span> :: ea<span class="comment">   !&lt; an array to which the amount of fluid entrained</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">                                              !! from the layer above during this call will be</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">                                              !! added [H ~&gt; m or kg m-2].</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                           <span class="keywordtype">intent(in)</span> :: eb<span class="comment">   !&lt; an array to which the amount of fluid entrained</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">                                              !! from the layer below during this call will be</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">                                              !! added [H ~&gt; m or kg m-2].</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keywordtype">type</span>(forcing),           <span class="keywordtype">intent(in)</span> :: fluxes<span class="comment"> !&lt; A structure containing pointers to thermodynamic</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">                                              !! and tracer forcing fields.  Unused fields have NULL ptrs.</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="keywordtype">  real</span>,                    <span class="keywordtype">intent(in)</span> :: dt<span class="comment">   !&lt; The amount of time covered by this call [s]</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordtype">type</span>(oil_tracer_CS),     <span class="keywordtype">pointer</span>    :: CS<span class="comment">   !&lt; The control structure returned by a previous</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">                                              !! call to register_oil_tracer.</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),   <span class="keywordtype">intent(in)</span> :: tv<span class="comment">   !&lt; A structure pointing to various thermodynamic variables</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="keywordtype">  real</span>,          <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: evap_CFL_limit<span class="comment"> !&lt; Limit on the fraction of the water that can</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">                                              !! be fluxed out of the top layer in a timestep [nondim]</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="keywordtype">  real</span>,          <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: minimum_forcing_depth<span class="comment"> !&lt; The smallest depth over which</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">                                              !! fluxes can be applied [m]</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">!   This subroutine applies diapycnal diffusion and any other column</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">! tracer physics or chemistry to the tracers from this file.</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">! This is a simple example of a set of advected passive tracers.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">! The arguments to this subroutine are redundant in that</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">!     h_new(k) = h_old(k) + ea(k) - eb(k-1) + eb(k) - ea(k+1)</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span> :: h_work <span class="comment">! Used so that h can be modified</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="keywordtype">  real</span> :: Isecs_per_year = 1.0 / (365.0*86400.0)</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="keywordtype">  real</span> :: year, h_total, ldecay</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz, m, k_max</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = gv%ke</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordflow">if</span> (cs%ntr &lt; 1) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(evap_cfl_limit) .and. <span class="keyword">present</span>(minimum_forcing_depth)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">do</span> m=1,cs%ntr</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="keywordflow">do</span> k=1,nz ;<span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        h_work(i,j,k) = h_old(i,j,k)</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keyword">call </span>applytracerboundaryfluxesinout(g, gv, cs%tr(:,:,:,m) , dt, fluxes, h_work, &amp;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;          evap_cfl_limit, minimum_forcing_depth)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keyword">call </span>tracer_vertdiff(h_work, ea, eb, dt, cs%tr(:,:,:,m), g, gv)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">do</span> m=1,cs%ntr</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="keyword">call </span>tracer_vertdiff(h_old, ea, eb, dt, cs%tr(:,:,:,m), g, gv)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  year = time_type_to_real(cs%Time) * isecs_per_year</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="comment">! Decay tracer (limit decay rate to 1/dt - just in case)</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keywordflow">do</span> m=2,cs%ntr</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="comment">!CS%tr(i,j,k,m) = CS%tr(i,j,k,m) - dt*CS%oil_decay_rate(m)*CS%tr(i,j,k,m) ! Simple</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="comment">!CS%tr(i,j,k,m) = CS%tr(i,j,k,m) - min(dt*CS%oil_decay_rate(m),1.)*CS%tr(i,j,k,m) ! Safer</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keywordflow">if</span> (cs%oil_decay_rate(m)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        cs%tr(i,j,k,m) = g%mask2dT(i,j)*max(1.-dt*cs%oil_decay_rate(m),0.)*cs%tr(i,j,k,m) <span class="comment">! Safest</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="keywordflow">elseif</span> (cs%oil_decay_rate(m)&lt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        ldecay = 12.*(3.0**(-(tv%T(i,j,k)-20.)/10.)) <span class="comment">! Timescale [days]</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        ldecay = 1./(86400.*ldecay) <span class="comment">! Rate [s-1]</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        cs%tr(i,j,k,m) = g%mask2dT(i,j)*max(1.-dt*ldecay,0.)*cs%tr(i,j,k,m)</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="comment">! Add oil at the source location</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordflow">if</span> (year&gt;=cs%oil_start_year .and. year&lt;=cs%oil_end_year .and. &amp;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      cs%oil_source_i&gt;-999 .and. cs%oil_source_j&gt;-999) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    i=cs%oil_source_i ; j=cs%oil_source_j</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    k_max=nz ; h_total=0.</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">do</span> k=nz, 2, -1</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      h_total = h_total + h_new(i,j,k)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="keywordflow">if</span> (h_total&lt;10.) k_max=k-1 <span class="comment">! Find bottom most interface that is 10 m above bottom</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">do</span> m=1,cs%ntr</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      k=cs%oil_source_k(m)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <span class="keywordflow">if</span> (k&gt;0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        k=min(k,k_max) <span class="comment">! Only insert k or first layer with interface 10 m above bottom</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        cs%tr(i,j,k,m) = cs%tr(i,j,k,m) + cs%oil_source_rate*dt / &amp;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                ((h_new(i,j,k)+gv%H_subroundoff) * g%US%L_to_m**2*g%areaT(i,j) )</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <span class="keywordflow">elseif</span> (k&lt;0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        h_total=gv%H_subroundoff</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">do</span> k=1, nz</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;          h_total = h_total + h_new(i,j,k)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordflow">do</span> k=1, nz</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;          cs%tr(i,j,k,m) = cs%tr(i,j,k,m) + cs%oil_source_rate*dt/(h_total &amp;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                                           * g%US%L_to_m**2*g%areaT(i,j) )</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__tracer__diabatic_8F90_source.html#l00225">mom_tracer_diabatic::applytracerboundaryfluxesinout()</a>, and <a class="el" href="MOM__tracer__diabatic_8F90_source.html#l00027">mom_tracer_diabatic::tracer_vertdiff()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespaceoil__tracer_a16435914b962aacb079217f7c88d7b0a_cgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a428f70692e0f8a537b73e24ada1e5357"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a428f70692e0f8a537b73e24ada1e5357">&#9670;&nbsp;</a></span>oil_tracer_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public oil_tracer::oil_tracer_end </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structoil__tracer_1_1oil__tracer__cs.html">oil_tracer_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Deallocate memory associated with this tracer package. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cs</td><td>The control structure returned by a previous call to register_oil_tracer. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="oil__tracer_8F90_source.html#l00487">487</a> of file <a class="el" href="oil__tracer_8F90_source.html">oil_tracer.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordtype">type</span>(oil_tracer_CS), <span class="keywordtype">pointer</span> :: CS<span class="comment"> !&lt; The control structure returned by a previous</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">                                     !! call to register_oil_tracer.</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="keywordtype">integer</span> :: m</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tr)) <span class="keyword">deallocate</span>(cs%tr)</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keyword">deallocate</span>(cs)</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="keywordflow">  endif</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8ce7b2baccfc17f5c5ba0e52b9c44cc6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ce7b2baccfc17f5c5ba0e52b9c44cc6">&#9670;&nbsp;</a></span>oil_tracer_surface_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public oil_tracer::oil_tracer_surface_state </td>
          <td>(</td>
          <td class="paramtype">type(surface), intent(inout)&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structoil__tracer_1_1oil__tracer__cs.html">oil_tracer_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine extracts the surface fields from this tracer package that are to be shared with the atmosphere in coupled configurations. This particular tracer package does not report anything back to the coupler. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state</td><td>A structure containing fields that describe the surface state of the ocean. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thickness [H ~&gt; m or kg m-2]. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>The control structure returned by a previous call to register_oil_tracer. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="oil__tracer_8F90_source.html#l00456">456</a> of file <a class="el" href="oil__tracer_8F90_source.html">oil_tracer.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),  <span class="keywordtype">intent(in)</span>    :: G<span class="comment">  !&lt; The ocean&#39;s grid structure.</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordtype">type</span>(surface),          <span class="keywordtype">intent(inout)</span> :: state<span class="comment"> !&lt; A structure containing fields that</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">                                              !! describe the surface state of the ocean.</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                          <span class="keywordtype">intent(in)</span>    :: h<span class="comment">  !&lt; Layer thickness [H ~&gt; m or kg m-2].</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordtype">type</span>(oil_tracer_CS),    <span class="keywordtype">pointer</span>       :: CS<span class="comment"> !&lt; The control structure returned by a previous</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">                                              !! call to register_oil_tracer.</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="comment">! This particular tracer package does not report anything back to the coupler.</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="comment">! The code that is here is just a rough guide for packages that would.</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordtype">integer</span> :: m, is, ie, js, je, isd, ied, jsd, jed</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  isd = g%isd ; ied = g%ied ; jsd = g%jsd ; jed = g%jed</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="keywordflow">if</span> (cs%coupled_tracers) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">do</span> m=1,cs%ntr</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="comment">!   This call loads the surface values into the appropriate array in the</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="comment">! coupler-type structure.</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="keyword">call </span>coupler_type_set_data(cs%tr(:,:,1,m), cs%ind_tr(m), ind_csurf, &amp;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                   state%tr_fields, idim=(/isd, is, ie, ied/), &amp;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                   jdim=(/jsd, js, je, jed/) )</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="ae9bef348e3fea3af157e841a0c9f6aeb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9bef348e3fea3af157e841a0c9f6aeb">&#9670;&nbsp;</a></span>register_oil_tracer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical function, public oil_tracer::register_oil_tracer </td>
          <td>(</td>
          <td class="paramtype">type(hor_index_type), intent(in)&#160;</td>
          <td class="paramname"><em>HI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structoil__tracer_1_1oil__tracer__cs.html">oil_tracer_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(tracer_registry_type), pointer&#160;</td>
          <td class="paramname"><em>tr_Reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(mom_restart_cs), pointer&#160;</td>
          <td class="paramname"><em>restart_CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register oil tracer fields and subroutines to be used with MOM. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">hi</td><td>A horizontal index type structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure to parse for run-time parameters </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>A pointer that is set to point to the control structure for this module </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">tr_reg</td><td>A pointer that is set to point to the control structure for the tracer advection and diffusion module </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">restart_cs</td><td>A pointer to the restart control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="oil__tracer_8F90_source.html#l00078">78</a> of file <a class="el" href="oil__tracer_8F90_source.html">oil_tracer.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keywordtype">type</span>(hor_index_type),       <span class="keywordtype">intent(in)</span> :: HI<span class="comment">   !&lt; A horizontal index type structure</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type),    <span class="keywordtype">intent(in)</span> :: GV<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordtype">type</span>(param_file_type),      <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; A structure to parse for run-time parameters</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordtype">type</span>(oil_tracer_CS),        <span class="keywordtype">pointer</span>    :: CS<span class="comment"> !&lt; A pointer that is set to point to the control</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">                                               !! structure for this module</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type), <span class="keywordtype">pointer</span>   :: tr_Reg<span class="comment"> !&lt; A pointer that is set to point to the control</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">                                                  !! structure for the tracer advection and</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">                                                  !! diffusion module</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordtype">type</span>(MOM_restart_CS),       <span class="keywordtype">pointer</span>   :: restart_CS<span class="comment"> !&lt; A pointer to the restart control structure</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;oil_tracer&quot;</span> <span class="comment">! This module&#39;s name.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">character(len=200)</span> :: inputdir <span class="comment">! The directory where the input files are.</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordtype">character(len=48)</span>  :: var_name <span class="comment">! The variable&#39;s name.</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keywordtype">character(len=3)</span>   :: name_tag <span class="comment">! String for creating identifying oils</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordtype">character(len=48)</span> :: flux_units <span class="comment">! The units for tracer fluxes, here</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                            <span class="comment">! kg(oil) s-1 or kg(oil) m-3 kg(water) s-1.</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">pointer</span> :: tr_ptr(:,:,:) =&gt; null()</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordtype">logical</span> :: register_oil_tracer</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed, nz, m, i, j</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  isd = hi%isd ; ied = hi%ied ; jsd = hi%jsd ; jed = hi%jed ; nz = gv%ke</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;register_oil_tracer called with an &quot;</span>// &amp;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                             <span class="stringliteral">&quot;associated control structure.&quot;</span>)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keyword">allocate</span>(cs)</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">! Read all relevant parameters and write them to the model log.</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keyword">call </span>log_version(param_file, mdl, version, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OIL_IC_FILE&quot;</span>, cs%IC_file, &amp;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                 <span class="stringliteral">&quot;The file in which the oil tracer initial values can be &quot;</span>//&amp;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                 <span class="stringliteral">&quot;found, or an empty string for internal initialization.&quot;</span>, &amp;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                 default=<span class="stringliteral">&quot; &quot;</span>)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordflow">if</span> ((len_trim(cs%IC_file) &gt; 0) .and. (scan(cs%IC_file,<span class="stringliteral">&#39;/&#39;</span>) == 0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">! Add the directory if CS%IC_file is not already a complete path.</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR&quot;</span>, inputdir, default=<span class="stringliteral">&quot;.&quot;</span>)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    cs%IC_file = trim(slasher(inputdir))//trim(cs%IC_file)</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR/CFC_IC_FILE&quot;</span>, cs%IC_file)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OIL_IC_FILE_IS_Z&quot;</span>, cs%Z_IC_file, &amp;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                 <span class="stringliteral">&quot;If true, OIL_IC_FILE is in depth space, not layer space&quot;</span>, &amp;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                 default=.false.)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OIL_MAY_REINIT&quot;</span>, cs%oil_may_reinit, &amp;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                 <span class="stringliteral">&quot;If true, oil tracers may go through the initialization &quot;</span>//&amp;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                 <span class="stringliteral">&quot;code if they are not found in the restart files. &quot;</span>//&amp;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                 <span class="stringliteral">&quot;Otherwise it is a fatal error if the oil tracers are not &quot;</span>//&amp;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                 <span class="stringliteral">&quot;found in the restart files of a restarted run.&quot;</span>, &amp;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                 default=.false.)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OIL_SOURCE_LONGITUDE&quot;</span>, cs%oil_source_longitude, &amp;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                 <span class="stringliteral">&quot;The geographic longitude of the oil source.&quot;</span>, units=<span class="stringliteral">&quot;degrees E&quot;</span>, &amp;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                 fail_if_missing=.true.)</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OIL_SOURCE_LATITUDE&quot;</span>, cs%oil_source_latitude, &amp;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                 <span class="stringliteral">&quot;The geographic latitude of the oil source.&quot;</span>, units=<span class="stringliteral">&quot;degrees N&quot;</span>, &amp;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                 fail_if_missing=.true.)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OIL_SOURCE_LAYER&quot;</span>, cs%oil_source_k, &amp;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                 <span class="stringliteral">&quot;The layer into which the oil is introduced, or a &quot;</span>//&amp;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                 <span class="stringliteral">&quot;negative number for a vertically uniform source, &quot;</span>//&amp;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                 <span class="stringliteral">&quot;or 0 not to use this tracer.&quot;</span>, units=<span class="stringliteral">&quot;Layer&quot;</span>, default=0)</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OIL_SOURCE_RATE&quot;</span>, cs%oil_source_rate, &amp;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                 <span class="stringliteral">&quot;The rate of oil injection.&quot;</span>, units=<span class="stringliteral">&quot;kg s-1&quot;</span>, default=1.0)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OIL_DECAY_DAYS&quot;</span>, cs%oil_decay_days, &amp;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                 <span class="stringliteral">&quot;The decay timescale in days (if positive), or no decay &quot;</span>//&amp;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                 <span class="stringliteral">&quot;if 0, or use the temperature dependent decay rate of &quot;</span>//&amp;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                 <span class="stringliteral">&quot;Adcroft et al. (GRL, 2010) if negative.&quot;</span>, units=<span class="stringliteral">&quot;days&quot;</span>, &amp;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                 default=0.0)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OIL_DATED_START_YEAR&quot;</span>, cs%oil_start_year, &amp;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                 <span class="stringliteral">&quot;The time at which the oil source starts&quot;</span>, units=<span class="stringliteral">&quot;years&quot;</span>, &amp;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                 default=0.0)</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OIL_DATED_END_YEAR&quot;</span>, cs%oil_end_year, &amp;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                 <span class="stringliteral">&quot;The time at which the oil source ends&quot;</span>, units=<span class="stringliteral">&quot;years&quot;</span>, &amp;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                 default=1.0e99)</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  cs%ntr = 0</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  cs%oil_decay_rate(:) = 0.</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordflow">do</span> m=1,ntr_max</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> (cs%oil_source_k(m)/=0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="keyword">write</span>(name_tag(1:3),<span class="stringliteral">&#39;(&quot;_&quot;,I2.2)&#39;</span>) m</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      cs%ntr = cs%ntr + 1</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      cs%tr_desc(m) = var_desc(<span class="stringliteral">&quot;oil&quot;</span>//trim(name_tag), <span class="stringliteral">&quot;kg m-3&quot;</span>, <span class="stringliteral">&quot;Oil Tracer&quot;</span>, caller=mdl)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      cs%IC_val(m) = 0.0</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="keywordflow">if</span> (cs%oil_decay_days(m)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        cs%oil_decay_rate(m)=1./(86400.0*cs%oil_decay_days(m))</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="keywordflow">elseif</span> (cs%oil_decay_days(m)&lt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        cs%oil_decay_rate(m)=-1.</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;OIL_DECAY_RATE&quot;</span>, cs%oil_decay_rate(1:cs%ntr))</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="comment">! This needs to be changed if the units of tracer are changed above.</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keywordflow">if</span> (gv%Boussinesq) <span class="keywordflow">then</span> ; flux_units = <span class="stringliteral">&quot;kg s-1&quot;</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordflow">else</span> ; flux_units = <span class="stringliteral">&quot;kg m-3 kg s-1&quot;</span> ;<span class="keywordflow"> endif</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keyword">allocate</span>(cs%tr(isd:ied,jsd:jed,nz,cs%ntr)) ; cs%tr(:,:,:,:) = 0.0</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="keywordflow">do</span> m=1,cs%ntr</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">! This is needed to force the compiler not to do a copy in the registration</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">! calls.  Curses on the designers and implementers of Fortran90.</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    tr_ptr =&gt; cs%tr(:,:,:,m)</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keyword">call </span>query_vardesc(cs%tr_desc(m), name=var_name, caller=<span class="stringliteral">&quot;register_oil_tracer&quot;</span>)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">! Register the tracer for horizontal advection, diffusion, and restarts.</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keyword">call </span>register_tracer(tr_ptr, tr_reg, param_file, hi, gv, tr_desc=cs%tr_desc(m), &amp;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                         registry_diags=.true., flux_units=flux_units, restart_cs=restart_cs, &amp;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                         mandatory=.not.cs%oil_may_reinit)</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">!   Set coupled_tracers to be true (hard-coded above) to provide the surface</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">! values to the coupler (if any).  This is meta-code and its arguments will</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">! currently (deliberately) give fatal errors if it is used.</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">if</span> (cs%coupled_tracers) &amp;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      cs%ind_tr(m) = aof_set_coupler_flux(trim(var_name)//<span class="stringliteral">&#39;_flux&#39;</span>, &amp;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          flux_type=<span class="stringliteral">&#39; &#39;</span>, implementation=<span class="stringliteral">&#39; &#39;</span>, caller=<span class="stringliteral">&quot;register_oil_tracer&quot;</span>)</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  cs%tr_Reg =&gt; tr_reg</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  cs%restart_CSp =&gt; restart_cs</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  register_oil_tracer = .true.</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="atmos__ocean__fluxes_8F90_source.html#l00018">atmos_ocean_fluxes_mod::aof_set_coupler_flux()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>, <a class="el" href="oil__tracer_8F90_source.html#l00035">ntr_max</a>, <a class="el" href="MOM__io_8F90_source.html#l00699">mom_io::query_vardesc()</a>, <a class="el" href="MOM__tracer__registry_8F90_source.html#l00142">mom_tracer_registry::register_tracer()</a>, and <a class="el" href="MOM__io_8F90_source.html#l00600">mom_io::var_desc()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespaceoil__tracer_ae9bef348e3fea3af157e841a0c9f6aeb_cgraph.svg" width="100%" height="579"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a7d9cefa818e16dd56e1051c3bcff940f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d9cefa818e16dd56e1051c3bcff940f">&#9670;&nbsp;</a></span>ntr_max</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter oil_tracer::ntr_max = 20</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>the maximum number of tracers in this module. </p>

<p class="definition">Definition at line <a class="el" href="oil__tracer_8F90_source.html#l00035">35</a> of file <a class="el" href="oil__tracer_8F90_source.html">oil_tracer.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: NTR_MAX = 20<span class="comment"> !&lt; the maximum number of tracers in this module.</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="oil__tracer_8F90_source.html#l00078">register_oil_tracer()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceoil__tracer.html">oil_tracer</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
