<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_cap_mod Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespacemom__cap__mod.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">mom_cap_mod Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This module contains a set of subroutines that are required by NUOPC. </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__cap__mod_1_1fld__list__type.html">fld_list_type</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Contains field information.  <a href="structmom__cap__mod_1_1fld__list__type.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__cap__mod_1_1ocean__internalstate__type.html">ocean_internalstate_type</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Internal state type with pointers to three types defined by MOM.  <a href="structmom__cap__mod_1_1ocean__internalstate__type.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__cap__mod_1_1ocean__internalstate__wrapper.html">ocean_internalstate_wrapper</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wrapper-derived type required to associate an internal state instance with the ESMF/NUOPC component.  <a href="structmom__cap__mod_1_1ocean__internalstate__wrapper.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ae0439afc4c901d9850515768bdaaed09"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#ae0439afc4c901d9850515768bdaaed09">setservices</a> (gcomp, rc)</td></tr>
<tr class="memdesc:ae0439afc4c901d9850515768bdaaed09"><td class="mdescLeft">&#160;</td><td class="mdescRight">NUOPC SetService method is the only public entry point. SetServices registers all of the user-provided subroutines in the module with the NUOPC layer.  <a href="namespacemom__cap__mod.html#ae0439afc4c901d9850515768bdaaed09">More...</a><br /></td></tr>
<tr class="separator:ae0439afc4c901d9850515768bdaaed09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b1bd237d48b444c8c3410371aedc854"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a9b1bd237d48b444c8c3410371aedc854">initializep0</a> (gcomp, importState, exportState, clock, rc)</td></tr>
<tr class="memdesc:a9b1bd237d48b444c8c3410371aedc854"><td class="mdescLeft">&#160;</td><td class="mdescRight">First initialize subroutine called by NUOPC. The purpose is to set which version of the Initialize Phase Definition (IPD) to use.  <a href="namespacemom__cap__mod.html#a9b1bd237d48b444c8c3410371aedc854">More...</a><br /></td></tr>
<tr class="separator:a9b1bd237d48b444c8c3410371aedc854"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ec10447622ec1cd4cb568c194b8de61"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a2ec10447622ec1cd4cb568c194b8de61">initializeadvertise</a> (gcomp, importState, exportState, clock, rc)</td></tr>
<tr class="memdesc:a2ec10447622ec1cd4cb568c194b8de61"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called by NUOPC to advertise import and export fields. "Advertise" simply means that the standard names of all import and export fields are supplied. The NUOPC layer uses these to match fields between components in the coupled system.  <a href="namespacemom__cap__mod.html#a2ec10447622ec1cd4cb568c194b8de61">More...</a><br /></td></tr>
<tr class="separator:a2ec10447622ec1cd4cb568c194b8de61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11baa4d10abcce4225eb074a2c23e398"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a11baa4d10abcce4225eb074a2c23e398">initializerealize</a> (gcomp, importState, exportState, clock, rc)</td></tr>
<tr class="memdesc:a11baa4d10abcce4225eb074a2c23e398"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called by NUOPC to realize import and export fields. "Realizing" a field means that its grid has been defined and an ESMF_Field object has been created and put into the import or export State.  <a href="namespacemom__cap__mod.html#a11baa4d10abcce4225eb074a2c23e398">More...</a><br /></td></tr>
<tr class="separator:a11baa4d10abcce4225eb074a2c23e398"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acadf328859aac6eb57b5c508f3f73b61"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#acadf328859aac6eb57b5c508f3f73b61">datainitialize</a> (gcomp, rc)</td></tr>
<tr class="memdesc:acadf328859aac6eb57b5c508f3f73b61"><td class="mdescLeft">&#160;</td><td class="mdescRight">TODO.  <a href="namespacemom__cap__mod.html#acadf328859aac6eb57b5c508f3f73b61">More...</a><br /></td></tr>
<tr class="separator:acadf328859aac6eb57b5c508f3f73b61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aecd83368409a9c059ca3313e25391a0b"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#aecd83368409a9c059ca3313e25391a0b">modeladvance</a> (gcomp, rc)</td></tr>
<tr class="memdesc:aecd83368409a9c059ca3313e25391a0b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called by NUOPC to advance the model a single timestep.  <a href="namespacemom__cap__mod.html#aecd83368409a9c059ca3313e25391a0b">More...</a><br /></td></tr>
<tr class="separator:aecd83368409a9c059ca3313e25391a0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ac6a66c943ef7933973ed155a81dd91"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a5ac6a66c943ef7933973ed155a81dd91">modelsetrunclock</a> (gcomp, rc)</td></tr>
<tr class="separator:a5ac6a66c943ef7933973ed155a81dd91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b7799c15a6eeadc1d286ce4d37163e6"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a9b7799c15a6eeadc1d286ce4d37163e6">ocean_model_finalize</a> (gcomp, rc)</td></tr>
<tr class="memdesc:a9b7799c15a6eeadc1d286ce4d37163e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called by NUOPC at the end of the run to clean up.  <a href="namespacemom__cap__mod.html#a9b7799c15a6eeadc1d286ce4d37163e6">More...</a><br /></td></tr>
<tr class="separator:a9b7799c15a6eeadc1d286ce4d37163e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad65735d76d137896b5b838aa9e776757"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#ad65735d76d137896b5b838aa9e776757">state_setscalar</a> (value, scalar_id, State, mytask, scalar_name, scalar_count, rc)</td></tr>
<tr class="memdesc:ad65735d76d137896b5b838aa9e776757"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set scalar data from state for a particula name.  <a href="namespacemom__cap__mod.html#ad65735d76d137896b5b838aa9e776757">More...</a><br /></td></tr>
<tr class="separator:ad65735d76d137896b5b838aa9e776757"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57fa339b90f33aff03637f9dee5ffaf1"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a57fa339b90f33aff03637f9dee5ffaf1">mom_realizefields</a> (state, nfields, field_defs, tag, grid, mesh, rc)</td></tr>
<tr class="memdesc:a57fa339b90f33aff03637f9dee5ffaf1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Realize the import and export fields using either a grid or a mesh.  <a href="namespacemom__cap__mod.html#a57fa339b90f33aff03637f9dee5ffaf1">More...</a><br /></td></tr>
<tr class="separator:a57fa339b90f33aff03637f9dee5ffaf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5986d21c0a2391b640700c930373d0c9"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a5986d21c0a2391b640700c930373d0c9">fld_list_add</a> (num, fldlist, stdname, transferOffer, shortname)</td></tr>
<tr class="memdesc:a5986d21c0a2391b640700c930373d0c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up list of field information.  <a href="namespacemom__cap__mod.html#a5986d21c0a2391b640700c930373d0c9">More...</a><br /></td></tr>
<tr class="separator:a5986d21c0a2391b640700c930373d0c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81c1c8d1c54d3a7d0cdf7d939a9d7b5a"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a81c1c8d1c54d3a7d0cdf7d939a9d7b5a">shr_file_setlogunit</a> (nunit)</td></tr>
<tr class="separator:a81c1c8d1c54d3a7d0cdf7d939a9d7b5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4fe7282914df9a3a3e6d11dabe339b6"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#ab4fe7282914df9a3a3e6d11dabe339b6">shr_file_getlogunit</a> (nunit)</td></tr>
<tr class="separator:ab4fe7282914df9a3a3e6d11dabe339b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0ed5e7e790ddbb9f8d7152264ca28d0f"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a0ed5e7e790ddbb9f8d7152264ca28d0f">fldsmax</a> = 100</td></tr>
<tr class="separator:a0ed5e7e790ddbb9f8d7152264ca28d0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49361c7b41259416fa2c6b08a6bac193"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a49361c7b41259416fa2c6b08a6bac193">fldstoocn_num</a> = 0</td></tr>
<tr class="separator:a49361c7b41259416fa2c6b08a6bac193"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f0c52bdc4d9687b0c2f882a9ecc202b"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structmom__cap__mod_1_1fld__list__type.html">fld_list_type</a>), dimension(<a class="el" href="namespacemom__cap__mod.html#a0ed5e7e790ddbb9f8d7152264ca28d0f">fldsmax</a>)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a5f0c52bdc4d9687b0c2f882a9ecc202b">fldstoocn</a></td></tr>
<tr class="separator:a5f0c52bdc4d9687b0c2f882a9ecc202b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad948593abdb8da7fa79b69505913dc95"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#ad948593abdb8da7fa79b69505913dc95">fldsfrocn_num</a> = 0</td></tr>
<tr class="separator:ad948593abdb8da7fa79b69505913dc95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee3e3b3a693970aa5f79b3ba8ca97d35"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structmom__cap__mod_1_1fld__list__type.html">fld_list_type</a>), dimension(<a class="el" href="namespacemom__cap__mod.html#a0ed5e7e790ddbb9f8d7152264ca28d0f">fldsmax</a>)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#aee3e3b3a693970aa5f79b3ba8ca97d35">fldsfrocn</a></td></tr>
<tr class="separator:aee3e3b3a693970aa5f79b3ba8ca97d35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30d95b1e676bca2117b3db102b434fc4"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a30d95b1e676bca2117b3db102b434fc4">debug</a> = 0</td></tr>
<tr class="separator:a30d95b1e676bca2117b3db102b434fc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c76d05cdca9c737e6a460df1bfadbbd"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a2c76d05cdca9c737e6a460df1bfadbbd">import_slice</a> = 1</td></tr>
<tr class="separator:a2c76d05cdca9c737e6a460df1bfadbbd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa08ee7a9fc2f2a7e374db32013526765"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#aa08ee7a9fc2f2a7e374db32013526765">export_slice</a> = 1</td></tr>
<tr class="separator:aa08ee7a9fc2f2a7e374db32013526765"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0eecd812f3619a4648e2f9386b58fe3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=256)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#ac0eecd812f3619a4648e2f9386b58fe3">tmpstr</a></td></tr>
<tr class="separator:ac0eecd812f3619a4648e2f9386b58fe3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87f074f197c71e76f3ceb5265c12ea42"><td class="memItemLeft" align="right" valign="top">logical&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a87f074f197c71e76f3ceb5265c12ea42">write_diagnostics</a> = .false.</td></tr>
<tr class="separator:a87f074f197c71e76f3ceb5265c12ea42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad56cefdfe78b6f64cfbf67b65eae6e7e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=32)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#ad56cefdfe78b6f64cfbf67b65eae6e7e">runtype</a></td></tr>
<tr class="memdesc:ad56cefdfe78b6f64cfbf67b65eae6e7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">run type  <a href="namespacemom__cap__mod.html#ad56cefdfe78b6f64cfbf67b65eae6e7e">More...</a><br /></td></tr>
<tr class="separator:ad56cefdfe78b6f64cfbf67b65eae6e7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5658afa33822a37b08b4fde39429a6c1"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a5658afa33822a37b08b4fde39429a6c1">logunit</a></td></tr>
<tr class="memdesc:a5658afa33822a37b08b4fde39429a6c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">stdout logging unit number  <a href="namespacemom__cap__mod.html#a5658afa33822a37b08b4fde39429a6c1">More...</a><br /></td></tr>
<tr class="separator:a5658afa33822a37b08b4fde39429a6c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4760bc5e6def07188f5fb61e09a2de1"><td class="memItemLeft" align="right" valign="top">logical&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#ad4760bc5e6def07188f5fb61e09a2de1">profile_memory</a> = .true.</td></tr>
<tr class="separator:ad4760bc5e6def07188f5fb61e09a2de1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2007af76dfd1960bd6162c3bdd2b0ed1"><td class="memItemLeft" align="right" valign="top">logical&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a2007af76dfd1960bd6162c3bdd2b0ed1">grid_attach_area</a> = .false.</td></tr>
<tr class="separator:a2007af76dfd1960bd6162c3bdd2b0ed1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2e1656025fcc390497d059868d547aa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=128)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#ac2e1656025fcc390497d059868d547aa">scalar_field_name</a> = ''</td></tr>
<tr class="separator:ac2e1656025fcc390497d059868d547aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa34836ca41b881b490713afae1ce5b82"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#aa34836ca41b881b490713afae1ce5b82">scalar_field_count</a> = 0</td></tr>
<tr class="separator:aa34836ca41b881b490713afae1ce5b82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac69f1371ebbd90dfc117e54846cc90bb"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#ac69f1371ebbd90dfc117e54846cc90bb">scalar_field_idx_grid_nx</a> = 0</td></tr>
<tr class="separator:ac69f1371ebbd90dfc117e54846cc90bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae36725fbbb9270b498c860196e9f0374"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#ae36725fbbb9270b498c860196e9f0374">scalar_field_idx_grid_ny</a> = 0</td></tr>
<tr class="separator:ae36725fbbb9270b498c860196e9f0374"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcd81cf01660d4994dec787589d47616"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len= *), parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#abcd81cf01660d4994dec787589d47616">u_file_u</a> = __FILE__</td></tr>
<tr class="separator:abcd81cf01660d4994dec787589d47616"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ccb6bc098362e5ea43c44ed67b0be91"><td class="memItemLeft" align="right" valign="top">logical&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a9ccb6bc098362e5ea43c44ed67b0be91">cesm_coupled</a> = .true.</td></tr>
<tr class="separator:a9ccb6bc098362e5ea43c44ed67b0be91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2af2a851cf395c0e9bc914c5ca06e5b0"><td class="memItemLeft" align="right" valign="top">type(esmf_geomtype_flag)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__cap__mod.html#a2af2a851cf395c0e9bc914c5ca06e5b0">geomtype</a> = ESMF_GEOMTYPE_MESH</td></tr>
<tr class="separator:a2af2a851cf395c0e9bc914c5ca06e5b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="acadf328859aac6eb57b5c508f3f73b61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acadf328859aac6eb57b5c508f3f73b61">&#9670;&nbsp;</a></span>datainitialize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_cap_mod::datainitialize </td>
          <td>(</td>
          <td class="paramtype">type(esmf_gridcomp)&#160;</td>
          <td class="paramname"><em>gcomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>TODO. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>an ESMF_GridComp object </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">rc</td><td>return code </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>ESMF_GridComp object </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rc</td><td>return code </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l01771">1771</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  <span class="keywordtype">type</span>(ESMF_GridComp)  :: gcomp<span class="comment"> !&lt; ESMF_GridComp object</span></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: rc<span class="comment">    !&lt; return code</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160; </div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="comment">! local variables</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;  <span class="keywordtype">type</span>(ESMF_Clock)                       :: clock</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;  <span class="keywordtype">type</span>(ESMF_State)                       :: importState, exportState</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;  <span class="keywordtype">type</span> (ocean_public_type),      <span class="keywordtype">pointer</span> :: ocean_public       =&gt; null()</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;  <span class="keywordtype">type</span> (ocean_state_type),       <span class="keywordtype">pointer</span> :: ocean_state        =&gt; null()</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  <span class="keywordtype">type</span>(ice_ocean_boundary_type), <span class="keywordtype">pointer</span> :: Ice_ocean_boundary =&gt; null()</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;  <span class="keywordtype">type</span>(ocean_internalstate_wrapper)      :: ocean_internalstate</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type), <span class="keywordtype">pointer</span>         :: ocean_grid</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  <span class="keywordtype">character(240)</span>                         :: msgString</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;  <span class="keywordtype">integer</span>                                :: fieldCount, n</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;  <span class="keywordtype">type</span>(ESMF_Field)                       :: field</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;  <span class="keywordtype">character(len=64)</span>,<span class="keywordtype">allocatable</span>          :: fieldNameList(:)</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;  <span class="keywordtype">character(len=*)</span>,<span class="keywordtype">parameter</span>  :: subname=<span class="stringliteral">&#39;(MOM_cap:DataInitialize)&#39;</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;  <span class="comment">!--------------------------------</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160; </div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  <span class="comment">! query the Component for its clock, importState and exportState</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;  <span class="keyword">call </span>esmf_gridcompget(gcomp, clock=clock, importstate=importstate, exportstate=exportstate, rc=rc)</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160; </div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  <span class="keyword">call </span>esmf_gridcompgetinternalstate(gcomp, ocean_internalstate, rc)</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160; </div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;  ice_ocean_boundary =&gt; ocean_internalstate%ptr%ice_ocean_boundary_type_ptr</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;  ocean_public       =&gt; ocean_internalstate%ptr%ocean_public_type_ptr</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;  ocean_state        =&gt; ocean_internalstate%ptr%ocean_state_type_ptr</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;  <span class="keyword">call </span>get_ocean_grid(ocean_state, ocean_grid)</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160; </div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;  <span class="keywordflow">if</span> (cesm_coupled) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;     <span class="keyword">call </span>mom_export(ocean_public, ocean_grid, ocean_state, exportstate, clock, rc=rc)</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;          <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160; </div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;  <span class="keyword">call </span>esmf_stateget(exportstate, itemcount=fieldcount, rc=rc)</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160; </div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  <span class="keyword">allocate</span>(fieldnamelist(fieldcount))</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;  <span class="keyword">call </span>esmf_stateget(exportstate, itemnamelist=fieldnamelist, rc=rc)</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160; </div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;  <span class="keywordflow">do</span> n=1, fieldcount</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    <span class="keyword">call </span>esmf_stateget(exportstate, itemname=fieldnamelist(n), field=field, rc=rc)</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;      line=__line__, &amp;</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;      file=__file__)) &amp;</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;      <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160; </div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    <span class="keyword">call </span>nuopc_setattribute(field, name=<span class="stringliteral">&quot;Updated&quot;</span>, <span class="keywordtype">value</span>=<span class="stringliteral">&quot;true&quot;</span>, rc=rc)</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;      line=__line__, &amp;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;      file=__file__)) &amp;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;      <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;  <span class="keyword">deallocate</span>(fieldnamelist)</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160; </div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;  <span class="comment">! check whether all Fields in the exportState are &quot;Updated&quot;</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;  <span class="keywordflow">if</span> (nuopc_isupdated(exportstate)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    <span class="keyword">call </span>nuopc_compattributeset(gcomp, name=<span class="stringliteral">&quot;InitializeDataComplete&quot;</span>, <span class="keywordtype">value</span>=<span class="stringliteral">&quot;true&quot;</span>, rc=rc)</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160; </div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&quot;MOM6 - Initialize-Data-Dependency SATISFIED!!!&quot;</span>, esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;      line=__line__, &amp;</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;      file=__file__)) &amp;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;      <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160; </div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  <span class="keywordflow">if</span>(write_diagnostics) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    <span class="keyword">call </span>nuopc_write(exportstate, filenameprefix=<span class="stringliteral">&#39;field_init_ocn_export_&#39;</span>, &amp;</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;      timeslice=import_slice, relaxedflag=.true., rc=rc)</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;      line=__line__, &amp;</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      file=__file__)) &amp;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mom__cap_8F90_source.html#l00448">cesm_coupled</a>, <a class="el" href="mom__ocean__model__nuopc_8F90_source.html#l01176">mom_ocean_model_nuopc::get_ocean_grid()</a>, <a class="el" href="mom__cap_8F90_source.html#l00432">import_slice</a>, <a class="el" href="mom__cap__methods_8F90_source.html#l00331">mom_cap_methods::mom_export()</a>, and <a class="el" href="mom__cap_8F90_source.html#l00435">write_diagnostics</a>.</p>

<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00464">setservices()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_acadf328859aac6eb57b5c508f3f73b61_cgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_acadf328859aac6eb57b5c508f3f73b61_icgraph.svg" width="456" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a5986d21c0a2391b640700c930373d0c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5986d21c0a2391b640700c930373d0c9">&#9670;&nbsp;</a></span>fld_list_add()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_cap_mod::fld_list_add </td>
          <td>(</td>
          <td class="paramtype">integer, intent(inout)&#160;</td>
          <td class="paramname"><em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__cap__mod_1_1fld__list__type.html">fld_list_type</a>), dimension(:), intent(inout)&#160;</td>
          <td class="paramname"><em>fldlist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>stdname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>transferOffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in), optional&#160;</td>
          <td class="paramname"><em>shortname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set up list of field information. </p>

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l02593">2593</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;  <span class="keywordtype">integer</span>,                    <span class="keywordtype">intent(inout)</span> :: num</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;  <span class="keywordtype">type</span>(fld_list_type),        <span class="keywordtype">intent(inout)</span> :: fldlist(:)</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;  <span class="keywordtype">character(len=*)</span>,           <span class="keywordtype">intent(in)</span>    :: stdname</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;  <span class="keywordtype">character(len=*)</span>,           <span class="keywordtype">intent(in)</span>    :: transferOffer</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: shortname</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160; </div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;  <span class="comment">! local variables</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;  <span class="keywordtype">integer</span> :: rc</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: subname=<span class="stringliteral">&#39;(MOM_cap:fld_list_add)&#39;</span></div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160; </div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;  <span class="comment">! fill in the new entry</span></div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;  num = num + 1</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;  <span class="keywordflow">if</span> (num &gt; fldsmax) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;     <span class="keyword">call </span>esmf_logseterror(esmf_rc_val_outofrange, &amp;</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;          msg=trim(subname)//<span class="stringliteral">&quot;: ERROR number of field exceeded fldsMax: &quot;</span>//trim(stdname), &amp;</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;          line=__line__, file=__file__, rctoreturn=rc)</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;     <span class="keywordflow">return</span></div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160; </div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;  fldlist(num)%stdname        = trim(stdname)</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(shortname)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;     fldlist(num)%shortname   = trim(shortname)</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;     fldlist(num)%shortname   = trim(stdname)</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;  fldlist(num)%transferOffer  = trim(transferoffer)</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mom__cap_8F90_source.html#l00425">fldsmax</a>.</p>

<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00726">initializeadvertise()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_a5986d21c0a2391b640700c930373d0c9_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a2ec10447622ec1cd4cb568c194b8de61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ec10447622ec1cd4cb568c194b8de61">&#9670;&nbsp;</a></span>initializeadvertise()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_cap_mod::initializeadvertise </td>
          <td>(</td>
          <td class="paramtype">type(esmf_gridcomp)&#160;</td>
          <td class="paramname"><em>gcomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_state)&#160;</td>
          <td class="paramname"><em>importState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_state)&#160;</td>
          <td class="paramname"><em>exportState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_clock)&#160;</td>
          <td class="paramname"><em>clock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called by NUOPC to advertise import and export fields. "Advertise" simply means that the standard names of all import and export fields are supplied. The NUOPC layer uses these to match fields between components in the coupled system. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>an ESMF_GridComp object </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">importState</td><td>an ESMF_State object for import fields </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">exportState</td><td>an ESMF_State object for export fields </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">clock</td><td>an ESMF_Clock object </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">rc</td><td>return code </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>ESMF_GridComp object </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">exportstate</td><td>ESMF_State object for import/export fields </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">clock</td><td>ESMF_Clock object </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rc</td><td>return code </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00726">726</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="keywordtype">type</span>(ESMF_GridComp)            :: gcomp<span class="comment">                    !&lt; ESMF_GridComp object</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <span class="keywordtype">type</span>(ESMF_State)               :: importState, exportState<span class="comment"> !&lt; ESMF_State object for</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">                                                             !! import/export fields</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="keywordtype">type</span>(ESMF_Clock)               :: clock<span class="comment">                    !&lt; ESMF_Clock object</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span>           :: rc<span class="comment">                       !&lt; return code</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="comment">! local variables</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <span class="keywordtype">type</span>(ESMF_VM)                          :: vm</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="keywordtype">type</span>(ESMF_Time)                        :: MyTime</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="keywordtype">type</span>(ESMF_TimeInterval)                :: TINT</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="keywordtype">type</span> (ocean_public_type),      <span class="keywordtype">pointer</span> :: ocean_public =&gt; null()</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="keywordtype">type</span> (ocean_state_type),       <span class="keywordtype">pointer</span> :: ocean_state =&gt; null()</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="keywordtype">type</span>(ice_ocean_boundary_type), <span class="keywordtype">pointer</span> :: Ice_ocean_boundary =&gt; null()</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keywordtype">type</span>(ocean_internalstate_wrapper)      :: ocean_internalstate</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),         <span class="keywordtype">pointer</span> :: ocean_grid =&gt; null()</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <span class="keywordtype">type</span>(time_type)                        :: Run_len<span class="comment">      !&lt; length of experiment</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="keywordtype">type</span>(time_type)                        :: time0<span class="comment">        !&lt; Start time of coupled model&#39;s calendar.</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="keywordtype">type</span>(time_type)                        :: time_start<span class="comment">   !&lt; The time at which to initialize the ocean model</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  <span class="keywordtype">type</span>(time_type)                        :: Time_restart</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keywordtype">type</span>(time_type)                        :: DT</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <span class="keywordtype">integer</span>                                :: DT_OCEAN</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="keywordtype">integer</span>                                :: isc,iec,jsc,jec</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="keywordtype">integer</span>                                :: year=0, month=0, day=0, hour=0, minute=0, second=0</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="keywordtype">integer</span>                                :: mpi_comm_mom</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="keywordtype">integer</span>                                :: i,n</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="keywordtype">character(len=256)</span>                     :: stdname, shortname</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="keywordtype">character(len=32)</span>                      :: starttype            <span class="comment">! model start type</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keywordtype">character(len=512)</span>                     :: diro</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="keywordtype">character(len=512)</span>                     :: logfile</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="keywordtype">character(ESMF_MAXSTR)</span>                 :: cvalue</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <span class="keywordtype">logical</span>                                :: isPresent, isPresentDiro, isPresentLogfile, isSet</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="keywordtype">logical</span>                                :: existflag</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="keywordtype">integer</span>                                :: userRc</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="keywordtype">character(len=512)</span>                     :: restartfile          <span class="comment">! Path/Name of restart file</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span>            :: subname=<span class="stringliteral">&#39;(MOM_cap:InitializeAdvertise)&#39;</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="keywordtype">character(len=32)</span>                      :: calendar</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">!--------------------------------</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160; </div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  rc = esmf_success</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="keyword">call </span>esmf_logwrite(subname//<span class="stringliteral">&#39; enter&#39;</span>, esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keyword">allocate</span>(ice_ocean_boundary)</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="comment">!allocate(ocean_state) ! ocean_model_init allocate this pointer</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="keyword">allocate</span>(ocean_public)</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="keyword">allocate</span>(ocean_internalstate%ptr)</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  ocean_internalstate%ptr%ice_ocean_boundary_type_ptr =&gt; ice_ocean_boundary</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  ocean_internalstate%ptr%ocean_public_type_ptr       =&gt; ocean_public</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  ocean_internalstate%ptr%ocean_state_type_ptr        =&gt; ocean_state</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="keyword">call </span>esmf_vmgetcurrent(vm, rc=rc)</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keyword">call </span>esmf_vmget(vm, mpicommunicator=mpi_comm_mom, rc=rc)</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160; </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <span class="keyword">call </span>esmf_clockget(clock, currtime=mytime, timestep=tint,  rc=rc)</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="keyword">call </span>esmf_timeget (mytime, yy=year, mm=month, dd=day, h=hour, m=minute, s=second, rc=rc )</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160; </div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keyword">CALL </span>esmf_timeintervalget(tint, s=dt_ocean, rc=rc)</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160; </div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="keyword">call </span>fms_init(mpi_comm_mom)</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="keyword">call </span>constants_init</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <span class="keyword">call </span>field_manager_init</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160; </div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="comment">! determine the calendar</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="keywordflow">if</span> (cesm_coupled) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;     <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&quot;calendar&quot;</span>, <span class="keywordtype">value</span>=cvalue, &amp;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;          ispresent=ispresent, isset=isset, rc=rc)</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;          <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;     <span class="keywordflow">if</span> (ispresent .and. isset) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <span class="keyword">read</span>(cvalue,*) calendar</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        <span class="keywordflow">select case</span> (trim(calendar))</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;           <span class="keywordflow">case</span> (<span class="stringliteral">&quot;NO_LEAP&quot;</span>)</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;              <span class="keyword">call </span>set_calendar_type (noleap)</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;           <span class="keywordflow">case</span> (<span class="stringliteral">&quot;GREGORIAN&quot;</span>)</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;              <span class="keyword">call </span>set_calendar_type (gregorian)</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="keywordflow">           case default</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;              <span class="keyword">call </span>esmf_logseterror(esmf_rc_arg_bad, &amp;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                 msg=subname//<span class="stringliteral">&quot;: Calendar not supported in MOM6: &quot;</span>//trim(calendar), &amp;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                 line=__line__, file=__file__, rctoreturn=rc)</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="keywordflow">           end select</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;     <span class="keywordflow">else</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="keyword">call </span>set_calendar_type (noleap)</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;     <span class="keyword">call </span>set_calendar_type (julian)</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160; </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="keyword">call </span>diag_manager_init</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160; </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="comment">! this ocean connector will be driven at set interval</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  dt = set_time(dt_ocean, 0)</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="comment">! get current time</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  time_start = set_date(year,month,day,hour,minute,second)</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160; </div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="keywordflow">if</span> (is_root_pe()) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="keyword">write</span>(logunit,*) subname//<span class="stringliteral">&#39;current time: y,m,d-&#39;</span>,year,month,day,<span class="stringliteral">&#39;h,m,s=&#39;</span>,hour,minute,second</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160; </div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="comment">! get start/reference time</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="keyword">call </span>esmf_clockget(clock, reftime=mytime, rc=rc)</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keyword">call </span>esmf_timeget (mytime, yy=year, mm=month, dd=day, h=hour, m=minute, s=second, rc=rc )</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  time0 = set_date(year,month,day,hour,minute,second)</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160; </div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="keywordflow">if</span> (is_root_pe()) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keyword">write</span>(logunit,*) subname//<span class="stringliteral">&#39;start time: y,m,d-&#39;</span>,year,month,day,<span class="stringliteral">&#39;h,m,s=&#39;</span>,hour,minute,second</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="comment">! rsd need to figure out how to get this without share code</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="comment">!call shr_nuopc_get_component_instance(gcomp, inst_suffix, inst_index)</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="comment">!inst_name = &quot;OCN&quot;//trim(inst_suffix)</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="comment">! reset shr logging to my log file</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="keywordflow">if</span> (is_root_pe()) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;     <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&quot;diro&quot;</span>, &amp;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;          ispresent=ispresentdiro, rc=rc)</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;     <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&quot;logfile&quot;</span>, &amp;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;          ispresent=ispresentlogfile, rc=rc)</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;     <span class="keywordflow">if</span> (ispresentdiro .and. ispresentlogfile) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;          <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&quot;diro&quot;</span>, <span class="keywordtype">value</span>=diro, rc=rc)</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;          <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;              line=__line__, &amp;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;              file=__file__)) &amp;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;              <span class="keywordflow">return</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;          <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&quot;logfile&quot;</span>, <span class="keywordtype">value</span>=logfile, rc=rc)</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;          <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;              line=__line__, &amp;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;              file=__file__)) &amp;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;              <span class="keywordflow">return</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        <span class="keyword">open</span>(newunit=logunit,file=trim(diro)//<span class="stringliteral">&quot;/&quot;</span>//trim(logfile))</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;     <span class="keywordflow">else</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        logunit = output_unit</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;     logunit = output_unit</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160; </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  starttype = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&#39;start_type&#39;</span>, <span class="keywordtype">value</span>=cvalue, &amp;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;       ispresent=ispresent, isset=isset, rc=rc)</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="keywordflow">if</span> (ispresent .and. isset) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;     <span class="keyword">read</span>(cvalue,*) starttype</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;     <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&#39;MOM_cap:start_type unset - using input.nml for restart option&#39;</span>, &amp;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;          esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  runtype = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  <span class="keywordflow">if</span> (trim(starttype) == trim(<span class="stringliteral">&#39;startup&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;     runtype = <span class="stringliteral">&quot;initial&quot;</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (trim(starttype) == trim(<span class="stringliteral">&#39;continue&#39;</span>) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;     runtype = <span class="stringliteral">&quot;continue&quot;</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (trim(starttype) == trim(<span class="stringliteral">&#39;branch&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;     runtype = <span class="stringliteral">&quot;continue&quot;</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len_trim(starttype) &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;     <span class="keyword">call </span>esmf_logseterror(esmf_rc_arg_bad, &amp;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;          msg=subname//<span class="stringliteral">&quot;: unknown starttype - &quot;</span>//trim(starttype), &amp;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;          line=__line__, file=__file__, rctoreturn=rc)</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;     <span class="keywordflow">return</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160; </div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="keywordflow">if</span> (len_trim(runtype) &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;     <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&#39;MOM_cap:startup = &#39;</span>//trim(runtype), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  restartfile = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="keywordflow">if</span> (runtype == <span class="stringliteral">&quot;initial&quot;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;     <span class="comment">! startup (new run) - &#39;n&#39; is needed below if we don&#39;t specify input_filename in input.nml</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;     restartfile = <span class="stringliteral">&quot;n&quot;</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (runtype == <span class="stringliteral">&quot;continue&quot;</span>) <span class="keywordflow">then</span> <span class="comment">! hybrid or branch or continuos runs</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;     <span class="comment">! optionally call into system-specific implementation to get restart file name</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;     <span class="keyword">call </span>esmf_methodexecute(gcomp, label=<span class="stringliteral">&quot;GetRestartFileToRead&quot;</span>, &amp;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;          existflag=existflag, userrc=userrc, rc=rc)</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=<span class="stringliteral">&quot;Error executing user method to get restart filename&quot;</span>, &amp;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;         <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=userrc, msg=<span class="stringliteral">&quot;Error in method to get restart filename&quot;</span>, &amp;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;         <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;     <span class="keywordflow">if</span> (existflag) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&#39;MOM_cap: called user GetRestartFileToRead&#39;</span>, esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            line=__line__, &amp;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;            file=__file__)) &amp;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;            <span class="keywordflow">return</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160; </div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;     <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&#39;RestartFileToRead&#39;</span>, &amp;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;          <span class="keywordtype">value</span>=cvalue, ispresent=ispresent, isset=isset, rc=rc)</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;     <span class="keywordflow">if</span> (ispresent .and. isset) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        restartfile = trim(cvalue)</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&#39;MOM_cap: RestartFileToRead = &#39;</span>//trim(restartfile), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            line=__line__, &amp;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            file=__file__)) &amp;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            <span class="keywordflow">return</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;     <span class="keywordflow">else</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&#39;MOM_cap: restart requested, no RestartFileToRead attribute provided-will use input.nml&#39;</span>,&amp;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;             esmf_logmsg_warning, rc=rc)</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            line=__line__, &amp;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;            file=__file__)) &amp;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;            <span class="keywordflow">return</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160; </div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160; </div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  ocean_public%is_ocean_pe = .true.</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="keyword">call </span>ocean_model_init(ocean_public, ocean_state, time0, time_start, input_restart_file=trim(restartfile))</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160; </div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="keyword">call </span>ocean_model_init_sfc(ocean_state, ocean_public)</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keyword">call </span>mpp_get_compute_domain(ocean_public%domain, isc, iec, jsc, jec)</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160; </div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="keyword">allocate</span> ( ice_ocean_boundary% u_flux (isc:iec,jsc:jec),          &amp;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;             ice_ocean_boundary% v_flux (isc:iec,jsc:jec),          &amp;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;             ice_ocean_boundary% t_flux (isc:iec,jsc:jec),          &amp;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;             ice_ocean_boundary% q_flux (isc:iec,jsc:jec),          &amp;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;             ice_ocean_boundary% salt_flux (isc:iec,jsc:jec),       &amp;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;             ice_ocean_boundary% lw_flux (isc:iec,jsc:jec),         &amp;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;             ice_ocean_boundary% sw_flux_vis_dir (isc:iec,jsc:jec), &amp;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;             ice_ocean_boundary% sw_flux_vis_dif (isc:iec,jsc:jec), &amp;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;             ice_ocean_boundary% sw_flux_nir_dir (isc:iec,jsc:jec), &amp;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;             ice_ocean_boundary% sw_flux_nir_dif (isc:iec,jsc:jec), &amp;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;             ice_ocean_boundary% lprec (isc:iec,jsc:jec),           &amp;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;             ice_ocean_boundary% fprec (isc:iec,jsc:jec),           &amp;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;             ice_ocean_boundary% seaice_melt_heat (isc:iec,jsc:jec),&amp;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;             ice_ocean_boundary% seaice_melt (isc:iec,jsc:jec),     &amp;</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;             ice_ocean_boundary% mi (isc:iec,jsc:jec),              &amp;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;             ice_ocean_boundary% p (isc:iec,jsc:jec),               &amp;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;             ice_ocean_boundary% runoff (isc:iec,jsc:jec),          &amp;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;             ice_ocean_boundary% calving (isc:iec,jsc:jec),         &amp;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;             ice_ocean_boundary% runoff_hflx (isc:iec,jsc:jec),     &amp;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;             ice_ocean_boundary% calving_hflx (isc:iec,jsc:jec),    &amp;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;             ice_ocean_boundary% rofl_flux (isc:iec,jsc:jec),       &amp;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;             ice_ocean_boundary% rofi_flux (isc:iec,jsc:jec))</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160; </div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  ice_ocean_boundary%u_flux          = 0.0</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  ice_ocean_boundary%v_flux          = 0.0</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  ice_ocean_boundary%t_flux          = 0.0</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  ice_ocean_boundary%q_flux          = 0.0</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  ice_ocean_boundary%salt_flux       = 0.0</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  ice_ocean_boundary%lw_flux         = 0.0</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  ice_ocean_boundary%sw_flux_vis_dir = 0.0</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  ice_ocean_boundary%sw_flux_vis_dif = 0.0</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  ice_ocean_boundary%sw_flux_nir_dir = 0.0</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  ice_ocean_boundary%sw_flux_nir_dif = 0.0</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  ice_ocean_boundary%lprec           = 0.0</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  ice_ocean_boundary%fprec           = 0.0</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  ice_ocean_boundary%seaice_melt     = 0.0</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  ice_ocean_boundary%seaice_melt_heat= 0.0</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  ice_ocean_boundary%mi              = 0.0</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  ice_ocean_boundary%p               = 0.0</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  ice_ocean_boundary%runoff          = 0.0</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  ice_ocean_boundary%calving         = 0.0</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  ice_ocean_boundary%runoff_hflx     = 0.0</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  ice_ocean_boundary%calving_hflx    = 0.0</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  ice_ocean_boundary%rofl_flux       = 0.0</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  ice_ocean_boundary%rofi_flux       = 0.0</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160; </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  ocean_internalstate%ptr%ocean_state_type_ptr =&gt; ocean_state</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <span class="keyword">call </span>esmf_gridcompsetinternalstate(gcomp, ocean_internalstate, rc)</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160; </div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  <span class="keywordflow">if</span> (cesm_coupled) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;     <span class="keywordflow">if</span> (len_trim(scalar_field_name) &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, trim(scalar_field_name), <span class="stringliteral">&quot;will_provide&quot;</span>)</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        <span class="keyword">call </span>fld_list_add(fldsfrocn_num, fldsfrocn, trim(scalar_field_name), <span class="stringliteral">&quot;will_provide&quot;</span>)</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="comment">!call fld_list_add(fldsToOcn_num, fldsToOcn, &quot;Sw_lamult&quot;                 , &quot;will provide&quot;)</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="comment">!call fld_list_add(fldsToOcn_num, fldsToOcn, &quot;Sw_ustokes&quot;                , &quot;will provide&quot;)</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <span class="comment">!call fld_list_add(fldsToOcn_num, fldsToOcn, &quot;Sw_vstokes&quot;                , &quot;will provide&quot;)</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="comment">!call fld_list_add(fldsToOcn_num, fldsToOcn, &quot;Sw_hstokes&quot;                , &quot;will provide&quot;)</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="comment">!call fld_list_add(fldsToOcn_num, fldsToOcn, &quot;Fioi_melth&quot;                , &quot;will provide&quot;)</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="comment">!call fld_list_add(fldsToOcn_num, fldsToOcn, &quot;Fioi_meltw&quot;                , &quot;will provide&quot;)</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="comment">!call fld_list_add(fldsFrOcn_num, fldsFrOcn, &quot;So_fswpen&quot;                 , &quot;will provide&quot;)</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="comment">!call fld_list_add(fldsToOcn_num, fldsToOcn, &quot;mass_of_overlying_sea_ice&quot; , &quot;will provide&quot;)</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="comment">!call fld_list_add(fldsFrOcn_num, fldsFrOcn, &quot;sea_lev&quot;                   , &quot;will provide&quot;)</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160; </div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="comment">!--------- import fields -------------</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;mean_salt_rate&quot;</span>             , <span class="stringliteral">&quot;will provide&quot;</span>) <span class="comment">! from ice</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;mean_zonal_moment_flx&quot;</span>      , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;mean_merid_moment_flx&quot;</span>      , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;mean_sensi_heat_flx&quot;</span>        , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;mean_evap_rate&quot;</span>             , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;mean_net_lw_flx&quot;</span>            , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;mean_net_sw_vis_dir_flx&quot;</span>    , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;mean_net_sw_vis_dif_flx&quot;</span>    , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;mean_net_sw_ir_dir_flx&quot;</span>     , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;mean_net_sw_ir_dif_flx&quot;</span>     , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;mean_prec_rate&quot;</span>             , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;mean_fprec_rate&quot;</span>            , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;inst_pres_height_surface&quot;</span>   , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;Foxx_rofl&quot;</span>                  , <span class="stringliteral">&quot;will provide&quot;</span>) <span class="comment">!-&gt; liquid runoff</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;Foxx_rofi&quot;</span>                  , <span class="stringliteral">&quot;will provide&quot;</span>) <span class="comment">!-&gt; ice runoff</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;mean_fresh_water_to_ocean_rate&quot;</span>, <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="keyword">call </span>fld_list_add(fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;net_heat_flx_to_ocn&quot;</span>        , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160; </div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160; <span class="comment">!call fld_list_add(fldsToOcn_num, fldsToOcn, &quot;mean_runoff_rate&quot;           , &quot;will provide&quot;)</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160; <span class="comment">!call fld_list_add(fldsToOcn_num, fldsToOcn, &quot;mean_calving_rate&quot;          , &quot;will provide&quot;)</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160; <span class="comment">!call fld_list_add(fldsToOcn_num, fldsToOcn, &quot;mean_runoff_heat_flx&quot;       , &quot;will provide&quot;)</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160; <span class="comment">!call fld_list_add(fldsToOcn_num, fldsToOcn, &quot;mean_calving_heat_flx&quot;      , &quot;will provide&quot;)</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160; </div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  <span class="comment">!--------- export fields -------------</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="keyword">call </span>fld_list_add(fldsfrocn_num, fldsfrocn, <span class="stringliteral">&quot;ocean_mask&quot;</span>                 , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="keyword">call </span>fld_list_add(fldsfrocn_num, fldsfrocn, <span class="stringliteral">&quot;sea_surface_temperature&quot;</span>    , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  <span class="keyword">call </span>fld_list_add(fldsfrocn_num, fldsfrocn, <span class="stringliteral">&quot;s_surf&quot;</span>                     , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  <span class="keyword">call </span>fld_list_add(fldsfrocn_num, fldsfrocn, <span class="stringliteral">&quot;ocn_current_zonal&quot;</span>          , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  <span class="keyword">call </span>fld_list_add(fldsfrocn_num, fldsfrocn, <span class="stringliteral">&quot;ocn_current_merid&quot;</span>          , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  <span class="keyword">call </span>fld_list_add(fldsfrocn_num, fldsfrocn, <span class="stringliteral">&quot;sea_surface_slope_zonal&quot;</span>    , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  <span class="keyword">call </span>fld_list_add(fldsfrocn_num, fldsfrocn, <span class="stringliteral">&quot;sea_surface_slope_merid&quot;</span>    , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  <span class="keyword">call </span>fld_list_add(fldsfrocn_num, fldsfrocn, <span class="stringliteral">&quot;freezing_melting_potential&quot;</span> , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  <span class="keyword">call </span>fld_list_add(fldsfrocn_num, fldsfrocn, <span class="stringliteral">&quot;So_bldepth&quot;</span>                 , <span class="stringliteral">&quot;will provide&quot;</span>)</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160; </div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  <span class="keywordflow">do</span> n = 1,fldstoocn_num</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="keyword">call </span>nuopc_advertise(importstate, standardname=fldstoocn(n)%stdname, name=fldstoocn(n)%shortname, rc=rc)</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      line=__line__, &amp;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      file=__file__)) &amp;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160; </div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  <span class="keywordflow">do</span> n = 1,fldsfrocn_num</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="keyword">call </span>nuopc_advertise(exportstate, standardname=fldsfrocn(n)%stdname, name=fldsfrocn(n)%shortname, rc=rc)</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      line=__line__, &amp;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      file=__file__)) &amp;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;      <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mom__cap_8F90_source.html#l00448">cesm_coupled</a>, <a class="el" href="mom__cap_8F90_source.html#l02593">fld_list_add()</a>, <a class="el" href="mom__cap_8F90_source.html#l00429">fldsfrocn</a>, <a class="el" href="mom__cap_8F90_source.html#l00428">fldsfrocn_num</a>, <a class="el" href="mom__cap_8F90_source.html#l00427">fldstoocn</a>, <a class="el" href="mom__cap_8F90_source.html#l00426">fldstoocn_num</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00044">mom_error_handler::is_root_pe()</a>, <a class="el" href="mom__cap_8F90_source.html#l00437">logunit</a>, <a class="el" href="mom__cap_8F90_source.html#l00436">runtype</a>, and <a class="el" href="mom__cap_8F90_source.html#l00440">scalar_field_name</a>.</p>

<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00464">setservices()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_a2ec10447622ec1cd4cb568c194b8de61_cgraph.svg" width="487" height="104"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_a2ec10447622ec1cd4cb568c194b8de61_icgraph.svg" width="486" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a9b1bd237d48b444c8c3410371aedc854"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b1bd237d48b444c8c3410371aedc854">&#9670;&nbsp;</a></span>initializep0()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_cap_mod::initializep0 </td>
          <td>(</td>
          <td class="paramtype">type(esmf_gridcomp)&#160;</td>
          <td class="paramname"><em>gcomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_state)&#160;</td>
          <td class="paramname"><em>importState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_state)&#160;</td>
          <td class="paramname"><em>exportState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_clock)&#160;</td>
          <td class="paramname"><em>clock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>First initialize subroutine called by NUOPC. The purpose is to set which version of the Initialize Phase Definition (IPD) to use. </p>
<p>For this MOM cap, we are using IPDv01.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>an ESMF_GridComp object </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">importState</td><td>an ESMF_State object for import fields </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">exportState</td><td>an ESMF_State object for export fields </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">clock</td><td>an ESMF_Clock object </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">rc</td><td>return code </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>ESMF_GridComp object </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">exportstate</td><td>ESMF_State object for import/export fields </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">clock</td><td>ESMF_Clock object </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rc</td><td>return code </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00553">553</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="keywordtype">type</span>(ESMF_GridComp)   :: gcomp<span class="comment">                    !&lt; ESMF_GridComp object</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="keywordtype">type</span>(ESMF_State)      :: importState, exportState<span class="comment"> !&lt; ESMF_State object for</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">                                                    !! import/export fields</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="keywordtype">type</span>(ESMF_Clock)      :: clock<span class="comment">                    !&lt; ESMF_Clock object</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span>  :: rc<span class="comment">                       !&lt; return code</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="comment">! local variables</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="keywordtype">logical</span>                     :: isPresent, isSet</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordtype">integer</span>                     :: iostat</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keywordtype">character(len=64)</span>           :: <span class="keywordtype">value</span>, logmsg</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keywordtype">character(len=*)</span>,<span class="keywordtype">parameter</span>  :: subname=<span class="stringliteral">&#39;(MOM_cap:InitializeP0)&#39;</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160; </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  rc = esmf_success</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="comment">! Switch to IPDv03 by filtering all other phaseMap entries</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="keyword">call </span>nuopc_compfilterphasemap(gcomp, esmf_method_initialize, &amp;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;       acceptstringlist=(/<span class="stringliteral">&quot;IPDv03p&quot;</span>/), rc=rc)</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  write_diagnostics = .false.</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&quot;DumpFields&quot;</span>, <span class="keywordtype">value</span>=<span class="keywordtype">value</span>, &amp;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;       ispresent=ispresent, isset=isset, rc=rc)</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keywordflow">if</span> (ispresent .and. isset) write_diagnostics=(trim(<span class="keywordtype">value</span>)==<span class="stringliteral">&quot;true&quot;</span>)</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="keyword">write</span>(logmsg,*) write_diagnostics</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&#39;MOM_cap:DumpFields = &#39;</span>//trim(logmsg), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160; </div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  profile_memory = .false.</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&quot;ProfileMemory&quot;</span>, <span class="keywordtype">value</span>=<span class="keywordtype">value</span>, &amp;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;       ispresent=ispresent, isset=isset, rc=rc)</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keywordflow">if</span> (ispresent .and. isset) profile_memory=(trim(<span class="keywordtype">value</span>)==<span class="stringliteral">&quot;true&quot;</span>)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keyword">write</span>(logmsg,*) profile_memory</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&#39;MOM_cap:ProfileMemory = &#39;</span>//trim(logmsg), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  grid_attach_area = .false.</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&quot;GridAttachArea&quot;</span>, <span class="keywordtype">value</span>=<span class="keywordtype">value</span>, &amp;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;       ispresent=ispresent, isset=isset, rc=rc)</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordflow">if</span> (ispresent .and. isset) grid_attach_area=(trim(<span class="keywordtype">value</span>)==<span class="stringliteral">&quot;true&quot;</span>)</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="keyword">write</span>(logmsg,*) grid_attach_area</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&#39;MOM_cap:GridAttachArea = &#39;</span>//trim(logmsg), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  scalar_field_name = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&quot;ScalarFieldName&quot;</span>, <span class="keywordtype">value</span>=<span class="keywordtype">value</span>, &amp;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;       ispresent=ispresent, isset=isset, rc=rc)</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <span class="keywordflow">if</span> (ispresent .and. isset) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;     scalar_field_name = trim(<span class="keywordtype">value</span>)</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;     <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&#39;MOM_cap:ScalarFieldName = &#39;</span>//trim(scalar_field_name), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        line=__line__, &amp;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        file=__file__)) &amp;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  scalar_field_count = 0</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&quot;ScalarFieldCount&quot;</span>, <span class="keywordtype">value</span>=<span class="keywordtype">value</span>, &amp;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;       ispresent=ispresent, isset=isset, rc=rc)</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="keywordflow">if</span> (ispresent .and. isset) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;     <span class="keyword">read</span>(<span class="keywordtype">value</span>, <span class="stringliteral">&#39;(i)&#39;</span>, iostat=iostat) scalar_field_count</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;     <span class="keywordflow">if</span> (iostat /= 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;       <span class="keyword">call </span>esmf_logseterror(esmf_rc_arg_bad, &amp;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            msg=subname//<span class="stringliteral">&quot;: ScalarFieldCount not an integer: &quot;</span>//trim(<span class="keywordtype">value</span>), &amp;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            line=__line__, file=__file__, rctoreturn=rc)</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;     <span class="keyword">write</span>(logmsg,*) scalar_field_count</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;     <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&#39;MOM_cap:ScalarFieldCount = &#39;</span>//trim(logmsg), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  scalar_field_idx_grid_nx = 0</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&quot;ScalarFieldIdxGridNX&quot;</span>, <span class="keywordtype">value</span>=<span class="keywordtype">value</span>, &amp;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;       ispresent=ispresent, isset=isset, rc=rc)</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="keywordflow">if</span> (ispresent .and. isset) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;     <span class="keyword">read</span>(<span class="keywordtype">value</span>, <span class="stringliteral">&#39;(i)&#39;</span>, iostat=iostat) scalar_field_idx_grid_nx</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;     <span class="keywordflow">if</span> (iostat /= 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="keyword">call </span>esmf_logseterror(esmf_rc_arg_bad, &amp;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;             msg=subname//<span class="stringliteral">&quot;: ScalarFieldIdxGridNX not an integer: &quot;</span>//trim(<span class="keywordtype">value</span>), &amp;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;             line=__line__, file=__file__, rctoreturn=rc)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;     <span class="keyword">write</span>(logmsg,*) scalar_field_idx_grid_nx</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;     <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&#39;MOM_cap:ScalarFieldIdxGridNX = &#39;</span>//trim(logmsg), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160; </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  scalar_field_idx_grid_ny = 0</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&quot;ScalarFieldIdxGridNY&quot;</span>, <span class="keywordtype">value</span>=<span class="keywordtype">value</span>, &amp;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;       ispresent=ispresent, isset=isset, rc=rc)</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="keywordflow">if</span> (ispresent .and. isset) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;     <span class="keyword">read</span>(<span class="keywordtype">value</span>, <span class="stringliteral">&#39;(i)&#39;</span>, iostat=iostat) scalar_field_idx_grid_ny</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;     <span class="keywordflow">if</span> (iostat /= 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="keyword">call </span>esmf_logseterror(esmf_rc_arg_bad, &amp;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;             msg=subname//<span class="stringliteral">&quot;: ScalarFieldIdxGridNY not an integer: &quot;</span>//trim(<span class="keywordtype">value</span>), &amp;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;             line=__line__, file=__file__, rctoreturn=rc)</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;     <span class="keyword">write</span>(logmsg,*) scalar_field_idx_grid_ny</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;     <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&#39;MOM_cap:ScalarFieldIdxGridNY = &#39;</span>//trim(logmsg), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;          <span class="keywordflow">return</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keyword">call </span>nuopc_compattributeadd(gcomp, &amp;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;       attrlist=(/<span class="stringliteral">&#39;RestartFileToRead&#39;</span>, <span class="stringliteral">&#39;RestartFileToWrite&#39;</span>/), rc=rc)</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mom__cap_8F90_source.html#l00439">grid_attach_area</a>, <a class="el" href="mom__cap_8F90_source.html#l00438">profile_memory</a>, <a class="el" href="mom__cap_8F90_source.html#l00441">scalar_field_count</a>, <a class="el" href="mom__cap_8F90_source.html#l00442">scalar_field_idx_grid_nx</a>, <a class="el" href="mom__cap_8F90_source.html#l00443">scalar_field_idx_grid_ny</a>, <a class="el" href="mom__cap_8F90_source.html#l00440">scalar_field_name</a>, and <a class="el" href="mom__cap_8F90_source.html#l00435">write_diagnostics</a>.</p>

<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00464">setservices()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_a9b1bd237d48b444c8c3410371aedc854_icgraph.svg" width="444" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a11baa4d10abcce4225eb074a2c23e398"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11baa4d10abcce4225eb074a2c23e398">&#9670;&nbsp;</a></span>initializerealize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_cap_mod::initializerealize </td>
          <td>(</td>
          <td class="paramtype">type(esmf_gridcomp)&#160;</td>
          <td class="paramname"><em>gcomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_state)&#160;</td>
          <td class="paramname"><em>importState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_state)&#160;</td>
          <td class="paramname"><em>exportState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_clock)&#160;</td>
          <td class="paramname"><em>clock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called by NUOPC to realize import and export fields. "Realizing" a field means that its grid has been defined and an ESMF_Field object has been created and put into the import or export State. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>an ESMF_GridComp object </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">importState</td><td>an ESMF_State object for import fields </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">exportState</td><td>an ESMF_State object for export fields </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">clock</td><td>an ESMF_Clock object </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">rc</td><td>return code </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>ESMF_GridComp object </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">exportstate</td><td>ESMF_State object for import/export fields </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">clock</td><td>ESMF_Clock object </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rc</td><td>return code </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l01138">1138</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <span class="keywordtype">type</span>(ESMF_GridComp)  :: gcomp<span class="comment">                    !&lt; ESMF_GridComp object</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <span class="keywordtype">type</span>(ESMF_State)     :: importState, exportState<span class="comment"> !&lt; ESMF_State object for</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment">                                                   !! import/export fields</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  <span class="keywordtype">type</span>(ESMF_Clock)     :: clock<span class="comment">                    !&lt; ESMF_Clock object</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: rc<span class="comment">                       !&lt; return code</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160; </div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  <span class="comment">! Local Variables</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  <span class="keywordtype">type</span>(ESMF_VM)                              :: vm</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  <span class="keywordtype">type</span>(ESMF_Grid)                            :: gridIn, gridOut</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  <span class="keywordtype">type</span>(ESMF_Mesh)                            :: Emesh, EmeshTemp</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <span class="keywordtype">type</span>(ESMF_DeLayout)                        :: delayout</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <span class="keywordtype">type</span>(ESMF_Distgrid)                        :: Distgrid</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <span class="keywordtype">type</span>(ESMF_DistGridConnection), <span class="keywordtype">allocatable</span> :: connectionList(:)</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  <span class="keywordtype">type</span>(ESMF_StateItem_Flag)                  :: itemFlag</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="keywordtype">type</span> (ocean_public_type),      <span class="keywordtype">pointer</span>     :: ocean_public   =&gt; null()</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  <span class="keywordtype">type</span> (ocean_state_type),       <span class="keywordtype">pointer</span>     :: ocean_state =&gt; null()</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  <span class="keywordtype">type</span>(ice_ocean_boundary_type), <span class="keywordtype">pointer</span>     :: Ice_ocean_boundary =&gt; null()</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type)        , <span class="keywordtype">pointer</span>     :: ocean_grid</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <span class="keywordtype">type</span>(ocean_internalstate_wrapper)          :: ocean_internalstate</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  <span class="keywordtype">integer</span>                                    :: npet, ntiles</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <span class="keywordtype">integer</span>                                    :: nxg, nyg, cnt</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <span class="keywordtype">integer</span>                                    :: isc,iec,jsc,jec</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span>                       :: xb(:),xe(:),yb(:),ye(:),pe(:)</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span>                       :: deBlockList(:,:,:)</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span>                       :: petMap(:)</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span>                       :: deLabelList(:)</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span>                       :: indexList(:)</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="keywordtype">integer</span>                                    :: ioff, joff</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  <span class="keywordtype">integer</span>                                    :: i, j, n, i1, j1, n1, jlast</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <span class="keywordtype">integer</span>                                    :: lbnd1,ubnd1,lbnd2,ubnd2</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  <span class="keywordtype">integer</span>                                    :: lbnd3,ubnd3,lbnd4,ubnd4</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <span class="keywordtype">integer</span>                                    :: nblocks_tot</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="keywordtype">logical</span>                                    :: found</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="keywordtype">integer(ESMF_KIND_I4)</span>, <span class="keywordtype">pointer</span>             :: dataPtr_mask(:,:)</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="keywordtype">  real</span>(ESMF_KIND_R8), <span class="keywordtype">pointer</span>                :: dataPtr_area(:,:)</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="keywordtype">  real</span>(ESMF_KIND_R8), <span class="keywordtype">pointer</span>                :: dataPtr_xcen(:,:)</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="keywordtype">  real</span>(ESMF_KIND_R8), <span class="keywordtype">pointer</span>                :: dataPtr_ycen(:,:)</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="keywordtype">  real</span>(ESMF_KIND_R8), <span class="keywordtype">pointer</span>                :: dataPtr_xcor(:,:)</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="keywordtype">  real</span>(ESMF_KIND_R8), <span class="keywordtype">pointer</span>                :: dataPtr_ycor(:,:)</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  <span class="keywordtype">integer</span>                                    :: mpicom</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="keywordtype">integer</span>                                    :: localPet</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  <span class="keywordtype">integer</span>                                    :: lsize</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <span class="keywordtype">integer</span>                                    :: ig,jg, ni,nj,k</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span>                       :: gindex(:) <span class="comment">! global index space</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="keywordtype">character(len=128)</span>                         :: fldname</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  <span class="keywordtype">character(len=256)</span>                         :: cvalue</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  <span class="keywordtype">character(len=256)</span>                         :: frmt    <span class="comment">! format specifier for several error msgs</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <span class="keywordtype">character(len=512)</span>                         :: err_msg <span class="comment">! error messages</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span>                :: subname=<span class="stringliteral">&#39;(MOM_cap:InitializeRealize)&#39;</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  <span class="keywordtype">integer</span>                         :: spatialDim</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <span class="keywordtype">integer</span>                         :: numOwnedElements</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  <span class="keywordtype">type</span>(ESMF_Array)                :: elemMaskArray</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="keywordtype">  real</span>(ESMF_KIND_R8)    , <span class="keywordtype">pointer</span> :: ownedElemCoords(:)</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="keywordtype">  real</span>(ESMF_KIND_R8)    , <span class="keywordtype">pointer</span> :: lat(:), latMesh(:)</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="keywordtype">  real</span>(ESMF_KIND_R8)    , <span class="keywordtype">pointer</span> :: lon(:), lonMesh(:)</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <span class="keywordtype">integer(ESMF_KIND_I4)</span> , <span class="keywordtype">pointer</span> :: mask(:), maskMesh(:)</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="keywordtype">  real</span>(ESMF_KIND_R8)              :: diff_lon, diff_lat</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="keywordtype">  real</span>                            :: eps_omesh</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  <span class="comment">!--------------------------------</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160; </div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  rc = esmf_success</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160; </div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <span class="keyword">call </span>shr_file_setlogunit (logunit)</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  <span class="comment">!----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  <span class="comment">! Get pointers to ocean internal state</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <span class="comment">!----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160; </div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <span class="keyword">call </span>esmf_gridcompgetinternalstate(gcomp, ocean_internalstate, rc)</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160; </div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  ice_ocean_boundary =&gt; ocean_internalstate%ptr%ice_ocean_boundary_type_ptr</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  ocean_public       =&gt; ocean_internalstate%ptr%ocean_public_type_ptr</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  ocean_state        =&gt; ocean_internalstate%ptr%ocean_state_type_ptr</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160; </div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  <span class="comment">!----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  <span class="comment">! Get mpi information</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  <span class="comment">!----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160; </div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  <span class="keyword">call </span>esmf_vmgetcurrent(vm, rc=rc)</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160; </div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  <span class="keyword">call </span>esmf_vmget(vm, petcount=npet, mpicommunicator=mpicom, localpet=localpet, rc=rc)</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160; </div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  <span class="comment">! global mom grid size</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160; </div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="keyword">call </span>mpp_get_global_domain(ocean_public%domain, xsize=nxg, ysize=nyg)</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  <span class="keyword">write</span>(tmpstr,<span class="stringliteral">&#39;(a,2i6)&#39;</span>) subname//<span class="stringliteral">&#39; nxg,nyg = &#39;</span>,nxg,nyg</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="keyword">call </span>esmf_logwrite(trim(tmpstr), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;       <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160; </div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  <span class="comment">! number of tiles per PET, assumed to be 1, and number of pes (tiles) total</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160; </div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  ntiles=mpp_get_ntile_count(ocean_public%domain) <span class="comment">! this is tiles on this pe</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="keywordflow">if</span> (ntiles /= 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    rc = esmf_failure</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="keyword">call </span>esmf_logwrite(subname//<span class="stringliteral">&#39; ntiles must be 1&#39;</span>, esmf_logmsg_error, rc=rc)</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        line=__line__, &amp;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        file=__file__)) &amp;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  ntiles=mpp_get_domain_npes(ocean_public%domain)</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  <span class="keyword">write</span>(tmpstr,<span class="stringliteral">&#39;(a,1i6)&#39;</span>) subname//<span class="stringliteral">&#39; ntiles = &#39;</span>,ntiles</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  <span class="keyword">call </span>esmf_logwrite(trim(tmpstr), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;       line=__line__, &amp;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;       file=__file__)) &amp;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160; </div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  <span class="comment">! get start and end indices of each tile and their PET</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160; </div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  <span class="keyword">allocate</span>(xb(ntiles),xe(ntiles),yb(ntiles),ye(ntiles),pe(ntiles))</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <span class="keyword">call </span>mpp_get_compute_domains(ocean_public%domain, xbegin=xb, xend=xe, ybegin=yb, yend=ye)</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <span class="keyword">call </span>mpp_get_pelist(ocean_public%domain, pe)</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  <span class="keywordflow">if</span> (debug &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;     <span class="keywordflow">do</span> n = 1,ntiles</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        <span class="keyword">write</span>(tmpstr,<span class="stringliteral">&#39;(a,6i6)&#39;</span>) subname//<span class="stringliteral">&#39; tiles &#39;</span>,n,pe(n),xb(n),xe(n),yb(n),ye(n)</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        <span class="keyword">call </span>esmf_logwrite(trim(tmpstr), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;            line=__line__, &amp;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;            file=__file__)) &amp;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;            <span class="keywordflow">return</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="keywordflow">     enddo</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160; </div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="comment">! Create either a grid or a mesh</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160; </div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;   <span class="comment">!Get the ocean grid and sizes of global and computational domains</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;   <span class="keyword">call </span>get_ocean_grid(ocean_state, ocean_grid)</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160; </div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  <span class="keywordflow">if</span> (geomtype == esmf_geomtype_mesh) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160; </div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;     <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;     <span class="comment">! Create a MOM6 mesh</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;     <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160; </div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;     <span class="keyword">call </span>get_global_grid_size(ocean_grid, ni, nj)</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;     lsize = ( ocean_grid%iec - ocean_grid%isc + 1 ) * ( ocean_grid%jec - ocean_grid%jsc + 1 )</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160; </div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;     <span class="comment">! Create the global index space for the computational domain</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;     <span class="keyword">allocate</span>(gindex(lsize))</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;     k = 0</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;     <span class="keywordflow">do</span> j = ocean_grid%jsc, ocean_grid%jec</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        jg = j + ocean_grid%jdg_offset</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        <span class="keywordflow">do</span> i = ocean_grid%isc, ocean_grid%iec</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;           ig = i + ocean_grid%idg_offset</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;           k = k + 1 <span class="comment">! Increment position within gindex</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;           gindex(k) = ni * (jg - 1) + ig</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="keywordflow">     enddo</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160; </div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;     distgrid = esmf_distgridcreate(arbseqindexlist=gindex, rc=rc)</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160; </div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;     <span class="comment">! read in the mesh</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;     <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&#39;mesh_ocn&#39;</span>, <span class="keywordtype">value</span>=cvalue, rc=rc)</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160; </div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;     emeshtemp = esmf_meshcreate(filename=trim(cvalue), fileformat=esmf_fileformat_esmfmesh, rc=rc)</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160; </div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;     <span class="keywordflow">if</span> (localpet == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="keyword">write</span>(logunit,*)<span class="stringliteral">&#39;mesh file for mom6 domain is &#39;</span>,trim(cvalue)</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160; </div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;     <span class="comment">! recreate the mesh using the above distGrid</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;     emesh = esmf_meshcreate(emeshtemp, elementdistgrid=distgrid, rc=rc)</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160; </div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;     <span class="comment">! Check for consistency of lat, lon and mask between mesh and mom6 grid</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;     <span class="keyword">call </span>esmf_meshget(emesh, spatialdim=spatialdim, numownedelements=numownedelements, rc=rc)</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;          <span class="keywordflow">return</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160; </div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;     <span class="keyword">allocate</span>(ownedelemcoords(spatialdim*numownedelements))</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;     <span class="keyword">allocate</span>(lonmesh(numownedelements), lon(numownedelements))</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;     <span class="keyword">allocate</span>(latmesh(numownedelements), lat(numownedelements))</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;     <span class="keyword">allocate</span>(maskmesh(numownedelements), mask(numownedelements))</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160; </div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;     <span class="keyword">call </span>esmf_meshget(emesh, ownedelemcoords=ownedelemcoords, rc=rc)</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;          <span class="keywordflow">return</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;     <span class="keywordflow">do</span> n = 1,numownedelements</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        lonmesh(n) = ownedelemcoords(2*n-1)</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        latmesh(n) = ownedelemcoords(2*n)</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="keywordflow">     end do</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160; </div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;     elemmaskarray = esmf_arraycreate(distgrid, maskmesh, rc=rc)</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;          <span class="keywordflow">return</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;     <span class="keyword">call </span>esmf_meshget(emesh, elemmaskarray=elemmaskarray, rc=rc)</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;          <span class="keywordflow">return</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160; </div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;     <span class="keyword">call </span>mpp_get_compute_domain(ocean_public%domain, isc, iec, jsc, jec)</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;     n = 0</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;     <span class="keywordflow">do</span> j = jsc, jec</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;       jg = j + ocean_grid%jsc - jsc</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;       <span class="keywordflow">do</span> i = isc, iec</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;         ig = i + ocean_grid%isc - isc</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;         n = n+1</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;         mask(n) = ocean_grid%mask2dT(ig,jg)</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;         lon(n)  = ocean_grid%geolonT(ig,jg)</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;         lat(n)  = ocean_grid%geolatT(ig,jg)</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="keywordflow">     end do</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160; </div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;     eps_omesh = get_eps_omesh(ocean_state)</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;     <span class="keywordflow">do</span> n = 1,numownedelements</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;       diff_lon = abs(mod(lonmesh(n) - lon(n),360.0))</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;       <span class="keywordflow">if</span> (diff_lon &gt; eps_omesh) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;         frmt = <span class="stringliteral">&quot;(&#39;ERROR: Difference between ESMF Mesh and MOM6 domain coords is &quot;</span>//&amp;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;                <span class="stringliteral">&quot;greater than parameter EPS_OMESH. n, lonMesh(n), lon(n), diff_lon, &quot;</span>//&amp;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;                <span class="stringliteral">&quot;EPS_OMESH= &#39;,i8,2(f21.13,3x),2(d21.5))&quot;</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;         <span class="keyword">write</span>(err_msg, frmt)n,lonmesh(n),lon(n), diff_lon, eps_omesh</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;         <span class="keyword">call </span>mom_error(fatal, err_msg)</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;       diff_lat = abs(latmesh(n) - lat(n))</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;       <span class="keywordflow">if</span> (diff_lat &gt; eps_omesh) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;         frmt = <span class="stringliteral">&quot;(&#39;ERROR: Difference between ESMF Mesh and MOM6 domain coords is&quot;</span>//&amp;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;                <span class="stringliteral">&quot;greater than parameter EPS_OMESH. n, latMesh(n), lat(n), diff_lat, &quot;</span>//&amp;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;                <span class="stringliteral">&quot;EPS_OMESH= &#39;,i8,2(f21.13,3x),2(d21.5))&quot;</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;         <span class="keyword">write</span>(err_msg, frmt)n,latmesh(n),lat(n), diff_lat, eps_omesh</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;         <span class="keyword">call </span>mom_error(fatal, err_msg)</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        <span class="keywordflow">if</span> (abs(maskmesh(n) - mask(n)) &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;          frmt = <span class="stringliteral">&quot;(&#39;ERROR: ESMF mesh and MOM6 domain masks are inconsistent! - &quot;</span>//&amp;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;                 <span class="stringliteral">&quot;MOM n, maskMesh(n), mask(n) = &#39;,3(i8,2x))&quot;</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;          <span class="keyword">write</span>(err_msg, frmt)n,maskmesh(n),mask(n)</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;          <span class="keyword">call </span>mom_error(fatal, err_msg)</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="keywordflow">     end do</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160; </div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;     <span class="keyword">deallocate</span>(ownedelemcoords)</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;     <span class="keyword">deallocate</span>(lonmesh , lon )</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;     <span class="keyword">deallocate</span>(latmesh , lat )</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;     <span class="keyword">deallocate</span>(maskmesh, mask)</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;     <span class="comment">! realize the import and export fields using the mesh</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;     <span class="keyword">call </span>mom_realizefields(importstate, fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;Ocn import&quot;</span>, mesh=emesh, rc=rc)</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160; </div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;     <span class="keyword">call </span>mom_realizefields(exportstate, fldsfrocn_num, fldsfrocn, <span class="stringliteral">&quot;Ocn export&quot;</span>, mesh=emesh, rc=rc)</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160; </div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (geomtype == esmf_geomtype_grid) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160; </div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;     <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;     <span class="comment">! create a MOM6 grid</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;     <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160; </div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;     <span class="comment">! generate delayout and dist_grid</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160; </div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;     <span class="keyword">allocate</span>(deblocklist(2,2,ntiles))</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;     <span class="keyword">allocate</span>(petmap(ntiles))</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;     <span class="keyword">allocate</span>(delabellist(ntiles))</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160; </div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;     <span class="keywordflow">do</span> n = 1, ntiles</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;       delabellist(n) = n</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;       deblocklist(1,1,n) = xb(n)</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;       deblocklist(1,2,n) = xe(n)</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;       deblocklist(2,1,n) = yb(n)</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;       deblocklist(2,2,n) = ye(n)</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;       petmap(n) = pe(n)</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;       <span class="comment">! write(tmpstr,&#39;(a,3i8)&#39;) subname//&#39; iglo = &#39;,n,deBlockList(1,1,n),deBlockList(1,2,n)</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;       <span class="comment">! call ESMF_LogWrite(trim(tmpstr), ESMF_LOGMSG_INFO, rc=rc)</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;       <span class="comment">! write(tmpstr,&#39;(a,3i8)&#39;) subname//&#39; jglo = &#39;,n,deBlockList(2,1,n),deBlockList(2,2,n)</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;       <span class="comment">! call ESMF_LogWrite(trim(tmpstr), ESMF_LOGMSG_INFO, rc=rc)</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;       <span class="comment">! write(tmpstr,&#39;(a,2i8)&#39;) subname//&#39; pe  = &#39;,n,petMap(n)</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;       <span class="comment">! call ESMF_LogWrite(trim(tmpstr), ESMF_LOGMSG_INFO, rc=rc)</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;       <span class="comment">!--- assume a tile with starting index of 1 has an equivalent wraparound tile on the other side</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="keywordflow">     enddo</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160; </div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;     delayout = esmf_delayoutcreate(petmap, rc=rc)</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;         <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160; </div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;     <span class="comment">! rsd this assumes tripole grid, but sometimes in CESM a bipole</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;     <span class="comment">! grid is used -- need to introduce conditional logic here</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160; </div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;     <span class="keyword">allocate</span>(connectionlist(2))</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160; </div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;     <span class="comment">! bipolar boundary condition at top row: nyg</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;     <span class="keyword">call </span>esmf_distgridconnectionset(connectionlist(1), tileindexa=1, &amp;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;          tileindexb=1, positionvector=(/nxg+1, 2*nyg+1/), &amp;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;          orientationvector=(/-1, -2/), rc=rc)</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;         <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160; </div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;     <span class="comment">! periodic boundary condition along first dimension</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;     <span class="keyword">call </span>esmf_distgridconnectionset(connectionlist(2), tileindexa=1, &amp;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;          tileindexb=1, positionvector=(/nxg, 0/), rc=rc)</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160; </div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;     distgrid = esmf_distgridcreate(minindex=(/1,1/), maxindex=(/nxg,nyg/), &amp;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;          <span class="comment">!        indexflag = ESMF_INDEX_DELOCAL, &amp;</span></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;          deblocklist=deblocklist, &amp;</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;          <span class="comment">!        deLabelList=deLabelList, &amp;</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;          delayout=delayout, &amp;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;          connectionlist=connectionlist, &amp;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;          rc=rc)</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160; </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;     <span class="keyword">deallocate</span>(xb,xe,yb,ye,pe)</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;     <span class="keyword">deallocate</span>(connectionlist)</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;     <span class="keyword">deallocate</span>(delabellist)</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;     <span class="keyword">deallocate</span>(deblocklist)</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;     <span class="keyword">deallocate</span>(petmap)</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160; </div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;     <span class="keyword">call </span>esmf_distgridget(distgrid=distgrid, localde=0, elementcount=cnt, rc=rc)</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160; </div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;     <span class="keyword">allocate</span>(indexlist(cnt))</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;     <span class="keyword">write</span>(tmpstr,<span class="stringliteral">&#39;(a,i8)&#39;</span>) subname//<span class="stringliteral">&#39; distgrid cnt= &#39;</span>,cnt</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;     <span class="keyword">call </span>esmf_logwrite(trim(tmpstr), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160; </div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;     <span class="keyword">call </span>esmf_distgridget(distgrid=distgrid, localde=0, seqindexlist=indexlist, rc=rc)</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160; </div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;     <span class="keyword">write</span>(tmpstr,<span class="stringliteral">&#39;(a,4i8)&#39;</span>) subname//<span class="stringliteral">&#39; distgrid list= &#39;</span>,&amp;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;          indexlist(1),indexlist(cnt),minval(indexlist), maxval(indexlist)</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;     <span class="keyword">call </span>esmf_logwrite(trim(tmpstr), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160; </div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;     <span class="keyword">deallocate</span>(indexlist)</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160; </div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;     <span class="comment">! create grid</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160; </div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;     gridin = esmf_gridcreate(distgrid=distgrid, &amp;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;          gridedgelwidth=(/0,0/), gridedgeuwidth=(/0,1/), &amp;</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;          coordsys = esmf_coordsys_sph_deg, &amp;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;          rc = rc)</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160; </div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160; </div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;     <span class="keyword">call </span>esmf_gridaddcoord(gridin, staggerloc=esmf_staggerloc_center, rc=rc)</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160; </div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;     <span class="keyword">call </span>esmf_gridaddcoord(gridin, staggerloc=esmf_staggerloc_corner, rc=rc)</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160; </div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;     <span class="keyword">call </span>esmf_gridadditem(gridin, itemflag=esmf_griditem_mask, itemtypekind=esmf_typekind_i4, &amp;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;          staggerloc=esmf_staggerloc_center, rc=rc)</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160; </div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;     <span class="comment">! Attach area to the Grid optionally. By default the cell areas are computed.</span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;     <span class="keywordflow">if</span>(grid_attach_area) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        <span class="keyword">call </span>esmf_gridadditem(gridin, itemflag=esmf_griditem_area, itemtypekind=esmf_typekind_r8, &amp;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;             staggerloc=esmf_staggerloc_center, rc=rc)</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;           line=__line__, &amp;</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;           file=__file__)) &amp;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;           <span class="keywordflow">return</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160; </div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160; </div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;     <span class="keyword">call </span>esmf_gridgetcoord(gridin, coorddim=1, &amp;</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;          staggerloc=esmf_staggerloc_center, &amp;</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;          farrayptr=dataptr_xcen, rc=rc)</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160; </div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;     <span class="keyword">call </span>esmf_gridgetcoord(gridin, coorddim=2, &amp;</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;          staggerloc=esmf_staggerloc_center, &amp;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;          farrayptr=dataptr_ycen, rc=rc)</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160; </div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160; </div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;     <span class="keyword">call </span>esmf_gridgetcoord(gridin, coorddim=1, &amp;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;          staggerloc=esmf_staggerloc_corner, &amp;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;          farrayptr=dataptr_xcor, rc=rc)</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160; </div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;     <span class="keyword">call </span>esmf_gridgetcoord(gridin, coorddim=2, &amp;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;          staggerloc=esmf_staggerloc_corner, &amp;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;          farrayptr=dataptr_ycor, rc=rc)</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160; </div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;     <span class="keyword">call </span>esmf_gridgetitem(gridin, itemflag=esmf_griditem_mask, &amp;</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;          staggerloc=esmf_staggerloc_center, &amp;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;          farrayptr=dataptr_mask, rc=rc)</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160; </div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;     <span class="keywordflow">if</span>(grid_attach_area) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;       <span class="keyword">call </span>esmf_gridgetitem(gridin, itemflag=esmf_griditem_area, &amp;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;             staggerloc=esmf_staggerloc_center, &amp;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;             farrayptr=dataptr_area, rc=rc)</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;       <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160; </div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;     <span class="comment">! load up area, mask, center and corner values</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;     <span class="comment">! area, mask, and centers should be same size in mom and esmf grid</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;     <span class="comment">! corner points may not be, need to offset corner points by 1 in i and j</span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;     <span class="comment">! retrieve these values directly from ocean_grid, which contains halo</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;     <span class="comment">! values for j=0 and wrap-around in i. on tripole seam, decomposition</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;     <span class="comment">! domains are 1 larger in j; to load corner values need to loop one extra row</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160; </div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;     <span class="keyword">call </span>mpp_get_compute_domain(ocean_public%domain, isc, iec, jsc, jec)</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160; </div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;     lbnd1 = lbound(dataptr_mask,1)</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;     ubnd1 = ubound(dataptr_mask,1)</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;     lbnd2 = lbound(dataptr_mask,2)</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;     ubnd2 = ubound(dataptr_mask,2)</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160; </div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;     lbnd3 = lbound(dataptr_xcor,1)</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;     ubnd3 = ubound(dataptr_xcor,1)</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;     lbnd4 = lbound(dataptr_xcor,2)</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;     ubnd4 = ubound(dataptr_xcor,2)</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160; </div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;     <span class="keyword">write</span>(tmpstr,*) subname//<span class="stringliteral">&#39; iscjsc = &#39;</span>,isc,iec,jsc,jec</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;     <span class="keyword">call </span>esmf_logwrite(trim(tmpstr), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160; </div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;     <span class="keyword">write</span>(tmpstr,*) subname//<span class="stringliteral">&#39; lbub12 = &#39;</span>,lbnd1,ubnd1,lbnd2,ubnd2</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;     <span class="keyword">call </span>esmf_logwrite(trim(tmpstr), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160; </div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;     <span class="keyword">write</span>(tmpstr,*) subname//<span class="stringliteral">&#39; lbub34 = &#39;</span>,lbnd3,ubnd3,lbnd4,ubnd4</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;     <span class="keyword">call </span>esmf_logwrite(trim(tmpstr), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160; </div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;     <span class="keywordflow">if</span> (iec-isc /= ubnd1-lbnd1 .or. jec-jsc /= ubnd2-lbnd2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        <span class="keyword">call </span>esmf_logseterror(esmf_rc_arg_bad, &amp;</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;             msg=subname//<span class="stringliteral">&quot;: fld and grid do not have the same size.&quot;</span>, &amp;</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;             line=__line__, file=__file__, rctoreturn=rc)</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160; </div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;     <span class="keywordflow">do</span> j = jsc, jec</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;       j1 = j + lbnd2 - jsc</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;       jg = j + ocean_grid%jsc - jsc</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;       <span class="keywordflow">do</span> i = isc, iec</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;         i1 = i + lbnd1 - isc</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;         ig = i + ocean_grid%isc - isc</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;         dataptr_mask(i1,j1)  = ocean_grid%mask2dT(ig,jg)</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;         dataptr_xcen(i1,j1)  = ocean_grid%geolonT(ig,jg)</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;         dataptr_ycen(i1,j1)  = ocean_grid%geolatT(ig,jg)</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;         <span class="keywordflow">if</span>(grid_attach_area) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;           dataptr_area(i1,j1)  = ocean_grid%areaT(ig,jg)</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="keywordflow">       enddo</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="keywordflow">     enddo</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160; </div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;     jlast = jec</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;     <span class="keywordflow">if</span>(jec == nyg)jlast = jec+1</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160; </div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;     <span class="keywordflow">do</span> j = jsc, jlast</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;       j1 = j + lbnd4 - jsc</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;       jg = j + ocean_grid%jsc - jsc - 1</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;       <span class="keywordflow">do</span> i = isc, iec</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;         i1 = i + lbnd3 - isc</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;         ig = i + ocean_grid%isc - isc - 1</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;         dataptr_xcor(i1,j1)  = ocean_grid%geolonBu(ig,jg)</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;         dataptr_ycor(i1,j1)  = ocean_grid%geolatBu(ig,jg)</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="keywordflow">       enddo</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="keywordflow">     enddo</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160; </div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;     <span class="keyword">write</span>(tmpstr,*) subname//<span class="stringliteral">&#39; mask = &#39;</span>,minval(dataptr_mask),maxval(dataptr_mask)</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;     <span class="keyword">call </span>esmf_logwrite(trim(tmpstr), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160; </div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;     <span class="keywordflow">if</span>(grid_attach_area) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;        <span class="keyword">write</span>(tmpstr,*) subname//<span class="stringliteral">&#39; area = &#39;</span>,minval(dataptr_area),maxval(dataptr_area)</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;        <span class="keyword">call </span>esmf_logwrite(trim(tmpstr), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160; </div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;     <span class="keyword">write</span>(tmpstr,*) subname//<span class="stringliteral">&#39; xcen = &#39;</span>,minval(dataptr_xcen),maxval(dataptr_xcen)</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;     <span class="keyword">call </span>esmf_logwrite(trim(tmpstr), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160; </div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;     <span class="keyword">write</span>(tmpstr,*) subname//<span class="stringliteral">&#39; ycen = &#39;</span>,minval(dataptr_ycen),maxval(dataptr_ycen)</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;     <span class="keyword">call </span>esmf_logwrite(trim(tmpstr), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160; </div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;     <span class="keyword">write</span>(tmpstr,*) subname//<span class="stringliteral">&#39; xcor = &#39;</span>,minval(dataptr_xcor),maxval(dataptr_xcor)</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;     <span class="keyword">call </span>esmf_logwrite(trim(tmpstr), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160; </div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;     <span class="keyword">write</span>(tmpstr,*) subname//<span class="stringliteral">&#39; ycor = &#39;</span>,minval(dataptr_ycor),maxval(dataptr_ycor)</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;     <span class="keyword">call </span>esmf_logwrite(trim(tmpstr), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160; </div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;     gridout = gridin <span class="comment">! for now out same as in</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160; </div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;     <span class="keyword">call </span>mom_realizefields(importstate, fldstoocn_num, fldstoocn, <span class="stringliteral">&quot;Ocn import&quot;</span>, grid=gridin, rc=rc)</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160; </div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;     <span class="keyword">call </span>mom_realizefields(exportstate, fldsfrocn_num, fldsfrocn, <span class="stringliteral">&quot;Ocn export&quot;</span>, grid=gridout, rc=rc)</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160; </div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160; </div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;  <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;  <span class="comment">! set scalar data in export state</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;  <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160; </div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;  <span class="keywordflow">if</span> (len_trim(scalar_field_name) &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;     <span class="keyword">call </span>state_setscalar(dble(nxg),scalar_field_idx_grid_nx, exportstate, localpet, &amp;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;         scalar_field_name, scalar_field_count, rc)</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160; </div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;     <span class="keyword">call </span>state_setscalar(dble(nyg),scalar_field_idx_grid_ny, exportstate, localpet, &amp;</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;          scalar_field_name, scalar_field_count, rc)</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;         <span class="keywordflow">return</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160; </div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160; </div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;  <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  <span class="comment">! Set module variable geomtype in MOM_cap_methods</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  <span class="keyword">call </span>mom_set_geomtype(geomtype)</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160; </div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;  <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;  <span class="comment">! write out diagnostics</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;  <span class="comment">!---------------------------------</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160; </div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;  <span class="comment">!call NUOPC_Write(exportState, fileNamePrefix=&#39;post_realize_field_ocn_export_&#39;, &amp;</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;  <span class="comment">!     timeslice=1, relaxedFlag=.true., rc=rc)</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  <span class="comment">!if (ESMF_LogFoundError(rcToCheck=rc, msg=ESMF_LOGERR_PASSTHRU, &amp;</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;  <span class="comment">!     line=__LINE__, &amp;</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;  <span class="comment">!     file=__FILE__)) &amp;</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;  <span class="comment">!     return  ! bail out</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mom__cap_8F90_source.html#l00431">debug</a>, <a class="el" href="mom__cap_8F90_source.html#l00429">fldsfrocn</a>, <a class="el" href="mom__cap_8F90_source.html#l00428">fldsfrocn_num</a>, <a class="el" href="mom__cap_8F90_source.html#l00427">fldstoocn</a>, <a class="el" href="mom__cap_8F90_source.html#l00426">fldstoocn_num</a>, <a class="el" href="mom__cap_8F90_source.html#l00449">geomtype</a>, <a class="el" href="mom__ocean__model__nuopc_8F90_source.html#l01186">mom_ocean_model_nuopc::get_eps_omesh()</a>, <a class="el" href="MOM__grid_8F90_source.html#l00502">mom_grid::get_global_grid_size()</a>, <a class="el" href="mom__ocean__model__nuopc_8F90_source.html#l01176">mom_ocean_model_nuopc::get_ocean_grid()</a>, <a class="el" href="mom__cap_8F90_source.html#l00439">grid_attach_area</a>, <a class="el" href="mom__cap_8F90_source.html#l00437">logunit</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>, <a class="el" href="mom__cap_8F90_source.html#l02440">mom_realizefields()</a>, <a class="el" href="mom__cap__methods_8F90_source.html#l00050">mom_cap_methods::mom_set_geomtype()</a>, <a class="el" href="mom__cap_8F90_source.html#l00441">scalar_field_count</a>, <a class="el" href="mom__cap_8F90_source.html#l00442">scalar_field_idx_grid_nx</a>, <a class="el" href="mom__cap_8F90_source.html#l00443">scalar_field_idx_grid_ny</a>, <a class="el" href="mom__cap_8F90_source.html#l00440">scalar_field_name</a>, <a class="el" href="mom__cap_8F90_source.html#l02625">shr_file_setlogunit()</a>, <a class="el" href="mom__cap_8F90_source.html#l02403">state_setscalar()</a>, and <a class="el" href="mom__cap_8F90_source.html#l00434">tmpstr</a>.</p>

<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00464">setservices()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_a11baa4d10abcce4225eb074a2c23e398_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_a11baa4d10abcce4225eb074a2c23e398_icgraph.svg" width="470" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aecd83368409a9c059ca3313e25391a0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aecd83368409a9c059ca3313e25391a0b">&#9670;&nbsp;</a></span>modeladvance()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_cap_mod::modeladvance </td>
          <td>(</td>
          <td class="paramtype">type(esmf_gridcomp)&#160;</td>
          <td class="paramname"><em>gcomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called by NUOPC to advance the model a single timestep. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>an ESMF_GridComp object </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">rc</td><td>return code </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>ESMF_GridComp object </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rc</td><td>return code </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l01870">1870</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;  <span class="keywordtype">type</span>(ESMF_GridComp)                    :: gcomp<span class="comment"> !&lt; ESMF_GridComp object</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span>                   :: rc<span class="comment">    !&lt; return code</span></div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160; </div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  <span class="comment">! local variables</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;  <span class="keywordtype">integer</span>                                :: userRc</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;  <span class="keywordtype">logical</span>                                :: existflag, isPresent, isSet</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;  <span class="keywordtype">logical</span>                                :: do_advance = .true.</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;  <span class="keywordtype">type</span>(ESMF_Clock)                       :: clock<span class="comment">!&lt; ESMF Clock class definition</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;  <span class="keywordtype">type</span>(ESMF_Alarm)                       :: alarm</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  <span class="keywordtype">type</span>(ESMF_State)                       :: importState, exportState</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;  <span class="keywordtype">type</span>(ESMF_Time)                        :: currTime</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;  <span class="keywordtype">type</span>(ESMF_TimeInterval)                :: timeStep</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;  <span class="keywordtype">type</span>(ESMF_Time)                        :: startTime</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;  <span class="keywordtype">type</span>(ESMF_TimeInterval)                :: time_elapsed</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;  <span class="keywordtype">integer(ESMF_KIND_I8)</span>                  :: n_interval, time_elapsed_sec</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;  <span class="keywordtype">character(len=64)</span>                      :: timestamp</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;  <span class="keywordtype">type</span> (ocean_public_type),      <span class="keywordtype">pointer</span> :: ocean_public       =&gt; null()</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;  <span class="keywordtype">type</span> (ocean_state_type),       <span class="keywordtype">pointer</span> :: ocean_state        =&gt; null()</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;  <span class="keywordtype">type</span>(ice_ocean_boundary_type), <span class="keywordtype">pointer</span> :: Ice_ocean_boundary =&gt; null()</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;  <span class="keywordtype">type</span>(ocean_internalstate_wrapper)      :: ocean_internalstate</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type)        , <span class="keywordtype">pointer</span> :: ocean_grid</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;  <span class="keywordtype">type</span>(time_type)                        :: Time</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;  <span class="keywordtype">type</span>(time_type)                        :: Time_step_coupled</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;  <span class="keywordtype">type</span>(time_type)                        :: Time_restart_current</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;  <span class="keywordtype">integer</span>                                :: dth, dtm, dts</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;  <span class="keywordtype">integer</span>                                :: nc</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;  <span class="keywordtype">type</span>(ESMF_Time)                        :: MyTime</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;  <span class="keywordtype">integer</span>                                :: seconds, day, year, month, hour, minute</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;  <span class="keywordtype">character(ESMF_MAXSTR)</span>                 :: restartname, cvalue</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;  <span class="keywordtype">character(240)</span>                         :: msgString</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;  <span class="keywordtype">character(len=*)</span>,<span class="keywordtype">parameter</span>             :: subname=<span class="stringliteral">&#39;(MOM_cap:ModelAdvance)&#39;</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160; </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;  rc = esmf_success</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;  <span class="keywordflow">if</span>(profile_memory) <span class="keyword">call </span>esmf_vmlogmeminfo(<span class="stringliteral">&quot;Entering MOM Model_ADVANCE: &quot;</span>)</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160; </div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;  <span class="keyword">call </span>shr_file_setlogunit (logunit)</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160; </div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;  <span class="comment">! query the Component for its clock, importState and exportState</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;  <span class="keyword">call </span>esmf_gridcompget(gcomp, clock=clock, importstate=importstate, &amp;</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    exportstate=exportstate, rc=rc)</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;  <span class="comment">! HERE THE MODEL ADVANCES: currTime -&gt; currTime + timeStep</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160; </div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;  <span class="keyword">call </span>esmf_clockprint(clock, options=<span class="stringliteral">&quot;currTime&quot;</span>, &amp;</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    prestring=<span class="stringliteral">&quot;------&gt;Advancing OCN from: &quot;</span>, unit=msgstring, rc=rc)</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;  <span class="keyword">call </span>esmf_logwrite(subname//trim(msgstring), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160; </div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;  <span class="keyword">call </span>esmf_clockget(clock, starttime=starttime, currtime=currtime, &amp;</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    timestep=timestep, rc=rc)</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160; </div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;  <span class="keyword">call </span>esmf_timeprint(currtime + timestep, &amp;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    prestring=<span class="stringliteral">&quot;--------------------------------&gt; to: &quot;</span>, unit=msgstring, rc=rc)</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;  <span class="keyword">call </span>esmf_logwrite(trim(msgstring), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160; </div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;  time_step_coupled = esmf2fms_time(timestep)</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;  time = esmf2fms_time(currtime)</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160; </div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;  <span class="comment">!---------------</span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;  <span class="comment">! Apply ocean lag for startup runs:</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;  <span class="comment">!---------------</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160; </div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;  <span class="keywordflow">if</span> (cesm_coupled) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    <span class="keywordflow">if</span> (trim(runtype) == <span class="stringliteral">&quot;initial&quot;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160; </div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;      <span class="comment">! Do not call MOM6 timestepping routine if the first cpl tstep of a startup run</span></div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;      <span class="keywordflow">if</span> (currtime == starttime) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&quot;MOM6 - Skipping the first coupling timestep&quot;</span>, esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;          <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;        do_advance = .false.</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        do_advance = .true.</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160; </div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;      <span class="keywordflow">if</span> (do_advance) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;         <span class="comment">! If the second cpl tstep of a startup run, step back a cpl tstep and advance for two cpl tsteps</span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;         <span class="keywordflow">if</span> (currtime == starttime + timestep) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;            <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&quot;MOM6 - Stepping back one coupling timestep&quot;</span>, esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;            <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;                 line=__line__, &amp;</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;                 file=__file__)) &amp;</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                 <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;            time = esmf2fms_time(currtime-timestep) <span class="comment">! i.e., startTime</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160; </div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;            <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&quot;MOM6 - doubling the coupling timestep&quot;</span>, esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;            <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;                 line=__line__, &amp;</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                 file=__file__)) &amp;</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;                 <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;            time_step_coupled = 2 * esmf2fms_time(timestep)</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160; </div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160; </div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;  <span class="keywordflow">if</span> (do_advance) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160; </div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;     <span class="keyword">call </span>esmf_gridcompgetinternalstate(gcomp, ocean_internalstate, rc)</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;          <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160; </div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;     ice_ocean_boundary =&gt; ocean_internalstate%ptr%ice_ocean_boundary_type_ptr</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;     ocean_public       =&gt; ocean_internalstate%ptr%ocean_public_type_ptr</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;     ocean_state        =&gt; ocean_internalstate%ptr%ocean_state_type_ptr</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160; </div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;     <span class="comment">!---------------</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;     <span class="comment">! Write diagnostics for import</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;     <span class="comment">!---------------</span></div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160; </div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;     <span class="keywordflow">if</span> (write_diagnostics) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        <span class="keyword">call </span>nuopc_write(importstate, filenameprefix=<span class="stringliteral">&#39;field_ocn_import_&#39;</span>, &amp;</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;             timeslice=import_slice, relaxedflag=.true., rc=rc)</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;             line=__line__, &amp;</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;             file=__file__)) &amp;</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;             <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;        import_slice = import_slice + 1</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160; </div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;     <span class="comment">!---------------</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;     <span class="comment">! Get ocean grid</span></div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;     <span class="comment">!---------------</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160; </div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;     <span class="keyword">call </span>get_ocean_grid(ocean_state, ocean_grid)</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160; </div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;     <span class="comment">!---------------</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;     <span class="comment">! Import data</span></div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;     <span class="comment">!---------------</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160; </div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;     <span class="keyword">call </span>mom_import(ocean_public, ocean_grid, importstate, ice_ocean_boundary, rc=rc)</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;          <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160; </div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;     <span class="comment">!---------------</span></div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;     <span class="comment">! Update MOM6</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;     <span class="comment">!---------------</span></div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160; </div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;     <span class="keywordflow">if</span>(profile_memory) <span class="keyword">call </span>esmf_vmlogmeminfo(<span class="stringliteral">&quot;Entering MOM update_ocean_model: &quot;</span>)</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;     <span class="keyword">call </span>update_ocean_model(ice_ocean_boundary, ocean_state, ocean_public, time, time_step_coupled)</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;     <span class="keywordflow">if</span>(profile_memory) <span class="keyword">call </span>esmf_vmlogmeminfo(<span class="stringliteral">&quot;Leaving MOM update_ocean_model: &quot;</span>)</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160; </div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;     <span class="comment">!---------------</span></div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;     <span class="comment">! Export Data</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;     <span class="comment">!---------------</span></div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160; </div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;     <span class="keyword">call </span>mom_export(ocean_public, ocean_grid, ocean_state, exportstate, clock, rc=rc)</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;          <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160; </div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160; </div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;  <span class="comment">!---------------</span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;  <span class="comment">! If restart alarm is ringing - write restart file</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;  <span class="comment">!---------------</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160; </div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;  <span class="keyword">call </span>esmf_clockgetalarm(clock, alarmname=<span class="stringliteral">&#39;alarm_restart&#39;</span>, alarm=alarm, rc=rc)</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      line=__line__, &amp;</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;      file=__file__)) &amp;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;      <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160; </div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;  <span class="keywordflow">if</span> (esmf_alarmisringing(alarm, rc=rc)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;         <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160; </div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;     <span class="keyword">call </span>esmf_alarmringeroff(alarm, rc=rc )</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;         <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160; </div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;     <span class="comment">! call into system specific method to get desired restart filename</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;     restartname = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;     <span class="keyword">call </span>esmf_methodexecute(gcomp, label=<span class="stringliteral">&quot;GetRestartFileToWrite&quot;</span>, &amp;</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;          existflag=existflag, userrc=userrc, rc=rc)</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=<span class="stringliteral">&quot;Error executing user method to get restart filename&quot;</span>, &amp;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;         <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160; </div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=userrc, msg=<span class="stringliteral">&quot;Error in method to get restart filename&quot;</span>, &amp;</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;          <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;     <span class="keywordflow">if</span> (existflag) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&quot;MOM_cap: called user GetRestartFileToWrite method&quot;</span>, esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;            line=__line__, &amp;</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;            file=__file__)) &amp;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;            <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;        <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&#39;RestartFileToWrite&#39;</span>, &amp;</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;             ispresent=ispresent, isset=isset, <span class="keywordtype">value</span>=cvalue, rc=rc)</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;            line=__line__, &amp;</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;            file=__file__)) &amp;</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;            <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;        <span class="keywordflow">if</span> (ispresent .and. isset) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;           restartname = trim(cvalue)</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;           <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&quot;MOM_cap: User RestartFileToWrite: &quot;</span>//trim(restartname), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;           <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;               line=__line__, &amp;</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;               file=__file__)) &amp;</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;               <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160; </div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;     <span class="keywordflow">if</span> (len_trim(restartname) == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;        <span class="comment">! none provided, so use a default restart filename</span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;        <span class="keyword">call </span>esmf_clockgetnexttime(clock, mytime, rc=rc)</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;            line=__line__, &amp;</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;            file=__file__)) &amp;</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;            <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;        <span class="keyword">call </span>esmf_timeget (mytime, yy=year, mm=month, dd=day, &amp;</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;             h=hour, m=minute, s=seconds, rc=rc )</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;            line=__line__, &amp;</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;            file=__file__)) &amp;</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;            <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;        <span class="keyword">write</span>(restartname,<span class="stringliteral">&#39;(A,&quot;.mom6.r.&quot;,I4.4,&quot;-&quot;,I2.2,&quot;-&quot;,I2.2,&quot;-&quot;,I2.2,&quot;-&quot;,I2.2,&quot;-&quot;,I2.2)&#39;</span>) &amp;</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;              <span class="stringliteral">&quot;ocn&quot;</span>, year, month, day, hour, minute, seconds</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;        <span class="keyword">call </span>esmf_logwrite(<span class="stringliteral">&quot;MOM_cap: Using default restart filename:  &quot;</span>//trim(restartname), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;            line=__line__, &amp;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;            file=__file__)) &amp;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;            <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160; </div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;     <span class="comment">! TODO: address if this requirement is being met for the DA group</span></div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;     <span class="comment">! Optionally write restart files when currTime-startTime is integer multiples of restart_interval</span></div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;     <span class="comment">! if (restart_interval &gt; 0 ) then</span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;     <span class="comment">!   time_elapsed = currTime - startTime</span></div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;     <span class="comment">!   call ESMF_TimeIntervalGet(time_elapsed, s_i8=time_elapsed_sec, rc=rc)</span></div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;     <span class="comment">!   if (ESMF_LogFoundError(rcToCheck=rc, msg=ESMF_LOGERR_PASSTHRU, &amp;</span></div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;     <span class="comment">!     line=__LINE__, &amp;</span></div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;     <span class="comment">!     file=__FILE__)) &amp;</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;     <span class="comment">!     return  ! bail out</span></div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;     <span class="comment">!   n_interval = time_elapsed_sec / restart_interval</span></div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;     <span class="comment">!   if ((n_interval .gt. 0) .and. (n_interval*restart_interval == time_elapsed_sec)) then</span></div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;     <span class="comment">!       time_restart_current = esmf2fms_time(currTime)</span></div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;     <span class="comment">!       timestamp = date_to_string(time_restart_current)</span></div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;     <span class="comment">!       call ESMF_LogWrite(&quot;MOM: Writing restart at &quot;//trim(timestamp), ESMF_LOGMSG_INFO, rc=rc)</span></div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;     <span class="comment">!       write(*,*) &#39;calling ocean_model_restart&#39;</span></div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;     <span class="comment">!       call ocean_model_restart(ocean_state, timestamp)</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;     <span class="comment">!   endif</span></div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;     <span class="comment">! endif</span></div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160; </div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;     <span class="comment">! write restart file(s)</span></div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;     <span class="keyword">call </span>ocean_model_restart(ocean_state, restartname=restartname)</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160; </div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;     <span class="keywordflow">if</span> (is_root_pe()) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;       <span class="keyword">write</span>(logunit,*) subname//<span class="stringliteral">&#39; writing restart file &#39;</span>,trim(restartname)</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160; </div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  <span class="comment">!---------------</span></div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;  <span class="comment">! Write diagnostics</span></div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;  <span class="comment">!---------------</span></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160; </div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;  <span class="keywordflow">if</span> (write_diagnostics) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;     <span class="keyword">call </span>nuopc_write(exportstate, filenameprefix=<span class="stringliteral">&#39;field_ocn_export_&#39;</span>, &amp;</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;          timeslice=export_slice, relaxedflag=.true., rc=rc)</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;         line=__line__, &amp;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;         file=__file__)) &amp;</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;         <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;     export_slice = export_slice + 1</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160; </div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;  <span class="keywordflow">if</span>(profile_memory) <span class="keyword">call </span>esmf_vmlogmeminfo(<span class="stringliteral">&quot;Leaving MOM Model_ADVANCE: &quot;</span>)</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mom__cap_8F90_source.html#l00448">cesm_coupled</a>, <a class="el" href="mom__cap_8F90_source.html#l00433">export_slice</a>, <a class="el" href="mom__ocean__model__nuopc_8F90_source.html#l01176">mom_ocean_model_nuopc::get_ocean_grid()</a>, <a class="el" href="mom__cap_8F90_source.html#l00432">import_slice</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00044">mom_error_handler::is_root_pe()</a>, <a class="el" href="mom__cap_8F90_source.html#l00437">logunit</a>, <a class="el" href="mom__cap__methods_8F90_source.html#l00331">mom_cap_methods::mom_export()</a>, <a class="el" href="mom__cap__methods_8F90_source.html#l00061">mom_cap_methods::mom_import()</a>, <a class="el" href="mom__cap_8F90_source.html#l00438">profile_memory</a>, <a class="el" href="mom__cap_8F90_source.html#l00436">runtype</a>, <a class="el" href="mom__cap_8F90_source.html#l02625">shr_file_setlogunit()</a>, and <a class="el" href="mom__cap_8F90_source.html#l00435">write_diagnostics</a>.</p>

<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00464">setservices()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_aecd83368409a9c059ca3313e25391a0b_cgraph.svg" width="100%" height="535"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_aecd83368409a9c059ca3313e25391a0b_icgraph.svg" width="470" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a5ac6a66c943ef7933973ed155a81dd91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ac6a66c943ef7933973ed155a81dd91">&#9670;&nbsp;</a></span>modelsetrunclock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_cap_mod::modelsetrunclock </td>
          <td>(</td>
          <td class="paramtype">type(esmf_gridcomp)&#160;</td>
          <td class="paramname"><em>gcomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l02180">2180</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;  <span class="keywordtype">type</span>(ESMF_GridComp)  :: gcomp</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: rc</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160; </div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;  <span class="comment">! local variables</span></div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;  <span class="keywordtype">type</span>(ESMF_Clock)         :: mclock, dclock</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;  <span class="keywordtype">type</span>(ESMF_Time)          :: mcurrtime, dcurrtime</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;  <span class="keywordtype">type</span>(ESMF_Time)          :: mstoptime</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;  <span class="keywordtype">type</span>(ESMF_TimeInterval)  :: mtimestep, dtimestep</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;  <span class="keywordtype">character(len=128)</span>       :: mtimestring, dtimestring</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;  <span class="keywordtype">character(len=256)</span>       :: cvalue</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;  <span class="keywordtype">character(len=256)</span>       :: restart_option <span class="comment">! Restart option units</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;  <span class="keywordtype">integer</span>                  :: restart_n      <span class="comment">! Number until restart interval</span></div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;  <span class="keywordtype">integer</span>                  :: restart_ymd    <span class="comment">! Restart date (YYYYMMDD)</span></div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;  <span class="keywordtype">type</span>(ESMF_ALARM)         :: restart_alarm</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;  <span class="keywordtype">logical</span>                  :: isPresent, isSet</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;  <span class="keywordtype">logical</span>                  :: first_time = .true.</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;  <span class="keywordtype">character(len=*)</span>,<span class="keywordtype">parameter</span> :: subname=<span class="stringliteral">&#39;MOM_cap:(ModelSetRunClock) &#39;</span></div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;  <span class="comment">!--------------------------------</span></div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160; </div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;  rc = esmf_success</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160; </div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;  <span class="comment">! query the Component for its clock, importState and exportState</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;  <span class="keyword">call </span>nuopc_modelget(gcomp, driverclock=dclock, modelclock=mclock, rc=rc)</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160; </div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;  <span class="keyword">call </span>esmf_clockget(dclock, currtime=dcurrtime, timestep=dtimestep, rc=rc)</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160; </div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;  <span class="keyword">call </span>esmf_clockget(mclock, currtime=mcurrtime, timestep=mtimestep, rc=rc)</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160; </div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;  <span class="comment">!--------------------------------</span></div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;  <span class="comment">! check that the current time in the model and driver are the same</span></div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;  <span class="comment">!--------------------------------</span></div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160; </div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;  <span class="keywordflow">if</span> (mcurrtime /= dcurrtime) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    <span class="keyword">call </span>esmf_timeget(dcurrtime, timestring=dtimestring, rc=rc)</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      line=__line__, &amp;</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      file=__file__)) &amp;</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;      <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160; </div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    <span class="keyword">call </span>esmf_timeget(mcurrtime, timestring=mtimestring, rc=rc)</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;      line=__line__, &amp;</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;      file=__file__)) &amp;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;      <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160; </div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;    <span class="keyword">call </span>esmf_logseterror(esmf_rc_val_wrong, &amp;</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;         msg=subname//<span class="stringliteral">&quot;: ERROR in time consistency: &quot;</span>//trim(dtimestring)//<span class="stringliteral">&quot; != &quot;</span>//trim(mtimestring),  &amp;</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;         line=__line__, file=__file__, rctoreturn=rc)</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160; </div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;  <span class="comment">!--------------------------------</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;  <span class="comment">! force model clock currtime and timestep to match driver and set stoptime</span></div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;  <span class="comment">!--------------------------------</span></div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160; </div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;  mstoptime = mcurrtime + dtimestep</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160; </div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;  <span class="keyword">call </span>esmf_clockset(mclock, currtime=dcurrtime, timestep=dtimestep, stoptime=mstoptime, rc=rc)</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160; </div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;  <span class="keywordflow">if</span> (first_time) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;     <span class="comment">!--------------------------------</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;     <span class="comment">! set restart alarm</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;     <span class="comment">!--------------------------------</span></div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160; </div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;     <span class="comment">! defaults</span></div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;     restart_n = 0</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;     restart_ymd = 0</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160; </div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;     <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&quot;restart_option&quot;</span>, ispresent=ispresent, &amp;</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;          isset=isset, <span class="keywordtype">value</span>=restart_option, rc=rc)</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;          <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;     <span class="keywordflow">if</span> (ispresent .and. isset) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;        <span class="keyword">call </span>nuopc_compattributeget(gcomp,  name=<span class="stringliteral">&quot;restart_n&quot;</span>, <span class="keywordtype">value</span>=cvalue, &amp;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;             ispresent=ispresent, isset=isset, rc=rc)</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;             line=__line__, &amp;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;             file=__file__)) &amp;</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;             <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;        <span class="keywordflow">if</span> (ispresent .and. isset) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;           <span class="keyword">read</span>(cvalue,*) restart_n</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;        <span class="keyword">call </span>nuopc_compattributeget(gcomp, name=<span class="stringliteral">&quot;restart_ymd&quot;</span>, <span class="keywordtype">value</span>=cvalue, &amp;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;             ispresent=ispresent, isset=isset, rc=rc)</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;             line=__line__, &amp;</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;             file=__file__)) &amp;</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;             <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;        <span class="keywordflow">if</span> (ispresent .and. isset) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;           <span class="keyword">read</span>(cvalue,*) restart_ymd</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;     <span class="keywordflow">else</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;        restart_option = <span class="stringliteral">&quot;none&quot;</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160; </div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;     <span class="keyword">call </span>alarminit(mclock, &amp;</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;          alarm   = restart_alarm,         &amp;</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;          option  = trim(restart_option),  &amp;</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;          opt_n   = restart_n,             &amp;</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;          opt_ymd = restart_ymd,           &amp;</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;          reftime = mcurrtime,             &amp;</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;          alarmname = <span class="stringliteral">&#39;alarm_restart&#39;</span>, rc=rc)</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;          <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160; </div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;     <span class="keyword">call </span>esmf_alarmset(restart_alarm, clock=mclock, rc=rc)</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;          <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;     first_time = .false.</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160; </div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;     <span class="keyword">call </span>esmf_logwrite(subname//<span class="stringliteral">&quot; Set restart option = &quot;</span>//restart_option, &amp;</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;          esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;     <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;          <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160; </div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160; </div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;  <span class="comment">!--------------------------------</span></div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;  <span class="comment">! Advance model clock to trigger alarms then reset model clock back to currtime</span></div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;  <span class="comment">!--------------------------------</span></div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160; </div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;  <span class="keyword">call </span>esmf_clockadvance(mclock,rc=rc)</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160; </div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;  <span class="keyword">call </span>esmf_clockset(mclock, currtime=dcurrtime, timestep=dtimestep, stoptime=mstoptime, rc=rc)</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mom__cap__time_8F90_source.html#l00069">mom_cap_time::alarminit()</a>.</p>

<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00464">setservices()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_a5ac6a66c943ef7933973ed155a81dd91_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_a5ac6a66c943ef7933973ed155a81dd91_icgraph.svg" width="487" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a57fa339b90f33aff03637f9dee5ffaf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57fa339b90f33aff03637f9dee5ffaf1">&#9670;&nbsp;</a></span>mom_realizefields()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_cap_mod::mom_realizefields </td>
          <td>(</td>
          <td class="paramtype">type(esmf_state), intent(inout)&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nfields</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__cap__mod_1_1fld__list__type.html">fld_list_type</a>), dimension(:), intent(inout)&#160;</td>
          <td class="paramname"><em>field_defs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>tag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_grid), intent(in), optional&#160;</td>
          <td class="paramname"><em>grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_mesh), intent(in), optional&#160;</td>
          <td class="paramname"><em>mesh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(inout)&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Realize the import and export fields using either a grid or a mesh. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state</td><td>ESMF_State object for import/export fields. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nfields</td><td>Number of fields. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">field_defs</td><td>Structure with field's information. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tag</td><td>Import or export. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grid</td><td>ESMF grid. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mesh</td><td>ESMF mesh. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rc</td><td>Return code. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l02440">2440</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;  <span class="keywordtype">type</span>(ESMF_State)    , <span class="keywordtype">intent(inout)</span>        :: state<span class="comment"> !&lt; ESMF_State object for</span></div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;<span class="comment">                                                      !! import/export fields.</span></div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;  <span class="keywordtype">integer</span>             , <span class="keywordtype">intent(in)</span>           :: nfields<span class="comment"> !&lt; Number of fields.</span></div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;  <span class="keywordtype">type</span>(fld_list_type) , <span class="keywordtype">intent(inout)</span>        :: field_defs(:)<span class="comment"> !&lt; Structure with field&#39;s</span></div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;<span class="comment">                                                              !! information.</span></div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;  <span class="keywordtype">character(len=*)</span>    , <span class="keywordtype">intent(in)</span>           :: tag<span class="comment"> !&lt; Import or export.</span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;  <span class="keywordtype">type</span>(ESMF_Grid)     , <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: grid<span class="comment">!&lt; ESMF grid.</span></div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;  <span class="keywordtype">type</span>(ESMF_Mesh)     , <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: mesh<span class="comment">!&lt; ESMF mesh.</span></div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;  <span class="keywordtype">integer</span>             , <span class="keywordtype">intent(inout)</span>        :: rc<span class="comment">  !&lt; Return code.</span></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160; </div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  <span class="comment">! local variables</span></div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;  <span class="keywordtype">integer</span>                     :: i</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;  <span class="keywordtype">type</span>(ESMF_Field)            :: field</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;<span class="keywordtype">  real</span>(ESMF_KIND_R8), <span class="keywordtype">pointer</span> :: fldptr1d(:)   <span class="comment">! for mesh</span></div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;<span class="keywordtype">  real</span>(ESMF_KIND_R8), <span class="keywordtype">pointer</span> :: fldptr2d(:,:) <span class="comment">! for grid</span></div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;  <span class="keywordtype">character(len=*)</span>,<span class="keywordtype">parameter</span>  :: subname=<span class="stringliteral">&#39;(MOM_cap:MOM_RealizeFields)&#39;</span></div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  <span class="comment">!--------------------------------------------------------</span></div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160; </div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;  rc = esmf_success</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160; </div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;  <span class="keywordflow">do</span> i = 1, nfields</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160; </div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;    <span class="keywordflow">if</span> (nuopc_isconnected(state, fieldname=field_defs(i)%shortname)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160; </div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;      <span class="keywordflow">if</span> (field_defs(i)%shortname == scalar_field_name) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160; </div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;        <span class="keyword">call </span>esmf_logwrite(subname // tag // <span class="stringliteral">&quot; Field &quot;</span>// trim(field_defs(i)%stdname) // <span class="stringliteral">&quot; is connected on root pe.&quot;</span>, &amp;</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;          esmf_logmsg_info, &amp;</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;          file=__file__, &amp;</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;          rc=rc)</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160; </div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;        <span class="keyword">call </span><a class="code" href="mom__cap_8F90.html#a5fb5cf93f9c582256b6835d768a42e60">setscalarfield</a>(field, rc)</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;          file=__file__)) &amp;</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;          <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160; </div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160; </div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;        <span class="keyword">call </span>esmf_logwrite(subname // tag // <span class="stringliteral">&quot; Field &quot;</span>// trim(field_defs(i)%stdname) // <span class="stringliteral">&quot; is connected.&quot;</span>, &amp;</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;          esmf_logmsg_info, &amp;</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;          line=__line__, &amp;</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;          file=__file__, &amp;</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;          rc=rc)</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160; </div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">present</span>(grid)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160; </div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;           field = esmf_fieldcreate(grid, esmf_typekind_r8, indexflag=esmf_index_delocal, &amp;</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;                name=field_defs(i)%shortname, rc=rc)</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;           <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;                line=__line__, &amp;</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;                file=__file__)) &amp;</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;                <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160; </div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;           <span class="comment">! initialize fldptr to zero</span></div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;           <span class="keyword">call </span>esmf_fieldget(field, farrayptr=fldptr2d, rc=rc)</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;           <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;                line=__line__, &amp;</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;                file=__file__)) &amp;</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;                <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;           fldptr2d(:,:) = 0.0</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160; </div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">present</span>(mesh)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160; </div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;           field = esmf_fieldcreate(mesh=mesh, typekind=esmf_typekind_r8, meshloc=esmf_meshloc_element, &amp;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;                name=field_defs(i)%shortname, rc=rc)</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;           <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;                line=__line__, &amp;</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;                file=__file__)) &amp;</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;                <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160; </div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;           <span class="comment">! initialize fldptr to zero</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;           <span class="keyword">call </span>esmf_fieldget(field, farrayptr=fldptr1d, rc=rc)</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;           <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;                line=__line__, &amp;</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;                file=__file__)) &amp;</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;                <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;           fldptr1d(:) = 0.0</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160; </div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160; </div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160; </div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;      <span class="comment">! Realize connected field</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;      <span class="keyword">call </span>nuopc_realize(state, field=field, rc=rc)</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;        line=__line__, &amp;</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;        file=__file__)) &amp;</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;        <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160; </div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;    <span class="keywordflow">else</span> <span class="comment">! field is not connected</span></div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160; </div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;      <span class="keyword">call </span>esmf_logwrite(subname // tag // <span class="stringliteral">&quot; Field &quot;</span>// trim(field_defs(i)%stdname) // <span class="stringliteral">&quot; is not connected.&quot;</span>, &amp;</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;        esmf_logmsg_info, &amp;</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;        line=__line__, &amp;</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;        file=__file__, &amp;</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;        rc=rc)</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;      <span class="comment">! remove a not connected Field from State</span></div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;      <span class="keyword">call </span>esmf_stateremove(state, (/field_defs(i)%shortname/), rc=rc)</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;        line=__line__, &amp;</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;        file=__file__)) &amp;</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;        <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160; </div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160; </div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160; </div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;<span class="keyword">contains</span>  <span class="comment">!- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160; </div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;  <span class="keyword">subroutine </span><a class="code" href="mom__cap_8F90.html#a5fb5cf93f9c582256b6835d768a42e60">setscalarfield</a>(field, rc)</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160; </div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;    <span class="comment">! create a field with scalar data on the root pe</span></div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;    <span class="keywordtype">type</span>(ESMF_Field), <span class="keywordtype">intent(inout)</span>  :: field</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;    <span class="keywordtype">integer</span>,          <span class="keywordtype">intent(inout)</span>  :: rc</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160; </div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;    <span class="comment">! local variables</span></div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;    <span class="keywordtype">type</span>(ESMF_Distgrid) :: distgrid</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    <span class="keywordtype">type</span>(ESMF_Grid)     :: grid</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: subname=<span class="stringliteral">&#39;(MOM_cap:SetScalarField)&#39;</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160; </div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;    rc = esmf_success</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160; </div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;    <span class="comment">! create a DistGrid with a single index space element, which gets mapped onto DE 0.</span></div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;    distgrid = esmf_distgridcreate(minindex=(/1/), maxindex=(/1/), rc=rc)</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;        line=__line__, &amp;</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;        file=__file__)) &amp;</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;        <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160; </div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;    grid = esmf_gridcreate(distgrid, rc=rc)</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;        line=__line__, &amp;</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;        file=__file__)) &amp;</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;        <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160; </div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;    <span class="comment">! num of scalar values</span></div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;    field = esmf_fieldcreate(name=trim(scalar_field_name), grid=grid, typekind=esmf_typekind_r8, &amp;</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;         ungriddedlbound=(/1/), ungriddedubound=(/scalar_field_count/), gridtofieldmap=(/2/), rc=rc)</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;        line=__line__, &amp;</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;        file=__file__)) &amp;</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;        <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160; </div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="mom__cap_8F90.html#a5fb5cf93f9c582256b6835d768a42e60">setscalarfield</a></div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mom__cap_8F90_source.html#l00440">scalar_field_name</a>, and <a class="el" href="mom__cap_8F90_source.html#l02552">setscalarfield()</a>.</p>

<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_a57fa339b90f33aff03637f9dee5ffaf1_cgraph.svg" width="402" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_a57fa339b90f33aff03637f9dee5ffaf1_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a9b7799c15a6eeadc1d286ce4d37163e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b7799c15a6eeadc1d286ce4d37163e6">&#9670;&nbsp;</a></span>ocean_model_finalize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_cap_mod::ocean_model_finalize </td>
          <td>(</td>
          <td class="paramtype">type(esmf_gridcomp)&#160;</td>
          <td class="paramname"><em>gcomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called by NUOPC at the end of the run to clean up. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>an ESMF_GridComp object </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">rc</td><td>return code </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>ESMF_GridComp object </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rc</td><td>return code </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l02347">2347</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160; </div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;  <span class="keywordtype">type</span>(ESMF_GridComp)  :: gcomp<span class="comment"> !&lt; ESMF_GridComp object</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: rc<span class="comment">    !&lt; return code</span></div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160; </div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;  <span class="comment">! local variables</span></div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;  <span class="keywordtype">type</span> (ocean_public_type),      <span class="keywordtype">pointer</span> :: ocean_public</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;  <span class="keywordtype">type</span> (ocean_state_type),       <span class="keywordtype">pointer</span> :: ocean_state</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;  <span class="keywordtype">type</span>(ocean_internalstate_wrapper)      :: ocean_internalstate</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;  <span class="keywordtype">type</span>(TIME_TYPE)                        :: Time</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;  <span class="keywordtype">type</span>(ESMF_Clock)                       :: clock</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;  <span class="keywordtype">type</span>(ESMF_Time)                        :: currTime</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;  <span class="keywordtype">character(len=64)</span>                      :: timestamp</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;  <span class="keywordtype">character(len=*)</span>,<span class="keywordtype">parameter</span>  :: subname=<span class="stringliteral">&#39;(MOM_cap:ocean_model_finalize)&#39;</span></div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160; </div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;  <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;MOM: --- finalize called ---&#39;</span></div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;  rc = esmf_success</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160; </div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;  <span class="keyword">call </span>esmf_gridcompgetinternalstate(gcomp, ocean_internalstate, rc)</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160; </div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;  ocean_public =&gt; ocean_internalstate%ptr%ocean_public_type_ptr</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;  ocean_state  =&gt; ocean_internalstate%ptr%ocean_state_type_ptr</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160; </div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;  <span class="keyword">call </span>nuopc_modelget(gcomp, modelclock=clock, rc=rc)</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160; </div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;  <span class="keyword">call </span>esmf_clockget(clock, currtime=currtime, rc=rc)</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;  time = esmf2fms_time(currtime)</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160; </div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;  <span class="keywordflow">if</span> (cesm_coupled) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;     <span class="keyword">call </span>ocean_model_end(ocean_public, ocean_state, time, write_restart=.false.)</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;     <span class="keyword">call </span>ocean_model_end(ocean_public, ocean_state, time, write_restart=.true.)</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  <span class="keyword">call </span>field_manager_end()</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160; </div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;  <span class="keyword">call </span>fms_io_exit()</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;  <span class="keyword">call </span>fms_end()</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160; </div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;  <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;MOM: --- completed ---&#39;</span></div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mom__cap_8F90_source.html#l00448">cesm_coupled</a>.</p>

<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00464">setservices()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_a9b7799c15a6eeadc1d286ce4d37163e6_icgraph.svg" width="416" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ae0439afc4c901d9850515768bdaaed09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0439afc4c901d9850515768bdaaed09">&#9670;&nbsp;</a></span>setservices()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_cap_mod::setservices </td>
          <td>(</td>
          <td class="paramtype">type(esmf_gridcomp)&#160;</td>
          <td class="paramname"><em>gcomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>NUOPC SetService method is the only public entry point. SetServices registers all of the user-provided subroutines in the module with the NUOPC layer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>an ESMF_GridComp object </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">rc</td><td>return code </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>an ESMF_GridComp object </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rc</td><td>return code </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00464">464</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keywordtype">type</span>(ESMF_GridComp)  :: gcomp<span class="comment"> !&lt; an ESMF_GridComp object</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: rc<span class="comment">    !&lt; return code</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="comment">! local variables</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordtype">character(len=*)</span>,<span class="keywordtype">parameter</span>  :: subname=<span class="stringliteral">&#39;(MOM_cap:SetServices)&#39;</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  rc = esmf_success</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="comment">! the NUOPC model component will register the generic methods</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keyword">call </span>nuopc_compderive(gcomp, model_routine_ss, rc=rc)</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="comment">! switching to IPD versions</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keyword">call </span>esmf_gridcompsetentrypoint(gcomp, esmf_method_initialize, &amp;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    userroutine=initializep0, phase=0, rc=rc)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="comment">! set entry point for methods that require specific implementation</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="keyword">call </span>nuopc_compsetentrypoint(gcomp, esmf_method_initialize, &amp;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    phaselabellist=(/<span class="stringliteral">&quot;IPDv03p1&quot;</span>/), userroutine=initializeadvertise, rc=rc)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="keyword">call </span>nuopc_compsetentrypoint(gcomp, esmf_method_initialize, &amp;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    phaselabellist=(/<span class="stringliteral">&quot;IPDv03p3&quot;</span>/), userroutine=initializerealize, rc=rc)</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="comment">!------------------</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="comment">! attach specializing method(s)</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="comment">!------------------</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="keyword">call </span>nuopc_compspecialize(gcomp, speclabel=model_label_datainitialize, &amp;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    specroutine=datainitialize, rc=rc)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160; </div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keyword">call </span>nuopc_compspecialize(gcomp, speclabel=model_label_advance, &amp;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    specroutine=modeladvance, rc=rc)</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keyword">call </span>esmf_methodremove(gcomp, label=model_label_setrunclock, rc=rc)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keyword">call </span>nuopc_compspecialize(gcomp, speclabel=model_label_setrunclock, &amp;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;       specroutine=modelsetrunclock, rc=rc)</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160; </div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keyword">call </span>nuopc_compspecialize(gcomp, speclabel=model_label_finalize, &amp;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    specroutine=ocean_model_finalize, rc=rc)</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, &amp;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    line=__line__, &amp;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    file=__file__)) &amp;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordflow">return</span>  <span class="comment">! bail out</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mom__cap_8F90_source.html#l01771">datainitialize()</a>, <a class="el" href="mom__cap_8F90_source.html#l00726">initializeadvertise()</a>, <a class="el" href="mom__cap_8F90_source.html#l00553">initializep0()</a>, <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>, <a class="el" href="mom__cap_8F90_source.html#l01870">modeladvance()</a>, <a class="el" href="mom__cap_8F90_source.html#l02180">modelsetrunclock()</a>, and <a class="el" href="mom__cap_8F90_source.html#l02347">ocean_model_finalize()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_ae0439afc4c901d9850515768bdaaed09_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ab4fe7282914df9a3a3e6d11dabe339b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4fe7282914df9a3a3e6d11dabe339b6">&#9670;&nbsp;</a></span>shr_file_getlogunit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_cap_mod::shr_file_getlogunit </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nunit</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l02631">2631</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nunit</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;  <span class="comment">! do nothing for this stub - its just here to replace</span></div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;  <span class="comment">! having cppdefs in the main program</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a81c1c8d1c54d3a7d0cdf7d939a9d7b5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81c1c8d1c54d3a7d0cdf7d939a9d7b5a">&#9670;&nbsp;</a></span>shr_file_setlogunit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_cap_mod::shr_file_setlogunit </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nunit</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l02625">2625</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nunit</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;  <span class="comment">! do nothing for this stub - its just here to replace</span></div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;  <span class="comment">! having cppdefs in the main program</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>, and <a class="el" href="mom__cap_8F90_source.html#l01870">modeladvance()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_a81c1c8d1c54d3a7d0cdf7d939a9d7b5a_icgraph.svg" width="100%" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ad65735d76d137896b5b838aa9e776757"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad65735d76d137896b5b838aa9e776757">&#9670;&nbsp;</a></span>state_setscalar()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_cap_mod::state_setscalar </td>
          <td>(</td>
          <td class="paramtype">real(esmf_kind_r8), intent(in)&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>scalar_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_state), intent(inout)&#160;</td>
          <td class="paramname"><em>State</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>mytask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>scalar_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>scalar_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(inout)&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set scalar data from state for a particula name. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rc</td><td>return code </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l02403">2403</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;<span class="keywordtype">  real</span>(ESMF_KIND_R8),<span class="keywordtype">intent(in)</span>     :: value</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;  <span class="keywordtype">integer</span>,           <span class="keywordtype">intent(in)</span>     :: scalar_id</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;  <span class="keywordtype">type</span>(ESMF_State),  <span class="keywordtype">intent(inout)</span>  :: State</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;  <span class="keywordtype">integer</span>,           <span class="keywordtype">intent(in)</span>     :: mytask</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;  <span class="keywordtype">character(len=*)</span>,  <span class="keywordtype">intent(in)</span>     :: scalar_name</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;  <span class="keywordtype">integer</span>,           <span class="keywordtype">intent(in)</span>     :: scalar_count</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;  <span class="keywordtype">integer</span>,           <span class="keywordtype">intent(inout)</span>  :: rc<span class="comment">           !&lt; return code</span></div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160; </div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;  <span class="comment">! local variables</span></div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;  <span class="keywordtype">type</span>(ESMF_Field)                :: field</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;<span class="keywordtype">  real</span>(ESMF_KIND_R8), <span class="keywordtype">pointer</span>     :: farrayptr(:,:)</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span>     :: subname=<span class="stringliteral">&#39;(MOM_cap:State_SetScalar)&#39;</span></div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;  <span class="comment">!--------------------------------------------------------</span></div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160; </div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;  rc = esmf_success</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160; </div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;  <span class="keyword">call </span>esmf_stateget(state, itemname=trim(scalar_name), field=field, rc=rc)</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;  <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, line=__line__, file=u_file_u)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160; </div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;  <span class="keywordflow">if</span> (mytask == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;    <span class="keyword">call </span>esmf_fieldget(field, farrayptr=farrayptr, rc=rc)</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rctocheck=rc, msg=esmf_logerr_passthru, line=__line__, file=u_file_u)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160; </div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;    <span class="keywordflow">if</span> (scalar_id &lt; 0 .or. scalar_id &gt; scalar_count) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;       <span class="keyword">call </span>esmf_logseterror(esmf_rc_arg_bad, &amp;</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;            msg=subname//<span class="stringliteral">&quot;: ERROR in scalar_id&quot;</span>, &amp;</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;            line=__line__, file=__file__, rctoreturn=rc)</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;       <span class="keywordflow">return</span></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160; </div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;    farrayptr(scalar_id,1) = <span class="keywordtype">value</span></div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mom__cap_8F90_source.html#l00444">u_file_u</a>.</p>

<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__cap__mod_ad65735d76d137896b5b838aa9e776757_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a9ccb6bc098362e5ea43c44ed67b0be91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ccb6bc098362e5ea43c44ed67b0be91">&#9670;&nbsp;</a></span>cesm_coupled</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical mom_cap_mod::cesm_coupled = .true.</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00448">448</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keywordtype">logical</span> :: cesm_coupled = .true.</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l01771">datainitialize()</a>, <a class="el" href="mom__cap_8F90_source.html#l00726">initializeadvertise()</a>, <a class="el" href="mom__cap_8F90_source.html#l01870">modeladvance()</a>, and <a class="el" href="mom__cap_8F90_source.html#l02347">ocean_model_finalize()</a>.</p>

</div>
</div>
<a id="a30d95b1e676bca2117b3db102b434fc4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30d95b1e676bca2117b3db102b434fc4">&#9670;&nbsp;</a></span>debug</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_cap_mod::debug = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00431">431</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="keywordtype">integer</span>              :: debug = 0</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>.</p>

</div>
</div>
<a id="aa08ee7a9fc2f2a7e374db32013526765"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa08ee7a9fc2f2a7e374db32013526765">&#9670;&nbsp;</a></span>export_slice</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_cap_mod::export_slice = 1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00433">433</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="keywordtype">integer</span>              :: export_slice = 1</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l01870">modeladvance()</a>.</p>

</div>
</div>
<a id="aee3e3b3a693970aa5f79b3ba8ca97d35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee3e3b3a693970aa5f79b3ba8ca97d35">&#9670;&nbsp;</a></span>fldsfrocn</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">type (<a class="el" href="structmom__cap__mod_1_1fld__list__type.html">fld_list_type</a>), dimension(<a class="el" href="namespacemom__cap__mod.html#a0ed5e7e790ddbb9f8d7152264ca28d0f">fldsmax</a>) mom_cap_mod::fldsfrocn</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00429">429</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="keywordtype">type</span> (fld_list_type) :: fldsFrOcn(fldsMax)</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00726">initializeadvertise()</a>, and <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>.</p>

</div>
</div>
<a id="ad948593abdb8da7fa79b69505913dc95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad948593abdb8da7fa79b69505913dc95">&#9670;&nbsp;</a></span>fldsfrocn_num</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_cap_mod::fldsfrocn_num = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00428">428</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="keywordtype">integer</span>              :: fldsFrOcn_num = 0</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00726">initializeadvertise()</a>, and <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>.</p>

</div>
</div>
<a id="a0ed5e7e790ddbb9f8d7152264ca28d0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ed5e7e790ddbb9f8d7152264ca28d0f">&#9670;&nbsp;</a></span>fldsmax</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_cap_mod::fldsmax = 100</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00425">425</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="keywordtype">integer</span>,<span class="keywordtype">parameter</span>    :: fldsMax = 100</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l02593">fld_list_add()</a>.</p>

</div>
</div>
<a id="a5f0c52bdc4d9687b0c2f882a9ecc202b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f0c52bdc4d9687b0c2f882a9ecc202b">&#9670;&nbsp;</a></span>fldstoocn</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">type (<a class="el" href="structmom__cap__mod_1_1fld__list__type.html">fld_list_type</a>), dimension(<a class="el" href="namespacemom__cap__mod.html#a0ed5e7e790ddbb9f8d7152264ca28d0f">fldsmax</a>) mom_cap_mod::fldstoocn</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00427">427</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="keywordtype">type</span> (fld_list_type) :: fldsToOcn(fldsMax)</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00726">initializeadvertise()</a>, and <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>.</p>

</div>
</div>
<a id="a49361c7b41259416fa2c6b08a6bac193"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49361c7b41259416fa2c6b08a6bac193">&#9670;&nbsp;</a></span>fldstoocn_num</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_cap_mod::fldstoocn_num = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00426">426</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="keywordtype">integer</span>              :: fldsToOcn_num = 0</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00726">initializeadvertise()</a>, and <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>.</p>

</div>
</div>
<a id="a2af2a851cf395c0e9bc914c5ca06e5b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2af2a851cf395c0e9bc914c5ca06e5b0">&#9670;&nbsp;</a></span>geomtype</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">type(esmf_geomtype_flag) mom_cap_mod::geomtype = ESMF_GEOMTYPE_MESH</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00449">449</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="keywordtype">type</span>(ESMF_GeomType_Flag) :: geomtype = esmf_geomtype_mesh</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>.</p>

</div>
</div>
<a id="a2007af76dfd1960bd6162c3bdd2b0ed1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2007af76dfd1960bd6162c3bdd2b0ed1">&#9670;&nbsp;</a></span>grid_attach_area</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical mom_cap_mod::grid_attach_area = .false.</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00439">439</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="keywordtype">logical</span>              :: grid_attach_area = .false.</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00553">initializep0()</a>, and <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>.</p>

</div>
</div>
<a id="a2c76d05cdca9c737e6a460df1bfadbbd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c76d05cdca9c737e6a460df1bfadbbd">&#9670;&nbsp;</a></span>import_slice</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_cap_mod::import_slice = 1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00432">432</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="keywordtype">integer</span>              :: import_slice = 1</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l01771">datainitialize()</a>, and <a class="el" href="mom__cap_8F90_source.html#l01870">modeladvance()</a>.</p>

</div>
</div>
<a id="a5658afa33822a37b08b4fde39429a6c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5658afa33822a37b08b4fde39429a6c1">&#9670;&nbsp;</a></span>logunit</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_cap_mod::logunit</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>stdout logging unit number </p>

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00437">437</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="keywordtype">integer</span>              :: logunit<span class="comment">  !&lt; stdout logging unit number</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00726">initializeadvertise()</a>, <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>, and <a class="el" href="mom__cap_8F90_source.html#l01870">modeladvance()</a>.</p>

</div>
</div>
<a id="ad4760bc5e6def07188f5fb61e09a2de1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4760bc5e6def07188f5fb61e09a2de1">&#9670;&nbsp;</a></span>profile_memory</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical mom_cap_mod::profile_memory = .true.</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00438">438</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="keywordtype">logical</span>              :: profile_memory = .true.</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00553">initializep0()</a>, and <a class="el" href="mom__cap_8F90_source.html#l01870">modeladvance()</a>.</p>

</div>
</div>
<a id="ad56cefdfe78b6f64cfbf67b65eae6e7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad56cefdfe78b6f64cfbf67b65eae6e7e">&#9670;&nbsp;</a></span>runtype</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=32) mom_cap_mod::runtype</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>run type </p>

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00436">436</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">character(len=32)    :: runtype  !&lt; run type</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00726">initializeadvertise()</a>, and <a class="el" href="mom__cap_8F90_source.html#l01870">modeladvance()</a>.</p>

</div>
</div>
<a id="aa34836ca41b881b490713afae1ce5b82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa34836ca41b881b490713afae1ce5b82">&#9670;&nbsp;</a></span>scalar_field_count</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_cap_mod::scalar_field_count = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00441">441</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="keywordtype">integer</span>              :: scalar_field_count = 0</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00553">initializep0()</a>, <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>, and <a class="el" href="mom__cap_8F90_source.html#l02552">setscalarfield()</a>.</p>

</div>
</div>
<a id="ac69f1371ebbd90dfc117e54846cc90bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac69f1371ebbd90dfc117e54846cc90bb">&#9670;&nbsp;</a></span>scalar_field_idx_grid_nx</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_cap_mod::scalar_field_idx_grid_nx = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00442">442</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="keywordtype">integer</span>              :: scalar_field_idx_grid_nx = 0</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00553">initializep0()</a>, and <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>.</p>

</div>
</div>
<a id="ae36725fbbb9270b498c860196e9f0374"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae36725fbbb9270b498c860196e9f0374">&#9670;&nbsp;</a></span>scalar_field_idx_grid_ny</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_cap_mod::scalar_field_idx_grid_ny = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00443">443</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keywordtype">integer</span>              :: scalar_field_idx_grid_ny = 0</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00553">initializep0()</a>, and <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>.</p>

</div>
</div>
<a id="ac2e1656025fcc390497d059868d547aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2e1656025fcc390497d059868d547aa">&#9670;&nbsp;</a></span>scalar_field_name</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=128) mom_cap_mod::scalar_field_name = ''</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00440">440</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">character(len=128)   :: scalar_field_name = &#39;&#39;</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l00726">initializeadvertise()</a>, <a class="el" href="mom__cap_8F90_source.html#l00553">initializep0()</a>, <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>, <a class="el" href="mom__cap_8F90_source.html#l02440">mom_realizefields()</a>, and <a class="el" href="mom__cap_8F90_source.html#l02552">setscalarfield()</a>.</p>

</div>
</div>
<a id="ac0eecd812f3619a4648e2f9386b58fe3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0eecd812f3619a4648e2f9386b58fe3">&#9670;&nbsp;</a></span>tmpstr</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=256) mom_cap_mod::tmpstr</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00434">434</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">character(len=256)   :: tmpstr</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l01138">initializerealize()</a>.</p>

</div>
</div>
<a id="abcd81cf01660d4994dec787589d47616"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcd81cf01660d4994dec787589d47616">&#9670;&nbsp;</a></span>u_file_u</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), parameter mom_cap_mod::u_file_u = __FILE__</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00444">444</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">character(len=*),parameter :: u_file_u = &amp;</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;     __file__</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l02403">state_setscalar()</a>.</p>

</div>
</div>
<a id="a87f074f197c71e76f3ceb5265c12ea42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87f074f197c71e76f3ceb5265c12ea42">&#9670;&nbsp;</a></span>write_diagnostics</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical mom_cap_mod::write_diagnostics = .false.</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__cap_8F90_source.html#l00435">435</a> of file <a class="el" href="mom__cap_8F90_source.html">mom_cap.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="keywordtype">logical</span>              :: write_diagnostics = .false.</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__cap_8F90_source.html#l01771">datainitialize()</a>, <a class="el" href="mom__cap_8F90_source.html#l00553">initializep0()</a>, and <a class="el" href="mom__cap_8F90_source.html#l01870">modeladvance()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="amom__cap_8F90_html_a5fb5cf93f9c582256b6835d768a42e60"><div class="ttname"><a href="mom__cap_8F90.html#a5fb5cf93f9c582256b6835d768a42e60">setscalarfield</a></div><div class="ttdeci">subroutine setscalarfield(field, rc)</div><div class="ttdef"><b>Definition:</b> <a href="mom__cap_8F90_source.html#l02552">mom_cap.F90:2552</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemom__cap__mod.html">mom_cap_mod</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
