<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: dyed_obc_tracer Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespacedyed__obc__tracer.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">dyed_obc_tracer Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This tracer package dyes flow through open boundaries. </p>
<p>By Kate Hedstrom, 2017, copied from DOME tracers and also dye_example.</p>
<p>This file contains an example of the code that is needed to set up and use a set of dynamically passive tracers. These tracers dye the inflowing water, one per open boundary segment.</p>
<p>A single subroutine is called from within each file to register each of the tracers for reinitialization and advection and to register the subroutine that initializes the tracers and set up their output and the subroutine that does any tracer physics or chemistry along with diapycnal mixing (included here because some tracers may float or swim vertically or dye diapycnal processes). </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdyed__obc__tracer_1_1dyed__obc__tracer__cs.html">dyed_obc_tracer_cs</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The control structure for the dyed_obc tracer package.  <a href="structdyed__obc__tracer_1_1dyed__obc__tracer__cs.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a968aec7f642a4750d835b0d030c17fe5"><td class="memItemLeft" align="right" valign="top">logical function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedyed__obc__tracer.html#a968aec7f642a4750d835b0d030c17fe5">register_dyed_obc_tracer</a> (HI, GV, param_file, CS, tr_Reg, restart_CS)</td></tr>
<tr class="memdesc:a968aec7f642a4750d835b0d030c17fe5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register tracer fields and subroutines to be used with MOM.  <a href="namespacedyed__obc__tracer.html#a968aec7f642a4750d835b0d030c17fe5">More...</a><br /></td></tr>
<tr class="separator:a968aec7f642a4750d835b0d030c17fe5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6775bb4fc321a45c68880edc243fcfa"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedyed__obc__tracer.html#ae6775bb4fc321a45c68880edc243fcfa">initialize_dyed_obc_tracer</a> (restart, day, G, GV, h, diag, OBC, CS)</td></tr>
<tr class="memdesc:ae6775bb4fc321a45c68880edc243fcfa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the CSntr tracer fields in tr(:,:,:,:) and sets up the tracer output.  <a href="namespacedyed__obc__tracer.html#ae6775bb4fc321a45c68880edc243fcfa">More...</a><br /></td></tr>
<tr class="separator:ae6775bb4fc321a45c68880edc243fcfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c9e4c1789bdcebd4f0fa1380eb6df3e"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedyed__obc__tracer.html#a7c9e4c1789bdcebd4f0fa1380eb6df3e">dyed_obc_tracer_column_physics</a> (h_old, h_new, ea, eb, fluxes, dt, G, GV, US, CS, evap_CFL_limit, minimum_forcing_depth)</td></tr>
<tr class="memdesc:a7c9e4c1789bdcebd4f0fa1380eb6df3e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine applies diapycnal diffusion and any other column tracer physics or chemistry to the tracers from this file. This is a simple example of a set of advected passive tracers.  <a href="namespacedyed__obc__tracer.html#a7c9e4c1789bdcebd4f0fa1380eb6df3e">More...</a><br /></td></tr>
<tr class="separator:a7c9e4c1789bdcebd4f0fa1380eb6df3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00701a980f0ec3042a1d2661287191a4"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedyed__obc__tracer.html#a00701a980f0ec3042a1d2661287191a4">dyed_obc_tracer_end</a> (CS)</td></tr>
<tr class="memdesc:a00701a980f0ec3042a1d2661287191a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clean up memory allocations, if any.  <a href="namespacedyed__obc__tracer.html#a00701a980f0ec3042a1d2661287191a4">More...</a><br /></td></tr>
<tr class="separator:a00701a980f0ec3042a1d2661287191a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a7c9e4c1789bdcebd4f0fa1380eb6df3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c9e4c1789bdcebd4f0fa1380eb6df3e">&#9670;&nbsp;</a></span>dyed_obc_tracer_column_physics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public dyed_obc_tracer::dyed_obc_tracer_column_physics </td>
          <td>(</td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h_old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h_new</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>ea</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>eb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(forcing), intent(in)&#160;</td>
          <td class="paramname"><em>fluxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structdyed__obc__tracer_1_1dyed__obc__tracer__cs.html">dyed_obc_tracer_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>evap_CFL_limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>minimum_forcing_depth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine applies diapycnal diffusion and any other column tracer physics or chemistry to the tracers from this file. This is a simple example of a set of advected passive tracers. </p>
<p>The arguments to this subroutine are redundant in that h_new(k) = h_old(k) + ea(k) - eb(k-1) + eb(k) - ea(k+1) </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_old</td><td>Layer thickness before entrainment [H ~&gt; m or kg m-2]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_new</td><td>Layer thickness after entrainment [H ~&gt; m or kg m-2]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ea</td><td>an array to which the amount of fluid entrained </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eb</td><td>an array to which the amount of fluid entrained </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fluxes</td><td>A structure containing pointers to thermodynamic and tracer forcing fields. Unused fields have NULL ptrs. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>The amount of time covered by this call [T ~&gt; s] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>The control structure returned by a previous call to dyed_obc_register_tracer. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">evap_cfl_limit</td><td>Limit on the fraction of the water that can be fluxed out of the top layer in a timestep [nondim] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">minimum_forcing_depth</td><td>The smallest depth over which fluxes can be applied [H ~&gt; m or kg m-2] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="dyed__obc__tracer_8F90_source.html#l00205">205</a> of file <a class="el" href="dyed__obc__tracer_8F90_source.html">dyed_obc_tracer.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),   <span class="keywordtype">intent(in)</span> :: G<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type), <span class="keywordtype">intent(in)</span> :: GV<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                           <span class="keywordtype">intent(in)</span> :: h_old<span class="comment"> !&lt; Layer thickness before entrainment [H ~&gt; m or kg m-2].</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                           <span class="keywordtype">intent(in)</span> :: h_new<span class="comment"> !&lt; Layer thickness after entrainment [H ~&gt; m or kg m-2].</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                           <span class="keywordtype">intent(in)</span> :: ea<span class="comment">   !&lt; an array to which the amount of fluid entrained</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">                                              !! from the layer above during this call will be</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">                                              !! added [H ~&gt; m or kg m-2].</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                           <span class="keywordtype">intent(in)</span> :: eb<span class="comment">   !&lt; an array to which the amount of fluid entrained</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">                                              !! from the layer below during this call will be</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">                                              !! added [H ~&gt; m or kg m-2].</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordtype">type</span>(forcing),           <span class="keywordtype">intent(in)</span> :: fluxes<span class="comment"> !&lt; A structure containing pointers to thermodynamic</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">                                              !! and tracer forcing fields.  Unused fields have NULL ptrs.</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keywordtype">  real</span>,                    <span class="keywordtype">intent(in)</span> :: dt<span class="comment">   !&lt; The amount of time covered by this call [T ~&gt; s]</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),   <span class="keywordtype">intent(in)</span> :: US<span class="comment">   !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordtype">type</span>(dyed_obc_tracer_CS), <span class="keywordtype">pointer</span>   :: CS<span class="comment">   !&lt; The control structure returned by a previous</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">                                              !! call to dyed_obc_register_tracer.</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keywordtype">  real</span>,          <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: evap_CFL_limit<span class="comment"> !&lt; Limit on the fraction of the water that can</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">                                              !! be fluxed out of the top layer in a timestep [nondim]</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="keywordtype">  real</span>,          <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: minimum_forcing_depth<span class="comment"> !&lt; The smallest depth over which</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">                                              !! fluxes can be applied [H ~&gt; m or kg m-2]</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">! Local variables</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="keywordtype">  real</span> :: b1(SZI_(G))          <span class="comment">! b1 and c1 are variables used by the</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="keywordtype">  real</span> :: c1(SZI_(G),SZK_(G))  <span class="comment">! tridiagonal solver.</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span> :: h_work <span class="comment">! Used so that h can be modified</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz, m</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = gv%ke</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordflow">if</span> (cs%ntr &lt; 1) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(evap_cfl_limit) .and. <span class="keyword">present</span>(minimum_forcing_depth)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">do</span> m=1,cs%ntr</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="keywordflow">do</span> k=1,nz ;<span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        h_work(i,j,k) = h_old(i,j,k)</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keyword">call </span>applytracerboundaryfluxesinout(g, gv, cs%tr(:,:,:,m), dt, fluxes, h_work, &amp;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                                          evap_cfl_limit, minimum_forcing_depth)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="keywordflow">if</span> (nz &gt; 1) <span class="keyword">call </span>tracer_vertdiff(h_work, ea, eb, dt, cs%tr(:,:,:,m), g, gv)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">do</span> m=1,cs%ntr</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">if</span> (nz &gt; 1) <span class="keyword">call </span>tracer_vertdiff(h_old, ea, eb, dt, cs%tr(:,:,:,m), g, gv)</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__tracer__diabatic_8F90_source.html#l00230">mom_tracer_diabatic::applytracerboundaryfluxesinout()</a>, and <a class="el" href="MOM__tracer__diabatic_8F90_source.html#l00027">mom_tracer_diabatic::tracer_vertdiff()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacedyed__obc__tracer_a7c9e4c1789bdcebd4f0fa1380eb6df3e_cgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a00701a980f0ec3042a1d2661287191a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00701a980f0ec3042a1d2661287191a4">&#9670;&nbsp;</a></span>dyed_obc_tracer_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public dyed_obc_tracer::dyed_obc_tracer_end </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structdyed__obc__tracer_1_1dyed__obc__tracer__cs.html">dyed_obc_tracer_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clean up memory allocations, if any. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cs</td><td>The control structure returned by a previous call to dyed_obc_register_tracer. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="dyed__obc__tracer_8F90_source.html#l00259">259</a> of file <a class="el" href="dyed__obc__tracer_8F90_source.html">dyed_obc_tracer.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keywordtype">type</span>(dyed_obc_tracer_CS), <span class="keywordtype">pointer</span> :: CS<span class="comment">   !&lt; The control structure returned by a previous</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">                                            !! call to dyed_obc_register_tracer.</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordtype">integer</span> :: m</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs%tr)) <span class="keyword">deallocate</span>(cs%tr)</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keyword">deallocate</span>(cs)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="keywordflow">  endif</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae6775bb4fc321a45c68880edc243fcfa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6775bb4fc321a45c68880edc243fcfa">&#9670;&nbsp;</a></span>initialize_dyed_obc_tracer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public dyed_obc_tracer::initialize_dyed_obc_tracer </td>
          <td>(</td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>restart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in), target&#160;</td>
          <td class="paramname"><em>day</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diag_ctrl), intent(in), target&#160;</td>
          <td class="paramname"><em>diag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_obc_type), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structdyed__obc__tracer_1_1dyed__obc__tracer__cs.html">dyed_obc_tracer_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the CSntr tracer fields in tr(:,:,:,:) and sets up the tracer output. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">restart</td><td>.true. if the fields have already been read from a restart file. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">day</td><td>Time of the start of the run. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thicknesses [H ~&gt; m or kg m-2] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">diag</td><td>Structure used to regulate diagnostic output. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Structure specifying open boundary options. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>The control structure returned by a previous call to dyed_obc_register_tracer. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="dyed__obc__tracer_8F90_source.html#l00136">136</a> of file <a class="el" href="dyed__obc__tracer_8F90_source.html">dyed_obc_tracer.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                 <span class="keywordtype">intent(in)</span> :: G<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type),               <span class="keywordtype">intent(in)</span> :: GV<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="keywordtype">logical</span>,                               <span class="keywordtype">intent(in)</span> :: restart<span class="comment"> !&lt; .true. if the fields have already</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">                                                               !! been read from a restart file.</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordtype">type</span>(time_type), <span class="keywordtype">target</span>,               <span class="keywordtype">intent(in)</span> :: day<span class="comment">     !&lt; Time of the start of the run.</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span> :: h<span class="comment">    !&lt; Layer thicknesses [H ~&gt; m or kg m-2]</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl), <span class="keywordtype">target</span>,               <span class="keywordtype">intent(in)</span> :: diag<span class="comment">    !&lt; Structure used to regulate diagnostic output.</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),                  <span class="keywordtype">pointer</span>    :: OBC<span class="comment">     !&lt; Structure specifying open boundary options.</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordtype">type</span>(dyed_obc_tracer_CS),              <span class="keywordtype">pointer</span>    :: CS<span class="comment">      !&lt; The control structure returned by a previous</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">                                                               !! call to dyed_obc_register_tracer.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">! Local variables</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span> :: temp(:,:,:)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:,:)</span> :: &amp;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    OBC_tr1_u =&gt; null(), &amp; <span class="comment">! These arrays should be allocated and set to</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    obc_tr1_v =&gt; null()    <span class="comment">! specify the values of tracer 1 that should come</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                           <span class="comment">! in through u- and v- points through the open</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                           <span class="comment">! boundary conditions, in the same units as tr.</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordtype">character(len=24)</span> :: name     <span class="comment">! A variable&#39;s name in a NetCDF file.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keywordtype">character(len=72)</span> :: longname <span class="comment">! The long name of that variable.</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordtype">character(len=48)</span> :: units    <span class="comment">! The dimensions of the variable.</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordtype">character(len=48)</span> :: flux_units <span class="comment">! The units for tracer fluxes, usually</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                            <span class="comment">! kg(tracer) kg(water)-1 m3 s-1 or kg(tracer) s-1.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">pointer</span> :: tr_ptr(:,:,:) =&gt; null()</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keywordtype">  real</span> :: h_neglect         <span class="comment">! A thickness that is so small it is usually lost</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                            <span class="comment">! in roundoff and can be neglected [H ~&gt; m or kg m-2].</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keywordtype">  real</span> :: e(SZK_(G)+1), e_top, e_bot, d_tr</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, isd, ied, jsd, jed, nz, m</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordtype">integer</span> :: IsdB, IedB, JsdB, JedB</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(cs)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">if</span> (cs%ntr &lt; 1) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = gv%ke</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  isd = g%isd ; ied = g%ied ; jsd = g%jsd ; jed = g%jed</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  isdb = g%IsdB ; iedb = g%IedB ; jsdb = g%JsdB ; jedb = g%JedB</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  h_neglect = gv%H_subroundoff</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  cs%Time =&gt; day</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  cs%diag =&gt; diag</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordflow">if</span> (.not.restart) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">if</span> (len_trim(cs%tracer_IC_file) &gt;= 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="comment">!  Read the tracer concentrations from a netcdf file.</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordflow">if</span> (.not.file_exists(cs%tracer_IC_file, g%Domain)) &amp;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;dyed_obc_initialize_tracer: Unable to open &quot;</span>// &amp;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                        cs%tracer_IC_file)</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">do</span> m=1,cs%ntr</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keyword">call </span>query_vardesc(cs%tr_desc(m), name, caller=<span class="stringliteral">&quot;initialize_dyed_obc_tracer&quot;</span>)</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keyword">call </span>mom_read_data(cs%tracer_IC_file, trim(name), cs%tr(:,:,:,m), g%Domain)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="keywordflow">do</span> m=1,cs%ntr</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;          cs%tr(i,j,k,m) = 0.0</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="keywordflow">  endif</span> <span class="comment">! restart</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>, and <a class="el" href="MOM__io_8F90_source.html#l00699">mom_io::query_vardesc()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacedyed__obc__tracer_ae6775bb4fc321a45c68880edc243fcfa_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a968aec7f642a4750d835b0d030c17fe5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a968aec7f642a4750d835b0d030c17fe5">&#9670;&nbsp;</a></span>register_dyed_obc_tracer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical function, public dyed_obc_tracer::register_dyed_obc_tracer </td>
          <td>(</td>
          <td class="paramtype">type(hor_index_type), intent(in)&#160;</td>
          <td class="paramname"><em>HI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structdyed__obc__tracer_1_1dyed__obc__tracer__cs.html">dyed_obc_tracer_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(tracer_registry_type), pointer&#160;</td>
          <td class="paramname"><em>tr_Reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(mom_restart_cs), pointer&#160;</td>
          <td class="paramname"><em>restart_CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register tracer fields and subroutines to be used with MOM. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">hi</td><td>A horizontal index type structure. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure to parse for run-time parameters </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>A pointer that is set to point to the control structure for this module </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">tr_reg</td><td>A pointer to the tracer registry. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">restart_cs</td><td>A pointer to the restart control structure. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="dyed__obc__tracer_8F90_source.html#l00055">55</a> of file <a class="el" href="dyed__obc__tracer_8F90_source.html">dyed_obc_tracer.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordtype">type</span>(hor_index_type),       <span class="keywordtype">intent(in)</span> :: HI<span class="comment">   !&lt; A horizontal index type structure.</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type),    <span class="keywordtype">intent(in)</span> :: GV<span class="comment">   !&lt; The ocean&#39;s vertical grid structure</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordtype">type</span>(param_file_type),      <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; A structure to parse for run-time parameters</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordtype">type</span>(dyed_obc_tracer_CS),   <span class="keywordtype">pointer</span>    :: CS<span class="comment">   !&lt; A pointer that is set to point to the</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">                                                 !! control structure for this module</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type), <span class="keywordtype">pointer</span>    :: tr_Reg<span class="comment"> !&lt; A pointer to the tracer registry.</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keywordtype">type</span>(MOM_restart_CS),       <span class="keywordtype">pointer</span>    :: restart_CS<span class="comment"> !&lt; A pointer to the restart control structure.</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">! Local variables</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordtype">character(len=80)</span>  :: name, longname</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;dyed_obc_tracer&quot;</span> <span class="comment">! This module&#39;s name.</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordtype">character(len=200)</span> :: inputdir</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keywordtype">character(len=48)</span>  :: flux_units <span class="comment">! The units for tracer fluxes, usually</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                            <span class="comment">! kg(tracer) kg(water)-1 m3 s-1 or kg(tracer) s-1.</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">pointer</span> :: tr_ptr(:,:,:) =&gt; null()</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordtype">logical</span> :: register_dyed_obc_tracer</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed, nz, m</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  isd = hi%isd ; ied = hi%ied ; jsd = hi%jsd ; jed = hi%jed ; nz = gv%ke</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;dyed_obc_register_tracer called with an &quot;</span>// &amp;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                            <span class="stringliteral">&quot;associated control structure.&quot;</span>)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keyword">allocate</span>(cs)</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">! Read all relevant parameters and write them to the model log.</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="keyword">call </span>log_version(param_file, mdl, version, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;NUM_DYE_TRACERS&quot;</span>, cs%ntr, &amp;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                 <span class="stringliteral">&quot;The number of dye tracers in this run. Each tracer &quot;</span>//&amp;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                 <span class="stringliteral">&quot;should have a separate boundary segment.&quot;</span>, default=0)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keyword">allocate</span>(cs%ind_tr(cs%ntr))</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keyword">allocate</span>(cs%tr_desc(cs%ntr))</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;dyed_obc_TRACER_IC_FILE&quot;</span>, cs%tracer_IC_file, &amp;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                 <span class="stringliteral">&quot;The name of a file from which to read the initial &quot;</span>//&amp;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                 <span class="stringliteral">&quot;conditions for the dyed_obc tracers, or blank to initialize &quot;</span>//&amp;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                 <span class="stringliteral">&quot;them internally.&quot;</span>, default=<span class="stringliteral">&quot; &quot;</span>)</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">if</span> (len_trim(cs%tracer_IC_file) &gt;= 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR&quot;</span>, inputdir, default=<span class="stringliteral">&quot;.&quot;</span>)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    inputdir = slasher(inputdir)</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    cs%tracer_IC_file = trim(inputdir)//trim(cs%tracer_IC_file)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;INPUTDIR/dyed_obc_TRACER_IC_FILE&quot;</span>, &amp;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                   cs%tracer_IC_file)</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keyword">allocate</span>(cs%tr(isd:ied,jsd:jed,nz,cs%ntr)) ; cs%tr(:,:,:,:) = 0.0</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordflow">do</span> m=1,cs%ntr</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keyword">write</span>(name,<span class="stringliteral">&#39;(&quot;dye_&quot;,I2.2)&#39;</span>) m</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keyword">write</span>(longname,<span class="stringliteral">&#39;(&quot;Concentration of dyed_obc Tracer &quot;,I2.2)&#39;</span>) m</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    cs%tr_desc(m) = var_desc(name, units=<span class="stringliteral">&quot;kg kg-1&quot;</span>, longname=longname, caller=mdl)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">if</span> (gv%Boussinesq) <span class="keywordflow">then</span> ; flux_units = <span class="stringliteral">&quot;kg kg-1 m3 s-1&quot;</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">else</span> ; flux_units = <span class="stringliteral">&quot;kg s-1&quot;</span> ;<span class="keywordflow"> endif</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">! This is needed to force the compiler not to do a copy in the registration</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">! calls.  Curses on the designers and implementers of Fortran90.</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    tr_ptr =&gt; cs%tr(:,:,:,m)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">! Register the tracer for horizontal advection, diffusion, and restarts.</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keyword">call </span>register_tracer(tr_ptr, tr_reg, param_file, hi, gv, &amp;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                         name=name, longname=longname, units=<span class="stringliteral">&quot;kg kg-1&quot;</span>, &amp;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                         registry_diags=.true., flux_units=flux_units, &amp;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                         restart_cs=restart_cs)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">!   Set coupled_tracers to be true (hard-coded above) to provide the surface</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">! values to the coupler (if any).  This is meta-code and its arguments will</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">! currently (deliberately) give fatal errors if it is used.</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">if</span> (cs%coupled_tracers) &amp;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      cs%ind_tr(m) = aof_set_coupler_flux(trim(name)//<span class="stringliteral">&#39;_flux&#39;</span>, &amp;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;          flux_type=<span class="stringliteral">&#39; &#39;</span>, implementation=<span class="stringliteral">&#39; &#39;</span>, caller=<span class="stringliteral">&quot;register_dyed_obc_tracer&quot;</span>)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  cs%tr_Reg =&gt; tr_reg</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  cs%restart_CSp =&gt; restart_cs</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  register_dyed_obc_tracer = .true.</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="atmos__ocean__fluxes_8F90_source.html#l00018">atmos_ocean_fluxes_mod::aof_set_coupler_flux()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>, <a class="el" href="MOM__tracer__registry_8F90_source.html#l00158">mom_tracer_registry::register_tracer()</a>, and <a class="el" href="MOM__io_8F90_source.html#l00600">mom_io::var_desc()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacedyed__obc__tracer_a968aec7f642a4750d835b0d030c17fe5_cgraph.svg" width="100%" height="579"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacedyed__obc__tracer.html">dyed_obc_tracer</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
