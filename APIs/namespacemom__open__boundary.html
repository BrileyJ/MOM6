<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_open_boundary Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespacemom__open__boundary.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">mom_open_boundary Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Controls where open boundary conditions are applied. </p>
<p>This module implements some aspects of internal open boundary conditions in MOM.</p>
<p>A small fragment of the grid is shown below:</p>
<p>j+1 x ^ x ^ x At x: q, CoriolisBu j+1 &gt; o &gt; o &gt; At ^: v, tauy j x ^ x ^ x At &gt;: u, taux j &gt; o &gt; o &gt; At o: h, bathyT, buoy, tr, T, S, Rml, ustar j-1 x ^ x ^ x i-1 i i+1 At x &amp; ^: i i+1 At &gt; &amp; o:</p>
<p>The boundaries always run through q grid points (x). </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__open__boundary_1_1file__obc__cs.html">file_obc_cs</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Control structure for open boundaries that read from files. Probably lots to update here.  <a href="structmom__open__boundary_1_1file__obc__cs.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__open__boundary_1_1obc__registry__type.html">obc_registry_type</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Type to carry basic OBC information needed for updating values.  <a href="structmom__open__boundary_1_1obc__registry__type.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__open__boundary_1_1obc__segment__data__type.html">obc_segment_data_type</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open boundary segment data from files (mostly).  <a href="structmom__open__boundary_1_1obc__segment__data__type.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__open__boundary_1_1obc__segment__tracer__type.html">obc_segment_tracer_type</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tracer on OBC segment data structure, for putting into a segment tracer registry.  <a href="structmom__open__boundary_1_1obc__segment__tracer__type.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__open__boundary_1_1obc__segment__type.html">obc_segment_type</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open boundary segment data structure.  <a href="structmom__open__boundary_1_1obc__segment__type.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__open__boundary_1_1obc__struct__type.html">obc_struct_type</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Type to carry something (what] for the OBC registry.  <a href="structmom__open__boundary_1_1obc__struct__type.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open-boundary data.  <a href="structmom__open__boundary_1_1ocean__obc__type.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__open__boundary_1_1segment__tracer__registry__type.html">segment_tracer_registry_type</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Registry type for tracers on segments.  <a href="structmom__open__boundary_1_1segment__tracer__registry__type.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ac94938f1a657896ff03efd3864faa02a"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#ac94938f1a657896ff03efd3864faa02a">open_boundary_config</a> (G, US, param_file, OBC)</td></tr>
<tr class="memdesc:ac94938f1a657896ff03efd3864faa02a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enables OBC module and reads configuration parameters This routine is called from MOM_initialize_fixed which occurs before the initialization of the vertical coordinate and ALE_init. Therefore segment data are not fully initialized here. The remainder of the segment data are initialized in a later call to update_open_boundary_data.  <a href="namespacemom__open__boundary.html#ac94938f1a657896ff03efd3864faa02a">More...</a><br /></td></tr>
<tr class="separator:ac94938f1a657896ff03efd3864faa02a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb17aba34a8aaceb524910d2e1196a0c"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#adb17aba34a8aaceb524910d2e1196a0c">initialize_segment_data</a> (G, OBC, PF)</td></tr>
<tr class="memdesc:adb17aba34a8aaceb524910d2e1196a0c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate space for reading OBC data from files. It sets up the required vertical remapping. In the process, it does funky stuff with the MPI processes.  <a href="namespacemom__open__boundary.html#adb17aba34a8aaceb524910d2e1196a0c">More...</a><br /></td></tr>
<tr class="separator:adb17aba34a8aaceb524910d2e1196a0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac357a1fb341db3aaffdfeca2eacab60b"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#ac357a1fb341db3aaffdfeca2eacab60b">setup_segment_indices</a> (G, seg, Is_obc, Ie_obc, Js_obc, Je_obc)</td></tr>
<tr class="memdesc:ac357a1fb341db3aaffdfeca2eacab60b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Define indices for segment and store in hor_index_type using global segment bounds corresponding to q-points.  <a href="namespacemom__open__boundary.html#ac357a1fb341db3aaffdfeca2eacab60b">More...</a><br /></td></tr>
<tr class="separator:ac357a1fb341db3aaffdfeca2eacab60b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa40e3464225d4e017b1a738995eeb3b2"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#aa40e3464225d4e017b1a738995eeb3b2">setup_u_point_obc</a> (OBC, G, US, segment_str, l_seg, PF, reentrant_y)</td></tr>
<tr class="memdesc:aa40e3464225d4e017b1a738995eeb3b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse an OBC_SEGMENT_%%% string starting with "I=" and configure placement and type of OBC accordingly.  <a href="namespacemom__open__boundary.html#aa40e3464225d4e017b1a738995eeb3b2">More...</a><br /></td></tr>
<tr class="separator:aa40e3464225d4e017b1a738995eeb3b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a706dd2fb2049757b3b76bf8b481e735c"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a706dd2fb2049757b3b76bf8b481e735c">setup_v_point_obc</a> (OBC, G, US, segment_str, l_seg, PF, reentrant_x)</td></tr>
<tr class="memdesc:a706dd2fb2049757b3b76bf8b481e735c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse an OBC_SEGMENT_%%% string starting with "J=" and configure placement and type of OBC accordingly.  <a href="namespacemom__open__boundary.html#a706dd2fb2049757b3b76bf8b481e735c">More...</a><br /></td></tr>
<tr class="separator:a706dd2fb2049757b3b76bf8b481e735c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0eb361009a2dddf3ad9a24d0d7223898"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a0eb361009a2dddf3ad9a24d0d7223898">parse_segment_str</a> (ni_global, nj_global, segment_str, l, m, n, action_str, reentrant)</td></tr>
<tr class="memdesc:a0eb361009a2dddf3ad9a24d0d7223898"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse an OBC_SEGMENT_%%% string.  <a href="namespacemom__open__boundary.html#a0eb361009a2dddf3ad9a24d0d7223898">More...</a><br /></td></tr>
<tr class="separator:a0eb361009a2dddf3ad9a24d0d7223898"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0aee21537ad757ce15e602d8fd55eb4d"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a0aee21537ad757ce15e602d8fd55eb4d">parse_segment_data_str</a> (segment_str, var, value, filenam, fieldnam, fields, num_fields, debug)</td></tr>
<tr class="memdesc:a0aee21537ad757ce15e602d8fd55eb4d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse an OBC_SEGMENT_%%_DATA string.  <a href="namespacemom__open__boundary.html#a0aee21537ad757ce15e602d8fd55eb4d">More...</a><br /></td></tr>
<tr class="separator:a0aee21537ad757ce15e602d8fd55eb4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e2dbab2a3e23eb9848aba473f635cec"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a2e2dbab2a3e23eb9848aba473f635cec">parse_for_tracer_reservoirs</a> (OBC, PF, use_temperature)</td></tr>
<tr class="memdesc:a2e2dbab2a3e23eb9848aba473f635cec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse all the OBC_SEGMENT_%%_DATA strings again to see which need tracer reservoirs (all pes need to know).  <a href="namespacemom__open__boundary.html#a2e2dbab2a3e23eb9848aba473f635cec">More...</a><br /></td></tr>
<tr class="separator:a2e2dbab2a3e23eb9848aba473f635cec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a349df847b304948d5b98352ddfd7bf8d"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a349df847b304948d5b98352ddfd7bf8d">parse_segment_param_real</a> (segment_str, var, param_value, debug)</td></tr>
<tr class="memdesc:a349df847b304948d5b98352ddfd7bf8d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse an OBC_SEGMENT_%%_PARAMS string.  <a href="namespacemom__open__boundary.html#a349df847b304948d5b98352ddfd7bf8d">More...</a><br /></td></tr>
<tr class="separator:a349df847b304948d5b98352ddfd7bf8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53dc87c231fcaf1c99fe818956fb111e"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a53dc87c231fcaf1c99fe818956fb111e">open_boundary_init</a> (G, GV, US, param_file, OBC, restart_CSp)</td></tr>
<tr class="memdesc:a53dc87c231fcaf1c99fe818956fb111e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize open boundary control structure and do any necessary rescaling of OBC fields that have been read from a restart file.  <a href="namespacemom__open__boundary.html#a53dc87c231fcaf1c99fe818956fb111e">More...</a><br /></td></tr>
<tr class="separator:a53dc87c231fcaf1c99fe818956fb111e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af55e663cc3a1f5f697e72066d75c9160"><td class="memItemLeft" align="right" valign="top">logical function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#af55e663cc3a1f5f697e72066d75c9160">open_boundary_query</a> (OBC, apply_open_OBC, apply_specified_OBC, apply_Flather_OBC, apply_nudged_OBC, needs_ext_seg_data)</td></tr>
<tr class="separator:af55e663cc3a1f5f697e72066d75c9160"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a709a33b9e33b5689d5ca73349ed51fb6"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a709a33b9e33b5689d5ca73349ed51fb6">open_boundary_dealloc</a> (OBC)</td></tr>
<tr class="memdesc:a709a33b9e33b5689d5ca73349ed51fb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deallocate open boundary data.  <a href="namespacemom__open__boundary.html#a709a33b9e33b5689d5ca73349ed51fb6">More...</a><br /></td></tr>
<tr class="separator:a709a33b9e33b5689d5ca73349ed51fb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb86d9ee7fc99dea787b88cfdb70f139"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#afb86d9ee7fc99dea787b88cfdb70f139">open_boundary_end</a> (OBC)</td></tr>
<tr class="memdesc:afb86d9ee7fc99dea787b88cfdb70f139"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close open boundary data.  <a href="namespacemom__open__boundary.html#afb86d9ee7fc99dea787b88cfdb70f139">More...</a><br /></td></tr>
<tr class="separator:afb86d9ee7fc99dea787b88cfdb70f139"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc301353fde1f12ef04dab751ddb7ac2"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#afc301353fde1f12ef04dab751ddb7ac2">open_boundary_impose_normal_slope</a> (OBC, G, depth)</td></tr>
<tr class="memdesc:afc301353fde1f12ef04dab751ddb7ac2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the slope of bathymetry normal to an open bounndary to zero.  <a href="namespacemom__open__boundary.html#afc301353fde1f12ef04dab751ddb7ac2">More...</a><br /></td></tr>
<tr class="separator:afc301353fde1f12ef04dab751ddb7ac2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7aa6f2b520108ce761ef107557f69069"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a7aa6f2b520108ce761ef107557f69069">open_boundary_impose_land_mask</a> (OBC, G, areaCu, areaCv, US)</td></tr>
<tr class="memdesc:a7aa6f2b520108ce761ef107557f69069"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reconcile masks and open boundaries, deallocate OBC on PEs where it is not needed. Also adjust u- and v-point cell area on specified open boundaries and mask all points outside open boundaries.  <a href="namespacemom__open__boundary.html#a7aa6f2b520108ce761ef107557f69069">More...</a><br /></td></tr>
<tr class="separator:a7aa6f2b520108ce761ef107557f69069"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2578141730f51e42c56bb05c3648ea08"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a2578141730f51e42c56bb05c3648ea08">setup_obc_tracer_reservoirs</a> (G, OBC)</td></tr>
<tr class="memdesc:a2578141730f51e42c56bb05c3648ea08"><td class="mdescLeft">&#160;</td><td class="mdescRight">Make sure the OBC tracer reservoirs are initialized.  <a href="namespacemom__open__boundary.html#a2578141730f51e42c56bb05c3648ea08">More...</a><br /></td></tr>
<tr class="separator:a2578141730f51e42c56bb05c3648ea08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5ceafcce53e896d30012f321c73d9f4"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#ae5ceafcce53e896d30012f321c73d9f4">radiation_open_bdry_conds</a> (OBC, u_new, u_old, v_new, v_old, G, US, dt)</td></tr>
<tr class="memdesc:ae5ceafcce53e896d30012f321c73d9f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply radiation conditions to 3D u,v at open boundaries.  <a href="namespacemom__open__boundary.html#ae5ceafcce53e896d30012f321c73d9f4">More...</a><br /></td></tr>
<tr class="separator:ae5ceafcce53e896d30012f321c73d9f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11acc9ede6f2b975bfc6b849a2603b46"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a11acc9ede6f2b975bfc6b849a2603b46">open_boundary_apply_normal_flow</a> (OBC, G, u, v)</td></tr>
<tr class="memdesc:a11acc9ede6f2b975bfc6b849a2603b46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Applies OBC values stored in segments to 3d u,v fields.  <a href="namespacemom__open__boundary.html#a11acc9ede6f2b975bfc6b849a2603b46">More...</a><br /></td></tr>
<tr class="separator:a11acc9ede6f2b975bfc6b849a2603b46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d48e6925d93fa98cbf5bb73903f94be"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a9d48e6925d93fa98cbf5bb73903f94be">open_boundary_zero_normal_flow</a> (OBC, G, u, v)</td></tr>
<tr class="memdesc:a9d48e6925d93fa98cbf5bb73903f94be"><td class="mdescLeft">&#160;</td><td class="mdescRight">Applies zero values to 3d u,v fields on OBC segments.  <a href="namespacemom__open__boundary.html#a9d48e6925d93fa98cbf5bb73903f94be">More...</a><br /></td></tr>
<tr class="separator:a9d48e6925d93fa98cbf5bb73903f94be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a151df14c3b8b1094ddf8f44c86493fd5"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a151df14c3b8b1094ddf8f44c86493fd5">gradient_at_q_points</a> (G, segment, uvel, vvel)</td></tr>
<tr class="memdesc:a151df14c3b8b1094ddf8f44c86493fd5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the tangential gradient of the normal flow at the boundary q-points.  <a href="namespacemom__open__boundary.html#a151df14c3b8b1094ddf8f44c86493fd5">More...</a><br /></td></tr>
<tr class="separator:a151df14c3b8b1094ddf8f44c86493fd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a4c67f2e0fe21f1a2274be12844a71a"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a0a4c67f2e0fe21f1a2274be12844a71a">set_tracer_data</a> (OBC, tv, h, G, PF, tracer_Reg)</td></tr>
<tr class="memdesc:a0a4c67f2e0fe21f1a2274be12844a71a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the initial values of the tracer open boundary conditions. Redoing this elsewhere.  <a href="namespacemom__open__boundary.html#a0a4c67f2e0fe21f1a2274be12844a71a">More...</a><br /></td></tr>
<tr class="separator:a0a4c67f2e0fe21f1a2274be12844a71a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29dd2dc87f43e0e26d22367ce93519ff"><td class="memItemLeft" align="right" valign="top">integer function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a29dd2dc87f43e0e26d22367ce93519ff">lookup_seg_field</a> (OBC_seg, field)</td></tr>
<tr class="memdesc:a29dd2dc87f43e0e26d22367ce93519ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Needs documentation.  <a href="namespacemom__open__boundary.html#a29dd2dc87f43e0e26d22367ce93519ff">More...</a><br /></td></tr>
<tr class="separator:a29dd2dc87f43e0e26d22367ce93519ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7f532a65dd8ae4db981f2ef4791fc56"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#aa7f532a65dd8ae4db981f2ef4791fc56">allocate_obc_segment_data</a> (OBC, segment)</td></tr>
<tr class="memdesc:aa7f532a65dd8ae4db981f2ef4791fc56"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate segment data fields.  <a href="namespacemom__open__boundary.html#aa7f532a65dd8ae4db981f2ef4791fc56">More...</a><br /></td></tr>
<tr class="separator:aa7f532a65dd8ae4db981f2ef4791fc56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d71c596c3bd7d773a39f5c63d5389ac"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a5d71c596c3bd7d773a39f5c63d5389ac">deallocate_obc_segment_data</a> (OBC, segment)</td></tr>
<tr class="memdesc:a5d71c596c3bd7d773a39f5c63d5389ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deallocate segment data fields.  <a href="namespacemom__open__boundary.html#a5d71c596c3bd7d773a39f5c63d5389ac">More...</a><br /></td></tr>
<tr class="separator:a5d71c596c3bd7d773a39f5c63d5389ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a556977a2754fab17e837a8fba75cd9ee"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a556977a2754fab17e837a8fba75cd9ee">open_boundary_test_extern_uv</a> (G, OBC, u, v)</td></tr>
<tr class="memdesc:a556977a2754fab17e837a8fba75cd9ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set tangential velocities outside of open boundaries to silly values (used for checking the interior state is independent of values outside of the domain).  <a href="namespacemom__open__boundary.html#a556977a2754fab17e837a8fba75cd9ee">More...</a><br /></td></tr>
<tr class="separator:a556977a2754fab17e837a8fba75cd9ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4123d11abdb141b21a4d52a0c43c4adb"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a4123d11abdb141b21a4d52a0c43c4adb">open_boundary_test_extern_h</a> (G, GV, OBC, h)</td></tr>
<tr class="memdesc:a4123d11abdb141b21a4d52a0c43c4adb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set thicknesses outside of open boundaries to silly values (used for checking the interior state is independent of values outside of the domain).  <a href="namespacemom__open__boundary.html#a4123d11abdb141b21a4d52a0c43c4adb">More...</a><br /></td></tr>
<tr class="separator:a4123d11abdb141b21a4d52a0c43c4adb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d2c8b028b9fc7d65f17155497a0487d"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a8d2c8b028b9fc7d65f17155497a0487d">update_obc_segment_data</a> (G, GV, US, OBC, tv, h, Time)</td></tr>
<tr class="memdesc:a8d2c8b028b9fc7d65f17155497a0487d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the OBC values on the segments.  <a href="namespacemom__open__boundary.html#a8d2c8b028b9fc7d65f17155497a0487d">More...</a><br /></td></tr>
<tr class="separator:a8d2c8b028b9fc7d65f17155497a0487d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e0e22d829c122134f039228c6f1c7fb"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a8e0e22d829c122134f039228c6f1c7fb">register_obc</a> (name, param_file, Reg)</td></tr>
<tr class="memdesc:a8e0e22d829c122134f039228c6f1c7fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">register open boundary objects for boundary updates.  <a href="namespacemom__open__boundary.html#a8e0e22d829c122134f039228c6f1c7fb">More...</a><br /></td></tr>
<tr class="separator:a8e0e22d829c122134f039228c6f1c7fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a6e28bbfec6ab82bfe2fd2848902945"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a0a6e28bbfec6ab82bfe2fd2848902945">obc_registry_init</a> (param_file, Reg)</td></tr>
<tr class="memdesc:a0a6e28bbfec6ab82bfe2fd2848902945"><td class="mdescLeft">&#160;</td><td class="mdescRight">This routine include declares and sets the variable "version".  <a href="namespacemom__open__boundary.html#a0a6e28bbfec6ab82bfe2fd2848902945">More...</a><br /></td></tr>
<tr class="separator:a0a6e28bbfec6ab82bfe2fd2848902945"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05d15beca2ef2b44fb36d129166907fa"><td class="memItemLeft" align="right" valign="top">logical function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a05d15beca2ef2b44fb36d129166907fa">register_file_obc</a> (param_file, CS, OBC_Reg)</td></tr>
<tr class="memdesc:a05d15beca2ef2b44fb36d129166907fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add file to OBC registry.  <a href="namespacemom__open__boundary.html#a05d15beca2ef2b44fb36d129166907fa">More...</a><br /></td></tr>
<tr class="separator:a05d15beca2ef2b44fb36d129166907fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55081f00e4a95f87ddc5dfe1d61f52e0"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a55081f00e4a95f87ddc5dfe1d61f52e0">file_obc_end</a> (CS)</td></tr>
<tr class="memdesc:a55081f00e4a95f87ddc5dfe1d61f52e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clean up the file OBC from registry.  <a href="namespacemom__open__boundary.html#a55081f00e4a95f87ddc5dfe1d61f52e0">More...</a><br /></td></tr>
<tr class="separator:a55081f00e4a95f87ddc5dfe1d61f52e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcd9637c6cc17658fe064ce1dc1011bf"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#adcd9637c6cc17658fe064ce1dc1011bf">segment_tracer_registry_init</a> (param_file, segment)</td></tr>
<tr class="memdesc:adcd9637c6cc17658fe064ce1dc1011bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the segment tracer registry.  <a href="namespacemom__open__boundary.html#adcd9637c6cc17658fe064ce1dc1011bf">More...</a><br /></td></tr>
<tr class="separator:adcd9637c6cc17658fe064ce1dc1011bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d5843dd1a4e1475f69b5eb2c5b0197d"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a5d5843dd1a4e1475f69b5eb2c5b0197d">register_segment_tracer</a> (tr_ptr, param_file, GV, segment, OBC_scalar, OBC_array)</td></tr>
<tr class="separator:a5d5843dd1a4e1475f69b5eb2c5b0197d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71194a8dc156fea37aab6539cc124086"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a71194a8dc156fea37aab6539cc124086">segment_tracer_registry_end</a> (Reg)</td></tr>
<tr class="memdesc:a71194a8dc156fea37aab6539cc124086"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clean up the segment tracer registry.  <a href="namespacemom__open__boundary.html#a71194a8dc156fea37aab6539cc124086">More...</a><br /></td></tr>
<tr class="separator:a71194a8dc156fea37aab6539cc124086"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0459cfc5b4e4115bde6ada1dd7c25139"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a0459cfc5b4e4115bde6ada1dd7c25139">register_temp_salt_segments</a> (GV, OBC, tr_Reg, param_file)</td></tr>
<tr class="separator:a0459cfc5b4e4115bde6ada1dd7c25139"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70d8b2b93599effe185abbc5a586b35c"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a70d8b2b93599effe185abbc5a586b35c">fill_temp_salt_segments</a> (G, OBC, tv)</td></tr>
<tr class="separator:a70d8b2b93599effe185abbc5a586b35c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7dbf161294debd059a40659ba691ca0b"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a7dbf161294debd059a40659ba691ca0b">mask_outside_obcs</a> (G, US, param_file, OBC)</td></tr>
<tr class="memdesc:a7dbf161294debd059a40659ba691ca0b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the region outside of all open boundary segments and make sure it is set to land mask. Gonna need to know global land mask as well to get it right...  <a href="namespacemom__open__boundary.html#a7dbf161294debd059a40659ba691ca0b">More...</a><br /></td></tr>
<tr class="separator:a7dbf161294debd059a40659ba691ca0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5a04fc90320c3af571f02f8c98f0b18"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#ab5a04fc90320c3af571f02f8c98f0b18">flood_fill</a> (G, color, cin, cout, cland)</td></tr>
<tr class="memdesc:ab5a04fc90320c3af571f02f8c98f0b18"><td class="mdescLeft">&#160;</td><td class="mdescRight">flood the cin, cout values  <a href="namespacemom__open__boundary.html#ab5a04fc90320c3af571f02f8c98f0b18">More...</a><br /></td></tr>
<tr class="separator:ab5a04fc90320c3af571f02f8c98f0b18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13ac2cc232309a51db31c3b9ee5f22af"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a13ac2cc232309a51db31c3b9ee5f22af">flood_fill2</a> (G, color, cin, cout, cland)</td></tr>
<tr class="memdesc:a13ac2cc232309a51db31c3b9ee5f22af"><td class="mdescLeft">&#160;</td><td class="mdescRight">flood the cin, cout values  <a href="namespacemom__open__boundary.html#a13ac2cc232309a51db31c3b9ee5f22af">More...</a><br /></td></tr>
<tr class="separator:a13ac2cc232309a51db31c3b9ee5f22af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1d4f35b2cff85617fc5766739db81de"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#af1d4f35b2cff85617fc5766739db81de">open_boundary_register_restarts</a> (HI, GV, OBC, Reg, param_file, restart_CSp, use_temperature)</td></tr>
<tr class="memdesc:af1d4f35b2cff85617fc5766739db81de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register OBC segment data for restarts.  <a href="namespacemom__open__boundary.html#af1d4f35b2cff85617fc5766739db81de">More...</a><br /></td></tr>
<tr class="separator:af1d4f35b2cff85617fc5766739db81de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a230cf67375352c9d55b4330180d35d7c"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a230cf67375352c9d55b4330180d35d7c">update_segment_tracer_reservoirs</a> (G, GV, uhr, vhr, h, OBC, dt, Reg)</td></tr>
<tr class="memdesc:a230cf67375352c9d55b4330180d35d7c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the OBC tracer reservoirs after the tracers have been updated.  <a href="namespacemom__open__boundary.html#a230cf67375352c9d55b4330180d35d7c">More...</a><br /></td></tr>
<tr class="separator:a230cf67375352c9d55b4330180d35d7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c6f236ceed8e7e696215f1638cf4b9c"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a2c6f236ceed8e7e696215f1638cf4b9c">adjustsegmentetatofitbathymetry</a> (G, GV, US, segment, fld)</td></tr>
<tr class="memdesc:a2c6f236ceed8e7e696215f1638cf4b9c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adjust interface heights to fit the bathymetry and diagnose layer thickness.  <a href="namespacemom__open__boundary.html#a2c6f236ceed8e7e696215f1638cf4b9c">More...</a><br /></td></tr>
<tr class="separator:a2c6f236ceed8e7e696215f1638cf4b9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a1dd4294ac05ea337431a26395003325f"><td class="memItemLeft" align="right" valign="top">integer, parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a1dd4294ac05ea337431a26395003325f">obc_none</a> = 0</td></tr>
<tr class="memdesc:a1dd4294ac05ea337431a26395003325f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates the use of no open boundary.  <a href="namespacemom__open__boundary.html#a1dd4294ac05ea337431a26395003325f">More...</a><br /></td></tr>
<tr class="separator:a1dd4294ac05ea337431a26395003325f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad14f75b62184f667bb07c0f31b633c7c"><td class="memItemLeft" align="right" valign="top">integer, parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#ad14f75b62184f667bb07c0f31b633c7c">obc_simple</a> = 1</td></tr>
<tr class="memdesc:ad14f75b62184f667bb07c0f31b633c7c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates the use of a simple inflow open boundary.  <a href="namespacemom__open__boundary.html#ad14f75b62184f667bb07c0f31b633c7c">More...</a><br /></td></tr>
<tr class="separator:ad14f75b62184f667bb07c0f31b633c7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59020084f9aa725ff55812572cabe6e6"><td class="memItemLeft" align="right" valign="top">integer, parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a59020084f9aa725ff55812572cabe6e6">obc_wall</a> = 2</td></tr>
<tr class="memdesc:a59020084f9aa725ff55812572cabe6e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates the use of a closed wall.  <a href="namespacemom__open__boundary.html#a59020084f9aa725ff55812572cabe6e6">More...</a><br /></td></tr>
<tr class="separator:a59020084f9aa725ff55812572cabe6e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab15bba6b94442339da4ea4dcb35811d"><td class="memItemLeft" align="right" valign="top">integer, parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#aab15bba6b94442339da4ea4dcb35811d">obc_flather</a> = 3</td></tr>
<tr class="memdesc:aab15bba6b94442339da4ea4dcb35811d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates the use of a Flather open boundary.  <a href="namespacemom__open__boundary.html#aab15bba6b94442339da4ea4dcb35811d">More...</a><br /></td></tr>
<tr class="separator:aab15bba6b94442339da4ea4dcb35811d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f7b9f941c542c5bcddb75de5fa8e38e"><td class="memItemLeft" align="right" valign="top">integer, parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a8f7b9f941c542c5bcddb75de5fa8e38e">obc_radiation</a> = 4</td></tr>
<tr class="memdesc:a8f7b9f941c542c5bcddb75de5fa8e38e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates the use of a radiation open boundary.  <a href="namespacemom__open__boundary.html#a8f7b9f941c542c5bcddb75de5fa8e38e">More...</a><br /></td></tr>
<tr class="separator:a8f7b9f941c542c5bcddb75de5fa8e38e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ace8760d7fa465a59d8cbc3340a5b5e"><td class="memItemLeft" align="right" valign="top">integer, parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a6ace8760d7fa465a59d8cbc3340a5b5e">obc_direction_n</a> = 100</td></tr>
<tr class="memdesc:a6ace8760d7fa465a59d8cbc3340a5b5e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates the boundary is an effective northern boundary.  <a href="namespacemom__open__boundary.html#a6ace8760d7fa465a59d8cbc3340a5b5e">More...</a><br /></td></tr>
<tr class="separator:a6ace8760d7fa465a59d8cbc3340a5b5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29aee121a765fc751bd1c21adf80af10"><td class="memItemLeft" align="right" valign="top">integer, parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a29aee121a765fc751bd1c21adf80af10">obc_direction_s</a> = 200</td></tr>
<tr class="memdesc:a29aee121a765fc751bd1c21adf80af10"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates the boundary is an effective southern boundary.  <a href="namespacemom__open__boundary.html#a29aee121a765fc751bd1c21adf80af10">More...</a><br /></td></tr>
<tr class="separator:a29aee121a765fc751bd1c21adf80af10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a876256dbb0556d7e04cdf091f1744b65"><td class="memItemLeft" align="right" valign="top">integer, parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a876256dbb0556d7e04cdf091f1744b65">obc_direction_e</a> = 300</td></tr>
<tr class="memdesc:a876256dbb0556d7e04cdf091f1744b65"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates the boundary is an effective eastern boundary.  <a href="namespacemom__open__boundary.html#a876256dbb0556d7e04cdf091f1744b65">More...</a><br /></td></tr>
<tr class="separator:a876256dbb0556d7e04cdf091f1744b65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a015e27a65957919ea3cd67767b8f26f7"><td class="memItemLeft" align="right" valign="top">integer, parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a015e27a65957919ea3cd67767b8f26f7">obc_direction_w</a> = 400</td></tr>
<tr class="memdesc:a015e27a65957919ea3cd67767b8f26f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates the boundary is an effective western boundary.  <a href="namespacemom__open__boundary.html#a015e27a65957919ea3cd67767b8f26f7">More...</a><br /></td></tr>
<tr class="separator:a015e27a65957919ea3cd67767b8f26f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6997b7b50a4afe32b14fd61ba858254f"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#a6997b7b50a4afe32b14fd61ba858254f">max_obc_fields</a> = 100</td></tr>
<tr class="memdesc:a6997b7b50a4afe32b14fd61ba858254f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum number of data fields needed for OBC segments.  <a href="namespacemom__open__boundary.html#a6997b7b50a4afe32b14fd61ba858254f">More...</a><br /></td></tr>
<tr class="separator:a6997b7b50a4afe32b14fd61ba858254f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6193d2825ef41d066e20706754a0d68"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#ad6193d2825ef41d066e20706754a0d68">id_clock_pass</a></td></tr>
<tr class="memdesc:ad6193d2825ef41d066e20706754a0d68"><td class="mdescLeft">&#160;</td><td class="mdescRight">A CPU time clock.  <a href="namespacemom__open__boundary.html#ad6193d2825ef41d066e20706754a0d68">More...</a><br /></td></tr>
<tr class="separator:ad6193d2825ef41d066e20706754a0d68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafc1b36aca40a894743f1565f4f9d152"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=40)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__open__boundary.html#aafc1b36aca40a894743f1565f4f9d152">mdl</a> = &quot;MOM_open_boundary&quot;</td></tr>
<tr class="memdesc:aafc1b36aca40a894743f1565f4f9d152"><td class="mdescLeft">&#160;</td><td class="mdescRight">This module's name.  <a href="namespacemom__open__boundary.html#aafc1b36aca40a894743f1565f4f9d152">More...</a><br /></td></tr>
<tr class="separator:aafc1b36aca40a894743f1565f4f9d152"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a2c6f236ceed8e7e696215f1638cf4b9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c6f236ceed8e7e696215f1638cf4b9c">&#9670;&nbsp;</a></span>adjustsegmentetatofitbathymetry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::adjustsegmentetatofitbathymetry </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1obc__segment__type.html">obc_segment_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>segment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>fld</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adjust interface heights to fit the bathymetry and diagnose layer thickness. </p>
<p>If the bottom most interface is below the topography then the bottom-most layers are contracted to GVAngstrom_m. If the bottom most interface is above the topography then the entire column is dilated (expanded) to fill the void. </p><dl class="section remark"><dt>Remarks</dt><dd>{There is a (hard-wired) "tolerance" parameter such that the criteria for adjustment must equal or exceed 10cm.} </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>The ocean's vertical grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">segment</td><td>pointer to segment type </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fld</td><td>field index to adjust thickness </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l04593">4593</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                      <span class="keywordtype">intent(in)</span>    :: G<span class="comment">   !&lt; The ocean&#39;s grid structure</span></div>
<div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type),                    <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">  !&lt; The ocean&#39;s vertical grid structure</span></div>
<div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),                      <span class="keywordtype">intent(in)</span>    :: US<span class="comment">  !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type),                     <span class="keywordtype">intent(inout)</span> :: segment<span class="comment"> !&lt; pointer to segment type</span></div>
<div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;  <span class="keywordtype">integer</span>,                                    <span class="keywordtype">intent(in)</span>    :: fld<span class="comment">  !&lt; field index to adjust thickness</span></div>
<div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, nz, contractions, dilations</div>
<div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;  <span class="keywordtype">integer</span> :: n</div>
<div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: eta <span class="comment">! Segment source data interface heights, [Z -&gt; m]</span></div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;<span class="keywordtype">  real</span> :: hTolerance = 0.1<span class="comment"> !&lt;  Tolerance to exceed adjustment criteria [Z ~&gt; m]</span></div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;<span class="keywordtype">  real</span> :: hTmp, eTmp, dilate</div>
<div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;  <span class="keywordtype">character(len=100)</span> :: mesg</div>
<div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160; </div>
<div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;  htolerance = 0.1*us%m_to_Z</div>
<div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160; </div>
<div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;  nz = <span class="keyword">size</span>(segment%field(fld)%dz_src,3)</div>
<div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160; </div>
<div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;  <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;     <span class="comment">! segment thicknesses are defined at cell face centers.</span></div>
<div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;     is = segment%HI%isdB ; ie = segment%HI%iedB</div>
<div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;     js = segment%HI%jsd ; je = segment%HI%jed</div>
<div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;     is = segment%HI%isd ; ie = segment%HI%ied</div>
<div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;     js = segment%HI%jsdB ; je = segment%HI%jedB</div>
<div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;  <span class="keyword">allocate</span>(eta(is:ie,js:je,nz+1))</div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;  contractions=0; dilations=0</div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;  <span class="keywordflow">do</span> j=js,je ; <span class="keywordflow">do</span> i=is,ie</div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;    eta(i,j,1)=0.0   <span class="comment">! segment data are assumed to be located on a static grid</span></div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;    <span class="comment">! For remapping calls, the entire column will be dilated</span></div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;    <span class="comment">! by a factor equal to the ratio of the sum of the geopotential referenced</span></div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;    <span class="comment">! source data thicknesses, and the current model thicknesses. This could be</span></div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;    <span class="comment">! an issue to be addressed, for instance if we are placing open boundaries</span></div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;    <span class="comment">! under ice shelf cavities.</span></div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;    <span class="keywordflow">do</span> k=2,nz+1</div>
<div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;      eta(i,j,k)=eta(i,j,k-1)-segment%field(fld)%dz_src(i,j,k-1)</div>
<div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;    <span class="comment">! The normal slope at the boundary is zero by a</span></div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;    <span class="comment">! previous call to open_boundary_impose_normal_slope</span></div>
<div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;    <span class="keywordflow">do</span> k=nz+1,1,-1</div>
<div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;      <span class="keywordflow">if</span> (-eta(i,j,k) &gt; segment%Htot(i,j) + htolerance) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;         eta(i,j,k) = -segment%Htot(i,j)</div>
<div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;         contractions = contractions + 1</div>
<div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160; </div>
<div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;    <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;      <span class="comment">! Collapse layers to thinnest possible if the thickness less than</span></div>
<div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;      <span class="comment">! the thinnest possible (or negative).</span></div>
<div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;      <span class="keywordflow">if</span> (eta(i,j,k) &lt; (eta(i,j,k+1) + gv%Angstrom_Z)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;         eta(i,j,k) = eta(i,j,k+1) + gv%Angstrom_Z</div>
<div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;         segment%field(fld)%dz_src(i,j,k) = gv%Angstrom_Z</div>
<div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;         segment%field(fld)%dz_src(i,j,k) = (eta(i,j,k) - eta(i,j,k+1))</div>
<div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160; </div>
<div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;    <span class="comment">!   The whole column is dilated to accommodate deeper topography than</span></div>
<div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;    <span class="comment">! the bathymetry would indicate.</span></div>
<div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;    <span class="keywordflow">if</span> (-eta(i,j,nz+1) &lt; segment%Htot(i,j) - htolerance) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;       dilations = dilations + 1</div>
<div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;       <span class="comment">! expand bottom-most cell only</span></div>
<div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;       eta(i,j,nz+1) = -segment%Htot(i,j)</div>
<div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;       segment%field(fld)%dz_src(i,j,nz)= eta(i,j,nz)-eta(i,j,nz+1)</div>
<div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;       <span class="comment">! if (eta(i,j,1) &lt;= eta(i,j,nz+1)) then</span></div>
<div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;       <span class="comment">!   do k=1,nz ; segment%field(fld)%dz_src(i,j,k) = (eta(i,j,1) + G%bathyT(i,j)) / real(nz) ; enddo</span></div>
<div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;       <span class="comment">! else</span></div>
<div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;       <span class="comment">!   dilate = (eta(i,j,1) + G%bathyT(i,j)) / (eta(i,j,1) - eta(i,j,nz+1))</span></div>
<div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;       <span class="comment">!   do k=1,nz ; segment%field(fld)%dz_src(i,j,k) = segment%field(fld)%dz_src(i,j,k) * dilate ; enddo</span></div>
<div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;       <span class="comment">! endif</span></div>
<div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;       <span class="comment">!do k=nz,2,-1 ; eta(i,j,K) = eta(i,j,K+1) + segment%field(fld)%dz_src(i,j,k) ; enddo</span></div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;    <span class="comment">! Now convert thicknesses to units of H.</span></div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;    <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;      segment%field(fld)%dz_src(i,j,k) = segment%field(fld)%dz_src(i,j,k)*gv%Z_to_H</div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;  enddo;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160; </div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;  <span class="comment">! can not do communication call here since only PEs on the current segment are here</span></div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160; </div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;  <span class="comment">! call sum_across_PEs(contractions)</span></div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;  <span class="comment">! if ((contractions &gt; 0) .and. (is_root_pe())) then</span></div>
<div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;  <span class="comment">!    write(mesg,&#39;(&quot;Thickness OBCs were contracted &quot;,&#39;// &amp;</span></div>
<div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;  <span class="comment">!         &#39;&quot;to fit topography in &quot;,I8,&quot; places.&quot;)&#39;) contractions</span></div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;  <span class="comment">!    call MOM_error(WARNING, &#39;adjustEtaToFitBathymetry: &#39;//mesg)</span></div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;  <span class="comment">! endif</span></div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;  <span class="comment">! call sum_across_PEs(dilations)</span></div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;  <span class="comment">! if ((dilations &gt; 0) .and. (is_root_pe())) then</span></div>
<div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;  <span class="comment">!    write(mesg,&#39;(&quot;Thickness OBCs were dilated &quot;,&#39;// &amp;</span></div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;  <span class="comment">!         &#39;&quot;to fit topography in &quot;,I8,&quot; places.&quot;)&#39;) dilations</span></div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;  <span class="comment">!    call MOM_error(WARNING, &#39;adjustEtaToFitBathymetry: &#39;//mesg)</span></div>
<div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;  <span class="comment">! endif</span></div>
<div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;  <span class="keyword">deallocate</span>(eta)</div>
<div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160; </div>
<div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160; </div>
<div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l03401">update_obc_segment_data()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a2c6f236ceed8e7e696215f1638cf4b9c_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aa7f532a65dd8ae4db981f2ef4791fc56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7f532a65dd8ae4db981f2ef4791fc56">&#9670;&nbsp;</a></span>allocate_obc_segment_data()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::allocate_obc_segment_data </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1obc__segment__type.html">obc_segment_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>segment</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocate segment data fields. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">segment</td><td>Open boundary segment </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l03171">3171</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),   <span class="keywordtype">pointer</span>       :: OBC<span class="comment">     !&lt; Open boundary structure</span></div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">intent(inout)</span> :: segment<span class="comment"> !&lt; Open boundary segment</span></div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;  <span class="keywordtype">integer</span> :: IsdB, IedB, JsdB, JedB</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;  <span class="keywordtype">integer</span> :: IscB, IecB, JscB, JecB</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;allocate_OBC_segment_data&quot;</span> <span class="comment">! This subroutine&#39;s name.</span></div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160; </div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;  isd = segment%HI%isd ; ied = segment%HI%ied</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;  jsd = segment%HI%jsd ; jed = segment%HI%jed</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;  isdb = segment%HI%IsdB ; iedb = segment%HI%IedB</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;  jsdb = segment%HI%JsdB ; jedb = segment%HI%JedB</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;  iscb = segment%HI%IscB ; iecb = segment%HI%IecB</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;  jscb = segment%HI%JscB ; jecb = segment%HI%JecB</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160; </div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;  <span class="keywordflow">if</span> (.not. segment%on_pe) <span class="keywordflow">return</span></div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160; </div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;  <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;    <span class="comment">! If these are just Flather, change update_OBC_segment_data accordingly</span></div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;    <span class="keyword">allocate</span>(segment%Cg(isdb:iedb,jsd:jed));                  segment%Cg(:,:)=0.</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;    <span class="keyword">allocate</span>(segment%Htot(isdb:iedb,jsd:jed));                segment%Htot(:,:)=0.0</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;    <span class="keyword">allocate</span>(segment%h(isdb:iedb,jsd:jed,obc%ke));            segment%h(:,:,:)=0.0</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;    <span class="keyword">allocate</span>(segment%eta(isdb:iedb,jsd:jed));                 segment%eta(:,:)=0.0</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;    <span class="keywordflow">if</span> (segment%radiation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;      <span class="keyword">allocate</span>(segment%rx_norm_rad(isdb:iedb,jsd:jed,obc%ke));  segment%rx_norm_rad(:,:,:)=0.0</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;    <span class="keyword">allocate</span>(segment%normal_vel(isdb:iedb,jsd:jed,obc%ke));   segment%normal_vel(:,:,:)=0.0</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;    <span class="keyword">allocate</span>(segment%normal_vel_bt(isdb:iedb,jsd:jed));       segment%normal_vel_bt(:,:)=0.0</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;    <span class="keyword">allocate</span>(segment%normal_trans(isdb:iedb,jsd:jed,obc%ke)); segment%normal_trans(:,:,:)=0.0</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;    <span class="keywordflow">if</span> (segment%nudged) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;      <span class="keyword">allocate</span>(segment%nudged_normal_vel(isdb:iedb,jsd:jed,obc%ke)); segment%nudged_normal_vel(:,:,:)=0.0</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;    <span class="keywordflow">if</span> (segment%radiation_tan .or. segment%nudged_tan .or. segment%specified_tan .or. &amp;</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;        segment%oblique_tan .or. obc%computed_vorticity .or. obc%computed_strain) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;      <span class="keyword">allocate</span>(segment%tangential_vel(isdb:iedb,jsdb:jedb,obc%ke)); segment%tangential_vel(:,:,:)=0.0</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;    <span class="keywordflow">if</span> (segment%nudged_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;      <span class="keyword">allocate</span>(segment%nudged_tangential_vel(isdb:iedb,jsdb:jedb,obc%ke)); segment%nudged_tangential_vel(:,:,:)=0.0</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;    <span class="keywordflow">if</span> (segment%nudged_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;      <span class="keyword">allocate</span>(segment%nudged_tangential_grad(isdb:iedb,jsdb:jedb,obc%ke)); segment%nudged_tangential_grad(:,:,:)=0.0</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;    <span class="keywordflow">if</span> (obc%specified_vorticity .or. obc%specified_strain .or. segment%radiation_grad .or. &amp;</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;              segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;      <span class="keyword">allocate</span>(segment%tangential_grad(isdb:iedb,jsdb:jedb,obc%ke)); segment%tangential_grad(:,:,:)=0.0</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;    <span class="keywordflow">if</span> (segment%oblique) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;      <span class="keyword">allocate</span>(segment%grad_normal(jsdb:jedb,2,obc%ke));      segment%grad_normal(:,:,:) = 0.0</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;      <span class="keyword">allocate</span>(segment%rx_norm_obl(isdb:iedb,jsd:jed,obc%ke));  segment%rx_norm_obl(:,:,:)=0.0</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;      <span class="keyword">allocate</span>(segment%ry_norm_obl(isdb:iedb,jsd:jed,obc%ke));  segment%ry_norm_obl(:,:,:)=0.0</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;      <span class="keyword">allocate</span>(segment%cff_normal(isdb:iedb,jsd:jed,obc%ke)); segment%cff_normal(:,:,:)=0.0</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    <span class="keywordflow">if</span> (segment%oblique_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;      <span class="keyword">allocate</span>(segment%grad_tan(jsd-1:jed+1,2,obc%ke));           segment%grad_tan(:,:,:) = 0.0</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    <span class="keywordflow">if</span> (segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;      <span class="keyword">allocate</span>(segment%grad_gradient(jsd:jed,2,obc%ke));      segment%grad_gradient(:,:,:) = 0.0</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160; </div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;  <span class="keywordflow">if</span> (segment%is_N_or_S) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;    <span class="comment">! If these are just Flather, change update_OBC_segment_data accordingly</span></div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;    <span class="keyword">allocate</span>(segment%Cg(isd:ied,jsdb:jedb));                  segment%Cg(:,:)=0.</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;    <span class="keyword">allocate</span>(segment%Htot(isd:ied,jsdb:jedb));                segment%Htot(:,:)=0.0</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;    <span class="keyword">allocate</span>(segment%h(isd:ied,jsdb:jedb,obc%ke));            segment%h(:,:,:)=0.0</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;    <span class="keyword">allocate</span>(segment%eta(isd:ied,jsdb:jedb));                 segment%eta(:,:)=0.0</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;    <span class="keywordflow">if</span> (segment%radiation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;      <span class="keyword">allocate</span>(segment%ry_norm_rad(isd:ied,jsdb:jedb,obc%ke));  segment%ry_norm_rad(:,:,:)=0.0</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    <span class="keyword">allocate</span>(segment%normal_vel(isd:ied,jsdb:jedb,obc%ke));   segment%normal_vel(:,:,:)=0.0</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;    <span class="keyword">allocate</span>(segment%normal_vel_bt(isd:ied,jsdb:jedb));       segment%normal_vel_bt(:,:)=0.0</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;    <span class="keyword">allocate</span>(segment%normal_trans(isd:ied,jsdb:jedb,obc%ke)); segment%normal_trans(:,:,:)=0.0</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;    <span class="keywordflow">if</span> (segment%nudged) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;      <span class="keyword">allocate</span>(segment%nudged_normal_vel(isd:ied,jsdb:jedb,obc%ke)); segment%nudged_normal_vel(:,:,:)=0.0</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;    <span class="keywordflow">if</span> (segment%radiation_tan .or. segment%nudged_tan .or. segment%specified_tan .or. &amp;</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;        segment%oblique_tan .or. obc%computed_vorticity .or. obc%computed_strain) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;      <span class="keyword">allocate</span>(segment%tangential_vel(isdb:iedb,jsdb:jedb,obc%ke)); segment%tangential_vel(:,:,:)=0.0</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;    <span class="keywordflow">if</span> (segment%nudged_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;      <span class="keyword">allocate</span>(segment%nudged_tangential_vel(isdb:iedb,jsdb:jedb,obc%ke)); segment%nudged_tangential_vel(:,:,:)=0.0</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;    <span class="keywordflow">if</span> (segment%nudged_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;      <span class="keyword">allocate</span>(segment%nudged_tangential_grad(isdb:iedb,jsdb:jedb,obc%ke)); segment%nudged_tangential_grad(:,:,:)=0.0</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;    <span class="keywordflow">if</span> (obc%specified_vorticity .or. obc%specified_strain .or. segment%radiation_grad .or. &amp;</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;              segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;      <span class="keyword">allocate</span>(segment%tangential_grad(isdb:iedb,jsdb:jedb,obc%ke)); segment%tangential_grad(:,:,:)=0.0</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;    <span class="keywordflow">if</span> (segment%oblique) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;      <span class="keyword">allocate</span>(segment%grad_normal(isdb:iedb,2,obc%ke));      segment%grad_normal(:,:,:) = 0.0</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;      <span class="keyword">allocate</span>(segment%rx_norm_obl(isd:ied,jsdb:jedb,obc%ke));  segment%rx_norm_obl(:,:,:)=0.0</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;      <span class="keyword">allocate</span>(segment%ry_norm_obl(isd:ied,jsdb:jedb,obc%ke));  segment%ry_norm_obl(:,:,:)=0.0</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;      <span class="keyword">allocate</span>(segment%cff_normal(isd:ied,jsdb:jedb,obc%ke)); segment%cff_normal(:,:,:)=0.0</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;    <span class="keywordflow">if</span> (segment%oblique_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;      <span class="keyword">allocate</span>(segment%grad_tan(isd-1:ied+1,2,obc%ke));           segment%grad_tan(:,:,:) = 0.0</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;    <span class="keywordflow">if</span> (segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;      <span class="keyword">allocate</span>(segment%grad_gradient(isd:ied,2,obc%ke));      segment%grad_gradient(:,:,:) = 0.0</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l00858">setup_u_point_obc()</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00994">setup_v_point_obc()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_aa7f532a65dd8ae4db981f2ef4791fc56_icgraph.svg" width="600" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a5d71c596c3bd7d773a39f5c63d5389ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d71c596c3bd7d773a39f5c63d5389ac">&#9670;&nbsp;</a></span>deallocate_obc_segment_data()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::deallocate_obc_segment_data </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1obc__segment__type.html">obc_segment_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>segment</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Deallocate segment data fields. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">segment</td><td>Open boundary segment </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l03278">3278</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),   <span class="keywordtype">pointer</span>       :: OBC<span class="comment">     !&lt; Open boundary structure</span></div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">intent(inout)</span> :: segment<span class="comment"> !&lt; Open boundary segment</span></div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;deallocate_OBC_segment_data&quot;</span> <span class="comment">! This subroutine&#39;s name.</span></div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160; </div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;  <span class="keywordflow">if</span> (.not. segment%on_pe) <span class="keywordflow">return</span></div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160; </div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%Cg)) <span class="keyword">deallocate</span>(segment%Cg)</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%Htot)) <span class="keyword">deallocate</span>(segment%Htot)</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%h)) <span class="keyword">deallocate</span>(segment%h)</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%eta)) <span class="keyword">deallocate</span>(segment%eta)</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%rx_norm_rad)) <span class="keyword">deallocate</span>(segment%rx_norm_rad)</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%ry_norm_rad)) <span class="keyword">deallocate</span>(segment%ry_norm_rad)</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%rx_norm_obl)) <span class="keyword">deallocate</span>(segment%rx_norm_obl)</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%ry_norm_obl)) <span class="keyword">deallocate</span>(segment%ry_norm_obl)</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%cff_normal)) <span class="keyword">deallocate</span>(segment%cff_normal)</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%grad_normal)) <span class="keyword">deallocate</span>(segment%grad_normal)</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%grad_tan)) <span class="keyword">deallocate</span>(segment%grad_tan)</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%grad_gradient)) <span class="keyword">deallocate</span>(segment%grad_gradient)</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%normal_vel)) <span class="keyword">deallocate</span>(segment%normal_vel)</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%normal_vel_bt)) <span class="keyword">deallocate</span>(segment%normal_vel_bt)</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%normal_trans)) <span class="keyword">deallocate</span>(segment%normal_trans)</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%nudged_normal_vel)) <span class="keyword">deallocate</span>(segment%nudged_normal_vel)</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%tangential_vel)) <span class="keyword">deallocate</span>(segment%tangential_vel)</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%nudged_tangential_vel)) <span class="keyword">deallocate</span>(segment%nudged_tangential_vel)</div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%nudged_tangential_grad)) <span class="keyword">deallocate</span>(segment%nudged_tangential_grad)</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%tangential_grad)) <span class="keyword">deallocate</span>(segment%tangential_grad)</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span> (segment%tr_Reg)) <span class="keyword">call </span>segment_tracer_registry_end(segment%tr_Reg)</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160; </div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l04074">segment_tracer_registry_end()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l01563">open_boundary_dealloc()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a5d71c596c3bd7d773a39f5c63d5389ac_cgraph.svg" width="448" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a5d71c596c3bd7d773a39f5c63d5389ac_icgraph.svg" width="619" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a55081f00e4a95f87ddc5dfe1d61f52e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55081f00e4a95f87ddc5dfe1d61f52e0">&#9670;&nbsp;</a></span>file_obc_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::file_obc_end </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1file__obc__cs.html">file_obc_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clean up the file OBC from registry. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cs</td><td>OBC file control structure. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l03972">3972</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;  <span class="keywordtype">type</span>(file_OBC_CS), <span class="keywordtype">pointer</span>    :: CS<span class="comment">   !&lt; OBC file control structure.</span></div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160; </div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;    <span class="keyword">deallocate</span>(cs)</div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;<span class="keywordflow">  endif</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__boundary__update_8F90_source.html#l00155">mom_boundary_update::obc_register_end()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a55081f00e4a95f87ddc5dfe1d61f52e0_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a70d8b2b93599effe185abbc5a586b35c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70d8b2b93599effe185abbc5a586b35c">&#9670;&nbsp;</a></span>fill_temp_salt_segments()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::fill_temp_salt_segments </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(inout)&#160;</td>
          <td class="paramname"><em>tv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>Ocean grid structure</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary structure</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tv</td><td>Thermodynamics structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l04122">4122</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),      <span class="keywordtype">intent(inout)</span> :: G<span class="comment">          !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),       <span class="keywordtype">pointer</span>       :: OBC<span class="comment">        !&lt; Open boundary structure</span></div>
<div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),      <span class="keywordtype">intent(inout)</span> :: tv<span class="comment">         !&lt; Thermodynamics structure</span></div>
<div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160; </div>
<div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;<span class="comment">! Local variables</span></div>
<div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, IsdB, IedB, jsd, jed, JsdB, JedB, n, nz</div>
<div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k</div>
<div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment =&gt; null() <span class="comment">! pointer to segment type list</span></div>
<div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160; </div>
<div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(obc)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(tv%T) .and. <span class="keyword">associated</span>(tv%S)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;  <span class="comment">! Both temperature and salinity fields</span></div>
<div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160; </div>
<div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;  <span class="keyword">call </span>pass_var(tv%T, g%Domain)</div>
<div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;  <span class="keyword">call </span>pass_var(tv%S, g%Domain)</div>
<div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160; </div>
<div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;  nz = g%ke</div>
<div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160; </div>
<div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;  <span class="keywordflow">do</span> n=1, obc%number_of_segments</div>
<div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;    segment =&gt; obc%segment(n)</div>
<div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;    <span class="keywordflow">if</span> (.not. segment%on_pe) cycle</div>
<div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160; </div>
<div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;    isd = segment%HI%isd ; ied = segment%HI%ied</div>
<div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;    jsd = segment%HI%jsd ; jed = segment%HI%jed</div>
<div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;    isdb = segment%HI%IsdB ; iedb = segment%HI%IedB</div>
<div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;    jsdb = segment%HI%JsdB ; jedb = segment%HI%JedB</div>
<div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160; </div>
<div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;    <span class="comment">! Fill with T and S values</span></div>
<div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;    <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;      i=segment%HI%IsdB</div>
<div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;      <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;        <span class="keywordflow">if</span> (segment%direction == obc_direction_w) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;          segment%tr_Reg%Tr(1)%t(i,j,k) = tv%T(i+1,j,k)</div>
<div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;          segment%tr_Reg%Tr(2)%t(i,j,k) = tv%S(i+1,j,k)</div>
<div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;          segment%tr_Reg%Tr(1)%t(i,j,k) = tv%T(i,j,k)</div>
<div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;          segment%tr_Reg%Tr(2)%t(i,j,k) = tv%S(i,j,k)</div>
<div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;      j=segment%HI%JsdB</div>
<div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;      <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;        <span class="keywordflow">if</span> (segment%direction == obc_direction_s) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;          segment%tr_Reg%Tr(1)%t(i,j,k) = tv%T(i,j+1,k)</div>
<div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;          segment%tr_Reg%Tr(2)%t(i,j,k) = tv%S(i,j+1,k)</div>
<div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;          segment%tr_Reg%Tr(1)%t(i,j,k) = tv%T(i,j,k)</div>
<div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;          segment%tr_Reg%Tr(2)%t(i,j,k) = tv%S(i,j,k)</div>
<div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;    segment%tr_Reg%Tr(1)%tres(:,:,:) = segment%tr_Reg%Tr(1)%t(:,:,:)</div>
<div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;    segment%tr_Reg%Tr(2)%tres(:,:,:) = segment%tr_Reg%Tr(2)%t(:,:,:)</div>
<div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;  <span class="keyword">call </span>setup_obc_tracer_reservoirs(g, obc)</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l00064">obc_direction_s</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00066">obc_direction_w</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l01749">setup_obc_tracer_reservoirs()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a70d8b2b93599effe185abbc5a586b35c_cgraph.svg" width="408" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ab5a04fc90320c3af571f02f8c98f0b18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5a04fc90320c3af571f02f8c98f0b18">&#9670;&nbsp;</a></span>flood_fill()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::flood_fill </td>
          <td>(</td>
          <td class="paramtype">type(dyn_horgrid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>color</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>cin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>cout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>cland</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>flood the cin, cout values </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">color</td><td>For sorting inside from outside </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cin</td><td>color for inside the domain </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cout</td><td>color for outside the domain </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cland</td><td>color for inside the land mask </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l04292">4292</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;  <span class="keywordtype">type</span>(dyn_horgrid_type), <span class="keywordtype">intent(inout)</span> :: G<span class="comment">      !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>,   <span class="keywordtype">intent(inout)</span> :: color<span class="comment">  !&lt; For sorting inside from outside</span></div>
<div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: cin<span class="comment">    !&lt; color for inside the domain</span></div>
<div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: cout<span class="comment">   !&lt; color for outside the domain</span></div>
<div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: cland<span class="comment">  !&lt; color for inside the land mask</span></div>
<div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160; </div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;<span class="comment">! Local variables</span></div>
<div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;  <span class="keywordtype">integer</span> :: i, j, ncount</div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160; </div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;  ncount = 1</div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;  <span class="keywordflow">do</span> <span class="keywordflow">while</span> (ncount &gt; 0)</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;    ncount = 0</div>
<div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;    <span class="keywordflow">do</span> j=g%jsd+1,g%jed-1</div>
<div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;      <span class="keywordflow">do</span> i=g%isd+1,g%ied-1</div>
<div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i-1,j) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;          color(i,j) = color(i-1,j)</div>
<div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i+1,j) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;          color(i,j) = color(i+1,j)</div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i,j-1) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;          color(i,j) = color(i,j-1)</div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i,j+1) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;          color(i,j) = color(i,j+1)</div>
<div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;    <span class="keywordflow">do</span> j=g%jed-1,g%jsd+1,-1</div>
<div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;      <span class="keywordflow">do</span> i=g%ied-1,g%isd+1,-1</div>
<div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i-1,j) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;          color(i,j) = color(i-1,j)</div>
<div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i+1,j) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;          color(i,j) = color(i+1,j)</div>
<div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i,j-1) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;          color(i,j) = color(i,j-1)</div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i,j+1) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;          color(i,j) = color(i,j+1)</div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;    <span class="keyword">call </span>pass_var(color, g%Domain)</div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;    <span class="keyword">call </span>sum_across_pes(ncount)</div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l04183">mask_outside_obcs()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_ab5a04fc90320c3af571f02f8c98f0b18_icgraph.svg" width="571" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a13ac2cc232309a51db31c3b9ee5f22af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13ac2cc232309a51db31c3b9ee5f22af">&#9670;&nbsp;</a></span>flood_fill2()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::flood_fill2 </td>
          <td>(</td>
          <td class="paramtype">type(dyn_horgrid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>color</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>cin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>cout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>cland</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>flood the cin, cout values </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">color</td><td>For sorting inside from outside </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cin</td><td>color for inside the domain </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cout</td><td>color for outside the domain </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cland</td><td>color for inside the land mask </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l04352">4352</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;  <span class="keywordtype">type</span>(dyn_horgrid_type), <span class="keywordtype">intent(inout)</span> :: G<span class="comment">       !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>,   <span class="keywordtype">intent(inout)</span> :: color<span class="comment">   !&lt; For sorting inside from outside</span></div>
<div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: cin<span class="comment">    !&lt; color for inside the domain</span></div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: cout<span class="comment">   !&lt; color for outside the domain</span></div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: cland<span class="comment">  !&lt; color for inside the land mask</span></div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160; </div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;<span class="comment">! Local variables</span></div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;  <span class="keywordtype">integer</span> :: i, j, ncount</div>
<div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160; </div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;  ncount = 1</div>
<div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;  <span class="keywordflow">do</span> <span class="keywordflow">while</span> (ncount &gt; 0)</div>
<div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;    ncount = 0</div>
<div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;    <span class="keywordflow">do</span> i=g%isd+1,g%ied-1</div>
<div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;      <span class="keywordflow">do</span> j=g%jsd+1,g%jed-1</div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i-1,j) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;          color(i,j) = color(i-1,j)</div>
<div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i+1,j) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;          color(i,j) = color(i+1,j)</div>
<div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i,j-1) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;          color(i,j) = color(i,j-1)</div>
<div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i,j+1) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;          color(i,j) = color(i,j+1)</div>
<div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;    <span class="keywordflow">do</span> i=g%ied-1,g%isd+1,-1</div>
<div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;      <span class="keywordflow">do</span> j=g%jed-1,g%jsd+1,-1</div>
<div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i-1,j) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;          color(i,j) = color(i-1,j)</div>
<div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i+1,j) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;          color(i,j) = color(i+1,j)</div>
<div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i,j-1) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;          color(i,j) = color(i,j-1)</div>
<div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;        <span class="keywordflow">if</span> (color(i,j) == 0.0 .and. color(i,j+1) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;          color(i,j) = color(i,j+1)</div>
<div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;          ncount = ncount + 1</div>
<div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;    <span class="keyword">call </span>pass_var(color, g%Domain)</div>
<div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;    <span class="keyword">call </span>sum_across_pes(ncount)</div>
<div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l04183">mask_outside_obcs()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a13ac2cc232309a51db31c3b9ee5f22af_icgraph.svg" width="571" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a151df14c3b8b1094ddf8f44c86493fd5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a151df14c3b8b1094ddf8f44c86493fd5">&#9670;&nbsp;</a></span>gradient_at_q_points()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::gradient_at_q_points </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1obc__segment__type.html">obc_segment_type</a>), pointer&#160;</td>
          <td class="paramname"><em>segment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>uvel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>vvel</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the tangential gradient of the normal flow at the boundary q-points. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">segment</td><td>OBC segment structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">uvel</td><td>zonal velocity [L T-1 ~&gt; m s-1] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vvel</td><td>meridional velocity [L T-1 ~&gt; m s-1] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l02966">2966</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type), <span class="keywordtype">intent(in)</span> :: G<span class="comment"> !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment<span class="comment"> !&lt; OBC segment structure</span></div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span>    :: uvel<span class="comment"> !&lt; zonal velocity [L T-1 ~&gt; m s-1]</span></div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span>    :: vvel<span class="comment"> !&lt; meridional velocity [L T-1 ~&gt; m s-1]</span></div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;  <span class="keywordtype">integer</span> :: i,j,k</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160; </div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;  <span class="keywordflow">if</span> (.not. segment%on_pe) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160; </div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;  <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;    <span class="keywordflow">if</span> (segment%direction == obc_direction_e) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;      i=segment%HI%isdB</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;      <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;        <span class="keywordflow">do</span> j=max(segment%HI%JsdB, g%HI%JsdB+1),min(segment%HI%JedB, g%HI%JedB-1)</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;          segment%grad_normal(j,1,k) = (uvel(i-1,j+1,k)-uvel(i-1,j,k)) * g%mask2dBu(i-1,j)</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;          segment%grad_normal(j,2,k) = (uvel(i,j+1,k)-uvel(i,j,k)) * g%mask2dBu(i,j)</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;      <span class="keywordflow">if</span> (segment%oblique_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;          <span class="keywordflow">do</span> j=max(segment%HI%jsd-1, g%HI%jsd),min(segment%HI%jed+1, g%HI%jed)</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;            segment%grad_tan(j,1,k) = (vvel(i-1,j,k)-vvel(i-1,j-1,k)) * g%mask2dT(i-1,j)</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;            segment%grad_tan(j,2,k) = (vvel(i,j,k)-vvel(i,j-1,k)) * g%mask2dT(i,j)</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;      <span class="keywordflow">if</span> (segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;          <span class="keywordflow">do</span> j=max(segment%HI%jsd, g%HI%jsd+1),min(segment%HI%jed, g%HI%jed-1)</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;            segment%grad_gradient(j,1,k) = (((vvel(i-1,j,k) - vvel(i-2,j,k))*g%IdxBu(i-2,j)) - &amp;</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;                 (vvel(i-1,j-1,k) - vvel(i-2,j-1,k))*g%IdxBu(i-2,j-1)) * g%mask2dCu(i-2,j)</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;            segment%grad_gradient(j,2,k) = (((vvel(i,j,k) - vvel(i-1,j,k))*g%IdxBu(i-1,j)) - &amp;</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;                 (vvel(i,j-1,k) - vvel(i-1,j-1,k))*g%IdxBu(i-1,j-1)) * g%mask2dCu(i-1,j)</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;    <span class="keywordflow">else</span> <span class="comment">! western segment</span></div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;      i=segment%HI%isdB</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;      <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;        <span class="keywordflow">do</span> j=max(segment%HI%JsdB, g%HI%JsdB+1),min(segment%HI%JedB, g%HI%JedB-1)</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;          segment%grad_normal(j,1,k) = (uvel(i+1,j+1,k)-uvel(i+1,j,k)) * g%mask2dBu(i+1,j)</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;          segment%grad_normal(j,2,k) = (uvel(i,j+1,k)-uvel(i,j,k)) * g%mask2dBu(i,j)</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;      <span class="keywordflow">if</span> (segment%oblique_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;          <span class="keywordflow">do</span> j=max(segment%HI%jsd-1, g%HI%jsd),min(segment%HI%jed+1, g%HI%jed)</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;            segment%grad_tan(j,1,k) = (vvel(i+2,j,k)-vvel(i+2,j-1,k)) * g%mask2dT(i+2,j)</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;            segment%grad_tan(j,2,k) = (vvel(i+1,j,k)-vvel(i+1,j-1,k)) * g%mask2dT(i+1,j)</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;      <span class="keywordflow">if</span> (segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;          <span class="keywordflow">do</span> j=max(segment%HI%jsd, g%HI%jsd+1),min(segment%HI%jed, g%HI%jed-1)</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;            segment%grad_gradient(j,1,k) = (((vvel(i+3,j,k) - vvel(i+2,j,k))*g%IdxBu(i+2,j)) - &amp;</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;                 (vvel(i+3,j-1,k) - vvel(i+2,j-1,k))*g%IdxBu(i+2,j-1)) * g%mask2dCu(i+2,j)</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;            segment%grad_gradient(j,2,k) = (((vvel(i+2,j,k) - vvel(i+1,j,k))*g%IdxBu(i+1,j)) - &amp;</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;                 (vvel(i+2,j-1,k) - vvel(i+1,j-1,k))*g%IdxBu(i+1,j-1)) * g%mask2dCu(i+1,j)</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;  <span class="keywordflow">elseif</span> (segment%is_N_or_S) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;    <span class="keywordflow">if</span> (segment%direction == obc_direction_n) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;      j=segment%HI%jsdB</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;      <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;        <span class="keywordflow">do</span> i=max(segment%HI%IsdB, g%HI%IsdB+1),min(segment%HI%IedB, g%HI%IedB-1)</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;          segment%grad_normal(i,1,k) = (vvel(i+1,j-1,k)-vvel(i,j-1,k)) * g%mask2dBu(i,j-1)</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;          segment%grad_normal(i,2,k) = (vvel(i+1,j,k)-vvel(i,j,k)) * g%mask2dBu(i,j)</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;      <span class="keywordflow">if</span> (segment%oblique_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;          <span class="keywordflow">do</span> i=max(segment%HI%isd-1, g%HI%isd),min(segment%HI%ied+1, g%HI%ied)</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;            segment%grad_tan(i,1,k) = (uvel(i,j-1,k)-uvel(i-1,j-1,k)) * g%mask2dT(i,j-1)</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;            segment%grad_tan(i,2,k) = (uvel(i,j,k)-uvel(i-1,j,k)) * g%mask2dT(i,j)</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;      <span class="keywordflow">if</span> (segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;          <span class="keywordflow">do</span> i=max(segment%HI%isd, g%HI%isd+1),min(segment%HI%ied, g%HI%ied-1)</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;            segment%grad_gradient(i,1,k) = (((uvel(i,j-1,k) - uvel(i,j-2,k))*g%IdyBu(i,j-2)) - &amp;</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;                 (uvel(i-1,j-1,k) - uvel(i-1,j-2,k))*g%IdyBu(i-1,j-2)) * g%mask2dCv(i,j-2)</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;            segment%grad_gradient(i,2,k) = (((uvel(i,j,k) - uvel(i,j-1,k))*g%IdyBu(i,j-1)) - &amp;</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;                 (uvel(i-1,j,k) - uvel(i-1,j-1,k))*g%IdyBu(i-1,j-1)) * g%mask2dCv(i,j-1)</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;    <span class="keywordflow">else</span> <span class="comment">! south segment</span></div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;      j=segment%HI%jsdB</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;      <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;        <span class="keywordflow">do</span> i=max(segment%HI%IsdB, g%HI%IsdB+1),min(segment%HI%IedB, g%HI%IedB-1)</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;          segment%grad_normal(i,1,k) = (vvel(i+1,j+1,k)-vvel(i,j+1,k)) * g%mask2dBu(i,j+1)</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;          segment%grad_normal(i,2,k) = (vvel(i+1,j,k)-vvel(i,j,k)) * g%mask2dBu(i,j)</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;      <span class="keywordflow">if</span> (segment%oblique_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;          <span class="keywordflow">do</span> i=max(segment%HI%isd-1, g%HI%isd),min(segment%HI%ied+1, g%HI%ied)</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;            segment%grad_tan(i,1,k) = (uvel(i,j+2,k)-uvel(i-1,j+2,k)) * g%mask2dT(i,j+2)</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;            segment%grad_tan(i,2,k) = (uvel(i,j+1,k)-uvel(i-1,j+1,k)) * g%mask2dT(i,j+1)</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;      <span class="keywordflow">if</span> (segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;          <span class="keywordflow">do</span> i=max(segment%HI%isd, g%HI%isd+1),min(segment%HI%ied, g%HI%ied-1)</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;            segment%grad_gradient(i,1,k) = (((uvel(i,j+3,k) - uvel(i,j+2,k))*g%IdyBu(i,j+2)) - &amp;</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;                 (uvel(i-1,j+3,k) - uvel(i-1,j+2,k))*g%IdyBu(i-1,j+2)) * g%mask2dCv(i,j+2)</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;            segment%grad_gradient(i,2,k) = (((uvel(i,j+2,k) - uvel(i,j+1,k))*g%IdyBu(i,j+1)) - &amp;</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;                 (uvel(i-1,j+2,k) - uvel(i-1,j+1,k))*g%IdyBu(i-1,j+1)) * g%mask2dCv(i,j+1)</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l00065">obc_direction_e</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00063">obc_direction_n</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l01788">radiation_open_bdry_conds()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a151df14c3b8b1094ddf8f44c86493fd5_icgraph.svg" width="394" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="adb17aba34a8aaceb524910d2e1196a0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb17aba34a8aaceb524910d2e1196a0c">&#9670;&nbsp;</a></span>initialize_segment_data()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::initialize_segment_data </td>
          <td>(</td>
          <td class="paramtype">type(dyn_horgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>PF</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocate space for reading OBC data from files. It sets up the required vertical remapping. In the process, it does funky stuff with the MPI processes. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">obc</td><td>Open boundary control structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pf</td><td>Parameter file handle </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00541">541</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="keywordtype">use </span>mpp_mod, <span class="keywordtype">only</span> : mpp_pe, mpp_set_current_pelist, mpp_get_current_pelist,mpp_npes</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="keywordtype">type</span>(dyn_horgrid_type), <span class="keywordtype">intent(in)</span>    :: G<span class="comment">   !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),   <span class="keywordtype">intent(inout)</span> :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="keywordtype">type</span>(param_file_type),  <span class="keywordtype">intent(in)</span>    :: PF<span class="comment">  !&lt; Parameter file handle</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordtype">integer</span> :: n,m,num_fields</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="keywordtype">character(len=256)</span> :: segstr, filename</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keywordtype">character(len=20)</span>  :: segnam, suffix</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keywordtype">character(len=32)</span>  :: varnam, fieldname</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="keywordtype">  real</span>               :: value</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keywordtype">character(len=32)</span>, <span class="keywordtype">dimension(MAX_OBC_FIELDS)</span> :: fields  <span class="comment">! segment field names</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="keywordtype">character(len=128)</span> :: inputdir</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment =&gt; null() <span class="comment">! pointer to segment type list</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordtype">character(len=32)</span>  :: remappingScheme</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="keywordtype">character(len=256)</span> :: mesg    <span class="comment">! Message for error messages.</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="keywordtype">logical</span> :: check_reconstruction, check_remapping, force_bounds_in_subcell</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(4)</span> :: siz,siz2</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keywordtype">integer</span> :: is, ie, js, je</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordtype">integer</span> :: IsdB, IedB, JsdB, JedB</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: saved_pelist</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keywordtype">integer</span> :: current_pe</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(1)</span> :: single_pelist</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="comment">!will be able to dynamically switch between sub-sampling refined grid data or model grid</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="comment">! There is a problem with the order of the OBC initialization</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="comment">! with respect to ALE_init. Currently handling this by copying the</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="comment">! param file so that I can use it later in step_MOM in order to finish</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="comment">! initializing segments on the first step.</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;INPUTDIR&quot;</span>, inputdir, default=<span class="stringliteral">&quot;.&quot;</span>)</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  inputdir = slasher(inputdir)</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;REMAPPING_SCHEME&quot;</span>, remappingscheme, &amp;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;          <span class="stringliteral">&quot;This sets the reconstruction scheme used &quot;</span>//&amp;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;          <span class="stringliteral">&quot;for vertical remapping for all variables. &quot;</span>//&amp;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;          <span class="stringliteral">&quot;It can be one of the following schemes: \n&quot;</span>//&amp;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;          trim(remappingschemesdoc), default=remappingdefaultscheme,do_not_log=.true.)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;FATAL_CHECK_RECONSTRUCTIONS&quot;</span>, check_reconstruction, &amp;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;          <span class="stringliteral">&quot;If true, cell-by-cell reconstructions are checked for &quot;</span>//&amp;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;          <span class="stringliteral">&quot;consistency and if non-monotonicity or an inconsistency is &quot;</span>//&amp;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;          <span class="stringliteral">&quot;detected then a FATAL error is issued.&quot;</span>, default=.false.,do_not_log=.true.)</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;FATAL_CHECK_REMAPPING&quot;</span>, check_remapping, &amp;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;          <span class="stringliteral">&quot;If true, the results of remapping are checked for &quot;</span>//&amp;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;          <span class="stringliteral">&quot;conservation and new extrema and if an inconsistency is &quot;</span>//&amp;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;          <span class="stringliteral">&quot;detected then a FATAL error is issued.&quot;</span>, default=.false.,do_not_log=.true.)</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;REMAP_BOUND_INTERMEDIATE_VALUES&quot;</span>, force_bounds_in_subcell, &amp;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;          <span class="stringliteral">&quot;If true, the values on the intermediate grid used for remapping &quot;</span>//&amp;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;          <span class="stringliteral">&quot;are forced to be bounded, which might not be the case due to &quot;</span>//&amp;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;          <span class="stringliteral">&quot;round off.&quot;</span>, default=.false.,do_not_log=.true.)</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keyword">call </span>get_param(pf, mdl, <span class="stringliteral">&quot;BRUSHCUTTER_MODE&quot;</span>, obc%brushcutter_mode, &amp;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;         <span class="stringliteral">&quot;If true, read external OBC data on the supergrid.&quot;</span>, &amp;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;         default=.false.)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keyword">allocate</span>(obc%remap_CS)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keyword">call </span>initialize_remapping(obc%remap_CS, remappingscheme, boundary_extrapolation = .false., &amp;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;       check_reconstruction=check_reconstruction, &amp;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;       check_remapping=check_remapping, force_bounds_in_subcell=force_bounds_in_subcell)</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160; </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="keywordflow">if</span> (obc%user_BCs_set_globally) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="comment">! Try this here just for the documentation. It is repeated below.</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="keywordflow">do</span> n=1, obc%number_of_segments</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    segment =&gt; obc%segment(n)</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keyword">write</span>(segnam,<span class="stringliteral">&quot;(&#39;OBC_SEGMENT_&#39;,i3.3,&#39;_DATA&#39;)&quot;</span>) n</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keyword">call </span>get_param(pf, mdl, segnam, segstr, <span class="stringliteral">&#39;OBC segment docs&#39;</span>)</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="comment">!&lt; temporarily disable communication in order to read segment data independently</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="keyword">allocate</span>(saved_pelist(0:mpp_npes()-1))</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="keyword">call </span>mpp_get_current_pelist(saved_pelist)</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  current_pe = mpp_pe()</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  single_pelist(1) = current_pe</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="keyword">call </span>mpp_set_current_pelist(single_pelist)</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160; </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keywordflow">do</span> n=1, obc%number_of_segments</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    segment =&gt; obc%segment(n)</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">if</span> (.not. segment%values_needed) cycle</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keyword">write</span>(segnam,<span class="stringliteral">&quot;(&#39;OBC_SEGMENT_&#39;,i3.3,&#39;_DATA&#39;)&quot;</span>) n</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keyword">write</span>(suffix,<span class="stringliteral">&quot;(&#39;_segment_&#39;,i3.3)&quot;</span>) n</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="comment">! needs documentation !!  Yet, unsafe for now, causes grief for</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="comment">! MOM_parameter_docs in circle_obcs on two processes.</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">!   call get_param(PF, mdl, segnam, segstr, &#39;xyz&#39;)</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="comment">! Clear out any old values</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    segstr = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keyword">call </span>get_param(pf, mdl, segnam, segstr)</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">if</span> (segstr == <span class="stringliteral">&#39;&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;No OBC_SEGMENT_XXX_DATA string for OBC segment &quot;,I3)&#39;</span>) n</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="keyword">call </span>mom_error(fatal, mesg)</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keyword">call </span>parse_segment_data_str(trim(segstr), fields=fields, num_fields=num_fields)</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordflow">if</span> (num_fields == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="keyword">call </span>mom_mesg(<span class="stringliteral">&#39;initialize_segment_data: num_fields = 0&#39;</span>)</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      cycle <span class="comment">! cycle to next segment</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keyword">allocate</span>(segment%field(num_fields))</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    segment%num_fields = num_fields</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    segment%temp_segment_data_exists=.false.</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    segment%salt_segment_data_exists=.false.</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">!!</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">! CODE HERE FOR OTHER OPTIONS (CLAMPED, NUDGED,..)</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">!!</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    isd = segment%HI%isd ; ied = segment%HI%ied</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    jsd = segment%HI%jsd ; jed = segment%HI%jed</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    isdb = segment%HI%IsdB ; iedb = segment%HI%IedB</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    jsdb = segment%HI%JsdB ; jedb = segment%HI%JedB</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160; </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordflow">do</span> m=1,num_fields</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keyword">call </span>parse_segment_data_str(trim(segstr), var=trim(fields(m)), <span class="keywordtype">value</span>=<span class="keywordtype">value</span>, filenam=filename, fieldnam=fieldname)</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keywordflow">if</span> (trim(filename) /= <span class="stringliteral">&#39;none&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        obc%update_OBC = .true. <span class="comment">! Data is assumed to be time-dependent if we are reading from file</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        obc%needs_IO_for_data = .true. <span class="comment">! At least one segment is using I/O for OBC data</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">!       segment%values_needed = .true. ! Indicates that i/o will be needed for this segment</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        segment%field(m)%name = trim(fields(m))</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;TEMP&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;           segment%temp_segment_data_exists=.true.</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;           segment%t_values_needed = .false.</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;SALT&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;           segment%salt_segment_data_exists=.true.</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;           segment%s_values_needed = .false.</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        filename = trim(inputdir)//trim(filename)</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        fieldname = trim(fieldname)//trim(suffix)</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        <span class="keyword">call </span>field_size(filename,fieldname,siz,no_domain=.true.)</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">!       if (siz(4) == 1) segment%values_needed = .false.</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keywordflow">if</span> (segment%on_pe) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;          <span class="keywordflow">if</span> (obc%brushcutter_mode .and. (modulo(siz(1),2) == 0 .or. modulo(siz(2),2) == 0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&#39;segment data are not on the supergrid&#39;</span>)</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;          siz2(1)=1</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;          <span class="keywordflow">if</span> (siz(1)&gt;1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            <span class="keywordflow">if</span> (obc%brushcutter_mode) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;              siz2(1)=(siz(1)-1)/2</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;              siz2(1)=siz(1)</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;          siz2(2)=1</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;          <span class="keywordflow">if</span> (siz(2)&gt;1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            <span class="keywordflow">if</span> (obc%brushcutter_mode) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;              siz2(2)=(siz(2)-1)/2</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;              siz2(2)=siz(2)</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;          siz2(3)=siz(3)</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160; </div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;          <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_src(isdb:iedb,jsdb:jedb,siz2(3)))</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;              segment%v_values_needed = .false.</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;DVDX&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_src(isdb:iedb,jsdb:jedb,siz2(3)))</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;              segment%g_values_needed = .false.</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_src(isdb:iedb,jsd:jed,siz2(3)))</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                segment%u_values_needed = .false.</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;SSH&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                segment%z_values_needed = .false.</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;TEMP&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                segment%t_values_needed = .false.</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;SALT&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                segment%s_values_needed = .false.</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_src(isdb:iedb,jsdb:jedb,siz2(3)))</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;              segment%u_values_needed = .false.</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;DUDY&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_src(isdb:iedb,jsdb:jedb,siz2(3)))</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;              segment%g_values_needed = .false.</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_src(isd:ied,jsdb:jedb,siz2(3)))</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                segment%v_values_needed = .false.</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;SSH&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                segment%z_values_needed = .false.</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;TEMP&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                segment%t_values_needed = .false.</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;SALT&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                segment%s_values_needed = .false.</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;          segment%field(m)%buffer_src(:,:,:)=0.0</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;          segment%field(m)%fid = init_external_field(trim(filename),&amp;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;               trim(fieldname),ignore_axis_atts=.true.,threading=single_file)</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;          <span class="keywordflow">if</span> (siz(3) &gt; 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            fieldname = <span class="stringliteral">&#39;dz_&#39;</span>//trim(fieldname)</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            <span class="keyword">call </span>field_size(filename,fieldname,siz,no_domain=.true.)</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DVDX&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%dz_src(isdb:iedb,jsdb:jedb,siz(3)))</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%dz_src(isdb:iedb,jsd:jed,siz(3)))</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DUDY&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%dz_src(isdb:iedb,jsdb:jedb,siz(3)))</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%dz_src(isd:ied,jsdb:jedb,siz(3)))</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            segment%field(m)%dz_src(:,:,:)=0.0</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            segment%field(m)%nk_src=siz(3)</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            segment%field(m)%fid_dz = init_external_field(trim(filename),trim(fieldname),&amp;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                       ignore_axis_atts=.true.,threading=single_file)</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            segment%field(m)%nk_src=1</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        segment%field(m)%fid = -1</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        segment%field(m)%value = <span class="keywordtype">value</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        segment%field(m)%name = trim(fields(m))</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;          segment%u_values_needed = .false.</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <span class="keywordflow">elseif</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;          segment%v_values_needed = .false.</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="keywordflow">elseif</span> (segment%field(m)%name == <span class="stringliteral">&#39;SSH&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;          segment%z_values_needed = .false.</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="keywordflow">elseif</span> (segment%field(m)%name == <span class="stringliteral">&#39;TEMP&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;          segment%t_values_needed = .false.</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="keywordflow">elseif</span> (segment%field(m)%name == <span class="stringliteral">&#39;SALT&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;          segment%s_values_needed = .false.</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">elseif</span> (segment%field(m)%name == <span class="stringliteral">&#39;DVDX&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DUDY&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;          segment%g_values_needed = .false.</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordflow">if</span> (segment%u_values_needed .or. segment%v_values_needed .or. &amp;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        segment%t_values_needed .or. segment%s_values_needed .or. &amp;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        segment%z_values_needed .or. segment%g_values_needed) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;Values needed for OBC segment &quot;,I3)&#39;</span>) n</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="keyword">call </span>mom_error(fatal, mesg)</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160; </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <span class="keyword">call </span>mpp_set_current_pelist(saved_pelist)</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l01547">mom_remapping::initialize_remapping()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00303">mdl</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00053">mom_error_handler::mom_mesg()</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l01243">parse_segment_data_str()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l00317">open_boundary_config()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_adb17aba34a8aaceb524910d2e1196a0c_cgraph.svg" width="100%" height="487"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_adb17aba34a8aaceb524910d2e1196a0c_icgraph.svg" width="372" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a29dd2dc87f43e0e26d22367ce93519ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29dd2dc87f43e0e26d22367ce93519ff">&#9670;&nbsp;</a></span>lookup_seg_field()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer function mom_open_boundary::lookup_seg_field </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1obc__segment__type.html">obc_segment_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC_seg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=32), intent(in)&#160;</td>
          <td class="paramname"><em>field</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Needs documentation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">obc_seg</td><td>OBC segment </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">field</td><td>The field name </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l03152">3152</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: OBC_seg<span class="comment"> !&lt; OBC segment</span></div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;  <span class="keywordtype">character(len=32)</span>, <span class="keywordtype">intent(in)</span> :: field<span class="comment"> !&lt; The field name</span></div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;  <span class="keywordtype">integer</span> :: lookup_seg_field</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;  <span class="keywordtype">integer</span> :: n</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160; </div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;  lookup_seg_field=-1</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;  <span class="keywordflow">do</span> n=1,obc_seg%num_fields</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;   <span class="keywordflow">if</span> (trim(field) == obc_seg%field(n)%name) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;     lookup_seg_field=n</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;     <span class="keywordflow">return</span></div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="a7dbf161294debd059a40659ba691ca0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7dbf161294debd059a40659ba691ca0b">&#9670;&nbsp;</a></span>mask_outside_obcs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::mask_outside_obcs </td>
          <td>(</td>
          <td class="paramtype">type(dyn_horgrid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Find the region outside of all open boundary segments and make sure it is set to land mask. Gonna need to know global land mask as well to get it right... </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>Parameter file handle </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l04183">4183</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;  <span class="keywordtype">type</span>(dyn_horgrid_type),       <span class="keywordtype">intent(inout)</span> :: G<span class="comment">          !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;  <span class="keywordtype">type</span>(param_file_type),        <span class="keywordtype">intent(in)</span>    :: param_file<span class="comment"> !&lt; Parameter file handle</span></div>
<div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),         <span class="keywordtype">pointer</span>       :: OBC<span class="comment">        !&lt; Open boundary structure</span></div>
<div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),        <span class="keywordtype">intent(in)</span>    :: US<span class="comment">         !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160; </div>
<div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, IsdB, IedB, jsd, jed, JsdB, JedB, n</div>
<div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;  <span class="keywordtype">integer</span> :: i, j</div>
<div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;  <span class="keywordtype">logical</span> :: fatal_error = .false.</div>
<div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;<span class="keywordtype">  real</span>    :: min_depth</div>
<div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: cin = 3, cout = 4, cland = -1, cedge = -2</div>
<div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;  <span class="keywordtype">character(len=256)</span> :: mesg    <span class="comment">! Message for error messages.</span></div>
<div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment =&gt; null() <span class="comment">! pointer to segment type list</span></div>
<div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:)</span> :: color, color2  <span class="comment">! For sorting inside from outside,</span></div>
<div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;                                                      <span class="comment">! two different ways</span></div>
<div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160; </div>
<div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(obc)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160; </div>
<div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;MINIMUM_DEPTH&quot;</span>, min_depth, &amp;</div>
<div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;                 units=<span class="stringliteral">&quot;m&quot;</span>, default=0.0, scale=us%m_to_Z, do_not_log=.true.)</div>
<div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160; </div>
<div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;  <span class="keyword">allocate</span>(color(g%isd:g%ied, g%jsd:g%jed)) ; color = 0</div>
<div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;  <span class="keyword">allocate</span>(color2(g%isd:g%ied, g%jsd:g%jed)) ; color2 = 0</div>
<div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160; </div>
<div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160; </div>
<div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;  <span class="comment">! Paint a frame around the outside.</span></div>
<div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;  <span class="keywordflow">do</span> j=g%jsd,g%jed</div>
<div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;    color(g%isd,j) = cedge</div>
<div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;    color(g%ied,j) = cedge</div>
<div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;    color2(g%isd,j) = cedge</div>
<div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;    color2(g%ied,j) = cedge</div>
<div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;  <span class="keywordflow">do</span> i=g%isd,g%ied</div>
<div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;    color(i,g%jsd) = cedge</div>
<div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;    color(i,g%jed) = cedge</div>
<div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;    color2(i,g%jsd) = cedge</div>
<div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;    color2(i,g%jed) = cedge</div>
<div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160; </div>
<div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;  <span class="comment">! Set color to cland in the land. Note that this is before the land</span></div>
<div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;  <span class="comment">! mask has been initialized, set mask values based on depth.</span></div>
<div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;  <span class="keywordflow">do</span> j=g%jsd,g%jed</div>
<div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;    <span class="keywordflow">do</span> i=g%isd,g%ied</div>
<div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;      <span class="keywordflow">if</span> (g%bathyT(i,j) &lt;= min_depth) color(i,j) = cland</div>
<div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;      <span class="keywordflow">if</span> (g%bathyT(i,j) &lt;= min_depth) color2(i,j) = cland</div>
<div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160; </div>
<div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;  <span class="keywordflow">do</span> j=g%jsd,g%jed ; <span class="keywordflow">do</span> i=g%IsdB+1,g%IedB-1</div>
<div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;    <span class="keywordflow">if</span> (obc%segment(obc%segnum_u(i,j))%direction == obc_direction_w) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;      <span class="keywordflow">if</span> (color(i,j) == 0.0) color(i,j) = cout</div>
<div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;      <span class="keywordflow">if</span> (color(i+1,j) == 0.0) color(i+1,j) = cin</div>
<div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;    <span class="keywordflow">elseif</span> (obc%segment(obc%segnum_u(i,j))%direction == obc_direction_e) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;      <span class="keywordflow">if</span> (color(i,j) == 0.0) color(i,j) = cin</div>
<div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;      <span class="keywordflow">if</span> (color(i+1,j) == 0.0) color(i+1,j) = cout</div>
<div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;  <span class="keywordflow">do</span> j=g%JsdB+1,g%JedB-1 ; <span class="keywordflow">do</span> i=g%isd,g%ied</div>
<div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;    <span class="keywordflow">if</span> (obc%segment(obc%segnum_v(i,j))%direction == obc_direction_s) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;      <span class="keywordflow">if</span> (color(i,j) == 0.0) color(i,j) = cout</div>
<div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;      <span class="keywordflow">if</span> (color(i,j+1) == 0.0) color(i,j+1) = cin</div>
<div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;    <span class="keywordflow">elseif</span> (obc%segment(obc%segnum_v(i,j))%direction == obc_direction_n) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;      <span class="keywordflow">if</span> (color(i,j) == 0.0) color(i,j) = cin</div>
<div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;      <span class="keywordflow">if</span> (color(i,j+1) == 0.0) color(i,j+1) = cout</div>
<div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160; </div>
<div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;  <span class="keywordflow">do</span> j=g%JsdB+1,g%JedB-1 ; <span class="keywordflow">do</span> i=g%isd,g%ied</div>
<div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;    <span class="keywordflow">if</span> (obc%segment(obc%segnum_v(i,j))%direction == obc_direction_s) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;      <span class="keywordflow">if</span> (color2(i,j) == 0.0) color2(i,j) = cout</div>
<div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;      <span class="keywordflow">if</span> (color2(i,j+1) == 0.0) color2(i,j+1) = cin</div>
<div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;    <span class="keywordflow">elseif</span> (obc%segment(obc%segnum_v(i,j))%direction == obc_direction_n) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;      <span class="keywordflow">if</span> (color2(i,j) == 0.0) color2(i,j) = cin</div>
<div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;      <span class="keywordflow">if</span> (color2(i,j+1) == 0.0) color2(i,j+1) = cout</div>
<div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;  <span class="keywordflow">do</span> j=g%jsd,g%jed ; <span class="keywordflow">do</span> i=g%IsdB+1,g%IedB-1</div>
<div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;    <span class="keywordflow">if</span> (obc%segment(obc%segnum_u(i,j))%direction == obc_direction_w) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;      <span class="keywordflow">if</span> (color2(i,j) == 0.0) color2(i,j) = cout</div>
<div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;      <span class="keywordflow">if</span> (color2(i+1,j) == 0.0) color2(i+1,j) = cin</div>
<div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;    <span class="keywordflow">elseif</span> (obc%segment(obc%segnum_u(i,j))%direction == obc_direction_e) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;      <span class="keywordflow">if</span> (color2(i,j) == 0.0) color2(i,j) = cin</div>
<div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;      <span class="keywordflow">if</span> (color2(i+1,j) == 0.0) color2(i+1,j) = cout</div>
<div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160; </div>
<div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;  <span class="comment">! Do the flood fill until there are no more uncolored cells.</span></div>
<div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;  <span class="keyword">call </span>flood_fill(g, color, cin, cout, cland)</div>
<div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;  <span class="keyword">call </span>flood_fill2(g, color2, cin, cout, cland)</div>
<div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160; </div>
<div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;  <span class="comment">! Use the color to set outside to min_depth on this process.</span></div>
<div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;  <span class="keywordflow">do</span> j=g%jsd,g%jed ; <span class="keywordflow">do</span> i=g%isd,g%ied</div>
<div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;    <span class="keywordflow">if</span> (color(i,j) /= color2(i,j)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;      fatal_error = .true.</div>
<div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;      <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;MOM_open_boundary: problem with OBC segments specification at &quot;,I5,&quot;,&quot;,I5,&quot; during\n&quot;, &amp;</span></div>
<div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;<span class="stringliteral"></span><span class="stringliteral">          &quot;the masking of the outside grid points.&quot;)&#39;</span>) i, j</div>
<div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;      <span class="keyword">call </span>mom_error(warning,<span class="stringliteral">&quot;MOM register_tracer: &quot;</span>//mesg, all_print=.true.)</div>
<div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;    <span class="keywordflow">if</span> (color(i,j) == cout) g%bathyT(i,j) = min_depth</div>
<div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;  <span class="keywordflow">if</span> (fatal_error) <span class="keyword">call </span>mom_error(fatal, &amp;</div>
<div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;      <span class="stringliteral">&quot;MOM_open_boundary: inconsistent OBC segments.&quot;</span>)</div>
<div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160; </div>
<div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;  <span class="keyword">deallocate</span>(color)</div>
<div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;  <span class="keyword">deallocate</span>(color2)</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l04292">flood_fill()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l04352">flood_fill2()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00303">mdl</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00065">obc_direction_e</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00063">obc_direction_n</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00064">obc_direction_s</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00066">obc_direction_w</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l00317">open_boundary_config()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a7dbf161294debd059a40659ba691ca0b_cgraph.svg" width="368" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a7dbf161294debd059a40659ba691ca0b_icgraph.svg" width="368" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a0a6e28bbfec6ab82bfe2fd2848902945"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a6e28bbfec6ab82bfe2fd2848902945">&#9670;&nbsp;</a></span>obc_registry_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::obc_registry_init </td>
          <td>(</td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1obc__registry__type.html">obc_registry_type</a>), pointer&#160;</td>
          <td class="paramname"><em>Reg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This routine include declares and sets the variable "version". </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>open file to parse for model parameters </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">reg</td><td>pointer to OBC registry </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l03925">3925</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; open file to parse for model parameters</span></div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;  <span class="keywordtype">type</span>(OBC_registry_type), <span class="keywordtype">pointer</span>    :: Reg<span class="comment">        !&lt; pointer to OBC registry</span></div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160; </div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">save</span> :: init_calls = 0</div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160; </div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;MOM_open_boundary&quot;</span> <span class="comment">! This module&#39;s name.</span></div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;  <span class="keywordtype">character(len=256)</span> :: mesg    <span class="comment">! Message for error messages.</span></div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160; </div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(reg)) <span class="keywordflow">then</span> ; <span class="keyword">allocate</span>(reg)</div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;  <span class="keywordflow">else</span> ; <span class="keywordflow">return</span> ;<span class="keywordflow"> endif</span></div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160; </div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;  <span class="comment">! Read all relevant parameters and write them to the model log.</span></div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;<span class="comment">! call log_version(param_file, mdl,s version, &quot;&quot;)</span></div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160; </div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;  init_calls = init_calls + 1</div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;  <span class="keywordflow">if</span> (init_calls &gt; 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;    <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;OBC_registry_init called &quot;,I3, &amp;</span></div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;<span class="stringliteral"></span><span class="stringliteral">      &amp;&quot; times with different registry pointers.&quot;)&#39;</span>) init_calls</div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;    <span class="keywordflow">if</span> (is_root_pe()) <span class="keyword">call </span>mom_error(warning,<span class="stringliteral">&quot;MOM_open_boundary&quot;</span>//mesg)</div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l03899">register_obc()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a0a6e28bbfec6ab82bfe2fd2848902945_icgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a11acc9ede6f2b975bfc6b849a2603b46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11acc9ede6f2b975bfc6b849a2603b46">&#9670;&nbsp;</a></span>open_boundary_apply_normal_flow()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::open_boundary_apply_normal_flow </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Applies OBC values stored in segments to 3d u,v fields. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary control structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">u</td><td>u field to update on open boundaries [L T-1 ~&gt; m s-1] </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v</td><td>v field to update on open boundaries [L T-1 ~&gt; m s-1] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l02898">2898</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;  <span class="comment">! Arguments</span></div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),                      <span class="keywordtype">pointer</span>       :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(inout)</span> :: G<span class="comment">   !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: u<span class="comment">   !&lt; u field to update on open</span></div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;<span class="comment">                                                                  !! boundaries [L T-1 ~&gt; m s-1]</span></div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: v<span class="comment">   !&lt; v field to update on open</span></div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;<span class="comment">                                                                  !! boundaries [L T-1 ~&gt; m s-1]</span></div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, n</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment =&gt; null()</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160; </div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(obc)) <span class="keywordflow">return</span> <span class="comment">! Bail out if OBC is not available</span></div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160; </div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;  <span class="keywordflow">do</span> n=1,obc%number_of_segments</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;    segment =&gt; obc%segment(n)</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;    <span class="keywordflow">if</span> (.not. segment%on_pe) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;      cycle</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;    <span class="keywordflow">elseif</span> (segment%radiation .or. segment%oblique .or. segment%gradient) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;      <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;        i=segment%HI%IsdB</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke ;  <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;          u(i,j,k) = segment%normal_vel(i,j,k)</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;      <span class="keywordflow">elseif</span> (segment%is_N_or_S) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;        j=segment%HI%JsdB</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke ;  <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;          v(i,j,k) = segment%normal_vel(i,j,k)</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l01788">radiation_open_bdry_conds()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a11acc9ede6f2b975bfc6b849a2603b46_icgraph.svg" width="394" height="67"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ac94938f1a657896ff03efd3864faa02a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac94938f1a657896ff03efd3864faa02a">&#9670;&nbsp;</a></span>open_boundary_config()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::open_boundary_config </td>
          <td>(</td>
          <td class="paramtype">type(dyn_horgrid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enables OBC module and reads configuration parameters This routine is called from MOM_initialize_fixed which occurs before the initialization of the vertical coordinate and ALE_init. Therefore segment data are not fully initialized here. The remainder of the segment data are initialized in a later call to update_open_boundary_data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>Parameter file handle </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00317">317</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordtype">type</span>(dyn_horgrid_type),  <span class="keywordtype">intent(inout)</span> :: G<span class="comment">   !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),   <span class="keywordtype">intent(in)</span>    :: US<span class="comment">  !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span>    :: param_file<span class="comment"> !&lt; Parameter file handle</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),    <span class="keywordtype">pointer</span>       :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keywordtype">integer</span> :: l <span class="comment">! For looping over segments</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keywordtype">logical</span> :: debug_OBC, debug, mask_outside, reentrant_x, reentrant_y</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordtype">character(len=15)</span> :: segment_param_str <span class="comment">! The run-time parameter name for each segment</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordtype">character(len=100)</span> :: segment_str      <span class="comment">! The contents (rhs) for parameter &quot;segment_param_str&quot;</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordtype">character(len=200)</span> :: config1          <span class="comment">! String for OBC_USER_CONFIG</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="keywordtype">  real</span>               :: Lscale_in, Lscale_out <span class="comment">! parameters controlling tracer values at the boundaries [L ~&gt; m]</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keyword">allocate</span>(obc)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160; </div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keyword">call </span>log_version(param_file, mdl, version, &amp;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                 <span class="stringliteral">&quot;Controls where open boundaries are located, what kind of boundary condition &quot;</span>//&amp;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                 <span class="stringliteral">&quot;to impose, and what data to apply, if any.&quot;</span>)</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_NUMBER_OF_SEGMENTS&quot;</span>, obc%number_of_segments, &amp;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                 <span class="stringliteral">&quot;The number of open boundary segments.&quot;</span>, &amp;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                 default=0)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;G_EARTH&quot;</span>, obc%g_Earth, &amp;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                 <span class="stringliteral">&quot;The gravitational acceleration of the Earth.&quot;</span>, &amp;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                 units=<span class="stringliteral">&quot;m s-2&quot;</span>, default = 9.80)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_USER_CONFIG&quot;</span>, config1, &amp;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                 <span class="stringliteral">&quot;A string that sets how the open boundary conditions are &quot;</span>//&amp;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                 <span class="stringliteral">&quot; configured: \n&quot;</span>, default=<span class="stringliteral">&quot;none&quot;</span>, do_not_log=.true.)</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;NK&quot;</span>, obc%ke, &amp;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                 <span class="stringliteral">&quot;The number of model layers&quot;</span>, default=0, do_not_log=.true.)</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordflow">if</span> (config1 /= <span class="stringliteral">&quot;none&quot;</span> .and. config1 /= <span class="stringliteral">&quot;dyed_obcs&quot;</span>) obc%user_BCs_set_globally = .true.</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keywordflow">if</span> (obc%number_of_segments &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_ZERO_VORTICITY&quot;</span>, obc%zero_vorticity, &amp;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;         <span class="stringliteral">&quot;If true, sets relative vorticity to zero on open boundaries.&quot;</span>, &amp;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;         default=.false.)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_FREESLIP_VORTICITY&quot;</span>, obc%freeslip_vorticity, &amp;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;         <span class="stringliteral">&quot;If true, sets the normal gradient of tangential velocity to &quot;</span>//&amp;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;         <span class="stringliteral">&quot;zero in the relative vorticity on open boundaries. This cannot &quot;</span>//&amp;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;         <span class="stringliteral">&quot;be true if another OBC_XXX_VORTICITY option is True.&quot;</span>, default=.true.)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_COMPUTED_VORTICITY&quot;</span>, obc%computed_vorticity, &amp;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;         <span class="stringliteral">&quot;If true, uses the external values of tangential velocity &quot;</span>//&amp;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;         <span class="stringliteral">&quot;in the relative vorticity on open boundaries. This cannot &quot;</span>//&amp;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;         <span class="stringliteral">&quot;be true if another OBC_XXX_VORTICITY option is True.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_SPECIFIED_VORTICITY&quot;</span>, obc%specified_vorticity, &amp;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;         <span class="stringliteral">&quot;If true, uses the external values of tangential velocity &quot;</span>//&amp;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;         <span class="stringliteral">&quot;in the relative vorticity on open boundaries. This cannot &quot;</span>//&amp;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;         <span class="stringliteral">&quot;be true if another OBC_XXX_VORTICITY option is True.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">if</span> ((obc%zero_vorticity .and. obc%freeslip_vorticity) .or.  &amp;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        (obc%zero_vorticity .and. obc%computed_vorticity) .or.  &amp;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        (obc%zero_vorticity .and. obc%specified_vorticity) .or.  &amp;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        (obc%freeslip_vorticity .and. obc%computed_vorticity) .or.  &amp;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        (obc%freeslip_vorticity .and. obc%specified_vorticity) .or.  &amp;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        (obc%computed_vorticity .and. obc%specified_vorticity))  &amp;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;         <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, open_boundary_config:\n&quot;</span>//&amp;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;         <span class="stringliteral">&quot;Only one of OBC_ZERO_VORTICITY, OBC_FREESLIP_VORTICITY, OBC_COMPUTED_VORTICITY\n&quot;</span>//&amp;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;         <span class="stringliteral">&quot;and OBC_IMPORTED_VORTICITY can be True at once.&quot;</span>)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_ZERO_STRAIN&quot;</span>, obc%zero_strain, &amp;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;         <span class="stringliteral">&quot;If true, sets the strain used in the stress tensor to zero on open boundaries.&quot;</span>, &amp;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;         default=.false.)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_FREESLIP_STRAIN&quot;</span>, obc%freeslip_strain, &amp;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;         <span class="stringliteral">&quot;If true, sets the normal gradient of tangential velocity to &quot;</span>//&amp;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;         <span class="stringliteral">&quot;zero in the strain use in the stress tensor on open boundaries. This cannot &quot;</span>//&amp;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;         <span class="stringliteral">&quot;be true if another OBC_XXX_STRAIN option is True.&quot;</span>, default=.true.)</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_COMPUTED_STRAIN&quot;</span>, obc%computed_strain, &amp;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;         <span class="stringliteral">&quot;If true, sets the normal gradient of tangential velocity to &quot;</span>//&amp;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;         <span class="stringliteral">&quot;zero in the strain use in the stress tensor on open boundaries. This cannot &quot;</span>//&amp;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;         <span class="stringliteral">&quot;be true if another OBC_XXX_STRAIN option is True.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_SPECIFIED_STRAIN&quot;</span>, obc%specified_strain, &amp;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;         <span class="stringliteral">&quot;If true, sets the normal gradient of tangential velocity to &quot;</span>//&amp;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;         <span class="stringliteral">&quot;zero in the strain use in the stress tensor on open boundaries. This cannot &quot;</span>//&amp;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;         <span class="stringliteral">&quot;be true if another OBC_XXX_STRAIN option is True.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">if</span> ((obc%zero_strain .and. obc%freeslip_strain) .or.  &amp;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        (obc%zero_strain .and. obc%computed_strain) .or.  &amp;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        (obc%zero_strain .and. obc%specified_strain) .or.  &amp;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        (obc%freeslip_strain .and. obc%computed_strain) .or.  &amp;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        (obc%freeslip_strain .and. obc%specified_strain) .or.  &amp;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        (obc%computed_strain .and. obc%specified_strain))  &amp;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;         <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, open_boundary_config: \n&quot;</span>//&amp;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;         <span class="stringliteral">&quot;Only one of OBC_ZERO_STRAIN, OBC_FREESLIP_STRAIN, OBC_COMPUTED_STRAIN \n&quot;</span>//&amp;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;         <span class="stringliteral">&quot;and OBC_IMPORTED_STRAIN can be True at once.&quot;</span>)</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_ZERO_BIHARMONIC&quot;</span>, obc%zero_biharmonic, &amp;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;         <span class="stringliteral">&quot;If true, zeros the Laplacian of flow on open boundaries in the biharmonic &quot;</span>//&amp;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;         <span class="stringliteral">&quot;viscosity term.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;MASK_OUTSIDE_OBCS&quot;</span>, mask_outside, &amp;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;         <span class="stringliteral">&quot;If true, set the areas outside open boundaries to be land.&quot;</span>, &amp;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;         default=.false.)</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;DEBUG&quot;</span>, debug, default=.false.)</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;DEBUG_OBC&quot;</span>, debug_obc, default=.false.)</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">if</span> (debug_obc .or. debug) &amp;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;DEBUG_OBC&quot;</span>, debug_obc, &amp;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                 <span class="stringliteral">&quot;If true, do additional calls to help debug the performance &quot;</span>//&amp;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                 <span class="stringliteral">&quot;of the open boundary condition code.&quot;</span>, default=.false., &amp;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                 debuggingparam=.true.)</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_SILLY_THICK&quot;</span>, obc%silly_h, &amp;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                 <span class="stringliteral">&quot;A silly value of thicknesses used outside of open boundary &quot;</span>//&amp;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                 <span class="stringliteral">&quot;conditions for debugging.&quot;</span>, units=<span class="stringliteral">&quot;m&quot;</span>, default=0.0, scale=us%m_to_Z, &amp;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                 do_not_log=.not.debug_obc, debuggingparam=.true.)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_SILLY_VEL&quot;</span>, obc%silly_u, &amp;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                 <span class="stringliteral">&quot;A silly value of velocities used outside of open boundary &quot;</span>//&amp;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                 <span class="stringliteral">&quot;conditions for debugging.&quot;</span>, units=<span class="stringliteral">&quot;m/s&quot;</span>, default=0.0, scale=us%m_s_to_L_T, &amp;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                 do_not_log=.not.debug_obc, debuggingparam=.true.)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    reentrant_x = .false.</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;REENTRANT_X&quot;</span>, reentrant_x, default=.true.)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    reentrant_y = .false.</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;REENTRANT_Y&quot;</span>, reentrant_y, default=.false.)</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="comment">! Allocate everything</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="comment">! Note the 0-segment is needed when %segnum_u/v(:,:) = 0</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keyword">allocate</span>(obc%segment(0:obc%number_of_segments))</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">do</span> l=0,obc%number_of_segments</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      obc%segment(l)%Flather = .false.</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      obc%segment(l)%radiation = .false.</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      obc%segment(l)%radiation_tan = .false.</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      obc%segment(l)%radiation_grad = .false.</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      obc%segment(l)%oblique = .false.</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      obc%segment(l)%oblique_tan = .false.</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      obc%segment(l)%oblique_grad = .false.</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      obc%segment(l)%nudged = .false.</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      obc%segment(l)%nudged_tan = .false.</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      obc%segment(l)%nudged_grad = .false.</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      obc%segment(l)%specified = .false.</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      obc%segment(l)%specified_tan = .false.</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      obc%segment(l)%open = .false.</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      obc%segment(l)%gradient = .false.</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      obc%segment(l)%values_needed = .false.</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      obc%segment(l)%u_values_needed = .false.</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      obc%segment(l)%v_values_needed = .false.</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      obc%segment(l)%t_values_needed = .false.</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      obc%segment(l)%s_values_needed = .false.</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      obc%segment(l)%z_values_needed = .false.</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      obc%segment(l)%g_values_needed = .false.</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      obc%segment(l)%direction = obc_none</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      obc%segment(l)%is_N_or_S = .false.</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      obc%segment(l)%is_E_or_W = .false.</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      obc%segment(l)%is_E_or_W_2 = .false.</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      obc%segment(l)%Velocity_nudging_timescale_in = 0.0</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      obc%segment(l)%Velocity_nudging_timescale_out = 0.0</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      obc%segment(l)%num_fields = 0</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keyword">allocate</span>(obc%segnum_u(g%IsdB:g%IedB,g%jsd:g%jed)) ; obc%segnum_u(:,:) = obc_none</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keyword">allocate</span>(obc%segnum_v(g%isd:g%ied,g%JsdB:g%JedB)) ; obc%segnum_v(:,:) = obc_none</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">do</span> l = 1, obc%number_of_segments</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="keyword">write</span>(segment_param_str(1:15),<span class="stringliteral">&quot;(&#39;OBC_SEGMENT_&#39;,i3.3)&quot;</span>) l</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="keyword">call </span>get_param(param_file, mdl, segment_param_str, segment_str, &amp;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;           <span class="stringliteral">&quot;Documentation needs to be dynamic?????&quot;</span>, &amp;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;           fail_if_missing=.true.)</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      segment_str = remove_spaces(segment_str)</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keywordflow">if</span> (segment_str(1:2) == <span class="stringliteral">&#39;I=&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="keyword">call </span>setup_u_point_obc(obc, g, us, segment_str, l, param_file, reentrant_y)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <span class="keywordflow">elseif</span> (segment_str(1:2) == <span class="stringliteral">&#39;J=&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="keyword">call </span>setup_v_point_obc(obc, g, us, segment_str, l, param_file, reentrant_x)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, open_boundary_config: &quot;</span>//&amp;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;             <span class="stringliteral">&quot;Unable to interpret &quot;</span>//segment_param_str//<span class="stringliteral">&quot; = &quot;</span>//trim(segment_str))</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">!    if (open_boundary_query(OBC, needs_ext_seg_data=.true.)) &amp;</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keyword">call </span>initialize_segment_data(g, obc, param_file)</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">if</span> (open_boundary_query(obc, apply_open_obc=.true.)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_RADIATION_MAX&quot;</span>, obc%rx_max, &amp;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                   <span class="stringliteral">&quot;The maximum magnitude of the baroclinic radiation &quot;</span>//&amp;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                   <span class="stringliteral">&quot;velocity (or speed of characteristics).  This is only &quot;</span>//&amp;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                   <span class="stringliteral">&quot;used if one of the open boundary segments is using Orlanski.&quot;</span>, &amp;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                   units=<span class="stringliteral">&quot;m s-1&quot;</span>, default=10.0)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_RAD_VEL_WT&quot;</span>, obc%gamma_uv, &amp;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                   <span class="stringliteral">&quot;The relative weighting for the baroclinic radiation &quot;</span>//&amp;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                   <span class="stringliteral">&quot;velocities (or speed of characteristics) at the new &quot;</span>//&amp;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                   <span class="stringliteral">&quot;time level (1) or the running mean (0) for velocities. &quot;</span>//&amp;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                   <span class="stringliteral">&quot;Valid values range from 0 to 1. This is only used if &quot;</span>//&amp;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                   <span class="stringliteral">&quot;one of the open boundary segments is using Orlanski.&quot;</span>, &amp;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                   units=<span class="stringliteral">&quot;nondim&quot;</span>, default=0.3)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    lscale_in = 0.</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    lscale_out = 0.</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">if</span> (open_boundary_query(obc, apply_open_obc=.true.)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_TRACER_RESERVOIR_LENGTH_SCALE_OUT &quot;</span>, lscale_out, &amp;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                 <span class="stringliteral">&quot;An effective length scale for restoring the tracer concentration &quot;</span>//&amp;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                 <span class="stringliteral">&quot;at the boundaries to externally imposed values when the flow &quot;</span>//&amp;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                 <span class="stringliteral">&quot;is exiting the domain.&quot;</span>, units=<span class="stringliteral">&quot;m&quot;</span>, default=0.0, scale=us%m_to_L)</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OBC_TRACER_RESERVOIR_LENGTH_SCALE_IN &quot;</span>, lscale_in, &amp;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                 <span class="stringliteral">&quot;An effective length scale for restoring the tracer concentration &quot;</span>//&amp;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                 <span class="stringliteral">&quot;at the boundaries to values from the interior when the flow &quot;</span>//&amp;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                 <span class="stringliteral">&quot;is entering the domain.&quot;</span>, units=<span class="stringliteral">&quot;m&quot;</span>, default=0.0, scale=us%m_to_L)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span> (mask_outside) <span class="keyword">call </span>mask_outside_obcs(g, us, param_file, obc)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="comment">! All tracers are using the same restoring length scale for now, but we may want to make this</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="comment">! tracer-specific in the future for example, in cases where certain tracers are poorly constrained</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="comment">! by data while others are well constrained - MJH.</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">do</span> l = 1, obc%number_of_segments</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      obc%segment(l)%Tr_InvLscale_in = 0.0</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="keywordflow">if</span> (lscale_in&gt;0.) obc%segment(l)%Tr_InvLscale_in =  1.0/lscale_in</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      obc%segment(l)%Tr_InvLscale_out = 0.0</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordflow">if</span> (lscale_out&gt;0.) obc%segment(l)%Tr_InvLscale_out =  1.0/lscale_out</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="keywordflow">  endif</span> <span class="comment">! OBC%number_of_segments &gt; 0</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160; </div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">! Safety check</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="keywordflow">if</span> ((obc%open_u_BCs_exist_globally .or. obc%open_v_BCs_exist_globally) .and. &amp;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;       .not.g%symmetric ) <span class="keyword">call </span>mom_error(fatal, &amp;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;       <span class="stringliteral">&quot;MOM_open_boundary, open_boundary_config: &quot;</span>//&amp;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;       <span class="stringliteral">&quot;Symmetric memory must be used when using Flather OBCs.&quot;</span>)</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="keywordflow">if</span> (.not.(obc%specified_u_BCs_exist_globally .or. obc%specified_v_BCs_exist_globally .or. &amp;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;              obc%open_u_BCs_exist_globally .or. obc%open_v_BCs_exist_globally)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">! No open boundaries have been requested</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keyword">call </span>open_boundary_dealloc(obc)</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="comment">! Need this for ocean_only mode boundary interpolation.</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keyword">call </span>time_interp_external_init()</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l00541">initialize_segment_data()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l04183">mask_outside_obcs()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00303">mdl</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00058">obc_none</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01563">open_boundary_dealloc()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01541">open_boundary_query()</a>, <a class="el" href="MOM__string__functions_8F90_source.html#l00292">mom_string_functions::remove_spaces()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00858">setup_u_point_obc()</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00994">setup_v_point_obc()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_ac94938f1a657896ff03efd3864faa02a_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a709a33b9e33b5689d5ca73349ed51fb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a709a33b9e33b5689d5ca73349ed51fb6">&#9670;&nbsp;</a></span>open_boundary_dealloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::open_boundary_dealloc </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Deallocate open boundary data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">obc</td><td>Open boundary control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l01563">1563</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type), <span class="keywordtype">pointer</span> :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment =&gt; null()</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;  <span class="keywordtype">integer</span> :: n</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160; </div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(obc)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160; </div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  <span class="keywordflow">do</span> n=1, obc%number_of_segments</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    segment =&gt; obc%segment(n)</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    <span class="keyword">call </span>deallocate_obc_segment_data(obc, segment)</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc%segment)) <span class="keyword">deallocate</span>(obc%segment)</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc%segnum_u)) <span class="keyword">deallocate</span>(obc%segnum_u)</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc%segnum_v)) <span class="keyword">deallocate</span>(obc%segnum_v)</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc%rx_normal)) <span class="keyword">deallocate</span>(obc%rx_normal)</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc%ry_normal)) <span class="keyword">deallocate</span>(obc%ry_normal)</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc%rx_oblique)) <span class="keyword">deallocate</span>(obc%rx_oblique)</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc%ry_oblique)) <span class="keyword">deallocate</span>(obc%ry_oblique)</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc%cff_normal)) <span class="keyword">deallocate</span>(obc%cff_normal)</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc%tres_x)) <span class="keyword">deallocate</span>(obc%tres_x)</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc%tres_y)) <span class="keyword">deallocate</span>(obc%tres_y)</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  <span class="keyword">deallocate</span>(obc)</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l03278">deallocate_obc_segment_data()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l00317">open_boundary_config()</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l01588">open_boundary_end()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a709a33b9e33b5689d5ca73349ed51fb6_cgraph.svg" width="655" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a709a33b9e33b5689d5ca73349ed51fb6_icgraph.svg" width="372" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="afb86d9ee7fc99dea787b88cfdb70f139"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb86d9ee7fc99dea787b88cfdb70f139">&#9670;&nbsp;</a></span>open_boundary_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::open_boundary_end </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close open boundary data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">obc</td><td>Open boundary control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l01588">1588</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type), <span class="keywordtype">pointer</span> :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  <span class="keyword">call </span>open_boundary_dealloc(obc)</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l01563">open_boundary_dealloc()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_afb86d9ee7fc99dea787b88cfdb70f139_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a7aa6f2b520108ce761ef107557f69069"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7aa6f2b520108ce761ef107557f69069">&#9670;&nbsp;</a></span>open_boundary_impose_land_mask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::open_boundary_impose_land_mask </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(dyn_horgrid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>areaCu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>areaCv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reconcile masks and open boundaries, deallocate OBC on PEs where it is not needed. Also adjust u- and v-point cell area on specified open boundaries and mask all points outside open boundaries. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary control structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">areacu</td><td>Area of a u-cell [L2 ~&gt; m2] </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">areacv</td><td>Area of a u-cell [L2 ~&gt; m2] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l01639">1639</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),              <span class="keywordtype">pointer</span>       :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  <span class="keywordtype">type</span>(dyn_horgrid_type),            <span class="keywordtype">intent(inout)</span> :: G<span class="comment">   !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),             <span class="keywordtype">intent(in)</span>    :: US<span class="comment">  !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G))</span>, <span class="keywordtype">intent(inout)</span> :: areaCu<span class="comment"> !&lt; Area of a u-cell [L2 ~&gt; m2]</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G))</span>, <span class="keywordtype">intent(inout)</span> :: areaCv<span class="comment"> !&lt; Area of a u-cell [L2 ~&gt; m2]</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;  <span class="keywordtype">integer</span> :: i, j, n</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment =&gt; null()</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;  <span class="keywordtype">logical</span> :: any_U, any_V</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160; </div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(obc)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160; </div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;  <span class="keywordflow">do</span> n=1,obc%number_of_segments</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    segment=&gt;obc%segment(n)</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    <span class="keywordflow">if</span> (.not. segment%on_pe) cycle</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;      <span class="comment">! Sweep along u-segments and delete the OBC for blocked points.</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      <span class="comment">! Also, mask all points outside.</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      i=segment%HI%IsdB</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;      <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        <span class="keywordflow">if</span> (g%mask2dCu(i,j) == 0) obc%segnum_u(i,j) = obc_none</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        <span class="keywordflow">if</span> (segment%direction == obc_direction_w) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;          g%mask2dT(i,j) = 0</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;          g%mask2dT(i+1,j) = 0</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      <span class="keywordflow">do</span> j=segment%HI%JsdB+1,segment%HI%JedB-1</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        <span class="keywordflow">if</span> (segment%direction == obc_direction_w) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;          g%mask2dCv(i,j) = 0</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;          g%mask2dCv(i+1,j) = 0</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      <span class="comment">! Sweep along v-segments and delete the OBC for blocked points.</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;      j=segment%HI%JsdB</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;      <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        <span class="keywordflow">if</span> (g%mask2dCv(i,j) == 0) obc%segnum_v(i,j) = obc_none</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        <span class="keywordflow">if</span> (segment%direction == obc_direction_s) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;          g%mask2dT(i,j) = 0</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;          g%mask2dT(i,j+1) = 0</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      <span class="keywordflow">do</span> i=segment%HI%IsdB+1,segment%HI%IedB-1</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        <span class="keywordflow">if</span> (segment%direction == obc_direction_s) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;          g%mask2dCu(i,j) = 0</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;          g%mask2dCu(i,j+1) = 0</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160; </div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;  <span class="keywordflow">do</span> n=1,obc%number_of_segments</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    segment=&gt;obc%segment(n)</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    <span class="keywordflow">if</span> (.not. segment%on_pe .or. .not. segment%specified) cycle</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      <span class="comment">! Sweep along u-segments and for %specified BC points reset the u-point area which was masked out</span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;      i=segment%HI%IsdB</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;      <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        <span class="keywordflow">if</span> (segment%direction == obc_direction_e) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;          areacu(i,j) = g%areaT(i,j)   <span class="comment">! Both of these are in [L2]</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        <span class="keywordflow">else</span>   <span class="comment">! West</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;          areacu(i,j) = g%areaT(i+1,j) <span class="comment">! Both of these are in [L2]</span></div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;      <span class="comment">! Sweep along v-segments and for %specified BC points reset the v-point area which was masked out</span></div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;      j=segment%HI%JsdB</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;      <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;        <span class="keywordflow">if</span> (segment%direction == obc_direction_s) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;          areacv(i,j) = g%areaT(i,j+1) <span class="comment">! Both of these are in [L2]</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;        <span class="keywordflow">else</span>      <span class="comment">! North</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;          areacu(i,j) = g%areaT(i,j)   <span class="comment">! Both of these are in [L2]</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160; </div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;  <span class="comment">! G%mask2du will be open wherever bathymetry allows it.</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  <span class="comment">! Bathymetry outside of the open boundary was adjusted to match</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <span class="comment">! the bathymetry inside so these points will be open unless the</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;  <span class="comment">! bathymetry inside the boundary was too shallow and flagged as land.</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  any_u = .false.</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;  any_v = .false.</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  <span class="keywordflow">do</span> n=1,obc%number_of_segments</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    segment=&gt;obc%segment(n)</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <span class="keywordflow">if</span> (.not. segment%on_pe) cycle</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      i=segment%HI%IsdB</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;      <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        <span class="keywordflow">if</span> (obc%segnum_u(i,j) /= obc_none) any_u = .true.</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;      j=segment%HI%JsdB</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;      <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;        <span class="keywordflow">if</span> (obc%segnum_v(i,j) /= obc_none) any_v = .true.</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160; </div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;  obc%OBC_pe = .true.</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;  <span class="keywordflow">if</span> (.not.(any_u .or. any_v)) obc%OBC_pe = .false.</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l00065">obc_direction_e</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00064">obc_direction_s</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00066">obc_direction_w</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00058">obc_none</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__fixed__initialization_8F90_source.html#l00056">mom_fixed_initialization::mom_initialize_fixed()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a7aa6f2b520108ce761ef107557f69069_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="afc301353fde1f12ef04dab751ddb7ac2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc301353fde1f12ef04dab751ddb7ac2">&#9670;&nbsp;</a></span>open_boundary_impose_normal_slope()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::open_boundary_impose_normal_slope </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(dyn_horgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>depth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the slope of bathymetry normal to an open bounndary to zero. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary control structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">depth</td><td>Bathymetry at h-points </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l01594">1594</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),             <span class="keywordtype">pointer</span>       :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  <span class="keywordtype">type</span>(dyn_horgrid_type),           <span class="keywordtype">intent(in)</span>    :: G<span class="comment"> !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>, <span class="keywordtype">intent(inout)</span> :: depth<span class="comment"> !&lt; Bathymetry at h-points</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  <span class="keywordtype">integer</span> :: i, j, n</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment =&gt; null()</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160; </div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(obc)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160; </div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  <span class="keywordflow">if</span> (.not.(obc%specified_u_BCs_exist_globally .or. obc%specified_v_BCs_exist_globally .or. &amp;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;              obc%open_u_BCs_exist_globally .or. obc%open_v_BCs_exist_globally)) &amp;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160; </div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;  <span class="keywordflow">do</span> n=1,obc%number_of_segments</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    segment=&gt;obc%segment(n)</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    <span class="keywordflow">if</span> (.not. segment%on_pe) cycle</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="keywordflow">if</span> (segment%direction == obc_direction_e) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;      i=segment%HI%IsdB</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;      <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;        depth(i+1,j) = depth(i,j)</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    <span class="keywordflow">elseif</span> (segment%direction == obc_direction_w) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;      i=segment%HI%IsdB</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;      <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        depth(i,j) = depth(i+1,j)</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <span class="keywordflow">elseif</span> (segment%direction == obc_direction_n) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      j=segment%HI%JsdB</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;      <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        depth(i,j+1) = depth(i,j)</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;    <span class="keywordflow">elseif</span> (segment%direction == obc_direction_s) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;      j=segment%HI%JsdB</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;      <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;        depth(i,j) = depth(i,j+1)</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l00065">obc_direction_e</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00063">obc_direction_n</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00064">obc_direction_s</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00066">obc_direction_w</a>.</p>

</div>
</div>
<a id="a53dc87c231fcaf1c99fe818956fb111e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53dc87c231fcaf1c99fe818956fb111e">&#9670;&nbsp;</a></span>open_boundary_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::open_boundary_init </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(mom_restart_cs), pointer&#160;</td>
          <td class="paramname"><em>restart_CSp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize open boundary control structure and do any necessary rescaling of OBC fields that have been read from a restart file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Container for vertical grid information </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>Parameter file handle </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary control structure </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">restart_csp</td><td>Restart structure, data intent(inout) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l01479">1479</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),   <span class="keywordtype">intent(in)</span> :: G<span class="comment">   !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type), <span class="keywordtype">intent(in)</span> :: GV<span class="comment">  !&lt; Container for vertical grid information</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),   <span class="keywordtype">intent(in)</span> :: US<span class="comment">  !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; Parameter file handle</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),    <span class="keywordtype">pointer</span>    :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  <span class="keywordtype">type</span>(MOM_restart_CS),    <span class="keywordtype">pointer</span>    :: restart_CSp<span class="comment"> !&lt; Restart structure, data intent(inout)</span></div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160; </div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="keywordtype">  real</span> :: vel2_rescale <span class="comment">! A rescaling factor for squared velocities from the representation in</span></div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                       <span class="comment">! a restart file to the internal representation in this run.</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, isd, ied, jsd, jed, nz</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  <span class="keywordtype">integer</span> :: IsdB, IedB, JsdB, JedB</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  isd  = g%isd  ; ied  = g%ied  ; jsd  = g%jsd  ; jed  = g%jed ; nz = gv%ke</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  isdb = g%IsdB ; iedb = g%IedB ; jsdb = g%JsdB ; jedb = g%JedB</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160; </div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(obc)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160; </div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  id_clock_pass = cpu_clock_id(<span class="stringliteral">&#39;(Ocean OBC halo updates)&#39;</span>, grain=clock_routine)</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160; </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  <span class="comment">! The rx_normal and ry_normal arrays used with radiation OBCs are currently in units of grid</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  <span class="comment">! points per timestep, but if this were to be corrected to [L T-1 ~&gt; m s-1] or [T-1 ~&gt; s-1] to</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  <span class="comment">! permit timesteps to change between calls to the OBC code, the following would be needed:</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="comment">!  if ( OBC%radiation_BCs_exist_globally .and. (US%s_to_T_restart * US%m_to_L_restart /= 0.0) .and. &amp;</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="comment">!       ((US%m_to_L * US%s_to_T_restart) /= (US%m_to_L_restart * US%s_to_T)) ) then</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment">!    vel_rescale = (US%m_to_L * US%s_to_T_restart) /  (US%m_to_L_restart * US%s_to_T)</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment">!    if (query_initialized(OBC%rx_normal, &quot;rx_normal&quot;, restart_CSp)) then</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment">!      do k=1,nz ; do j=jsd,jed ; do I=IsdB,IedB</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment">!        OBC%rx_normal(I,j,k) = vel_rescale * OBC%rx_normal(I,j,k)</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">!      enddo ; enddo ; enddo</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">!    endif</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="comment">!    if (query_initialized(OBC%ry_normal, &quot;ry_normal&quot;, restart_CSp)) then</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="comment">!      do k=1,nz ; do J=JsdB,JedB ; do i=isd,ied</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="comment">!        OBC%ry_normal(i,J,k) = vel_rescale * OBC%ry_normal(i,J,k)</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="comment">!      enddo ; enddo ; enddo</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="comment">!    endif</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="comment">!  endif</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160; </div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;  <span class="comment">! The oblique boundary condition terms have units of [L2 T-2 ~&gt; m2 s-2] and may need to be rescaled.</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  <span class="keywordflow">if</span> ( obc%oblique_BCs_exist_globally .and. (us%s_to_T_restart * us%m_to_L_restart /= 0.0) .and. &amp;</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;       ((us%m_to_L * us%s_to_T_restart) /= (us%m_to_L_restart * us%s_to_T)) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    vel2_rescale = (us%m_to_L * us%s_to_T_restart)**2 /  (us%m_to_L_restart * us%s_to_T)**2</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <span class="keywordflow">if</span> (query_initialized(obc%rx_oblique, <span class="stringliteral">&quot;rx_oblique&quot;</span>, restart_csp)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;      <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=jsd,jed ; <span class="keywordflow">do</span> i=isdb,iedb</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        obc%rx_oblique(i,j,k) = vel2_rescale * obc%rx_oblique(i,j,k)</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <span class="keywordflow">if</span> (query_initialized(obc%ry_oblique, <span class="stringliteral">&quot;ry_oblique&quot;</span>, restart_csp)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=jsdb,jedb ; <span class="keywordflow">do</span> i=isd,ied</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        obc%ry_oblique(i,j,k) = vel2_rescale * obc%ry_oblique(i,j,k)</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keywordflow">if</span> (query_initialized(obc%cff_normal, <span class="stringliteral">&quot;cff_normal&quot;</span>, restart_csp)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;      <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=jsdb,jedb ; <span class="keywordflow">do</span> i=isdb,iedb</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        obc%cff_normal(i,j,k) = vel2_rescale * obc%cff_normal(i,j,k)</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l00301">id_clock_pass</a>.</p>

</div>
</div>
<a id="af55e663cc3a1f5f697e72066d75c9160"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af55e663cc3a1f5f697e72066d75c9160">&#9670;&nbsp;</a></span>open_boundary_query()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical function, public mom_open_boundary::open_boundary_query </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>apply_open_OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>apply_specified_OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>apply_Flather_OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>apply_nudged_OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>needs_ext_seg_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary control structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">apply_open_obc</td><td>Returns True if open_*_BCs_exist_globally is true</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">apply_specified_obc</td><td>Returns True if specified_*_BCs_exist_globally is true</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">apply_flather_obc</td><td>Returns True if Flather_*_BCs_exist_globally is true</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">apply_nudged_obc</td><td>Returns True if nudged_*_BCs_exist_globally is true</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">needs_ext_seg_data</td><td>Returns True if external segment data needed </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l01541">1541</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type), <span class="keywordtype">pointer</span>    :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,    <span class="keywordtype">intent(in)</span> :: apply_open_OBC<span class="comment">      !&lt; Returns True if open_*_BCs_exist_globally is true</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,    <span class="keywordtype">intent(in)</span> :: apply_specified_OBC<span class="comment"> !&lt; Returns True if specified_*_BCs_exist_globally is true</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,    <span class="keywordtype">intent(in)</span> :: apply_Flather_OBC<span class="comment">   !&lt; Returns True if Flather_*_BCs_exist_globally is true</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,    <span class="keywordtype">intent(in)</span> :: apply_nudged_OBC<span class="comment">    !&lt; Returns True if nudged_*_BCs_exist_globally is true</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>,    <span class="keywordtype">intent(in)</span> :: needs_ext_seg_data<span class="comment">  !&lt; Returns True if external segment data needed</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;  open_boundary_query = .false.</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(obc)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(apply_open_obc)) open_boundary_query = obc%open_u_BCs_exist_globally .or. &amp;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;                                                     obc%open_v_BCs_exist_globally</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(apply_specified_obc)) open_boundary_query = obc%specified_u_BCs_exist_globally .or. &amp;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;                                                          obc%specified_v_BCs_exist_globally</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(apply_flather_obc)) open_boundary_query = obc%Flather_u_BCs_exist_globally .or. &amp;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;                                                        obc%Flather_v_BCs_exist_globally</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(apply_nudged_obc)) open_boundary_query = obc%nudged_u_BCs_exist_globally .or. &amp;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;                                                       obc%nudged_v_BCs_exist_globally</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(needs_ext_seg_data)) open_boundary_query = obc%needs_IO_for_data</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l00317">open_boundary_config()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_af55e663cc3a1f5f697e72066d75c9160_icgraph.svg" width="368" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="af1d4f35b2cff85617fc5766739db81de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1d4f35b2cff85617fc5766739db81de">&#9670;&nbsp;</a></span>open_boundary_register_restarts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::open_boundary_register_restarts </td>
          <td>(</td>
          <td class="paramtype">type(hor_index_type), intent(in)&#160;</td>
          <td class="paramname"><em>HI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), pointer&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(tracer_registry_type), pointer&#160;</td>
          <td class="paramname"><em>Reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(mom_restart_cs), pointer&#160;</td>
          <td class="paramname"><em>restart_CSp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>use_temperature</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register OBC segment data for restarts. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">hi</td><td>Horizontal indices </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">gv</td><td>Container for vertical grid information </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>OBC data structure, data intent(inout) </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">reg</td><td>pointer to tracer registry </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>Parameter file handle </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">restart_csp</td><td>Restart structure, data intent(inout) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use_temperature</td><td>If true, T and S are used </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l04413">4413</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;  <span class="keywordtype">type</span>(hor_index_type),    <span class="keywordtype">intent(in)</span> :: HI<span class="comment"> !&lt; Horizontal indices</span></div>
<div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type), <span class="keywordtype">pointer</span>    :: GV<span class="comment"> !&lt; Container for vertical grid information</span></div>
<div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),    <span class="keywordtype">pointer</span>    :: OBC<span class="comment"> !&lt; OBC data structure, data intent(inout)</span></div>
<div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type), <span class="keywordtype">pointer</span> :: Reg<span class="comment"> !&lt; pointer to tracer registry</span></div>
<div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; Parameter file handle</span></div>
<div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;  <span class="keywordtype">type</span>(MOM_restart_CS),    <span class="keywordtype">pointer</span>    :: restart_CSp<span class="comment"> !&lt; Restart structure, data intent(inout)</span></div>
<div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;  <span class="keywordtype">logical</span>,                 <span class="keywordtype">intent(in)</span> :: use_temperature<span class="comment"> !&lt; If true, T and S are used</span></div>
<div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;  <span class="keywordtype">type</span>(vardesc) :: vd</div>
<div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;  <span class="keywordtype">integer</span>       :: m, n</div>
<div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;  <span class="keywordtype">character(len=100)</span> :: mesg</div>
<div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment=&gt;null()</div>
<div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160; </div>
<div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(obc)) &amp;</div>
<div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;       <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;open_boundary_register_restarts: Called with &quot;</span>//&amp;</div>
<div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;                      <span class="stringliteral">&quot;uninitialized OBC control structure&quot;</span>)</div>
<div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160; </div>
<div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc%rx_normal) .or. <span class="keyword">associated</span>(obc%ry_normal) .or. &amp;</div>
<div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;      <span class="keyword">associated</span>(obc%rx_oblique) .or. <span class="keyword">associated</span>(obc%ry_oblique) .or. <span class="keyword">associated</span>(obc%cff_normal)) &amp;</div>
<div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;       <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;open_boundary_register_restarts: Restart &quot;</span>//&amp;</div>
<div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;                      <span class="stringliteral">&quot;arrays were previously allocated&quot;</span>)</div>
<div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160; </div>
<div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc%tres_x) .or. <span class="keyword">associated</span>(obc%tres_y)) &amp;</div>
<div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;       <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;open_boundary_register_restarts: Restart &quot;</span>//&amp;</div>
<div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;                      <span class="stringliteral">&quot;arrays were previously allocated&quot;</span>)</div>
<div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160; </div>
<div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;  <span class="comment">! *** This is a temporary work around for restarts with OBC segments.</span></div>
<div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;  <span class="comment">! This implementation uses 3D arrays solely for restarts. We need</span></div>
<div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;  <span class="comment">! to be able to add 2D ( x,z or y,z ) data to restarts to avoid using</span></div>
<div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;  <span class="comment">! so much memory and disk space. ***</span></div>
<div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;  <span class="keywordflow">if</span> (obc%radiation_BCs_exist_globally) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;    <span class="keyword">allocate</span>(obc%rx_normal(hi%isdB:hi%iedB,hi%jsd:hi%jed,gv%ke))</div>
<div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;    obc%rx_normal(:,:,:) = 0.0</div>
<div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;    vd = var_desc(<span class="stringliteral">&quot;rx_normal&quot;</span>, <span class="stringliteral">&quot;m s-1&quot;</span>, <span class="stringliteral">&quot;Normal Phase Speed for EW radiation OBCs&quot;</span>, <span class="stringliteral">&#39;u&#39;</span>, <span class="stringliteral">&#39;L&#39;</span>)</div>
<div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;    <span class="keyword">call </span>register_restart_field(obc%rx_normal, vd, .false., restart_csp)</div>
<div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;    <span class="keyword">allocate</span>(obc%ry_normal(hi%isd:hi%ied,hi%jsdB:hi%jedB,gv%ke))</div>
<div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;    obc%ry_normal(:,:,:) = 0.0</div>
<div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;    vd = var_desc(<span class="stringliteral">&quot;ry_normal&quot;</span>, <span class="stringliteral">&quot;m s-1&quot;</span>, <span class="stringliteral">&quot;Normal Phase Speed for NS radiation OBCs&quot;</span>, <span class="stringliteral">&#39;v&#39;</span>, <span class="stringliteral">&#39;L&#39;</span>)</div>
<div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;    <span class="keyword">call </span>register_restart_field(obc%ry_normal, vd, .false., restart_csp)</div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;  <span class="keywordflow">if</span> (obc%oblique_BCs_exist_globally) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;    <span class="keyword">allocate</span>(obc%rx_oblique(hi%isdB:hi%iedB,hi%jsd:hi%jed,gv%ke))</div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;    obc%rx_oblique(:,:,:) = 0.0</div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;    vd = var_desc(<span class="stringliteral">&quot;rx_oblique&quot;</span>, <span class="stringliteral">&quot;m2 s-2&quot;</span>, <span class="stringliteral">&quot;Radiation Speed Squared for EW oblique OBCs&quot;</span>, <span class="stringliteral">&#39;u&#39;</span>, <span class="stringliteral">&#39;L&#39;</span>)</div>
<div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;    <span class="keyword">call </span>register_restart_field(obc%rx_oblique, vd, .false., restart_csp)</div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;    <span class="keyword">allocate</span>(obc%ry_oblique(hi%isd:hi%ied,hi%jsdB:hi%jedB,gv%ke))</div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;    obc%ry_oblique(:,:,:) = 0.0</div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;    vd = var_desc(<span class="stringliteral">&quot;ry_oblique&quot;</span>, <span class="stringliteral">&quot;m2 s-2&quot;</span>, <span class="stringliteral">&quot;Radiation Speed Squared for NS oblique OBCs&quot;</span>, <span class="stringliteral">&#39;v&#39;</span>, <span class="stringliteral">&#39;L&#39;</span>)</div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;    <span class="keyword">call </span>register_restart_field(obc%ry_oblique, vd, .false., restart_csp)</div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;    <span class="keyword">allocate</span>(obc%cff_normal(hi%IsdB:hi%IedB,hi%jsdB:hi%jedB,gv%ke))</div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;    obc%cff_normal(:,:,:) = 0.0</div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;    vd = var_desc(<span class="stringliteral">&quot;cff_normal&quot;</span>, <span class="stringliteral">&quot;m2 s-2&quot;</span>, <span class="stringliteral">&quot;denominator for oblique OBCs&quot;</span>, <span class="stringliteral">&#39;q&#39;</span>, <span class="stringliteral">&#39;L&#39;</span>)</div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;    <span class="keyword">call </span>register_restart_field(obc%cff_normal, vd, .false., restart_csp)</div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160; </div>
<div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;  <span class="keywordflow">if</span> (reg%ntr == 0) <span class="keywordflow">return</span></div>
<div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(obc%tracer_x_reservoirs_used)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;    obc%ntr = reg%ntr</div>
<div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;    <span class="keyword">allocate</span>(obc%tracer_x_reservoirs_used(reg%ntr))</div>
<div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;    <span class="keyword">allocate</span>(obc%tracer_y_reservoirs_used(reg%ntr))</div>
<div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;    obc%tracer_x_reservoirs_used(:) = .false.</div>
<div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;    obc%tracer_y_reservoirs_used(:) = .false.</div>
<div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;    <span class="keyword">call </span>parse_for_tracer_reservoirs(obc, param_file, use_temperature)</div>
<div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;    <span class="comment">! This would be coming from user code such as DOME.</span></div>
<div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;    <span class="keywordflow">if</span> (obc%ntr /= reg%ntr) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;<span class="comment">!        call MOM_error(FATAL, &quot;open_boundary_regiser_restarts: Inconsistent value for ntr&quot;)</span></div>
<div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;      <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;Inconsistent values for ntr &quot;, I8,&quot; and &quot;,I8,&quot;.&quot;)&#39;</span>) obc%ntr, reg%ntr</div>
<div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;      <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&#39;open_boundary_register_restarts: &#39;</span>//mesg)</div>
<div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160; </div>
<div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;  <span class="comment">! Still painfully inefficient, now in four dimensions.</span></div>
<div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;  <span class="keywordflow">if</span> (any(obc%tracer_x_reservoirs_used)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;    <span class="keyword">allocate</span>(obc%tres_x(hi%isdB:hi%iedB,hi%jsd:hi%jed,gv%ke,obc%ntr))</div>
<div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;    obc%tres_x(:,:,:,:) = 0.0</div>
<div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;    <span class="keywordflow">do</span> m=1,obc%ntr</div>
<div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;      <span class="keywordflow">if</span> (obc%tracer_x_reservoirs_used(m)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;        <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;tres_x_&quot;,I3.3)&#39;</span>) m</div>
<div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;        vd = var_desc(mesg,<span class="stringliteral">&quot;Conc&quot;</span>, <span class="stringliteral">&quot;Tracer concentration for EW OBCs&quot;</span>,<span class="stringliteral">&#39;u&#39;</span>,<span class="stringliteral">&#39;L&#39;</span>)</div>
<div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;        <span class="keyword">call </span>register_restart_field(obc%tres_x(:,:,:,m), vd, .false., restart_csp)</div>
<div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;  <span class="keywordflow">if</span> (any(obc%tracer_y_reservoirs_used)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;    <span class="keyword">allocate</span>(obc%tres_y(hi%isd:hi%ied,hi%jsdB:hi%jedB,gv%ke,obc%ntr))</div>
<div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;    obc%tres_y(:,:,:,:) = 0.0</div>
<div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;    <span class="keywordflow">do</span> m=1,obc%ntr</div>
<div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;      <span class="keywordflow">if</span> (obc%tracer_y_reservoirs_used(m)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;        <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;tres_y_&quot;,I3.3)&#39;</span>) m</div>
<div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;        vd = var_desc(mesg,<span class="stringliteral">&quot;Conc&quot;</span>, <span class="stringliteral">&quot;Tracer concentration for NS OBCs&quot;</span>,<span class="stringliteral">&#39;v&#39;</span>,<span class="stringliteral">&#39;L&#39;</span>)</div>
<div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;        <span class="keyword">call </span>register_restart_field(obc%tres_y(:,:,:,m), vd, .false., restart_csp)</div>
<div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l01332">parse_for_tracer_reservoirs()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_af1d4f35b2cff85617fc5766739db81de_cgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a4123d11abdb141b21a4d52a0c43c4adb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4123d11abdb141b21a4d52a0c43c4adb">&#9670;&nbsp;</a></span>open_boundary_test_extern_h()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::open_boundary_test_extern_h </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  gv %ke), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set thicknesses outside of open boundaries to silly values (used for checking the interior state is independent of values outside of the domain). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Ocean vertical grid structure </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Layer thickness [H ~&gt; m or kg m-2] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l03357">3357</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(in)</span>    :: G<span class="comment">   !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type),                   <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">  !&lt;  Ocean vertical grid structure</span></div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),                      <span class="keywordtype">pointer</span>       :: OBC<span class="comment"> !&lt; Open boundary structure</span></div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(GV))</span>,<span class="keywordtype">intent(inout)</span> :: h<span class="comment">   !&lt; Layer thickness [H ~&gt; m or kg m-2]</span></div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;<span class="keywordtype">  real</span> :: silly_h  <span class="comment">! A silly thickness for testing [H ~&gt; m or kg m-2]</span></div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, n</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160; </div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(obc)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160; </div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;  silly_h = gv%Z_to_H*obc%silly_h</div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160; </div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;  <span class="keywordflow">do</span> n = 1, obc%number_of_segments</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;    <span class="keywordflow">do</span> k = 1, gv%ke</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;      <span class="keywordflow">if</span> (obc%segment(n)%is_N_or_S) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;        j = obc%segment(n)%HI%JsdB</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;        <span class="keywordflow">if</span> (obc%segment(n)%direction == obc_direction_n) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;          <span class="keywordflow">do</span> i = obc%segment(n)%HI%isd, obc%segment(n)%HI%ied</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;            h(i,j+1,k) = silly_h</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;          <span class="keywordflow">do</span> i = obc%segment(n)%HI%isd, obc%segment(n)%HI%ied</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;            h(i,j,k) = silly_h</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;      <span class="keywordflow">elseif</span> (obc%segment(n)%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;        i = obc%segment(n)%HI%IsdB</div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;        <span class="keywordflow">if</span> (obc%segment(n)%direction == obc_direction_e) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;          <span class="keywordflow">do</span> j = obc%segment(n)%HI%jsd, obc%segment(n)%HI%jed</div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;            h(i+1,j,k) = silly_h</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;          <span class="keywordflow">do</span> j = obc%segment(n)%HI%jsd, obc%segment(n)%HI%jed</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;            h(i,j,k) = silly_h</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l00065">obc_direction_e</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00063">obc_direction_n</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__dynamics__split__RK2_8F90_source.html#l00239">mom_dynamics_split_rk2::step_mom_dyn_split_rk2()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a4123d11abdb141b21a4d52a0c43c4adb_icgraph.svg" width="455" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a556977a2754fab17e837a8fba75cd9ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a556977a2754fab17e837a8fba75cd9ee">&#9670;&nbsp;</a></span>open_boundary_test_extern_uv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::open_boundary_test_extern_uv </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isdb: g %iedb, g %jsd: g %jed,  g %ke), intent(inout)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsdb: g %jedb,  g %ke), intent(inout)&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set tangential velocities outside of open boundaries to silly values (used for checking the interior state is independent of values outside of the domain). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">u</td><td>Zonal velocity [L T-1 ~&gt; m s-1] </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v</td><td>Meridional velocity [L T-1 ~&gt; m s-1] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l03314">3314</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(in)</span>    :: G<span class="comment"> !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),                      <span class="keywordtype">pointer</span>       :: OBC<span class="comment"> !&lt; Open boundary structure</span></div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G), SZK_(G))</span>,<span class="keywordtype">intent(inout)</span> :: u<span class="comment"> !&lt; Zonal velocity [L T-1 ~&gt; m s-1]</span></div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G), SZK_(G))</span>,<span class="keywordtype">intent(inout)</span> :: v<span class="comment"> !&lt; Meridional velocity [L T-1 ~&gt; m s-1]</span></div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, n</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160; </div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(obc)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160; </div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;  <span class="keywordflow">do</span> n = 1, obc%number_of_segments</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;    <span class="keywordflow">do</span> k = 1, g%ke</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;      <span class="keywordflow">if</span> (obc%segment(n)%is_N_or_S) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;        j = obc%segment(n)%HI%JsdB</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;        <span class="keywordflow">if</span> (obc%segment(n)%direction == obc_direction_n) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;          <span class="keywordflow">do</span> i = obc%segment(n)%HI%IsdB, obc%segment(n)%HI%IedB</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;            u(i,j+1,k) = obc%silly_u</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;          <span class="keywordflow">do</span> i = obc%segment(n)%HI%IsdB, obc%segment(n)%HI%IedB</div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;            u(i,j,k) = obc%silly_u</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;      <span class="keywordflow">elseif</span> (obc%segment(n)%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;        i = obc%segment(n)%HI%IsdB</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;        <span class="keywordflow">if</span> (obc%segment(n)%direction == obc_direction_e) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;          <span class="keywordflow">do</span> j = obc%segment(n)%HI%JsdB, obc%segment(n)%HI%JedB</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;            v(i+1,j,k) = obc%silly_u</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;          <span class="keywordflow">do</span> j = obc%segment(n)%HI%JsdB, obc%segment(n)%HI%JedB</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;            v(i,j,k) = obc%silly_u</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l00065">obc_direction_e</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00063">obc_direction_n</a>.</p>

</div>
</div>
<a id="a9d48e6925d93fa98cbf5bb73903f94be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d48e6925d93fa98cbf5bb73903f94be">&#9670;&nbsp;</a></span>open_boundary_zero_normal_flow()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::open_boundary_zero_normal_flow </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Applies zero values to 3d u,v fields on OBC segments. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary control structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">u</td><td>u field to update on open boundaries </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v</td><td>v field to update on open boundaries </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l02934">2934</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;  <span class="comment">! Arguments</span></div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),                      <span class="keywordtype">pointer</span>       :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(inout)</span> :: G<span class="comment">   !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: u<span class="comment">   !&lt; u field to update on open boundaries</span></div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: v<span class="comment">   !&lt; v field to update on open boundaries</span></div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, n</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment =&gt; null()</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160; </div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(obc)) <span class="keywordflow">return</span> <span class="comment">! Bail out if OBC is not available</span></div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160; </div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;  <span class="keywordflow">do</span> n=1,obc%number_of_segments</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;    segment =&gt; obc%segment(n)</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <span class="keywordflow">if</span> (.not. segment%on_pe) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;      cycle</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;    <span class="keywordflow">elseif</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;      i=segment%HI%IsdB</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;      <span class="keywordflow">do</span> k=1,g%ke ;  <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;        u(i,j,k) = 0.</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;    <span class="keywordflow">elseif</span> (segment%is_N_or_S) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;      j=segment%HI%JsdB</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;      <span class="keywordflow">do</span> k=1,g%ke ;  <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        v(i,j,k) = 0.</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__dynamics__unsplit_8F90_source.html#l00188">mom_dynamics_unsplit::step_mom_dyn_unsplit()</a>, and <a class="el" href="MOM__dynamics__unsplit__RK2_8F90_source.html#l00191">mom_dynamics_unsplit_rk2::step_mom_dyn_unsplit_rk2()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a9d48e6925d93fa98cbf5bb73903f94be_icgraph.svg" width="492" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a2e2dbab2a3e23eb9848aba473f635cec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e2dbab2a3e23eb9848aba473f635cec">&#9670;&nbsp;</a></span>parse_for_tracer_reservoirs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::parse_for_tracer_reservoirs </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>PF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>use_temperature</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse all the OBC_SEGMENT_%%_DATA strings again to see which need tracer reservoirs (all pes need to know). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">obc</td><td>Open boundary control structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pf</td><td>Parameter file handle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use_temperature</td><td>If true, T and S are used </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l01332">1332</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),   <span class="keywordtype">intent(inout)</span> :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  <span class="keywordtype">type</span>(param_file_type),  <span class="keywordtype">intent(in)</span>    :: PF<span class="comment">  !&lt; Parameter file handle</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <span class="keywordtype">logical</span>,                <span class="keywordtype">intent(in)</span> :: use_temperature<span class="comment"> !&lt; If true, T and S are used</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160; </div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <span class="keywordtype">integer</span> :: n,m,num_fields</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <span class="keywordtype">character(len=256)</span> :: segstr, filename</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  <span class="keywordtype">character(len=20)</span>  :: segnam, suffix</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  <span class="keywordtype">character(len=32)</span>  :: varnam, fieldname</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="keywordtype">  real</span>               :: value</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  <span class="keywordtype">character(len=32)</span>, <span class="keywordtype">dimension(MAX_OBC_FIELDS)</span> :: fields  <span class="comment">! segment field names</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment =&gt; null() <span class="comment">! pointer to segment type list</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  <span class="keywordtype">character(len=256)</span> :: mesg    <span class="comment">! Message for error messages.</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160; </div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  <span class="keywordflow">do</span> n=1, obc%number_of_segments</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    segment =&gt; obc%segment(n)</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <span class="keyword">write</span>(segnam,<span class="stringliteral">&quot;(&#39;OBC_SEGMENT_&#39;,i3.3,&#39;_DATA&#39;)&quot;</span>) n</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="keyword">write</span>(suffix,<span class="stringliteral">&quot;(&#39;_segment_&#39;,i3.3)&quot;</span>) n</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <span class="comment">! Clear out any old values</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    segstr = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="keyword">call </span>get_param(pf, mdl, segnam, segstr)</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="keywordflow">if</span> (segstr == <span class="stringliteral">&#39;&#39;</span>) cycle</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160; </div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <span class="keyword">call </span>parse_segment_data_str(trim(segstr), fields=fields, num_fields=num_fields)</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <span class="keywordflow">if</span> (num_fields == 0) cycle</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160; </div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <span class="comment">! At this point, just search for TEMP and SALT as tracers 1 and 2.</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    <span class="keywordflow">do</span> m=1,num_fields</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;      <span class="keyword">call </span>parse_segment_data_str(trim(segstr), var=trim(fields(m)), <span class="keywordtype">value</span>=<span class="keywordtype">value</span>, filenam=filename, fieldnam=fieldname)</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      <span class="keywordflow">if</span> (trim(filename) /= <span class="stringliteral">&#39;none&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        <span class="keywordflow">if</span> (fields(m) == <span class="stringliteral">&#39;TEMP&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;          <span class="keywordflow">if</span> (segment%is_E_or_W_2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;            obc%tracer_x_reservoirs_used(1) = .true.</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;            obc%tracer_y_reservoirs_used(1) = .true.</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        <span class="keywordflow">if</span> (fields(m) == <span class="stringliteral">&#39;SALT&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;          <span class="keywordflow">if</span> (segment%is_E_or_W_2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;            obc%tracer_x_reservoirs_used(2) = .true.</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;            obc%tracer_y_reservoirs_used(2) = .true.</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="comment">! Alternately, set first two to true if use_temperature is true</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <span class="keywordflow">if</span> (use_temperature) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      <span class="keywordflow">if</span> (segment%is_E_or_W_2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        obc%tracer_x_reservoirs_used(1) = .true.</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        obc%tracer_x_reservoirs_used(2) = .true.</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        obc%tracer_y_reservoirs_used(1) = .true.</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        obc%tracer_y_reservoirs_used(2) = .true.</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160; </div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  <span class="keywordflow">return</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l00303">mdl</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l01243">parse_segment_data_str()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l04413">open_boundary_register_restarts()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a2e2dbab2a3e23eb9848aba473f635cec_cgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a2e2dbab2a3e23eb9848aba473f635cec_icgraph.svg" width="399" height="67"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a0aee21537ad757ce15e602d8fd55eb4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0aee21537ad757ce15e602d8fd55eb4d">&#9670;&nbsp;</a></span>parse_segment_data_str()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::parse_segment_data_str </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>segment_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in), optional&#160;</td>
          <td class="paramname"><em>var</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out), optional&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(out), optional&#160;</td>
          <td class="paramname"><em>filenam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(out), optional&#160;</td>
          <td class="paramname"><em>fieldnam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), dimension(<a class="el" href="namespacemom__open__boundary.html#a6997b7b50a4afe32b14fd61ba858254f">max_obc_fields</a>), intent(out), optional&#160;</td>
          <td class="paramname"><em>fields</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out), optional&#160;</td>
          <td class="paramname"><em>num_fields</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>debug</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse an OBC_SEGMENT_%%_DATA string. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">segment_str</td><td>A string in form of "VAR1=file:foo1.nc(varnam1),VAR2=file:foo2.nc(varnam2),..." </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">var</td><td>The name of the variable for which parameters are needed </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">filenam</td><td>The name of the input file if using "file" method </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fieldnam</td><td>The name of the variable in the input file if using "file" method </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">value</td><td>A constant value if using the "value" method </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fields</td><td>List of fieldnames for each segment </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">num_fields</td><td>The number of fields in the segment data </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">debug</td><td>If present and true, write verbose debugging messages </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l01243">1243</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;   <span class="keywordtype">character(len=*)</span>,           <span class="keywordtype">intent(in)</span>   :: segment_str<span class="comment"> !&lt; A string in form of</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="comment">                                                          !! &quot;VAR1=file:foo1.nc(varnam1),VAR2=file:foo2.nc(varnam2),...&quot;</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;   <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>   :: var<span class="comment">        !&lt; The name of the variable for which parameters are needed</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;   <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(out)</span>  :: filenam<span class="comment">    !&lt; The name of the input file if using &quot;file&quot; method</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;   <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(out)</span>  :: fieldnam<span class="comment">   !&lt; The name of the variable in the input file if using</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment">                                                          !! &quot;file&quot; method</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="keywordtype">   real</span>,             <span class="keywordtype">optional</span>, <span class="keywordtype">intent(out)</span>  :: <span class="keywordtype">value</span><span class="comment">      !&lt; A constant value if using the &quot;value&quot; method</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;   <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">dimension(MAX_OBC_FIELDS)</span>, &amp;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                     <span class="keywordtype">optional</span>, <span class="keywordtype">intent(out)</span>  :: fields<span class="comment">     !&lt; List of fieldnames for each segment</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;   <span class="keywordtype">integer</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(out)</span>           :: num_fields<span class="comment"> !&lt; The number of fields in the segment data</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>            :: debug<span class="comment">      !&lt; If present and true, write verbose debugging messages</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;   <span class="comment">! Local variables</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;   <span class="keywordtype">character(len=128)</span> :: word1, word2, word3, method</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;   <span class="keywordtype">integer</span> :: lword, nfields, n, m</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;   <span class="keywordtype">logical</span> :: continue,dbg</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;   <span class="keywordtype">character(len=32)</span>, <span class="keywordtype">dimension(MAX_OBC_FIELDS)</span> :: flds</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160; </div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;   nfields=0</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;   continue=.true.</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;   dbg=.false.</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">PRESENT</span>(debug)) dbg=debug</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160; </div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;   <span class="keywordflow">do</span> <span class="keywordflow">while</span> (continue)</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;      word1 = extract_word(segment_str,<span class="stringliteral">&#39;,&#39;</span>,nfields+1)</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;      <span class="keywordflow">if</span> (trim(word1) == <span class="stringliteral">&#39;&#39;</span>) <span class="keywordflow">exit</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      nfields=nfields+1</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      word2 = extract_word(word1,<span class="stringliteral">&#39;=&#39;</span>,1)</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      flds(nfields) = trim(word2)</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160; </div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">PRESENT</span>(fields)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;     <span class="keywordflow">do</span> n=1,nfields</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;       fields(n) = flds(n)</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="keywordflow">     enddo</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160; </div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">PRESENT</span>(num_fields)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      num_fields=nfields</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="keywordflow">   endif</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160; </div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;   m=0</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">PRESENT</span>(var)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;     <span class="keywordflow">do</span> n=1,nfields</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;       <span class="keywordflow">if</span> (trim(var)==trim(flds(n))) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;          m=n</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;          <span class="keywordflow">exit</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="keywordflow">     enddo</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;     <span class="keywordflow">if</span> (m==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        <span class="keyword">call </span>abort()</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160; </div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="comment">! Process first word which will start with the fieldname</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;     word3 = extract_word(segment_str,<span class="stringliteral">&#39;,&#39;</span>,m)</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;     word1 = extract_word(word3,<span class="stringliteral">&#39;:&#39;</span>,1)</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment">!     if (trim(word1) == &#39;&#39;) exit</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;     word2 = extract_word(word1,<span class="stringliteral">&#39;=&#39;</span>,1)</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;     <span class="keywordflow">if</span> (trim(word2) == trim(var)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        method=trim(extract_word(word1,<span class="stringliteral">&#39;=&#39;</span>,2))</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        lword=len_trim(method)</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        <span class="keywordflow">if</span> (method(lword-3:lword) == <span class="stringliteral">&#39;file&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;           <span class="comment">! raise an error id filename/fieldname not in argument list</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;           word1 = extract_word(word3,<span class="stringliteral">&#39;:&#39;</span>,2)</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;           filenam = extract_word(word1,<span class="stringliteral">&#39;(&#39;</span>,1)</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;           fieldnam = extract_word(word1,<span class="stringliteral">&#39;(&#39;</span>,2)</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;           lword=len_trim(fieldnam)</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;           fieldnam = fieldnam(1:lword-1)  <span class="comment">! remove trailing parenth</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;           <span class="keywordtype">value</span>=-999.</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        <span class="keywordflow">elseif</span> (method(lword-4:lword) == <span class="stringliteral">&#39;value&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;           filenam = <span class="stringliteral">&#39;none&#39;</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;           fieldnam = <span class="stringliteral">&#39;none&#39;</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;           word1 = extract_word(word3,<span class="stringliteral">&#39;:&#39;</span>,2)</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;           lword=len_trim(word1)</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;           <span class="keyword">read</span>(word1(1:lword),*,<span class="keyword">end</span>=986,err=987) value</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160; </div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;   <span class="keywordflow">return</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160; 986 <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&#39;End of record while parsing segment data specification! &#39;</span>//trim(segment_str))</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160; 987 <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&#39;Error while parsing segment data specification! &#39;</span>//trim(segment_str))</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__string__functions_8F90_source.html#l00207">mom_string_functions::extract_word()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l00541">initialize_segment_data()</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l01332">parse_for_tracer_reservoirs()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a0aee21537ad757ce15e602d8fd55eb4d_cgraph.svg" width="564" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a0aee21537ad757ce15e602d8fd55eb4d_icgraph.svg" width="612" height="134"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a349df847b304948d5b98352ddfd7bf8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a349df847b304948d5b98352ddfd7bf8d">&#9670;&nbsp;</a></span>parse_segment_param_real()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::parse_segment_param_real </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>segment_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>var</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>param_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>debug</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse an OBC_SEGMENT_%%_PARAMS string. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">segment_str</td><td>A string in form of "VAR1=file:foo1.nc(varnam1),VAR2=file:foo2.nc(varnam2),..." </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">var</td><td>The name of the variable for which parameters are needed </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">param_value</td><td>The value of the parameter </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">debug</td><td>If present and true, write verbose debugging messages </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l01396">1396</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;   <span class="keywordtype">character(len=*)</span>,  <span class="keywordtype">intent(in)</span>  :: segment_str<span class="comment"> !&lt; A string in form of</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="comment">                                                 !! &quot;VAR1=file:foo1.nc(varnam1),VAR2=file:foo2.nc(varnam2),...&quot;</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;   <span class="keywordtype">character(len=*)</span>,  <span class="keywordtype">intent(in)</span>  :: var<span class="comment">         !&lt; The name of the variable for which parameters are needed</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="keywordtype">   real</span>,              <span class="keywordtype">intent(out)</span> :: param_value<span class="comment"> !&lt; The value of the parameter</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;   <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>  :: debug<span class="comment">       !&lt; If present and true, write verbose debugging messages</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;   <span class="comment">! Local variables</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;   <span class="keywordtype">character(len=128)</span> :: word1, word2, word3, method</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;   <span class="keywordtype">integer</span> :: lword, nfields, n, m</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;   <span class="keywordtype">logical</span> :: continue,dbg</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;   <span class="keywordtype">character(len=32)</span>, <span class="keywordtype">dimension(MAX_OBC_FIELDS)</span> :: flds</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160; </div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;   nfields=0</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;   continue=.true.</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;   dbg=.false.</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;   <span class="keywordflow">if</span> (<span class="keyword">PRESENT</span>(debug)) dbg=debug</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160; </div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;   <span class="keywordflow">do</span> <span class="keywordflow">while</span> (continue)</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      word1 = extract_word(segment_str,<span class="stringliteral">&#39;,&#39;</span>,nfields+1)</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      <span class="keywordflow">if</span> (trim(word1) == <span class="stringliteral">&#39;&#39;</span>) <span class="keywordflow">exit</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;      nfields=nfields+1</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      word2 = extract_word(word1,<span class="stringliteral">&#39;=&#39;</span>,1)</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      flds(nfields) = trim(word2)</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="keywordflow">   enddo</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160; </div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;   <span class="comment">! if (PRESENT(fields)) then</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;   <span class="comment">!   do n=1,nfields</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;   <span class="comment">!     fields(n) = flds(n)</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;   <span class="comment">!   enddo</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;   <span class="comment">! endif</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160; </div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;   <span class="comment">! if (PRESENT(num_fields)) then</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;   <span class="comment">!    num_fields=nfields</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;   <span class="comment">!    return</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;   <span class="comment">! endif</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160; </div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;   m=0</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="comment">!   if (PRESENT(var)) then</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;     <span class="keywordflow">do</span> n=1,nfields</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;       <span class="keywordflow">if</span> (trim(var)==trim(flds(n))) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;          m=n</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;          <span class="keywordflow">exit</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="keywordflow">     enddo</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;     <span class="keywordflow">if</span> (m==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        <span class="keyword">call </span>abort()</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160; </div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="comment">! Process first word which will start with the fieldname</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;     word3 = extract_word(segment_str,<span class="stringliteral">&#39;,&#39;</span>,m)</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment">!     word1 = extract_word(word3,&#39;:&#39;,1)</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment">!     if (trim(word1) == &#39;&#39;) exit</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;     word2 = extract_word(word1,<span class="stringliteral">&#39;=&#39;</span>,1)</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;     <span class="keywordflow">if</span> (trim(word2) == trim(var)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        method=trim(extract_word(word1,<span class="stringliteral">&#39;=&#39;</span>,2))</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        lword=len_trim(method)</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        <span class="keyword">read</span>(method(1:lword),*,err=987) param_value</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        <span class="comment">! if (method(lword-3:lword) == &#39;file&#39;) then</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        <span class="comment">!    ! raise an error id filename/fieldname not in argument list</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        <span class="comment">!    word1 = extract_word(word3,&#39;:&#39;,2)</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        <span class="comment">!    filenam = extract_word(word1,&#39;(&#39;,1)</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="comment">!    fieldnam = extract_word(word1,&#39;(&#39;,2)</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        <span class="comment">!    lword=len_trim(fieldnam)</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        <span class="comment">!    fieldnam = fieldnam(1:lword-1)  ! remove trailing parenth</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        <span class="comment">!    value=-999.</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        <span class="comment">! elseif (method(lword-4:lword) == &#39;value&#39;) then</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        <span class="comment">!    filenam = &#39;none&#39;</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        <span class="comment">!    fieldnam = &#39;none&#39;</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;        <span class="comment">!    word1 = extract_word(word3,&#39;:&#39;,2)</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        <span class="comment">!    lword=len_trim(word1)</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        <span class="comment">!    read(word1(1:lword),*,end=986,err=987) value</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;        <span class="comment">! endif</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="comment">!    endif</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160; </div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;   <span class="keywordflow">return</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160; 986 <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&#39;End of record while parsing segment data specification! &#39;</span>//trim(segment_str))</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160; 987 <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&#39;Error while parsing segment parameter specification! &#39;</span>//trim(segment_str))</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="a0eb361009a2dddf3ad9a24d0d7223898"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0eb361009a2dddf3ad9a24d0d7223898">&#9670;&nbsp;</a></span>parse_segment_str()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::parse_segment_str </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ni_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nj_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>segment_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>action_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>reentrant</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse an OBC_SEGMENT_%%% string. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ni_global</td><td>Number of h-points in zonal direction </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nj_global</td><td>Number of h-points in meridional direction </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">segment_str</td><td>A string in form of "I=l,J=m:n,string" or "J=l,I=m,n,string" </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">l</td><td>The value of I=l, if segment_str begins with I=l, or the value of J=l </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">m</td><td>The value of J=m, if segment_str begins with I=, or the value of I=m </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">n</td><td>The value of J=n, if segment_str begins with I=, or the value of I=n </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">action_str</td><td>The "string" part of segment_str </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reentrant</td><td>is domain reentrant in relevant direction? </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l01129">1129</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  <span class="keywordtype">integer</span>,          <span class="keywordtype">intent(in)</span>  :: ni_global<span class="comment"> !&lt; Number of h-points in zonal direction</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  <span class="keywordtype">integer</span>,          <span class="keywordtype">intent(in)</span>  :: nj_global<span class="comment"> !&lt; Number of h-points in meridional direction</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>  :: segment_str<span class="comment"> !&lt; A string in form of &quot;I=l,J=m:n,string&quot; or &quot;J=l,I=m,n,string&quot;</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  <span class="keywordtype">integer</span>,          <span class="keywordtype">intent(out)</span> :: l<span class="comment"> !&lt; The value of I=l, if segment_str begins with I=l, or the value of J=l</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  <span class="keywordtype">integer</span>,          <span class="keywordtype">intent(out)</span> :: m<span class="comment"> !&lt; The value of J=m, if segment_str begins with I=, or the value of I=m</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  <span class="keywordtype">integer</span>,          <span class="keywordtype">intent(out)</span> :: n<span class="comment"> !&lt; The value of J=n, if segment_str begins with I=, or the value of I=n</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(out)</span> :: action_str(:)<span class="comment"> !&lt; The &quot;string&quot; part of segment_str</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  <span class="keywordtype">logical</span>,          <span class="keywordtype">intent(in)</span>  :: reentrant<span class="comment"> !&lt; is domain reentrant in relevant direction?</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;  <span class="keywordtype">character(len=24)</span> :: word1, word2, m_word, n_word<span class="comment"> !&lt; Words delineated by commas in a string in form of</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">                                                    !! &quot;I=%,J=%:%,string&quot;</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  <span class="keywordtype">integer</span> :: l_max<span class="comment"> !&lt; Either ni_global or nj_global, depending on whether segment_str begins with &quot;I=&quot; or &quot;J=&quot;</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  <span class="keywordtype">integer</span> :: mn_max<span class="comment"> !&lt; Either nj_global or ni_global, depending on whether segment_str begins with &quot;I=&quot; or &quot;J=&quot;</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  <span class="keywordtype">integer</span> :: j</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: halo = 10</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160; </div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  <span class="comment">! Process first word which will started with either &#39;I=&#39; or &#39;J=&#39;</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  word1 = extract_word(segment_str,<span class="stringliteral">&#39;,&#39;</span>,1)</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  word2 = extract_word(segment_str,<span class="stringliteral">&#39;,&#39;</span>,2)</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  <span class="keywordflow">if</span> (word1(1:2)==<span class="stringliteral">&#39;I=&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    l_max = ni_global</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    mn_max = nj_global</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keywordflow">if</span> (.not. (word2(1:2)==<span class="stringliteral">&#39;J=&#39;</span>)) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, parse_segment_str: &quot;</span>//&amp;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                     <span class="stringliteral">&quot;Second word of string &#39;&quot;</span>//trim(segment_str)//<span class="stringliteral">&quot;&#39; must start with &#39;J=&#39;.&quot;</span>)</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  <span class="keywordflow">elseif</span> (word1(1:2)==<span class="stringliteral">&#39;J=&#39;</span>) <span class="keywordflow">then</span> <span class="comment">! Note that the file_parser uniformaly expands &quot;=&quot; to &quot; = &quot;</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    l_max = nj_global</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    mn_max = ni_global</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <span class="keywordflow">if</span> (.not. (word2(1:2)==<span class="stringliteral">&#39;I=&#39;</span>)) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, parse_segment_str: &quot;</span>//&amp;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;                     <span class="stringliteral">&quot;Second word of string &#39;&quot;</span>//trim(segment_str)//<span class="stringliteral">&quot;&#39; must start with &#39;I=&#39;.&quot;</span>)</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, parse_segment_str&quot;</span>//&amp;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;                   <span class="stringliteral">&quot;String &#39;&quot;</span>//segment_str//<span class="stringliteral">&quot;&#39; must start with &#39;I=&#39; or &#39;J=&#39;.&quot;</span>)</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160; </div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="comment">! Read l</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  l = <a class="code" href="MOM__open__boundary_8F90.html#a0793b1a5746e6ead6bff50c3a52cae90">interpret_int_expr</a>( word1(3:24), l_max )</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="keywordflow">if</span> (l&lt;0 .or. l&gt;l_max) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, parse_segment_str: &quot;</span>//&amp;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                   <span class="stringliteral">&quot;First value from string &#39;&quot;</span>//trim(segment_str)//<span class="stringliteral">&quot;&#39; is outside of the physical domain.&quot;</span>)</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="comment">! Read m</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  m_word = extract_word(word2(3:24),<span class="stringliteral">&#39;:&#39;</span>,1)</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  m = <a class="code" href="MOM__open__boundary_8F90.html#a0793b1a5746e6ead6bff50c3a52cae90">interpret_int_expr</a>( m_word, mn_max )</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="keywordflow">if</span> (reentrant) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="keywordflow">if</span> (m&lt;-halo .or. m&gt;mn_max+halo) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, parse_segment_str: &quot;</span>//&amp;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                     <span class="stringliteral">&quot;Beginning of range in string &#39;&quot;</span>//trim(segment_str)//<span class="stringliteral">&quot;&#39; is outside of the physical domain.&quot;</span>)</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="keywordflow">if</span> (m&lt;-1 .or. m&gt;mn_max+1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, parse_segment_str: &quot;</span>//&amp;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                     <span class="stringliteral">&quot;Beginning of range in string &#39;&quot;</span>//trim(segment_str)//<span class="stringliteral">&quot;&#39; is outside of the physical domain.&quot;</span>)</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160; </div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <span class="comment">! Read n</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  n_word = extract_word(word2(3:24),<span class="stringliteral">&#39;:&#39;</span>,2)</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;  n = <a class="code" href="MOM__open__boundary_8F90.html#a0793b1a5746e6ead6bff50c3a52cae90">interpret_int_expr</a>( n_word, mn_max )</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  <span class="keywordflow">if</span> (reentrant) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">if</span> (n&lt;-halo .or. n&gt;mn_max+halo) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, parse_segment_str: &quot;</span>//&amp;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                     <span class="stringliteral">&quot;End of range in string &#39;&quot;</span>//trim(segment_str)//<span class="stringliteral">&quot;&#39; is outside of the physical domain.&quot;</span>)</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="keywordflow">if</span> (n&lt;-1 .or. n&gt;mn_max+1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, parse_segment_str: &quot;</span>//&amp;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                     <span class="stringliteral">&quot;End of range in string &#39;&quot;</span>//trim(segment_str)//<span class="stringliteral">&quot;&#39; is outside of the physical domain.&quot;</span>)</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160; </div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  <span class="keywordflow">if</span> (abs(n-m)==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, parse_segment_str: &quot;</span>//&amp;</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                   <span class="stringliteral">&quot;Range in string &#39;&quot;</span>//trim(segment_str)//<span class="stringliteral">&quot;&#39; must span one cell.&quot;</span>)</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160; </div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  <span class="comment">! Type of open boundary condition</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <span class="keywordflow">do</span> j = 1, <span class="keyword">size</span>(action_str)</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    action_str(j) = extract_word(segment_str,<span class="stringliteral">&#39;,&#39;</span>,2+j)</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160; </div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  <span class="keyword">contains</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160; </div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  <span class="comment">! Returns integer value interpreted from string in form of %I, N or N+-%I</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  <span class="keyword">integer </span><span class="keyword">function </span><a class="code" href="MOM__open__boundary_8F90.html#a0793b1a5746e6ead6bff50c3a52cae90">interpret_int_expr</a>(string, imax)</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: string<span class="comment"> !&lt; Integer in form or %I, N or N-%I</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="keywordtype">integer</span>,          <span class="keywordtype">intent(in)</span> :: imax<span class="comment"> !&lt; Value to replace &#39;N&#39; with</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="comment">! Local variables</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="keywordtype">integer</span> slen</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160; </div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    slen = len_trim(string)</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="keywordflow">if</span> (slen==0) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, parse_segment_str&quot;</span>//&amp;</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                                <span class="stringliteral">&quot;Parsed string was empty!&quot;</span>)</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="keywordflow">if</span> (len_trim(string)==1 .and. string(1:1)==<span class="stringliteral">&#39;N&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      <a class="code" href="MOM__open__boundary_8F90.html#a0793b1a5746e6ead6bff50c3a52cae90">interpret_int_expr</a> = imax</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="keywordflow">elseif</span> (string(1:1)==<span class="stringliteral">&#39;N&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      <span class="keywordflow">if</span> (string(2:2)==<span class="stringliteral">&#39;+&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        <span class="keyword">read</span>(string(3:slen),*,err=911) <a class="code" href="MOM__open__boundary_8F90.html#a0793b1a5746e6ead6bff50c3a52cae90">interpret_int_expr</a></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        <a class="code" href="MOM__open__boundary_8F90.html#a0793b1a5746e6ead6bff50c3a52cae90">interpret_int_expr</a> = imax + <a class="code" href="MOM__open__boundary_8F90.html#a0793b1a5746e6ead6bff50c3a52cae90">interpret_int_expr</a></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      <span class="keywordflow">elseif</span> (string(2:2)==<span class="stringliteral">&#39;-&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        <span class="keyword">read</span>(string(3:slen),*,err=911) <a class="code" href="MOM__open__boundary_8F90.html#a0793b1a5746e6ead6bff50c3a52cae90">interpret_int_expr</a></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        <a class="code" href="MOM__open__boundary_8F90.html#a0793b1a5746e6ead6bff50c3a52cae90">interpret_int_expr</a> = imax - <a class="code" href="MOM__open__boundary_8F90.html#a0793b1a5746e6ead6bff50c3a52cae90">interpret_int_expr</a></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      <span class="keyword">read</span>(string(1:slen),*,err=911) <a class="code" href="MOM__open__boundary_8F90.html#a0793b1a5746e6ead6bff50c3a52cae90">interpret_int_expr</a></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    911 <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, parse_segment_str&quot;</span>//&amp;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                       <span class="stringliteral">&quot;Problem reading value from string &#39;&quot;</span>//trim(string)//<span class="stringliteral">&quot;&#39;.&quot;</span>)</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  <span class="keyword">end function </span><a class="code" href="MOM__open__boundary_8F90.html#a0793b1a5746e6ead6bff50c3a52cae90">interpret_int_expr</a></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__string__functions_8F90_source.html#l00207">mom_string_functions::extract_word()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01214">interpret_int_expr()</a>, and <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l00858">setup_u_point_obc()</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00994">setup_v_point_obc()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a0eb361009a2dddf3ad9a24d0d7223898_cgraph.svg" width="100%" height="402"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a0eb361009a2dddf3ad9a24d0d7223898_icgraph.svg" width="571" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ae5ceafcce53e896d30012f321c73d9f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5ceafcce53e896d30012f321c73d9f4">&#9670;&nbsp;</a></span>radiation_open_bdry_conds()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::radiation_open_bdry_conds </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>u_new</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>u_old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>v_new</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>v_old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Apply radiation conditions to 3D u,v at open boundaries. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary control structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">u_new</td><td>On exit, new u values on open boundaries On entry, the old time-level v but including barotropic accelerations [L T-1 ~&gt; m s-1]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u_old</td><td>Original unadjusted u [L T-1 ~&gt; m s-1] </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v_new</td><td>On exit, new v values on open boundaries. On entry, the old time-level v but including barotropic accelerations [L T-1 ~&gt; m s-1]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">v_old</td><td>Original unadjusted v [L T-1 ~&gt; m s-1] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>Appropriate timestep [T ~&gt; s] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l01788">1788</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(inout)</span> :: G<span class="comment"> !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),                      <span class="keywordtype">pointer</span>       :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: u_new<span class="comment"> !&lt; On exit, new u values on open boundaries</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="comment">                                                                    !! On entry, the old time-level v but including</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="comment">                                                                    !! barotropic accelerations [L T-1 ~&gt; m s-1].</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span>    :: u_old<span class="comment"> !&lt; Original unadjusted u [L T-1 ~&gt; m s-1]</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: v_new<span class="comment"> !&lt; On exit, new v values on open boundaries.</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="comment">                                                                    !! On entry, the old time-level v but including</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="comment">                                                                    !! barotropic accelerations [L T-1 ~&gt; m s-1].</span></div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span>    :: v_old<span class="comment"> !&lt; Original unadjusted v  [L T-1 ~&gt; m s-1]</span></div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),                     <span class="keywordtype">intent(in)</span>    :: US<span class="comment">    !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;<span class="keywordtype">  real</span>,                                      <span class="keywordtype">intent(in)</span>    :: dt<span class="comment">    !&lt; Appropriate timestep [T ~&gt; s]</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="keywordtype">  real</span> :: dhdt, dhdx, dhdy  <span class="comment">! One-point differences in time or space [L T-1 ~&gt; m s-1]</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="keywordtype">  real</span> :: gamma_u, gamma_2  <span class="comment">! Fractional weightings of new values [nondim]</span></div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;<span class="keywordtype">  real</span> :: tau            <span class="comment">! A local nudging timescale [T ~&gt; s]</span></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="keywordtype">  real</span> :: rx_max, ry_max <span class="comment">! coefficients for radiation [nondim] or [L2 T-2 ~&gt; m2 s-2]</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="keywordtype">  real</span> :: rx_new, rx_avg <span class="comment">! coefficients for radiation [nondim] or [L2 T-2 ~&gt; m2 s-2]</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="keywordtype">  real</span> :: ry_new, ry_avg <span class="comment">! coefficients for radiation [nondim] or [L2 T-2 ~&gt; m2 s-2]</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="keywordtype">  real</span> :: cff_new, cff_avg <span class="comment">! denominator in oblique [L2 T-2 ~&gt; m2 s-2]</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: &amp;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    rx_tang_rad, &amp; <span class="comment">! The phase speed at u-points for tangential oblique OBCs</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;                   <span class="comment">! in units of grid points per timestep [nondim]</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    ry_tang_rad, &amp; <span class="comment">! The phase speed at v-points for tangential oblique OBCs</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                   <span class="comment">! in units of grid points per timestep [nondim]</span></div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    rx_tang_obl, &amp; <span class="comment">! The x-coefficient for tangential oblique OBCs [L2 T-2 ~&gt; m2 s-2]</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    ry_tang_obl, &amp; <span class="comment">! The y-coefficient for tangential oblique OBCs [L2 T-2 ~&gt; m2 s-2]</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    cff_tangential <span class="comment">! The denominator for tangential oblique OBCs [L2 T-2 ~&gt; m2 s-2]</span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="keywordtype">  real</span> :: eps      <span class="comment">! A small velocity squared [L2 T-2 ~&gt; m2 s-2]</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment =&gt; null()</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, m, nz, n</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  <span class="keywordtype">integer</span> :: is_obc, ie_obc, js_obc, je_obc</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160; </div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160; </div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(obc)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160; </div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;  <span class="keywordflow">if</span> (.not.(obc%open_u_BCs_exist_globally .or. obc%open_v_BCs_exist_globally)) &amp;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160; </div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;  eps = 1.0e-20*us%m_s_to_L_T**2</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160; </div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  <span class="comment">!! Copy previously calculated phase velocity from global arrays into segments</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  <span class="comment">!! This is terribly inefficient and temporary solution for continuity across restarts</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;  <span class="comment">!! and needs to be revisited in the future.</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  <span class="keywordflow">if</span> (obc%gamma_uv &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    <span class="keywordflow">do</span> n=1,obc%number_of_segments</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;      segment=&gt;obc%segment(n)</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;      <span class="keywordflow">if</span> (.not. segment%on_pe) cycle</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;      <span class="keywordflow">if</span> (segment%is_E_or_W .and. segment%radiation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;          i=segment%HI%IsdB</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;          <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;            segment%rx_norm_rad(i,j,k) = obc%rx_normal(i,j,k)</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      <span class="keywordflow">elseif</span> (segment%is_N_or_S .and. segment%radiation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;          j=segment%HI%JsdB</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;          <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;            segment%ry_norm_rad(i,j,k) = obc%ry_normal(i,j,k)</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;      <span class="keywordflow">if</span> (segment%is_E_or_W .and. segment%oblique) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;          i=segment%HI%IsdB</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;          <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;            segment%rx_norm_obl(i,j,k) = obc%rx_oblique(i,j,k)</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;            segment%ry_norm_obl(i,j,k) = obc%ry_oblique(i,j,k)</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;            segment%cff_normal(i,j,k) = obc%cff_normal(i,j,k)</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;      <span class="keywordflow">elseif</span> (segment%is_N_or_S .and. segment%oblique) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;          j=segment%HI%JsdB</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;          <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;            segment%rx_norm_obl(i,j,k) = obc%rx_oblique(i,j,k)</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;            segment%ry_norm_obl(i,j,k) = obc%ry_oblique(i,j,k)</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;            segment%cff_normal(i,j,k) = obc%cff_normal(i,j,k)</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160; </div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;  <span class="comment">! Now tracers (if any)</span></div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;  <span class="keywordflow">do</span> n=1,obc%number_of_segments</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    segment=&gt;obc%segment(n)</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%tr_Reg)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        i = segment%HI%IsdB</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        <span class="keywordflow">do</span> m=1,obc%ntr</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%tr_Reg%Tr(m)%tres)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;            <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;              <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;                segment%tr_Reg%Tr(m)%tres(i,j,k) = obc%tres_x(i,j,k,m)</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="keywordflow">            enddo</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;        j = segment%HI%JsdB</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;        <span class="keywordflow">do</span> m=1,obc%ntr</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%tr_Reg%Tr(m)%tres)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;            <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;              <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                segment%tr_Reg%Tr(m)%tres(i,j,k) = obc%tres_y(i,j,k,m)</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="keywordflow">            enddo</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160; </div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;  gamma_u = obc%gamma_uv</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;  rx_max = obc%rx_max ; ry_max = obc%rx_max</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;  <span class="keywordflow">do</span> n=1,obc%number_of_segments</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;     segment=&gt;obc%segment(n)</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;     <span class="keywordflow">if</span> (.not. segment%on_pe) cycle</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;     <span class="keywordflow">if</span> (segment%oblique) <span class="keyword">call </span>gradient_at_q_points(g, segment, u_new(:,:,:), v_new(:,:,:))</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;     <span class="keywordflow">if</span> (segment%direction == obc_direction_e) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;       i=segment%HI%IsdB</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;       <span class="keywordflow">if</span> (i&lt;g%HI%IscB) cycle</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;       <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;         <span class="keywordflow">if</span> (segment%radiation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;           dhdt = (u_old(i-1,j,k) - u_new(i-1,j,k)) <span class="comment">!old-new</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;           dhdx = (u_new(i-1,j,k) - u_new(i-2,j,k)) <span class="comment">!in new time backward sasha for I-1</span></div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;           rx_new = 0.0</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;           <span class="keywordflow">if</span> (dhdt*dhdx &gt; 0.0) rx_new = min( (dhdt/dhdx), rx_max) <span class="comment">! outward phase speed</span></div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;             rx_avg = (1.0-gamma_u)*segment%rx_norm_rad(i,j,k) + gamma_u*rx_new</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;             rx_avg = rx_new</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;           segment%rx_norm_rad(i,j,k) = rx_avg</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;           <span class="comment">! The new boundary value is interpolated between future interior</span></div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;           <span class="comment">! value, u_new(I-1) and past boundary value but with barotropic</span></div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;           <span class="comment">! accelerations, u_new(I).</span></div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;           segment%normal_vel(i,j,k) = (u_new(i,j,k) + rx_avg*u_new(i-1,j,k)) / (1.0+rx_avg)</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;           <span class="comment">! Copy restart fields into 3-d arrays. This is an inefficient and temporary issues</span></div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;           <span class="comment">! implemented as a work-around to limitations in restart capability</span></div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;             obc%rx_normal(i,j,k) = segment%rx_norm_rad(i,j,k)</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;         <span class="keywordflow">elseif</span> (segment%oblique) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;           dhdt = (u_old(i-1,j,k) - u_new(i-1,j,k)) <span class="comment">!old-new</span></div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;           dhdx = (u_new(i-1,j,k) - u_new(i-2,j,k)) <span class="comment">!in new time backward sasha for I-1</span></div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;           <span class="keywordflow">if</span> (dhdt*(segment%grad_normal(j,1,k) + segment%grad_normal(j-1,1,k)) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;             dhdy = segment%grad_normal(j-1,1,k)</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;           <span class="keywordflow">elseif</span> (dhdt*(segment%grad_normal(j,1,k) + segment%grad_normal(j-1,1,k)) == 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;             dhdy = 0.0</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;             dhdy = segment%grad_normal(j,1,k)</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;           <span class="keywordflow">if</span> (dhdt*dhdx &lt; 0.0) dhdt = 0.0</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;           rx_new = dhdt*dhdx</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;           cff_new = max(dhdx*dhdx + dhdy*dhdy, eps)</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;           ry_new = min(cff_new,max(dhdt*dhdy,-cff_new))</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;             rx_avg = (1.0-gamma_u)*segment%rx_norm_obl(i,j,k) + gamma_u*rx_new</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;             ry_avg = (1.0-gamma_u)*segment%ry_norm_obl(i,j,k) + gamma_u*ry_new</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;             cff_avg = (1.0-gamma_u)*segment%cff_normal(i,j,k) + gamma_u*cff_new</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;             rx_avg = rx_new</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;             ry_avg = ry_new</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;             cff_avg = cff_new</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;           segment%rx_norm_obl(i,j,k) = rx_avg</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;           segment%ry_norm_obl(i,j,k) = ry_avg</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;           segment%cff_normal(i,j,k) = cff_avg</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;           segment%normal_vel(i,j,k) = ((cff_avg*u_new(i,j,k) + rx_avg*u_new(i-1,j,k)) - &amp;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;                              (max(ry_avg,0.0)*segment%grad_normal(j-1,2,k) + &amp;</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                               min(ry_avg,0.0)*segment%grad_normal(j,2,k))) / &amp;</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;                            (cff_avg + rx_avg)</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;             <span class="comment">! Copy restart fields into 3-d arrays. This is an inefficient and temporary</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;             <span class="comment">! implementation as a work-around to limitations in restart capability</span></div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;             obc%rx_oblique(i,j,k) = segment%rx_norm_obl(i,j,k)</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;             obc%ry_oblique(i,j,k) = segment%ry_norm_obl(i,j,k)</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;             obc%cff_normal(i,j,k) = segment%cff_normal(i,j,k)</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;         <span class="keywordflow">elseif</span> (segment%gradient) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;           segment%normal_vel(i,j,k) = u_new(i-1,j,k)</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;         <span class="keywordflow">if</span> ((segment%radiation .or. segment%oblique) .and. segment%nudged) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;           <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;           <span class="keywordflow">if</span> (dhdt*dhdx &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;             tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;             tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;           gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;           segment%normal_vel(i,j,k) = (1.0 - gamma_2) * segment%normal_vel(i,j,k) + &amp;</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                                 gamma_2 * segment%nudged_normal_vel(i,j,k)</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="keywordflow">       enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;       <span class="keywordflow">if</span> (segment%radiation_tan .or. segment%radiation_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;         i=segment%HI%IsdB</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;         <span class="keyword">allocate</span>(rx_tang_rad(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;         <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;             rx_tang_rad(i,segment%HI%JsdB,k) = segment%rx_norm_rad(i,segment%HI%jsd,k)</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;             rx_tang_rad(i,segment%HI%JedB,k) = segment%rx_norm_rad(i,segment%HI%jed,k)</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;             <span class="keywordflow">do</span> j=segment%HI%JsdB+1,segment%HI%JedB-1</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;               rx_tang_rad(i,j,k) = 0.5*(segment%rx_norm_rad(i,j,k) + segment%rx_norm_rad(i,j+1,k))</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;             <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;               dhdt = v_old(i,j,k)-v_new(i,j,k)   <span class="comment">!old-new</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;               dhdx = v_new(i,j,k)-v_new(i-1,j,k) <span class="comment">!in new time backward sasha for I-1</span></div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;               rx_tang_rad(i,j,k) = 0.0</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;               <span class="keywordflow">if</span> (dhdt*dhdx &gt; 0.0) rx_tang_rad(i,j,k) = min( (dhdt/dhdx), rx_max) <span class="comment">! outward phase speed</span></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="keywordflow">         enddo</span></div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;         <span class="keywordflow">if</span> (segment%radiation_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;             rx_avg = rx_tang_rad(i,j,k)</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;             segment%tangential_vel(i,j,k) = (v_new(i,j,k) + rx_avg*v_new(i-1,j,k)) / (1.0+rx_avg)</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;             <span class="keywordflow">if</span> (rx_tang_rad(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;             segment%tangential_vel(i,j,k) = (1.0 - gamma_2) * segment%tangential_vel(i,j,k) + &amp;</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;                                 gamma_2 * segment%nudged_tangential_vel(i,j,k)</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;         <span class="keywordflow">if</span> (segment%radiation_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;           js_obc = max(segment%HI%JsdB,g%jsd+1)</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;           je_obc = min(segment%HI%JedB,g%jed-1)</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=js_obc,je_obc</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;             rx_avg = rx_tang_rad(i,j,k)</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="comment">!            if (G%mask2dCu(I-1,j) &gt; 0.0 .and. G%mask2dCu(I-1,j+1) &gt; 0.0) then</span></div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;<span class="comment">!              rx_avg = 0.5*(u_new(I-1,j,k) + u_new(I-1,j+1,k)) * dt * G%IdxBu(I-1,J)</span></div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="comment">!            elseif (G%mask2dCu(I-1,j) &gt; 0.0) then</span></div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;<span class="comment">!              rx_avg = u_new(I-1,j,k) * dt * G%IdxBu(I-1,J)</span></div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<span class="comment">!            elseif (G%mask2dCu(I-1,j+1) &gt; 0.0) then</span></div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;<span class="comment">!              rx_avg = u_new(I-1,j+1,k) * dt * G%IdxBu(I-1,J)</span></div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="comment">!            else</span></div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="comment">!              rx_avg = 0.0</span></div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="comment">!            endif</span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;             segment%tangential_grad(i,j,k) = ((v_new(i,j,k) - v_new(i-1,j,k))*g%IdxBu(i-1,j) + &amp;</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;                               rx_avg*(v_new(i-1,j,k) - v_new(i-2,j,k))*g%IdxBu(i-2,j)) / (1.0+rx_avg)</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;             <span class="keywordflow">if</span> (rx_tang_rad(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;             segment%tangential_grad(i,j,k) = (1.0 - gamma_2) * segment%tangential_grad(i,j,k) + &amp;</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;                                 gamma_2 * segment%nudged_tangential_grad(i,j,k)</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;         <span class="keyword">deallocate</span>(rx_tang_rad)</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;       <span class="keywordflow">if</span> (segment%oblique_tan .or. segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;         i=segment%HI%IsdB</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;         <span class="keyword">allocate</span>(rx_tang_obl(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;         <span class="keyword">allocate</span>(ry_tang_obl(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;         <span class="keyword">allocate</span>(cff_tangential(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;         <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;             rx_tang_obl(i,segment%HI%JsdB,k) = segment%rx_norm_obl(i,segment%HI%jsd,k)</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;             rx_tang_obl(i,segment%HI%JedB,k) = segment%rx_norm_obl(i,segment%HI%jed,k)</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;             ry_tang_obl(i,segment%HI%JsdB,k) = segment%ry_norm_obl(i,segment%HI%jsd,k)</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;             ry_tang_obl(i,segment%HI%JedB,k) = segment%ry_norm_obl(i,segment%HI%jed,k)</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;             cff_tangential(i,segment%HI%JsdB,k) = segment%cff_normal(i,segment%HI%jsd,k)</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;             cff_tangential(i,segment%HI%JedB,k) = segment%cff_normal(i,segment%HI%jed,k)</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;             <span class="keywordflow">do</span> j=segment%HI%JsdB+1,segment%HI%JedB-1</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;               rx_tang_obl(i,j,k) = 0.5*(segment%rx_norm_obl(i,j,k) + segment%rx_norm_obl(i,j+1,k))</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;               ry_tang_obl(i,j,k) = 0.5*(segment%ry_norm_obl(i,j,k) + segment%ry_norm_obl(i,j+1,k))</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;               cff_tangential(i,j,k) = 0.5*(segment%cff_normal(i,j,k) + segment%cff_normal(i,j+1,k))</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;             <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;               dhdt = v_old(i,j,k)-v_new(i,j,k)   <span class="comment">!old-new</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;               dhdx = v_new(i,j,k)-v_new(i-1,j,k) <span class="comment">!in new time backward sasha for I-1</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;               <span class="keywordflow">if</span> (dhdt*(segment%grad_tan(j,1,k) + segment%grad_tan(j+1,1,k)) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;                 dhdy = segment%grad_tan(j,1,k)</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;               <span class="keywordflow">elseif</span> (dhdt*(segment%grad_tan(j,1,k) + segment%grad_tan(j+1,1,k)) == 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;                 dhdy = 0.0</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;               <span class="keywordflow">else</span></div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;                 dhdy = segment%grad_tan(j+1,1,k)</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;<span class="keywordflow">               endif</span></div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;               <span class="keywordflow">if</span> (dhdt*dhdx &lt; 0.0) dhdt = 0.0</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;               rx_new = dhdt*dhdx</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;               cff_new = max(dhdx*dhdx + dhdy*dhdy, eps)</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;               ry_new = min(cff_new,max(dhdt*dhdy,-cff_new))</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;               rx_tang_obl(i,j,k) = rx_new</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;               ry_tang_obl(i,j,k) = ry_new</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;               cff_tangential(i,j,k) = cff_new</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;<span class="keywordflow">         enddo</span></div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;         <span class="keywordflow">if</span> (segment%oblique_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;             rx_avg = rx_tang_obl(i,j,k)</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;             ry_avg = ry_tang_obl(i,j,k)</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;             cff_avg = cff_tangential(i,j,k)</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;             segment%tangential_vel(i,j,k) = ((cff_avg*v_new(i,j,k) + rx_avg*v_new(i-1,j,k)) - &amp;</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;                                              (max(ry_avg,0.0)*segment%grad_tan(j,2,k) + &amp;</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;                                               min(ry_avg,0.0)*segment%grad_tan(j+1,2,k))) / &amp;</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;                                             (cff_avg + rx_avg)</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;             <span class="keywordflow">if</span> (rx_tang_obl(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;             segment%tangential_vel(i,j,k) = (1.0 - gamma_2) * segment%tangential_vel(i,j,k) + &amp;</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                                 gamma_2 * segment%nudged_tangential_vel(i,j,k)</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;         <span class="keywordflow">if</span> (segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;           js_obc = max(segment%HI%JsdB,g%jsd+1)</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;           je_obc = min(segment%HI%JedB,g%jed-1)</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> j=segment%HI%JsdB+1,segment%HI%JedB-1</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;             rx_avg = rx_tang_obl(i,j,k)</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;             ry_avg = ry_tang_obl(i,j,k)</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;             cff_avg = cff_tangential(i,j,k)</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;             segment%tangential_grad(i,j,k) =  &amp;</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;                 ((cff_avg*(v_new(i,j,k)  - v_new(i-1,j,k))*g%IdxBu(i-1,j) + &amp;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;                   rx_avg*(v_new(i-1,j,k) - v_new(i-2,j,k))*g%IdxBu(i-2,j)) - &amp;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;                  (max(ry_avg,0.0)*segment%grad_gradient(j,2,k) + &amp;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;                   min(ry_avg,0.0)*segment%grad_gradient(j+1,2,k)) ) / &amp;</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                 (cff_avg + rx_avg)</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;             <span class="keywordflow">if</span> (rx_tang_obl(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;             segment%tangential_grad(i,j,k) = (1.0 - gamma_2) * segment%tangential_grad(i,j,k) + &amp;</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                                 gamma_2 * segment%nudged_tangential_grad(i,j,k)</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;         <span class="keyword">deallocate</span>(rx_tang_obl)</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;         <span class="keyword">deallocate</span>(ry_tang_obl)</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;         <span class="keyword">deallocate</span>(cff_tangential)</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160; </div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;     <span class="keywordflow">if</span> (segment%direction == obc_direction_w) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;       i=segment%HI%IsdB</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;       <span class="keywordflow">if</span> (i&gt;g%HI%IecB) cycle</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;       <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;         <span class="keywordflow">if</span> (segment%radiation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;           dhdt = (u_old(i+1,j,k) - u_new(i+1,j,k)) <span class="comment">!old-new</span></div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;           dhdx = (u_new(i+1,j,k) - u_new(i+2,j,k)) <span class="comment">!in new time forward sasha for I+1</span></div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;           rx_new = 0.0</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;           <span class="keywordflow">if</span> (dhdt*dhdx &gt; 0.0) rx_new = min( (dhdt/dhdx), rx_max)</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;             rx_avg = (1.0-gamma_u)*segment%rx_norm_rad(i,j,k) + gamma_u*rx_new</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;             rx_avg = rx_new</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;           segment%rx_norm_rad(i,j,k) = rx_avg</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;           <span class="comment">! The new boundary value is interpolated between future interior</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;           <span class="comment">! value, u_new(I+1) and past boundary value but with barotropic</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;           <span class="comment">! accelerations, u_new(I).</span></div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;           segment%normal_vel(i,j,k) = (u_new(i,j,k) + rx_avg*u_new(i+1,j,k)) / (1.0+rx_avg)</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;             <span class="comment">! Copy restart fields into 3-d arrays. This is an inefficient and temporary issues</span></div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;             <span class="comment">! implemented as a work-around to limitations in restart capability</span></div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;             obc%rx_normal(i,j,k) = segment%rx_norm_rad(i,j,k)</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;         <span class="keywordflow">elseif</span> (segment%oblique) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;           dhdt = (u_old(i+1,j,k) - u_new(i+1,j,k)) <span class="comment">!old-new</span></div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;           dhdx = (u_new(i+1,j,k) - u_new(i+2,j,k)) <span class="comment">!in new time forward sasha for I+1</span></div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;           <span class="keywordflow">if</span> (dhdt*(segment%grad_normal(j,1,k) + segment%grad_normal(j-1,1,k)) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;             dhdy = segment%grad_normal(j-1,1,k)</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;           <span class="keywordflow">elseif</span> (dhdt*(segment%grad_normal(j,1,k) + segment%grad_normal(j-1,1,k)) == 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;             dhdy = 0.0</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;             dhdy = segment%grad_normal(j,1,k)</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;           <span class="keywordflow">if</span> (dhdt*dhdx &lt; 0.0) dhdt = 0.0</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160; </div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;           rx_new = dhdt*dhdx</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;           cff_new = max(dhdx*dhdx + dhdy*dhdy, eps)</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;           ry_new = min(cff_new,max(dhdt*dhdy,-cff_new))</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;             rx_avg = (1.0-gamma_u)*segment%rx_norm_obl(i,j,k) + gamma_u*rx_new</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;             ry_avg = (1.0-gamma_u)*segment%ry_norm_obl(i,j,k) + gamma_u*ry_new</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;             cff_avg = (1.0-gamma_u)*segment%cff_normal(i,j,k) + gamma_u*cff_new</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;             rx_avg = rx_new</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;             ry_avg = ry_new</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;             cff_avg = cff_new</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;           segment%rx_norm_obl(i,j,k) = rx_avg</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;           segment%ry_norm_obl(i,j,k) = ry_avg</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;           segment%cff_normal(i,j,k) = cff_avg</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;           segment%normal_vel(i,j,k) = ((cff_avg*u_new(i,j,k) + rx_avg*u_new(i+1,j,k)) - &amp;</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;                                        (max(ry_avg,0.0)*segment%grad_normal(j-1,2,k) + &amp;</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;                                         min(ry_avg,0.0)*segment%grad_normal(j,2,k))) / &amp;</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;                                       (cff_avg + rx_avg)</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;             <span class="comment">! Copy restart fields into 3-d arrays. This is an inefficient and temporary issues</span></div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;             <span class="comment">! implemented as a work-around to limitations in restart capability</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;             obc%rx_oblique(i,j,k) = segment%rx_norm_obl(i,j,k)</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;             obc%ry_oblique(i,j,k) = segment%ry_norm_obl(i,j,k)</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;             obc%cff_normal(i,j,k) = segment%cff_normal(i,j,k)</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;         <span class="keywordflow">elseif</span> (segment%gradient) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;           segment%normal_vel(i,j,k) = u_new(i+1,j,k)</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;         <span class="keywordflow">if</span> ((segment%radiation .or. segment%oblique) .and. segment%nudged) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;           <span class="comment">! dhdt gets set to 0. on inflow in oblique case</span></div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;           <span class="keywordflow">if</span> (dhdt*dhdx &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;             tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;             tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;           gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;           segment%normal_vel(i,j,k) = (1.0 - gamma_2) * segment%normal_vel(i,j,k) + &amp;</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;                                 gamma_2 * segment%nudged_normal_vel(i,j,k)</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;<span class="keywordflow">       enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;       <span class="keywordflow">if</span> (segment%radiation_tan .or. segment%radiation_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;         i=segment%HI%IsdB</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;         <span class="keyword">allocate</span>(rx_tang_rad(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;         <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;             rx_tang_rad(i,segment%HI%JsdB,k) = segment%rx_norm_rad(i,segment%HI%jsd,k)</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;             rx_tang_rad(i,segment%HI%JedB,k) = segment%rx_norm_rad(i,segment%HI%jed,k)</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;             <span class="keywordflow">do</span> j=segment%HI%JsdB+1,segment%HI%JedB-1</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;               rx_tang_rad(i,j,k) = 0.5*(segment%rx_norm_rad(i,j,k) + segment%rx_norm_rad(i,j+1,k))</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;             <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;               dhdt = v_old(i+1,j,k)-v_new(i+1,j,k)   <span class="comment">!old-new</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;               dhdx = v_new(i+1,j,k)-v_new(i+2,j,k) <span class="comment">!in new time backward sasha for I-1</span></div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;               rx_tang_rad(i,j,k) = 0.0</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;               <span class="keywordflow">if</span> (dhdt*dhdx &gt; 0.0) rx_tang_rad(i,j,k) = min( (dhdt/dhdx), rx_max) <span class="comment">! outward phase speed</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;<span class="keywordflow">         enddo</span></div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;         <span class="keywordflow">if</span> (segment%radiation_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;             rx_avg = rx_tang_rad(i,j,k)</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;             segment%tangential_vel(i,j,k) = (v_new(i+1,j,k) + rx_avg*v_new(i+2,j,k)) / (1.0+rx_avg)</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;             <span class="keywordflow">if</span> (rx_tang_rad(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;             segment%tangential_vel(i,j,k) = (1.0 - gamma_2) * segment%tangential_vel(i,j,k) + &amp;</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                                 gamma_2 * segment%nudged_tangential_vel(i,j,k)</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;         <span class="keywordflow">if</span> (segment%radiation_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;           js_obc = max(segment%HI%JsdB,g%jsd+1)</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;           je_obc = min(segment%HI%JedB,g%jed-1)</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> j=js_obc,je_obc</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;             rx_avg = rx_tang_rad(i,j,k)</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;<span class="comment">!            if (G%mask2dCu(I+1,j) &gt; 0.0 .and. G%mask2dCu(I+1,j+1) &gt; 0.0) then</span></div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;<span class="comment">!              rx_avg = 0.5*(u_new(I+1,j,k) + u_new(I+1,j+1,k)) * dt * G%IdxBu(I+1,J)</span></div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;<span class="comment">!            elseif (G%mask2dCu(I+1,j) &gt; 0.0) then</span></div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;<span class="comment">!              rx_avg = u_new(I+1,j,k) * dt * G%IdxBu(I+1,J)</span></div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;<span class="comment">!            elseif (G%mask2dCu(I+1,j+1) &gt; 0.0) then</span></div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;<span class="comment">!              rx_avg = u_new(I+1,j+1,k) * dt * G%IdxBu(I+1,J)</span></div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;<span class="comment">!            else</span></div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;<span class="comment">!              rx_avg = 0.0</span></div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;<span class="comment">!            endif</span></div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;             segment%tangential_grad(i,j,k) = ((v_new(i+2,j,k) - v_new(i+1,j,k))*g%IdxBu(i+1,j) + &amp;</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                               rx_avg*(v_new(i+3,j,k) - v_new(i+2,j,k))*g%IdxBu(i+2,j)) / (1.0+rx_avg)</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;             <span class="keywordflow">if</span> (rx_tang_rad(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;             segment%tangential_grad(i,j,k) = (1.0 - gamma_2) * segment%tangential_grad(i,j,k) + &amp;</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;                                 gamma_2 * segment%nudged_tangential_grad(i,j,k)</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;         <span class="keyword">deallocate</span>(rx_tang_rad)</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;       <span class="keywordflow">if</span> (segment%oblique_tan .or. segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;         i=segment%HI%IsdB</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;         <span class="keyword">allocate</span>(rx_tang_obl(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;         <span class="keyword">allocate</span>(ry_tang_obl(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;         <span class="keyword">allocate</span>(cff_tangential(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;         <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;             rx_tang_obl(i,segment%HI%JsdB,k) = segment%rx_norm_obl(i,segment%HI%jsd,k)</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;             rx_tang_obl(i,segment%HI%JedB,k) = segment%rx_norm_obl(i,segment%HI%jed,k)</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;             ry_tang_obl(i,segment%HI%JsdB,k) = segment%ry_norm_obl(i,segment%HI%jsd,k)</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;             ry_tang_obl(i,segment%HI%JedB,k) = segment%ry_norm_obl(i,segment%HI%jed,k)</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;             cff_tangential(i,segment%HI%JsdB,k) = segment%cff_normal(i,segment%HI%jsd,k)</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;             cff_tangential(i,segment%HI%JedB,k) = segment%cff_normal(i,segment%HI%jed,k)</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;             <span class="keywordflow">do</span> j=segment%HI%JsdB+1,segment%HI%JedB-1</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;               rx_tang_obl(i,j,k) = 0.5*(segment%rx_norm_obl(i,j,k) + segment%rx_norm_obl(i,j+1,k))</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;               ry_tang_obl(i,j,k) = 0.5*(segment%ry_norm_obl(i,j,k) + segment%ry_norm_obl(i,j+1,k))</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;               cff_tangential(i,j,k) = 0.5*(segment%cff_normal(i,j,k) + segment%cff_normal(i,j+1,k))</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;             <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;               dhdt = v_old(i+1,j,k)-v_new(i+1,j,k)   <span class="comment">!old-new</span></div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;               dhdx = v_new(i+1,j,k)-v_new(i+2,j,k) <span class="comment">!in new time backward sasha for I-1</span></div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;               <span class="keywordflow">if</span> (dhdt*(segment%grad_tan(j,1,k) + segment%grad_tan(j+1,1,k)) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;                 dhdy = segment%grad_tan(j,1,k)</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;               <span class="keywordflow">elseif</span> (dhdt*(segment%grad_tan(j,1,k) + segment%grad_tan(j+1,1,k)) == 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;                 dhdy = 0.0</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;               <span class="keywordflow">else</span></div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;                 dhdy = segment%grad_tan(j+1,1,k)</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;<span class="keywordflow">               endif</span></div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;               <span class="keywordflow">if</span> (dhdt*dhdx &lt; 0.0) dhdt = 0.0</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;               rx_new = dhdt*dhdx</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;               cff_new = max(dhdx*dhdx + dhdy*dhdy, eps)</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;               ry_new = min(cff_new,max(dhdt*dhdy,-cff_new))</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;               rx_tang_obl(i,j,k) = rx_new</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;               ry_tang_obl(i,j,k) = ry_new</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;               cff_tangential(i,j,k) = cff_new</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="keywordflow">         enddo</span></div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;         <span class="keywordflow">if</span> (segment%oblique_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;             rx_avg = rx_tang_obl(i,j,k)</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;             ry_avg = ry_tang_obl(i,j,k)</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;             cff_avg = cff_tangential(i,j,k)</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;             segment%tangential_vel(i,j,k) = ((cff_avg*v_new(i+1,j,k) + rx_avg*v_new(i+2,j,k)) - &amp;</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;                                              (max(ry_avg,0.0)*segment%grad_tan(j,2,k) + &amp;</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;                                               min(ry_avg,0.0)*segment%grad_tan(j+1,2,k))) / &amp;</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                                             (cff_avg + rx_avg)</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;             <span class="keywordflow">if</span> (rx_tang_obl(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;             segment%tangential_vel(i,j,k) = (1.0 - gamma_2) * segment%tangential_vel(i,j,k) + &amp;</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;                                 gamma_2 * segment%nudged_tangential_vel(i,j,k)</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;         <span class="keywordflow">if</span> (segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;           js_obc = max(segment%HI%JsdB,g%jsd+1)</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;           je_obc = min(segment%HI%JedB,g%jed-1)</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> j=segment%HI%JsdB+1,segment%HI%JedB-1</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;             rx_avg = rx_tang_obl(i,j,k)</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;             ry_avg = ry_tang_obl(i,j,k)</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;             cff_avg = cff_tangential(i,j,k)</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;             segment%tangential_grad(i,j,k) = &amp;</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;                 ((cff_avg*(v_new(i+2,j,k) - v_new(i+1,j,k))*g%IdxBu(i+1,j) + &amp;</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;                    rx_avg*(v_new(i+3,j,k) - v_new(i+2,j,k))*g%IdxBu(i+2,j)) - &amp;</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;                  (max(ry_avg,0.0)*segment%grad_gradient(j,2,k) + &amp;</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;                   min(ry_avg,0.0)*segment%grad_gradient(j+1,2,k))) / &amp;</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;                 (cff_avg + rx_avg)</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;             <span class="keywordflow">if</span> (rx_tang_obl(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;             segment%tangential_grad(i,j,k) = (1.0 - gamma_2) * segment%tangential_grad(i,j,k) + &amp;</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;                                 gamma_2 * segment%nudged_tangential_grad(i,j,k)</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;         <span class="keyword">deallocate</span>(rx_tang_obl)</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;         <span class="keyword">deallocate</span>(ry_tang_obl)</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;         <span class="keyword">deallocate</span>(cff_tangential)</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160; </div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;     <span class="keywordflow">if</span> (segment%direction == obc_direction_n) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;       j=segment%HI%JsdB</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;       <span class="keywordflow">if</span> (j&lt;g%HI%JscB) cycle</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;       <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;         <span class="keywordflow">if</span> (segment%radiation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;           dhdt = (v_old(i,j-1,k) - v_new(i,j-1,k)) <span class="comment">!old-new</span></div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;           dhdy = (v_new(i,j-1,k) - v_new(i,j-2,k)) <span class="comment">!in new time backward sasha for J-1</span></div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;           ry_new = 0.0</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;           <span class="keywordflow">if</span> (dhdt*dhdy &gt; 0.0) ry_new = min( (dhdt/dhdy), ry_max)</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;             ry_avg = (1.0-gamma_u)*segment%ry_norm_rad(i,j,k) + gamma_u*ry_new</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;             ry_avg = ry_new</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;           segment%ry_norm_rad(i,j,k) = ry_avg</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;           <span class="comment">! The new boundary value is interpolated between future interior</span></div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;           <span class="comment">! value, v_new(J-1) and past boundary value but with barotropic</span></div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;           <span class="comment">! accelerations, v_new(J).</span></div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;           segment%normal_vel(i,j,k) = (v_new(i,j,k) + ry_avg*v_new(i,j-1,k)) / (1.0+ry_avg)</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;             <span class="comment">! Copy restart fields into 3-d arrays. This is an inefficient and temporary issues</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;             <span class="comment">! implemented as a work-around to limitations in restart capability</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;             obc%ry_normal(i,j,k) = segment%ry_norm_rad(i,j,k)</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;         <span class="keywordflow">elseif</span> (segment%oblique) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;           dhdt = (v_old(i,j-1,k) - v_new(i,j-1,k)) <span class="comment">!old-new</span></div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;           dhdy = (v_new(i,j-1,k) - v_new(i,j-2,k)) <span class="comment">!in new time backward sasha for J-1</span></div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;           <span class="keywordflow">if</span> (dhdt*(segment%grad_normal(i,1,k) + segment%grad_normal(i-1,1,k)) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;             dhdx = segment%grad_normal(i-1,1,k)</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;           <span class="keywordflow">elseif</span> (dhdt*(segment%grad_normal(i,1,k) + segment%grad_normal(i-1,1,k)) == 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;             dhdx = 0.0</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;             dhdx = segment%grad_normal(i,1,k)</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;           <span class="keywordflow">if</span> (dhdt*dhdy &lt; 0.0) dhdt = 0.0</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;           ry_new = dhdt*dhdy</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;           cff_new = max(dhdx*dhdx + dhdy*dhdy, eps)</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;           rx_new = min(cff_new,max(dhdt*dhdx,-cff_new))</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;             rx_avg = (1.0-gamma_u)*segment%rx_norm_obl(i,j,k) + gamma_u*rx_new</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;             ry_avg = (1.0-gamma_u)*segment%ry_norm_obl(i,j,k) + gamma_u*ry_new</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;             cff_avg = (1.0-gamma_u)*segment%cff_normal(i,j,k) + gamma_u*cff_new</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;             rx_avg = rx_new</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;             ry_avg = ry_new</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;             cff_avg = cff_new</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;           segment%rx_norm_obl(i,j,k) = rx_avg</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;           segment%ry_norm_obl(i,j,k) = ry_avg</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;           segment%cff_normal(i,j,k) = cff_avg</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;           segment%normal_vel(i,j,k) = ((cff_avg*v_new(i,j,k) + ry_avg*v_new(i,j-1,k)) - &amp;</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;                                        (max(rx_avg,0.0)*segment%grad_normal(i-1,2,k) +&amp;</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                                         min(rx_avg,0.0)*segment%grad_normal(i,2,k))) / &amp;</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                                       (cff_avg + ry_avg)</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;             <span class="comment">! Copy restart fields into 3-d arrays. This is an inefficient and temporary issues</span></div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;             <span class="comment">! implemented as a work-around to limitations in restart capability</span></div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;             obc%rx_oblique(i,j,k) = segment%rx_norm_obl(i,j,k)</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;             obc%ry_oblique(i,j,k) = segment%ry_norm_obl(i,j,k)</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;             obc%cff_normal(i,j,k) = segment%cff_normal(i,j,k)</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;         <span class="keywordflow">elseif</span> (segment%gradient) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;           segment%normal_vel(i,j,k) = v_new(i,j-1,k)</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;         <span class="keywordflow">if</span> ((segment%radiation .or. segment%oblique) .and. segment%nudged) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;           <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;           <span class="keywordflow">if</span> (dhdt*dhdy &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;             tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;             tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;           gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;           segment%normal_vel(i,j,k) = (1.0 - gamma_2) * segment%normal_vel(i,j,k) + &amp;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;                                 gamma_2 * segment%nudged_normal_vel(i,j,k)</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;<span class="keywordflow">       enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;       <span class="keywordflow">if</span> (segment%radiation_tan .or. segment%radiation_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;         j=segment%HI%JsdB</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;         <span class="keyword">allocate</span>(ry_tang_rad(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;         <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;             ry_tang_rad(segment%HI%IsdB,j,k) = segment%ry_norm_rad(segment%HI%isd,j,k)</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;             ry_tang_rad(segment%HI%IedB,j,k) = segment%ry_norm_rad(segment%HI%ied,j,k)</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;             <span class="keywordflow">do</span> i=segment%HI%IsdB+1,segment%HI%IedB-1</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;               ry_tang_rad(i,j,k) = 0.5*(segment%ry_norm_rad(i,j,k) + segment%ry_norm_rad(i+1,j,k))</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;             <span class="keywordflow">do</span> i=segment%HI%IsdB,segment%HI%IedB</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;               dhdt = u_old(i,j-1,k)-u_new(i,j-1,k)   <span class="comment">!old-new</span></div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;               dhdy = u_new(i,j-1,k)-u_new(i,j-2,k) <span class="comment">!in new time backward sasha for I-1</span></div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;               ry_tang_rad(i,j,k) = 0.0</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;               <span class="keywordflow">if</span> (dhdt*dhdy &gt; 0.0) ry_tang_rad(i,j,k) = min( (dhdt/dhdy), rx_max) <span class="comment">! outward phase speed</span></div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;<span class="keywordflow">         enddo</span></div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;         <span class="keywordflow">if</span> (segment%radiation_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> i=segment%HI%IsdB,segment%HI%IedB</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;             ry_avg = ry_tang_rad(i,j,k)</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;             segment%tangential_vel(i,j,k) = (u_new(i,j,k) + ry_avg*u_new(i,j-1,k)) / (1.0+ry_avg)</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> i=segment%HI%IsdB,segment%HI%IedB</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;             <span class="keywordflow">if</span> (ry_tang_rad(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;             segment%tangential_vel(i,j,k) = (1.0 - gamma_2) * segment%tangential_vel(i,j,k) + &amp;</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;                                 gamma_2 * segment%nudged_tangential_vel(i,j,k)</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;         <span class="keywordflow">if</span> (segment%radiation_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;           is_obc = max(segment%HI%IsdB,g%isd+1)</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;           ie_obc = min(segment%HI%IedB,g%ied-1)</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> i=is_obc,ie_obc</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;             ry_avg = ry_tang_rad(i,j,k)</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;<span class="comment">!            if (G%mask2dCv(i,J-1) &gt; 0.0 .and. G%mask2dCv(i+1,J-1) &gt; 0.0) then</span></div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;<span class="comment">!              ry_avg = 0.5*(v_new(i,J-1,k) + v_new(i+1,J-1,k) * dt * G%IdyBu(I,J-1))</span></div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;<span class="comment">!            elseif (G%mask2dCv(i,J-1) &gt; 0.0) then</span></div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;<span class="comment">!              ry_avg = v_new(i,J-1,k) * dt *G%IdyBu(I,J-1)</span></div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;<span class="comment">!            elseif (G%mask2dCv(i+1,J-1) &gt; 0.0) then</span></div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;<span class="comment">!              ry_avg = v_new(i+1,J-1,k) * dt *G%IdyBu(I,J-1)</span></div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;<span class="comment">!            else</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;<span class="comment">!              ry_avg = 0.0</span></div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;<span class="comment">!            endif</span></div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;             segment%tangential_grad(i,j,k) = ((u_new(i,j,k) - u_new(i,j-1,k))*g%IdyBu(i,j-1) + &amp;</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;                               ry_avg*(u_new(i,j-1,k) - u_new(i,j-2,k))*g%IdyBu(i,j-2)) / (1.0+ry_avg)</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> i=segment%HI%IsdB,segment%HI%IedB</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;             <span class="keywordflow">if</span> (ry_tang_rad(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;             segment%tangential_grad(i,j,k) = (1.0 - gamma_2) * segment%tangential_grad(i,j,k) + &amp;</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;                                 gamma_2 * segment%nudged_tangential_grad(i,j,k)</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;         <span class="keyword">deallocate</span>(ry_tang_rad)</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;       <span class="keywordflow">if</span> (segment%oblique_tan .or. segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;         j=segment%HI%JsdB</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;         <span class="keyword">allocate</span>(rx_tang_obl(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;         <span class="keyword">allocate</span>(ry_tang_obl(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;         <span class="keyword">allocate</span>(cff_tangential(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;         <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;             rx_tang_obl(segment%HI%IsdB,j,k) = segment%rx_norm_obl(segment%HI%isd,j,k)</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;             rx_tang_obl(segment%HI%IedB,j,k) = segment%rx_norm_obl(segment%HI%ied,j,k)</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;             ry_tang_obl(segment%HI%IsdB,j,k) = segment%ry_norm_obl(segment%HI%isd,j,k)</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;             ry_tang_obl(segment%HI%IedB,j,k) = segment%ry_norm_obl(segment%HI%ied,j,k)</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;             cff_tangential(segment%HI%IsdB,j,k) = segment%cff_normal(segment%HI%isd,j,k)</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;             cff_tangential(segment%HI%IedB,j,k) = segment%cff_normal(segment%HI%ied,j,k)</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;             <span class="keywordflow">do</span> i=segment%HI%IsdB+1,segment%HI%IedB-1</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;               rx_tang_obl(i,j,k) = 0.5*(segment%rx_norm_obl(i,j,k) + segment%rx_norm_obl(i+1,j,k))</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;               ry_tang_obl(i,j,k) = 0.5*(segment%ry_norm_obl(i,j,k) + segment%ry_norm_obl(i+1,j,k))</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;               cff_tangential(i,j,k) = 0.5*(segment%cff_normal(i,j,k) + segment%cff_normal(i+1,j,k))</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;             <span class="keywordflow">do</span> i=segment%HI%IsdB,segment%HI%IedB</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;               dhdt = u_old(i,j,k)-u_new(i,j,k)   <span class="comment">!old-new</span></div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;               dhdy = u_new(i,j,k)-u_new(i,j-1,k) <span class="comment">!in new time backward sasha for I-1</span></div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;               <span class="keywordflow">if</span> (dhdt*(segment%grad_tan(i,1,k) + segment%grad_tan(i+1,1,k)) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;                 dhdx = segment%grad_tan(i,1,k)</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;               <span class="keywordflow">elseif</span> (dhdt*(segment%grad_tan(i,1,k) + segment%grad_tan(i+1,1,k)) == 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;                 dhdx = 0.0</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;               <span class="keywordflow">else</span></div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;                 dhdx = segment%grad_tan(i+1,1,k)</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;<span class="keywordflow">               endif</span></div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;               <span class="keywordflow">if</span> (dhdt*dhdy &lt; 0.0) dhdt = 0.0</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;               ry_new = dhdt*dhdy</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;               cff_new = max(dhdx*dhdx + dhdy*dhdy, eps)</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;               rx_new = min(cff_new,max(dhdt*dhdx,-cff_new))</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;               rx_tang_obl(i,j,k) = rx_new</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;               ry_tang_obl(i,j,k) = ry_new</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;               cff_tangential(i,j,k) = cff_new</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;<span class="keywordflow">         enddo</span></div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;         <span class="keywordflow">if</span> (segment%oblique_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> i=segment%HI%IsdB,segment%HI%IedB</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;             rx_avg = rx_tang_obl(i,j,k)</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;             ry_avg = ry_tang_obl(i,j,k)</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;             cff_avg = cff_tangential(i,j,k)</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;             segment%tangential_vel(i,j,k) = ((cff_avg*u_new(i,j,k) + ry_avg*u_new(i,j-1,k)) - &amp;</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;                                              (max(rx_avg,0.0)*segment%grad_tan(i,2,k) + &amp;</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;                                               min(rx_avg,0.0)*segment%grad_tan(i+1,2,k))) / &amp;</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;                                             (cff_avg + ry_avg)</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> i=segment%HI%IsdB,segment%HI%IedB</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;             <span class="keywordflow">if</span> (ry_tang_obl(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;             segment%tangential_vel(i,j,k) = (1.0 - gamma_2) * segment%tangential_vel(i,j,k) + &amp;</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;                                 gamma_2 * segment%nudged_tangential_vel(i,j,k)</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;         <span class="keywordflow">if</span> (segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;           is_obc = max(segment%HI%IsdB,g%isd+1)</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;           ie_obc = min(segment%HI%IedB,g%ied-1)</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> i=segment%HI%IsdB+1,segment%HI%IedB-1</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;             rx_avg = rx_tang_obl(i,j,k)</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;             ry_avg = ry_tang_obl(i,j,k)</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;             cff_avg = cff_tangential(i,j,k)</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;             segment%tangential_grad(i,j,k) =  &amp;</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;                 ((cff_avg*(u_new(i,j,k)   - u_new(i,j-1,k))*g%IdyBu(i,j-1) + &amp;</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;                    ry_avg*(u_new(i,j-1,k) - u_new(i,j-2,k))*g%IdyBu(i,j-2)) - &amp;</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;                                  (max(rx_avg,0.0)*segment%grad_gradient(i,2,k) + &amp;</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;                                   min(rx_avg,0.0)*segment%grad_gradient(i+1,2,k))) / &amp;</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;                                 (cff_avg + ry_avg)</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> i=segment%HI%IsdB,segment%HI%IedB</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;             <span class="keywordflow">if</span> (ry_tang_obl(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;             segment%tangential_grad(i,j,k) = (1.0 - gamma_2) * segment%tangential_grad(i,j,k) + &amp;</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;                                 gamma_2 * segment%nudged_tangential_grad(i,j,k)</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;         <span class="keyword">deallocate</span>(rx_tang_obl)</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;         <span class="keyword">deallocate</span>(ry_tang_obl)</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;         <span class="keyword">deallocate</span>(cff_tangential)</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160; </div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;     <span class="keywordflow">if</span> (segment%direction == obc_direction_s) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;       j=segment%HI%JsdB</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;       <span class="keywordflow">if</span> (j&gt;g%HI%JecB) cycle</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;       <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;         <span class="keywordflow">if</span> (segment%radiation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;           dhdt = (v_old(i,j+1,k) - v_new(i,j+1,k)) <span class="comment">!old-new</span></div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;           dhdy = (v_new(i,j+1,k) - v_new(i,j+2,k)) <span class="comment">!in new time backward sasha for J-1</span></div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;           ry_new = 0.0</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;           <span class="keywordflow">if</span> (dhdt*dhdy &gt; 0.0) ry_new = min( (dhdt/dhdy), ry_max)</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;             ry_avg = (1.0-gamma_u)*segment%ry_norm_rad(i,j,k) + gamma_u*ry_new</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;             ry_avg = ry_new</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;           segment%ry_norm_rad(i,j,k) = ry_avg</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;           <span class="comment">! The new boundary value is interpolated between future interior</span></div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;           <span class="comment">! value, v_new(J+1) and past boundary value but with barotropic</span></div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;           <span class="comment">! accelerations, v_new(J).</span></div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;           segment%normal_vel(i,j,k) = (v_new(i,j,k) + ry_avg*v_new(i,j+1,k)) / (1.0+ry_avg)</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;             <span class="comment">! Copy restart fields into 3-d arrays. This is an inefficient and temporary issues</span></div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;             <span class="comment">! implemented as a work-around to limitations in restart capability</span></div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;             obc%ry_normal(i,j,k) = segment%ry_norm_rad(i,j,k)</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;         <span class="keywordflow">elseif</span> (segment%oblique) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;           dhdt = (v_old(i,j+1,k) - v_new(i,j+1,k)) <span class="comment">!old-new</span></div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;           dhdy = (v_new(i,j+1,k) - v_new(i,j+2,k)) <span class="comment">!in new time backward sasha for J-1</span></div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;           <span class="keywordflow">if</span> (dhdt*(segment%grad_normal(i,1,k) + segment%grad_normal(i-1,1,k)) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;             dhdx = segment%grad_normal(i-1,1,k)</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;           <span class="keywordflow">elseif</span> (dhdt*(segment%grad_normal(i,1,k) + segment%grad_normal(i-1,1,k)) == 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;             dhdx = 0.0</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;             dhdx = segment%grad_normal(i,1,k)</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;           <span class="keywordflow">if</span> (dhdt*dhdy &lt; 0.0) dhdt = 0.0</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160; </div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;           ry_new = dhdt*dhdy</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;           cff_new = max(dhdx*dhdx + dhdy*dhdy, eps)</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;           rx_new = min(cff_new,max(dhdt*dhdx,-cff_new))</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;             rx_avg = (1.0-gamma_u)*segment%rx_norm_obl(i,j,k) + gamma_u*rx_new</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;             ry_avg = (1.0-gamma_u)*segment%ry_norm_obl(i,j,k) + gamma_u*ry_new</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;             cff_avg = (1.0-gamma_u)*segment%cff_normal(i,j,k) + gamma_u*cff_new</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;             rx_avg = rx_new</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;             ry_avg = ry_new</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;             cff_avg = cff_new</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;           segment%rx_norm_obl(i,j,k) = rx_avg</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;           segment%ry_norm_obl(i,j,k) = ry_avg</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;           segment%cff_normal(i,j,k) = cff_avg</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;           segment%normal_vel(i,j,k) = ((cff_avg*v_new(i,j,k) + ry_avg*v_new(i,j+1,k)) - &amp;</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;                                        (max(rx_avg,0.0)*segment%grad_normal(i-1,2,k) + &amp;</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;                                         min(rx_avg,0.0)*segment%grad_normal(i,2,k))) / &amp;</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;                                       (cff_avg + ry_avg)</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;             <span class="comment">! Copy restart fields into 3-d arrays. This is an inefficient and temporary issues</span></div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;             <span class="comment">! implemented as a work-around to limitations in restart capability</span></div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;             obc%rx_oblique(i,j,k) = segment%rx_norm_obl(i,j,k)</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;             obc%ry_oblique(i,j,k) = segment%ry_norm_obl(i,j,k)</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;             obc%cff_normal(i,j,k) = segment%cff_normal(i,j,k)</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;         <span class="keywordflow">elseif</span> (segment%gradient) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;           segment%normal_vel(i,j,k) = v_new(i,j+1,k)</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;         <span class="keywordflow">if</span> ((segment%radiation .or. segment%oblique) .and. segment%nudged) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;           <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;           <span class="keywordflow">if</span> (dhdt*dhdy &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;             tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;             tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;           gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;           segment%normal_vel(i,j,k) = (1.0 - gamma_2) * segment%normal_vel(i,j,k) + &amp;</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;                                 gamma_2 * segment%nudged_normal_vel(i,j,k)</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;<span class="keywordflow">       enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;       <span class="keywordflow">if</span> (segment%radiation_tan .or. segment%radiation_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;         j=segment%HI%JsdB</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;         <span class="keyword">allocate</span>(ry_tang_rad(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;         <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;             ry_tang_rad(segment%HI%IsdB,j,k) = segment%ry_norm_rad(segment%HI%isd,j,k)</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;             ry_tang_rad(segment%HI%IedB,j,k) = segment%ry_norm_rad(segment%HI%ied,j,k)</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;             <span class="keywordflow">do</span> i=segment%HI%IsdB+1,segment%HI%IedB-1</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;               ry_tang_rad(i,j,k) = 0.5*(segment%ry_norm_rad(i,j,k) + segment%ry_norm_rad(i+1,j,k))</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;             <span class="keywordflow">do</span> i=segment%HI%IsdB,segment%HI%IedB</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;               dhdt = u_old(i,j+1,k)-u_new(i,j+1,k)   <span class="comment">!old-new</span></div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;               dhdy = u_new(i,j+1,k)-u_new(i,j+2,k) <span class="comment">!in new time backward sasha for I-1</span></div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;               ry_tang_rad(i,j,k) = 0.0</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;               <span class="keywordflow">if</span> (dhdt*dhdy &gt; 0.0) ry_tang_rad(i,j,k) = min( (dhdt/dhdy), rx_max) <span class="comment">! outward phase speed</span></div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;<span class="keywordflow">         enddo</span></div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;         <span class="keywordflow">if</span> (segment%radiation_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> i=segment%HI%IsdB,segment%HI%IedB</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;             ry_avg = ry_tang_rad(i,j,k)</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;             segment%tangential_vel(i,j,k) = (u_new(i,j+1,k) + ry_avg*u_new(i,j+2,k)) / (1.0+ry_avg)</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> i=segment%HI%IsdB,segment%HI%IedB</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;             <span class="keywordflow">if</span> (ry_tang_rad(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;             segment%tangential_vel(i,j,k) = (1.0 - gamma_2) * segment%tangential_vel(i,j,k) + &amp;</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;                                 gamma_2 * segment%nudged_tangential_vel(i,j,k)</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;         <span class="keywordflow">if</span> (segment%radiation_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;           is_obc = max(segment%HI%IsdB,g%isd+1)</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;           ie_obc = min(segment%HI%IedB,g%ied-1)</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> i=is_obc,ie_obc</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;             ry_avg = ry_tang_rad(i,j,k)</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;<span class="comment">!            if (G%mask2dCv(i,J+1) &gt; 0.0 .and. G%mask2dCv(i+1,J+1) &gt; 0.0) then</span></div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;<span class="comment">!              ry_avg = 0.5*(v_new(i,J+1,k) + v_new(i+1,J+1,k)) * dt * G%IdyBu(I,J+1)</span></div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;<span class="comment">!            elseif (G%mask2dCv(i,J+1) &gt; 0.0) then</span></div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;<span class="comment">!              ry_avg = v_new(i,J+1,k) * dt * G%IdyBu(I,J+1)</span></div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;<span class="comment">!            elseif (G%mask2dCv(i+1,J+1) &gt; 0.0) then</span></div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;<span class="comment">!              ry_avg = v_new(i+1,J+1,k) * dt * G%IdyBu(I,J+1)</span></div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;<span class="comment">!            else</span></div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;<span class="comment">!              ry_avg = 0.0</span></div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;<span class="comment">!            endif</span></div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;             segment%tangential_grad(i,j,k) = ((u_new(i,j+2,k) - u_new(i,j+1,k))*g%IdyBu(i,j+1) + &amp;</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;                               ry_avg*(u_new(i,j+3,k) - u_new(i,j+2,k))*g%IdyBu(i,j+2)) / (1.0+ry_avg)</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;             <span class="keywordflow">if</span> (ry_tang_rad(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;             segment%tangential_grad(i,j,k) = (1.0 - gamma_2) * segment%tangential_grad(i,j,k) + &amp;</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;                                 gamma_2 * segment%nudged_tangential_grad(i,j,k)</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;         <span class="keyword">deallocate</span>(ry_tang_rad)</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;       <span class="keywordflow">if</span> (segment%oblique_tan .or. segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;         j=segment%HI%JsdB</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;         <span class="keyword">allocate</span>(rx_tang_obl(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;         <span class="keyword">allocate</span>(ry_tang_obl(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;         <span class="keyword">allocate</span>(cff_tangential(segment%HI%IsdB:segment%HI%IedB,segment%HI%JsdB:segment%HI%JedB,nz))</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;         <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;           <span class="keywordflow">if</span> (gamma_u &lt; 1.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;             rx_tang_obl(segment%HI%IsdB,j,k) = segment%rx_norm_obl(segment%HI%isd,j,k)</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;             rx_tang_obl(segment%HI%IedB,j,k) = segment%rx_norm_obl(segment%HI%ied,j,k)</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;             ry_tang_obl(segment%HI%IsdB,j,k) = segment%ry_norm_obl(segment%HI%isd,j,k)</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;             ry_tang_obl(segment%HI%IedB,j,k) = segment%ry_norm_obl(segment%HI%ied,j,k)</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;             cff_tangential(segment%HI%IsdB,j,k) = segment%cff_normal(segment%HI%isd,j,k)</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;             cff_tangential(segment%HI%IedB,j,k) = segment%cff_normal(segment%HI%ied,j,k)</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;             <span class="keywordflow">do</span> i=segment%HI%IsdB+1,segment%HI%IedB-1</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;               rx_tang_obl(i,j,k) = 0.5*(segment%rx_norm_obl(i,j,k) + segment%rx_norm_obl(i+1,j,k))</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;               ry_tang_obl(i,j,k) = 0.5*(segment%ry_norm_obl(i,j,k) + segment%ry_norm_obl(i+1,j,k))</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;               cff_tangential(i,j,k) = 0.5*(segment%cff_normal(i,j,k) + segment%cff_normal(i+1,j,k))</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;             <span class="keywordflow">do</span> i=segment%HI%IsdB,segment%HI%IedB</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;               dhdt = u_old(i,j+1,k)-u_new(i,j+1,k)   <span class="comment">!old-new</span></div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;               dhdy = u_new(i,j+1,k)-u_new(i,j+2,k) <span class="comment">!in new time backward sasha for I-1</span></div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;               <span class="keywordflow">if</span> (dhdt*(segment%grad_tan(i,1,k) + segment%grad_tan(i+1,1,k)) &gt; 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;                 dhdx = segment%grad_tan(i,1,k)</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;               <span class="keywordflow">elseif</span> (dhdt*(segment%grad_tan(i,1,k) + segment%grad_tan(i+1,1,k)) == 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;                 dhdx = 0.0</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;               <span class="keywordflow">else</span></div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;                 dhdx = segment%grad_tan(i+1,1,k)</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;<span class="keywordflow">               endif</span></div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;               <span class="keywordflow">if</span> (dhdt*dhdy &lt; 0.0) dhdt = 0.0</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;               ry_new = dhdt*dhdy</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;               cff_new = max(dhdx*dhdx + dhdy*dhdy, eps)</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;               rx_new = min(cff_new,max(dhdt*dhdx,-cff_new))</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;               rx_tang_obl(i,j,k) = rx_new</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;               ry_tang_obl(i,j,k) = ry_new</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;               cff_tangential(i,j,k) = cff_new</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;<span class="keywordflow">         enddo</span></div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;         <span class="keywordflow">if</span> (segment%oblique_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> i=segment%HI%IsdB,segment%HI%IedB</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;             rx_avg = rx_tang_obl(i,j,k)</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;             ry_avg = ry_tang_obl(i,j,k)</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;             cff_avg = cff_tangential(i,j,k)</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;             segment%tangential_vel(i,j,k) = ((cff_avg*u_new(i,j+1,k) + ry_avg*u_new(i,j+2,k)) - &amp;</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;                                              (max(rx_avg,0.0)*segment%grad_tan(i,2,k) + &amp;</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;                                               min(rx_avg,0.0)*segment%grad_tan(i+1,2,k)) ) / &amp;</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;                                             (cff_avg + ry_avg)</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> i=segment%HI%IsdB,segment%HI%IedB</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;             <span class="keywordflow">if</span> (ry_tang_obl(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;             segment%tangential_vel(i,j,k) = (1.0 - gamma_2) * segment%tangential_vel(i,j,k) + &amp;</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;                                             gamma_2 * segment%nudged_tangential_vel(i,j,k)</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;         <span class="keywordflow">if</span> (segment%oblique_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;           is_obc = max(segment%HI%IsdB,g%isd+1)</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;           ie_obc = min(segment%HI%IedB,g%ied-1)</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;           <span class="keywordflow">do</span> k=1,nz ;  <span class="keywordflow">do</span> i=segment%HI%IsdB+1,segment%HI%IedB-1</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;             rx_avg = rx_tang_obl(i,j,k)</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;             ry_avg = ry_tang_obl(i,j,k)</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;             cff_avg = cff_tangential(i,j,k)</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;             segment%tangential_grad(i,j,k) = &amp;</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;                 ((cff_avg*(u_new(i,j+2,k) - u_new(i,j+1,k))*g%IdyBu(i,j+1) + &amp;</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;                    ry_avg*(u_new(i,j+3,k) - u_new(i,j+2,k))*g%IdyBu(i,j+2)) - &amp;</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;                                  (max(rx_avg,0.0)*segment%grad_gradient(i,2,k) + &amp;</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;                                   min(rx_avg,0.0)*segment%grad_gradient(i+1,2,k))) / &amp;</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;                                 (cff_avg + ry_avg)</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;         <span class="keywordflow">if</span> (segment%nudged_grad) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;           <span class="keywordflow">do</span> k=1,nz ; <span class="keywordflow">do</span> j=segment%HI%JsdB,segment%HI%JedB</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;             <span class="comment">! dhdt gets set to 0 on inflow in oblique case</span></div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;             <span class="keywordflow">if</span> (ry_tang_obl(i,j,k) &lt;= 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;               tau = segment%Velocity_nudging_timescale_in</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;               tau = segment%Velocity_nudging_timescale_out</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;             gamma_2 = dt / (tau + dt)</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;             segment%tangential_grad(i,j,k) = (1.0 - gamma_2) * segment%tangential_grad(i,j,k) + &amp;</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;                                 gamma_2 * segment%nudged_tangential_grad(i,j,k)</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;<span class="keywordflow">           enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;         <span class="keyword">deallocate</span>(rx_tang_obl)</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;         <span class="keyword">deallocate</span>(ry_tang_obl)</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;         <span class="keyword">deallocate</span>(cff_tangential)</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160; </div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;  <span class="comment">! Actually update u_new, v_new</span></div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;  <span class="keyword">call </span>open_boundary_apply_normal_flow(obc, g, u_new, v_new)</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160; </div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;  <span class="keyword">call </span>pass_vector(u_new, v_new, g%Domain, clock=id_clock_pass)</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l02966">gradient_at_q_points()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00301">id_clock_pass</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00065">obc_direction_e</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00063">obc_direction_n</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00064">obc_direction_s</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00066">obc_direction_w</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l02898">open_boundary_apply_normal_flow()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_ae5ceafcce53e896d30012f321c73d9f4_cgraph.svg" width="394" height="134"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a05d15beca2ef2b44fb36d129166907fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05d15beca2ef2b44fb36d129166907fa">&#9670;&nbsp;</a></span>register_file_obc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical function, public mom_open_boundary::register_file_obc </td>
          <td>(</td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1file__obc__cs.html">file_obc_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1obc__registry__type.html">obc_registry_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC_Reg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add file to OBC registry. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>parameter file. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>file control structure. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc_reg</td><td>OBC registry. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l03951">3951</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;  <span class="keywordtype">type</span>(param_file_type),    <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; parameter file.</span></div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;  <span class="keywordtype">type</span>(file_OBC_CS),        <span class="keywordtype">pointer</span>    :: CS<span class="comment">         !&lt; file control structure.</span></div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;  <span class="keywordtype">type</span>(OBC_registry_type),  <span class="keywordtype">pointer</span>    :: OBC_Reg<span class="comment">    !&lt; OBC registry.</span></div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;  <span class="keywordtype">logical</span>                              :: register_file_OBC</div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;  <span class="keywordtype">character(len=32)</span>  :: casename = <span class="stringliteral">&quot;OBC file&quot;</span><span class="comment">        !&lt; This case&#39;s name.</span></div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160; </div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;register_file_OBC called with an &quot;</span>// &amp;</div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;                            <span class="stringliteral">&quot;associated control structure.&quot;</span>)</div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;  <span class="keyword">allocate</span>(cs)</div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160; </div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;  <span class="comment">! Register the file for boundary updates.</span></div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;  <span class="keyword">call </span>register_obc(casename, param_file, obc_reg)</div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;  register_file_obc = .true.</div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l03899">register_obc()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__boundary__update_8F90_source.html#l00062">mom_boundary_update::call_obc_register()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a05d15beca2ef2b44fb36d129166907fa_cgraph.svg" width="571" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a05d15beca2ef2b44fb36d129166907fa_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a8e0e22d829c122134f039228c6f1c7fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e0e22d829c122134f039228c6f1c7fb">&#9670;&nbsp;</a></span>register_obc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::register_obc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=32), intent(in)&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1obc__registry__type.html">obc_registry_type</a>), pointer&#160;</td>
          <td class="paramname"><em>Reg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>register open boundary objects for boundary updates. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>OBC name used for error messages </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>file to parse for model parameter values </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">reg</td><td>pointer to the tracer registry </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l03899">3899</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;  <span class="keywordtype">character(len=32)</span>,     <span class="keywordtype">intent(in)</span>  :: name<span class="comment">        !&lt; OBC name used for error messages</span></div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;  <span class="keywordtype">type</span>(param_file_type), <span class="keywordtype">intent(in)</span>  :: param_file<span class="comment">  !&lt; file to parse for  model parameter values</span></div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;  <span class="keywordtype">type</span>(OBC_registry_type), <span class="keywordtype">pointer</span>   :: Reg<span class="comment">         !&lt; pointer to the tracer registry</span></div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;  <span class="keywordtype">integer</span> :: nobc</div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;  <span class="keywordtype">character(len=256)</span> :: mesg    <span class="comment">! Message for error messages.</span></div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160; </div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(reg)) <span class="keyword">call </span>obc_registry_init(param_file, reg)</div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160; </div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;  <span class="keywordflow">if</span> (reg%nobc&gt;=max_fields_) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;    <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;Increase MAX_FIELDS_ in MOM_memory.h to at least &quot;,I3,&quot; to allow for &amp;</span></div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;<span class="stringliteral"></span><span class="stringliteral">        &amp;all the open boundaries being registered via register_OBC.&quot;)&#39;</span>) reg%nobc+1</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;    <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;MOM register_tracer: &quot;</span>//mesg)</div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;  reg%nobc = reg%nobc + 1</div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;  nobc     = reg%nobc</div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160; </div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;  reg%OB(nobc)%name = name</div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160; </div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;  <span class="keywordflow">if</span> (reg%locked) <span class="keyword">call </span>mom_error(fatal, &amp;</div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;      <span class="stringliteral">&quot;MOM register_tracer was called for variable &quot;</span>//trim(reg%OB(nobc)%name)//&amp;</div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;      <span class="stringliteral">&quot; with a locked tracer registry.&quot;</span>)</div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l03925">obc_registry_init()</a>.</p>

<p class="reference">Referenced by <a class="el" href="dyed__channel__initialization_8F90_source.html#l00041">dyed_channel_initialization::register_dyed_channel_obc()</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l03951">register_file_obc()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a8e0e22d829c122134f039228c6f1c7fb_cgraph.svg" width="368" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a8e0e22d829c122134f039228c6f1c7fb_icgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a5d5843dd1a4e1475f69b5eb2c5b0197d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d5843dd1a4e1475f69b5eb2c5b0197d">&#9670;&nbsp;</a></span>register_segment_tracer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::register_segment_tracer </td>
          <td>(</td>
          <td class="paramtype">type(tracer_type), target&#160;</td>
          <td class="paramname"><em>tr_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1obc__segment__type.html">obc_segment_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>segment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>OBC_scalar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>OBC_array</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">tr_ptr</td><td>A target that can be used to set a pointer to the stored value of tr. This target must be an enduring part of the control structure, because the tracer registry will use this memory, but it also means that any updates to this structure in the calling module will be available subsequently to the tracer registry.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>file to parse for model parameter values</td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">segment</td><td>current segment data structure</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">obc_scalar</td><td>If present, use scalar value for segment tracer inflow concentration.</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">obc_array</td><td>If true, use array values for segment tracer inflow concentration. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l04013">4013</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type), <span class="keywordtype">intent(in)</span>   :: GV<span class="comment">         !&lt; ocean vertical grid structure</span></div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;  <span class="keywordtype">type</span>(tracer_type), <span class="keywordtype">target</span>             :: tr_ptr<span class="comment">     !&lt; A target that can be used to set a pointer to the</span></div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;<span class="comment">                                                      !! stored value of tr. This target must be</span></div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;<span class="comment">                                                      !! an enduring part of the control structure,</span></div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;<span class="comment">                                                      !! because the tracer registry will use this memory,</span></div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;<span class="comment">                                                      !! but it also means that any updates to this</span></div>
<div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;<span class="comment">                                                      !! structure in the calling module will be</span></div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;<span class="comment">                                                      !! available subsequently to the tracer registry.</span></div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;  <span class="keywordtype">type</span>(param_file_type), <span class="keywordtype">intent(in)</span>     :: param_file<span class="comment"> !&lt; file to parse for  model parameter values</span></div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">intent(inout)</span> :: segment<span class="comment">    !&lt; current segment data structure</span></div>
<div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>            :: OBC_scalar<span class="comment"> !&lt; If present, use scalar value for segment tracer</span></div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;<span class="comment">                                                      !! inflow concentration.</span></div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>         :: OBC_array<span class="comment">  !&lt; If true, use array values for segment tracer</span></div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;<span class="comment">                                                      !! inflow concentration.</span></div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160; </div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160; </div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;<span class="comment">! Local variables</span></div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;  <span class="keywordtype">integer</span> :: ntseg</div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, jsd, jed</div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;  <span class="keywordtype">integer</span> :: IsdB, IedB, JsdB, JedB</div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;  <span class="keywordtype">character(len=256)</span> :: mesg    <span class="comment">! Message for error messages.</span></div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160; </div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;  <span class="keyword">call </span>segment_tracer_registry_init(param_file, segment)</div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160; </div>
<div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;  <span class="keywordflow">if</span> (segment%tr_Reg%ntseg&gt;=max_fields_) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;    <span class="keyword">write</span>(mesg,<span class="stringliteral">&#39;(&quot;Increase MAX_FIELDS_ in MOM_memory.h to at least &quot;,I3,&quot; to allow for &amp;</span></div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;<span class="stringliteral"></span><span class="stringliteral">        &amp;all the tracers being registered via register_tracer.&quot;)&#39;</span>) segment%tr_Reg%ntseg+1</div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;    <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;MOM register_tracer: &quot;</span>//mesg)</div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;  segment%tr_Reg%ntseg = segment%tr_Reg%ntseg + 1</div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;  ntseg     = segment%tr_Reg%ntseg</div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160; </div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;  isd = segment%HI%isd ; ied = segment%HI%ied</div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;  jsd = segment%HI%jsd ; jed = segment%HI%jed</div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;  isdb = segment%HI%IsdB ; iedb = segment%HI%IedB</div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;  jsdb = segment%HI%JsdB ; jedb = segment%HI%JedB</div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160; </div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;  segment%tr_Reg%Tr(ntseg)%Tr =&gt; tr_ptr</div>
<div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;  segment%tr_Reg%Tr(ntseg)%name = tr_ptr%name</div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160; </div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;  <span class="keywordflow">if</span> (segment%tr_Reg%locked) <span class="keyword">call </span>mom_error(fatal, &amp;</div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;      <span class="stringliteral">&quot;MOM register_tracer was called for variable &quot;</span>//trim(segment%tr_Reg%Tr(ntseg)%name)//&amp;</div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;      <span class="stringliteral">&quot; with a locked tracer registry.&quot;</span>)</div>
<div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160; </div>
<div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(obc_scalar)) segment%tr_Reg%Tr(ntseg)%OBC_inflow_conc = obc_scalar <span class="comment">! initialize tracer value later</span></div>
<div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(obc_array)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;    <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;      <span class="keyword">allocate</span>(segment%tr_Reg%Tr(ntseg)%t(isdb:iedb,jsd:jed,1:gv%ke));segment%tr_Reg%Tr(ntseg)%t(:,:,:)=0.0</div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;      <span class="keyword">allocate</span>(segment%tr_Reg%Tr(ntseg)%tres(isdb:iedb,jsd:jed,1:gv%ke));segment%tr_Reg%Tr(ntseg)%tres(:,:,:)=0.0</div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;      segment%tr_Reg%Tr(ntseg)%is_initialized=.false.</div>
<div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;    <span class="keywordflow">elseif</span> (segment%is_N_or_S) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;      <span class="keyword">allocate</span>(segment%tr_Reg%Tr(ntseg)%t(isd:ied,jsdb:jedb,1:gv%ke));segment%tr_Reg%Tr(ntseg)%t(:,:,:)=0.0</div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;      <span class="keyword">allocate</span>(segment%tr_Reg%Tr(ntseg)%tres(isd:ied,jsdb:jedb,1:gv%ke));segment%tr_Reg%Tr(ntseg)%tres(:,:,:)=0.0</div>
<div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;      segment%tr_Reg%Tr(ntseg)%is_initialized=.false.</div>
<div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l03981">segment_tracer_registry_init()</a>.</p>

<p class="reference">Referenced by <a class="el" href="DOME__initialization_8F90_source.html#l00245">dome_initialization::dome_set_obc_data()</a>, <a class="el" href="dyed__obcs__initialization_8F90_source.html#l00031">dyed_obcs_initialization::dyed_obcs_set_obc_data()</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l04088">register_temp_salt_segments()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a5d5843dd1a4e1475f69b5eb2c5b0197d_cgraph.svg" width="408" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a5d5843dd1a4e1475f69b5eb2c5b0197d_icgraph.svg" width="100%" height="437"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a0459cfc5b4e4115bde6ada1dd7c25139"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0459cfc5b4e4115bde6ada1dd7c25139">&#9670;&nbsp;</a></span>register_temp_salt_segments()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::register_temp_salt_segments </td>
          <td>(</td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(tracer_registry_type), pointer&#160;</td>
          <td class="paramname"><em>tr_Reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary structure</td></tr>
    <tr><td class="paramdir"></td><td class="paramname">tr_reg</td><td>Tracer registry</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>file to parse for model parameter values </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l04088">4088</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type),    <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">         !&lt; ocean vertical grid structure</span></div>
<div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),       <span class="keywordtype">pointer</span>       :: OBC<span class="comment">        !&lt; Open boundary structure</span></div>
<div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type), <span class="keywordtype">pointer</span>       :: tr_Reg<span class="comment">     !&lt; Tracer registry</span></div>
<div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;  <span class="keywordtype">type</span>(param_file_type),      <span class="keywordtype">intent(in)</span>    :: param_file<span class="comment"> !&lt; file to parse for  model parameter values</span></div>
<div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160; </div>
<div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;<span class="comment">! Local variables</span></div>
<div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;  <span class="keywordtype">integer</span> :: isd, ied, IsdB, IedB, jsd, jed, JsdB, JedB, nz, nf</div>
<div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, n</div>
<div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;  <span class="keywordtype">character(len=32)</span>  :: name</div>
<div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment =&gt; null() <span class="comment">! pointer to segment type list</span></div>
<div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;  <span class="keywordtype">type</span>(tracer_type), <span class="keywordtype">pointer</span>      :: tr_ptr =&gt; null()</div>
<div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160; </div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(obc)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160; </div>
<div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;  <span class="keywordflow">do</span> n=1, obc%number_of_segments</div>
<div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;    segment=&gt;obc%segment(n)</div>
<div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;    <span class="keywordflow">if</span> (.not. segment%on_pe) cycle</div>
<div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160; </div>
<div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%tr_Reg)) &amp;</div>
<div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;         <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;register_temp_salt_segments: tracer array was previously allocated&quot;</span>)</div>
<div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160; </div>
<div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;    name = <span class="stringliteral">&#39;temp&#39;</span></div>
<div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;    <span class="keyword">call </span>tracer_name_lookup(tr_reg, tr_ptr, name)</div>
<div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;    <span class="keyword">call </span>register_segment_tracer(tr_ptr, param_file, gv, segment, &amp;</div>
<div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;                                 obc_array=segment%temp_segment_data_exists)</div>
<div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;    name = <span class="stringliteral">&#39;salt&#39;</span></div>
<div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;    <span class="keyword">call </span>tracer_name_lookup(tr_reg, tr_ptr, name)</div>
<div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;    <span class="keyword">call </span>register_segment_tracer(tr_ptr, param_file, gv, segment, &amp;</div>
<div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;                                 obc_array=segment%salt_segment_data_exists)</div>
<div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l04013">register_segment_tracer()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a0459cfc5b4e4115bde6ada1dd7c25139_cgraph.svg" width="650" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a71194a8dc156fea37aab6539cc124086"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71194a8dc156fea37aab6539cc124086">&#9670;&nbsp;</a></span>segment_tracer_registry_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::segment_tracer_registry_end </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1segment__tracer__registry__type.html">segment_tracer_registry_type</a>), pointer&#160;</td>
          <td class="paramname"><em>Reg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clean up the segment tracer registry. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">reg</td><td>pointer to tracer registry </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l04074">4074</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;  <span class="keywordtype">type</span>(segment_tracer_registry_type), <span class="keywordtype">pointer</span> :: Reg<span class="comment">        !&lt; pointer to tracer registry</span></div>
<div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160; </div>
<div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;<span class="comment">! Local variables</span></div>
<div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;  <span class="keywordtype">integer</span> n</div>
<div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160; </div>
<div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(reg)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;    <span class="keywordflow">do</span> n = 1, reg%ntseg</div>
<div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">associated</span>(reg%Tr(n)%t)) <span class="keyword">deallocate</span>(reg%Tr(n)%t)</div>
<div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;    <span class="keyword">deallocate</span>(reg)</div>
<div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;<span class="keywordflow">  endif</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l03278">deallocate_obc_segment_data()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a71194a8dc156fea37aab6539cc124086_icgraph.svg" width="100%" height="388"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="adcd9637c6cc17658fe064ce1dc1011bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adcd9637c6cc17658fe064ce1dc1011bf">&#9670;&nbsp;</a></span>segment_tracer_registry_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::segment_tracer_registry_init </td>
          <td>(</td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1obc__segment__type.html">obc_segment_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>segment</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the segment tracer registry. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>open file to parse for model parameters </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">segment</td><td>the segment </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l03981">3981</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;  <span class="keywordtype">type</span>(param_file_type),      <span class="keywordtype">intent(in)</span>      :: param_file<span class="comment"> !&lt; open file to parse for model parameters</span></div>
<div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">intent(inout)</span>       :: segment<span class="comment">    !&lt;  the segment</span></div>
<div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160; </div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">save</span> :: init_calls = 0</div>
<div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160; </div>
<div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div>
<div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div>
<div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;segment_tracer_registry_init&quot;</span> <span class="comment">! This routine&#39;s name.</span></div>
<div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;  <span class="keywordtype">character(len=256)</span> :: mesg    <span class="comment">! Message for error messages.</span></div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160; </div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(segment%tr_Reg)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;    <span class="keyword">allocate</span>(segment%tr_Reg)</div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160; </div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;  init_calls = init_calls + 1</div>
<div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160; </div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;  <span class="comment">! Read all relevant parameters and write them to the model log.</span></div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;  <span class="keywordflow">if</span> (init_calls == 1) <span class="keyword">call </span>log_version(param_file, mdl, version, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160; </div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;<span class="comment">! Need to call once per segment with tracers...</span></div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;<span class="comment">! if (init_calls &gt; 1) then</span></div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;<span class="comment">!   write(mesg,&#39;(&quot;segment_tracer_registry_init called &quot;,I3, &amp;</span></div>
<div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;<span class="comment">!     &amp;&quot; times with different registry pointers.&quot;)&#39;) init_calls</span></div>
<div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;<span class="comment">!   if (is_root_pe()) call MOM_error(WARNING,&quot;MOM_tracer&quot;//mesg)</span></div>
<div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;<span class="comment">! endif</span></div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l00303">mdl</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l04013">register_segment_tracer()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_adcd9637c6cc17658fe064ce1dc1011bf_icgraph.svg" width="100%" height="437"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a0a4c67f2e0fe21f1a2274be12844a71a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a4c67f2e0fe21f1a2274be12844a71a">&#9670;&nbsp;</a></span>set_tracer_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::set_tracer_data </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(inout)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g), szk_(g)), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>PF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(tracer_registry_type), pointer&#160;</td>
          <td class="paramname"><em>tracer_Reg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the initial values of the tracer open boundary conditions. Redoing this elsewhere. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">tv</td><td>Thermodynamics structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Thickness </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pf</td><td>Parameter file handle </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">tracer_reg</td><td>Tracer registry </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l03090">3090</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(inout)</span> :: G<span class="comment"> !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),                      <span class="keywordtype">pointer</span>       :: OBC<span class="comment"> !&lt; Open boundary structure</span></div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                     <span class="keywordtype">intent(inout)</span> :: tv<span class="comment"> !&lt; Thermodynamics structure</span></div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: h<span class="comment"> !&lt; Thickness</span></div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;  <span class="keywordtype">type</span>(param_file_type),                     <span class="keywordtype">intent(in)</span>    :: PF<span class="comment"> !&lt; Parameter file handle</span></div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type),                <span class="keywordtype">pointer</span>       :: tracer_Reg<span class="comment"> !&lt; Tracer registry</span></div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, itt, is, ie, js, je, isd, ied, jsd, jed, nz, n</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;  <span class="keywordtype">integer</span> :: isd_off, jsd_off</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;  <span class="keywordtype">integer</span> :: IsdB, IedB, JsdB, JedB</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment  =&gt; null() <span class="comment">! pointer to segment type list</span></div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;set_tracer_data&quot;</span> <span class="comment">! This subroutine&#39;s name.</span></div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;  <span class="keywordtype">character(len=200)</span> :: filename, OBC_file, inputdir <span class="comment">! Strings for file/path</span></div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160; </div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;<span class="keywordtype">  real</span> :: temp_u(G%domain%niglobal+1,G%domain%njglobal)</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;<span class="keywordtype">  real</span> :: temp_v(G%domain%niglobal,G%domain%njglobal+1)</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160; </div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec ; nz = g%ke</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;  isd = g%isd ; ied = g%ied ; jsd = g%jsd ; jed = g%jed</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;  isdb = g%IsdB ; iedb = g%IedB ; jsdb = g%JsdB ; jedb = g%JedB</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160; </div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;  <span class="comment">! For now, there are no radiation conditions applied to the thicknesses, since</span></div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;  <span class="comment">! the thicknesses might not be physically motivated.  Instead, sponges should be</span></div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;  <span class="comment">! used to enforce the near-boundary layer structure.</span></div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160; </div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(tv%T)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160; </div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;    <span class="keyword">call </span>pass_var(tv%T, g%Domain)</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;    <span class="keyword">call </span>pass_var(tv%S, g%Domain)</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160; </div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;    <span class="keywordflow">do</span> n=1,obc%number_of_segments</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;      segment =&gt; obc%segment(n)</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;      <span class="keywordflow">if</span> (.not. segment%on_pe) cycle</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160; </div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;      <span class="keywordflow">if</span> (segment%direction == obc_direction_e) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;        i=segment%HI%IsdB</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke ;  <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;          tv%T(i+1,j,k) = tv%T(i,j,k) ; tv%S(i+1,j,k) = tv%S(i,j,k)</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;      <span class="keywordflow">elseif</span> (segment%direction == obc_direction_w) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;        i=segment%HI%IsdB</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke ;  <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;          tv%T(i,j,k) = tv%T(i+1,j,k) ; tv%S(i,j,k) = tv%S(i+1,j,k)</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;      <span class="keywordflow">elseif</span> (segment%direction == obc_direction_n) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;        j=segment%HI%JsdB</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke ;  <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;          tv%T(i,j+1,k) = tv%T(i,j,k) ; tv%S(i,j+1,k) = tv%S(i,j,k)</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;      <span class="keywordflow">elseif</span> (segment%direction == obc_direction_s) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;        j=segment%HI%JsdB</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke ;  <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;          tv%T(i,j,k) = tv%T(i,j+1,k) ; tv%S(i,j,k) = tv%S(i,j+1,k)</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l00065">obc_direction_e</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00063">obc_direction_n</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00064">obc_direction_s</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00066">obc_direction_w</a>.</p>

</div>
</div>
<a id="a2578141730f51e42c56bb05c3648ea08"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2578141730f51e42c56bb05c3648ea08">&#9670;&nbsp;</a></span>setup_obc_tracer_reservoirs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::setup_obc_tracer_reservoirs </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Make sure the OBC tracer reservoirs are initialized. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l01749">1749</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),      <span class="keywordtype">intent(inout)</span> :: G<span class="comment">          !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),       <span class="keywordtype">pointer</span>       :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment =&gt; null()</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, m, n</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160; </div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;  <span class="keywordflow">do</span> n=1,obc%number_of_segments</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    segment=&gt;obc%segment(n)</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%tr_Reg)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        i = segment%HI%IsdB</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        <span class="keywordflow">do</span> m=1,obc%ntr</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%tr_Reg%Tr(m)%tres)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;            <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;              <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;                obc%tres_x(i,j,k,m) = segment%tr_Reg%Tr(m)%t(i,j,k)</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="keywordflow">            enddo</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;        j = segment%HI%JsdB</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;        <span class="keywordflow">do</span> m=1,obc%ntr</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%tr_Reg%Tr(m)%tres)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;            <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;              <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;                obc%tres_y(i,j,k,m) = segment%tr_Reg%Tr(m)%t(i,j,k)</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="keywordflow">            enddo</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l04122">fill_temp_salt_segments()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a2578141730f51e42c56bb05c3648ea08_icgraph.svg" width="408" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ac357a1fb341db3aaffdfeca2eacab60b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac357a1fb341db3aaffdfeca2eacab60b">&#9670;&nbsp;</a></span>setup_segment_indices()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::setup_segment_indices </td>
          <td>(</td>
          <td class="paramtype">type(dyn_horgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1obc__segment__type.html">obc_segment_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>seg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>Is_obc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>Ie_obc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>Js_obc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>Je_obc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Define indices for segment and store in hor_index_type using global segment bounds corresponding to q-points. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>grid type </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">seg</td><td>Open boundary segment </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">is_obc</td><td>Q-point global i-index of start of segment </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ie_obc</td><td>Q-point global i-index of end of segment </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">js_obc</td><td>Q-point global j-index of start of segment </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">je_obc</td><td>Q-point global j-index of end of segment </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00799">799</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="keywordtype">type</span>(dyn_horgrid_type), <span class="keywordtype">intent(in)</span> :: G<span class="comment"> !&lt; grid type</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">intent(inout)</span> :: seg<span class="comment">  !&lt; Open boundary segment</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: Is_obc<span class="comment"> !&lt; Q-point global i-index of start of segment</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: Ie_obc<span class="comment"> !&lt; Q-point global i-index of end of segment</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: Js_obc<span class="comment"> !&lt; Q-point global j-index of start of segment</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: Je_obc<span class="comment"> !&lt; Q-point global j-index of end of segment</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keywordtype">integer</span> :: Isg,Ieg,Jsg,Jeg</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160; </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="comment">! Isg, Ieg will be I*_obc in global space</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <span class="keywordflow">if</span> (ie_obc&lt;is_obc) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    isg=ie_obc;ieg=is_obc</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    isg=is_obc;ieg=ie_obc</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="keywordflow">if</span> (je_obc&lt;js_obc) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    jsg=je_obc;jeg=js_obc</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    jsg=js_obc;jeg=je_obc</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160; </div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="comment">! Global space I*_obc but sorted</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  seg%HI%IsgB = isg ; seg%HI%IegB = ieg</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  seg%HI%isg = isg+1 ; seg%HI%ieg = ieg</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  seg%HI%JsgB = jsg ; seg%HI%JegB = jeg</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  seg%HI%jsg = jsg+1 ; seg%HI%Jeg = jeg</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <span class="comment">! Move into local index space</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  isg = isg - g%idg_offset</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  jsg = jsg - g%jdg_offset</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  ieg = ieg - g%idg_offset</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  jeg = jeg - g%jdg_offset</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="comment">! This is the i-extent of the segment on this PE.</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="comment">! The values are nonsense if the segment is not on this PE.</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  seg%HI%IsdB = min( max(isg, g%HI%IsdB), g%HI%IedB)</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  seg%HI%IedB = min( max(ieg, g%HI%IsdB), g%HI%IedB)</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  seg%HI%isd = min( max(isg+1, g%HI%isd), g%HI%ied)</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  seg%HI%ied = min( max(ieg, g%HI%isd), g%HI%ied)</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  seg%HI%IscB = min( max(isg, g%HI%IscB), g%HI%IecB)</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  seg%HI%IecB = min( max(ieg, g%HI%IscB), g%HI%IecB)</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  seg%HI%isc = min( max(isg+1, g%HI%isc), g%HI%iec)</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  seg%HI%iec = min( max(ieg, g%HI%isc), g%HI%iec)</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160; </div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="comment">! This is the j-extent of the segment on this PE.</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="comment">! The values are nonsense if the segment is not on this PE.</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  seg%HI%JsdB = min( max(jsg, g%HI%JsdB), g%HI%JedB)</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  seg%HI%JedB = min( max(jeg, g%HI%JsdB), g%HI%JedB)</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  seg%HI%jsd = min( max(jsg+1, g%HI%jsd), g%HI%jed)</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  seg%HI%jed = min( max(jeg, g%HI%jsd), g%HI%jed)</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  seg%HI%JscB = min( max(jsg, g%HI%JscB), g%HI%JecB)</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  seg%HI%JecB = min( max(jeg, g%HI%JscB), g%HI%JecB)</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  seg%HI%jsc = min( max(jsg+1, g%HI%jsc), g%HI%jec)</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  seg%HI%jec = min( max(jeg, g%HI%jsc), g%HI%jec)</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l00858">setup_u_point_obc()</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00994">setup_v_point_obc()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_ac357a1fb341db3aaffdfeca2eacab60b_icgraph.svg" width="575" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aa40e3464225d4e017b1a738995eeb3b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa40e3464225d4e017b1a738995eeb3b2">&#9670;&nbsp;</a></span>setup_u_point_obc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::setup_u_point_obc </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(dyn_horgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>segment_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>l_seg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>PF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>reentrant_y</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse an OBC_SEGMENT_%%% string starting with "I=" and configure placement and type of OBC accordingly. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary control structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">segment_str</td><td>A string in form of "I=%,J=%:%,string" </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">l_seg</td><td>which segment is this? </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pf</td><td>Parameter file handle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reentrant_y</td><td>is the domain reentrant in y? </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00858">858</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),    <span class="keywordtype">pointer</span>    :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordtype">type</span>(dyn_horgrid_type),  <span class="keywordtype">intent(in)</span> :: G<span class="comment">   !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),   <span class="keywordtype">intent(in)</span> :: US<span class="comment">  !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="keywordtype">character(len=*)</span>,        <span class="keywordtype">intent(in)</span> :: segment_str<span class="comment"> !&lt; A string in form of &quot;I=%,J=%:%,string&quot;</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span> :: l_seg<span class="comment"> !&lt; which segment is this?</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="keywordtype">type</span>(param_file_type), <span class="keywordtype">intent(in)</span>   :: PF<span class="comment">  !&lt; Parameter file handle</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>                 :: reentrant_y<span class="comment"> !&lt; is the domain reentrant in y?</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="keywordtype">integer</span> :: I_obc, Js_obc, Je_obc <span class="comment">! Position of segment in global index space</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="keywordtype">integer</span> :: j, a_loop</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="keywordtype">character(len=32)</span> :: action_str(8)</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="keywordtype">character(len=128)</span> :: segment_param_str</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span>  :: tnudge</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="comment">! This returns the global indices for the segment</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="keyword">call </span>parse_segment_str(g%ieg, g%jeg, segment_str, i_obc, js_obc, je_obc, action_str, reentrant_y)</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160; </div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keyword">call </span>setup_segment_indices(g, obc%segment(l_seg),i_obc,i_obc,js_obc,je_obc)</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  i_obc = i_obc - g%idg_offset <span class="comment">! Convert to local tile indices on this tile</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  js_obc = js_obc - g%jdg_offset <span class="comment">! Convert to local tile indices on this tile</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  je_obc = je_obc - g%jdg_offset <span class="comment">! Convert to local tile indices on this tile</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keywordflow">if</span> (je_obc&gt;js_obc) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    obc%segment(l_seg)%direction = obc_direction_e</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="keywordflow">elseif</span> (je_obc&lt;js_obc) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    obc%segment(l_seg)%direction = obc_direction_w</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    j=js_obc;js_obc=je_obc;je_obc=j</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160; </div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  obc%segment(l_seg)%on_pe = .false.</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160; </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="keywordflow">do</span> a_loop = 1,8 <span class="comment">! up to 8 options available</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordflow">if</span> (len_trim(action_str(a_loop)) == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      cycle</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;FLATHER&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      obc%segment(l_seg)%Flather = .true.</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      obc%segment(l_seg)%open = .true.</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      obc%Flather_u_BCs_exist_globally = .true.</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      obc%open_u_BCs_exist_globally = .true.</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      obc%segment%z_values_needed = .true.</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      obc%segment%u_values_needed = .true.</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;ORLANSKI&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      obc%segment(l_seg)%radiation = .true.</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      obc%segment(l_seg)%open = .true.</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      obc%open_u_BCs_exist_globally = .true.</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      obc%radiation_BCs_exist_globally = .true.</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;ORLANSKI_TAN&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      obc%segment(l_seg)%radiation = .true.</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      obc%segment(l_seg)%radiation_tan = .true.</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      obc%radiation_BCs_exist_globally = .true.</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;ORLANSKI_GRAD&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      obc%segment(l_seg)%radiation = .true.</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      obc%segment(l_seg)%radiation_grad = .true.</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;OBLIQUE&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;      obc%segment(l_seg)%oblique = .true.</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      obc%segment(l_seg)%open = .true.</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      obc%oblique_BCs_exist_globally = .true.</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      obc%open_u_BCs_exist_globally = .true.</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;OBLIQUE_TAN&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      obc%segment(l_seg)%oblique = .true.</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      obc%segment(l_seg)%oblique_tan = .true.</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      obc%oblique_BCs_exist_globally = .true.</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;OBLIQUE_GRAD&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      obc%segment(l_seg)%oblique = .true.</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      obc%segment(l_seg)%oblique_grad = .true.</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;NUDGED&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      obc%segment(l_seg)%nudged = .true.</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      obc%nudged_u_BCs_exist_globally = .true.</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      obc%segment%u_values_needed = .true.</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;NUDGED_TAN&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      obc%segment(l_seg)%nudged_tan = .true.</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      obc%nudged_u_BCs_exist_globally = .true.</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      obc%segment%v_values_needed = .true.</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;NUDGED_GRAD&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      obc%segment(l_seg)%nudged_grad = .true.</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      obc%segment%g_values_needed = .true.</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;GRADIENT&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      obc%segment(l_seg)%gradient = .true.</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      obc%segment(l_seg)%open = .true.</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      obc%open_u_BCs_exist_globally = .true.</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;SIMPLE&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      obc%segment(l_seg)%specified = .true.</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      obc%specified_u_BCs_exist_globally = .true. <span class="comment">! This avoids deallocation</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      obc%segment%u_values_needed = .true.</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;SIMPLE_TAN&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      obc%segment(l_seg)%specified_tan = .true.</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, setup_u_point_obc: &quot;</span>//&amp;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                     <span class="stringliteral">&quot;String &#39;&quot;</span>//trim(action_str(a_loop))//<span class="stringliteral">&quot;&#39; not understood.&quot;</span>)</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keywordflow">if</span> (obc%segment(l_seg)%nudged .or. obc%segment(l_seg)%nudged_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      <span class="keyword">write</span>(segment_param_str(1:43),<span class="stringliteral">&quot;(&#39;OBC_SEGMENT_&#39;,i3.3,&#39;_VELOCITY_NUDGING_TIMESCALES&#39;)&quot;</span>) l_seg</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;      <span class="keyword">allocate</span>(tnudge(2))</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;      <span class="keyword">call </span>get_param(pf, mdl, segment_param_str(1:43), tnudge, &amp;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                     <span class="stringliteral">&quot;Timescales in days for nudging along a segment, &quot;</span>//&amp;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                     <span class="stringliteral">&quot;for inflow, then outflow. Setting both to zero should &quot;</span>//&amp;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                     <span class="stringliteral">&quot;behave like SIMPLE obcs for the baroclinic velocities.&quot;</span>, &amp;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                     fail_if_missing=.true., default=0., units=<span class="stringliteral">&quot;days&quot;</span>, scale=86400.0*us%s_to_T)</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;      obc%segment(l_seg)%Velocity_nudging_timescale_in = tnudge(1)</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      obc%segment(l_seg)%Velocity_nudging_timescale_out = tnudge(2)</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <span class="keyword">deallocate</span>(tnudge)</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160; </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="keywordflow">  enddo</span> <span class="comment">! a_loop</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160; </div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  obc%segment(l_seg)%is_E_or_W_2 = .true.</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160; </div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="keywordflow">if</span> (i_obc&lt;=g%HI%IsdB+1 .or. i_obc&gt;=g%HI%IedB-1) <span class="keywordflow">return</span> <span class="comment">! Boundary is not on tile</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">if</span> (je_obc&lt;=g%HI%JsdB .or. js_obc&gt;=g%HI%JedB) <span class="keywordflow">return</span> <span class="comment">! Segment is not on tile</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160; </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  obc%segment(l_seg)%on_pe = .true.</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  obc%segment(l_seg)%is_E_or_W = .true.</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160; </div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordflow">do</span> j=g%HI%jsd, g%HI%jed</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordflow">if</span> (j&gt;js_obc .and. j&lt;=je_obc) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      obc%segnum_u(i_obc,j) = l_seg</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  obc%segment(l_seg)%Is_obc = i_obc</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  obc%segment(l_seg)%Ie_obc = i_obc</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  obc%segment(l_seg)%Js_obc = js_obc</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  obc%segment(l_seg)%Je_obc = je_obc</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="keyword">call </span>allocate_obc_segment_data(obc, obc%segment(l_seg))</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160; </div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keywordflow">if</span> (obc%segment(l_seg)%oblique .and.  obc%segment(l_seg)%radiation) &amp;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;         <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, setup_u_point_obc: \n&quot;</span>//&amp;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;         <span class="stringliteral">&quot;Orlanski and Oblique OBC options cannot be used together on one segment.&quot;</span>)</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160; </div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="keywordflow">if</span> (obc%segment(l_seg)%u_values_needed .or. obc%segment(l_seg)%v_values_needed .or. &amp;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      obc%segment(l_seg)%t_values_needed .or. obc%segment(l_seg)%s_values_needed .or. &amp;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      obc%segment(l_seg)%z_values_needed .or. obc%segment(l_seg)%g_values_needed) &amp;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    obc%segment(l_seg)%values_needed = .true.</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l03171">allocate_obc_segment_data()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00303">mdl</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00065">obc_direction_e</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00066">obc_direction_w</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01129">parse_segment_str()</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00799">setup_segment_indices()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l00317">open_boundary_config()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_aa40e3464225d4e017b1a738995eeb3b2_cgraph.svg" width="100%" height="504"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_aa40e3464225d4e017b1a738995eeb3b2_icgraph.svg" width="368" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a706dd2fb2049757b3b76bf8b481e735c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a706dd2fb2049757b3b76bf8b481e735c">&#9670;&nbsp;</a></span>setup_v_point_obc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_open_boundary::setup_v_point_obc </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(dyn_horgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>segment_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>l_seg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>PF</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>reentrant_x</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse an OBC_SEGMENT_%%% string starting with "J=" and configure placement and type of OBC accordingly. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary control structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">segment_str</td><td>A string in form of "J=%,I=%:%,string" </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">l_seg</td><td>which segment is this? </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pf</td><td>Parameter file handle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reentrant_x</td><td>is the domain reentrant in x? </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00994">994</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),    <span class="keywordtype">pointer</span>    :: OBC<span class="comment"> !&lt; Open boundary control structure</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keywordtype">type</span>(dyn_horgrid_type),  <span class="keywordtype">intent(in)</span> :: G<span class="comment">   !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),   <span class="keywordtype">intent(in)</span> :: US<span class="comment">  !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="keywordtype">character(len=*)</span>,        <span class="keywordtype">intent(in)</span> :: segment_str<span class="comment"> !&lt; A string in form of &quot;J=%,I=%:%,string&quot;</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span> :: l_seg<span class="comment"> !&lt; which segment is this?</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="keywordtype">type</span>(param_file_type),   <span class="keywordtype">intent(in)</span> :: PF<span class="comment">  !&lt; Parameter file handle</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>                 :: reentrant_x<span class="comment"> !&lt; is the domain reentrant in x?</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <span class="keywordtype">integer</span> :: J_obc, Is_obc, Ie_obc <span class="comment">! Position of segment in global index space</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keywordtype">integer</span> :: i, a_loop</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <span class="keywordtype">character(len=32)</span> :: action_str(8)</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="keywordtype">character(len=128)</span> :: segment_param_str</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span>  :: tnudge</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160; </div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <span class="comment">! This returns the global indices for the segment</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="keyword">call </span>parse_segment_str(g%ieg, g%jeg, segment_str, j_obc, is_obc, ie_obc, action_str, reentrant_x)</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160; </div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="keyword">call </span>setup_segment_indices(g, obc%segment(l_seg),is_obc,ie_obc,j_obc,j_obc)</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160; </div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  j_obc = j_obc - g%jdg_offset <span class="comment">! Convert to local tile indices on this tile</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  is_obc = is_obc - g%idg_offset <span class="comment">! Convert to local tile indices on this tile</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  ie_obc = ie_obc - g%idg_offset <span class="comment">! Convert to local tile indices on this tile</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160; </div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <span class="keywordflow">if</span> (ie_obc&gt;is_obc) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;     obc%segment(l_seg)%direction = obc_direction_s</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  <span class="keywordflow">elseif</span> (ie_obc&lt;is_obc) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;     obc%segment(l_seg)%direction = obc_direction_n</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;     i=is_obc;is_obc=ie_obc;ie_obc=i</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160; </div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  obc%segment(l_seg)%on_pe = .false.</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160; </div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <span class="keywordflow">do</span> a_loop = 1,8</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="keywordflow">if</span> (len_trim(action_str(a_loop)) == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      cycle</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;FLATHER&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      obc%segment(l_seg)%Flather = .true.</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      obc%segment(l_seg)%open = .true.</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      obc%Flather_v_BCs_exist_globally = .true.</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      obc%open_v_BCs_exist_globally = .true.</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      obc%segment%z_values_needed = .true.</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      obc%segment%v_values_needed = .true.</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;ORLANSKI&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      obc%segment(l_seg)%radiation = .true.</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      obc%segment(l_seg)%open = .true.</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      obc%open_v_BCs_exist_globally = .true.</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      obc%radiation_BCs_exist_globally = .true.</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;ORLANSKI_TAN&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      obc%segment(l_seg)%radiation = .true.</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      obc%segment(l_seg)%radiation_tan = .true.</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      obc%radiation_BCs_exist_globally = .true.</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;ORLANSKI_GRAD&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      obc%segment(l_seg)%radiation = .true.</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      obc%segment(l_seg)%radiation_grad = .true.</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;OBLIQUE&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      obc%segment(l_seg)%oblique = .true.</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      obc%segment(l_seg)%open = .true.</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      obc%oblique_BCs_exist_globally = .true.</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      obc%open_v_BCs_exist_globally = .true.</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;OBLIQUE_TAN&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      obc%segment(l_seg)%oblique = .true.</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      obc%segment(l_seg)%oblique_tan = .true.</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      obc%oblique_BCs_exist_globally = .true.</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;OBLIQUE_GRAD&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      obc%segment(l_seg)%oblique = .true.</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      obc%segment(l_seg)%oblique_grad = .true.</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;NUDGED&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      obc%segment(l_seg)%nudged = .true.</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;      obc%nudged_v_BCs_exist_globally = .true.</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      obc%segment%v_values_needed = .true.</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;NUDGED_TAN&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      obc%segment(l_seg)%nudged_tan = .true.</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      obc%nudged_v_BCs_exist_globally = .true.</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      obc%segment%u_values_needed = .true.</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;NUDGED_GRAD&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      obc%segment(l_seg)%nudged_grad = .true.</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      obc%segment%g_values_needed = .true.</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;GRADIENT&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      obc%segment(l_seg)%gradient = .true.</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      obc%segment(l_seg)%open = .true.</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      obc%open_v_BCs_exist_globally = .true.</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;SIMPLE&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      obc%segment(l_seg)%specified = .true.</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      obc%specified_v_BCs_exist_globally = .true. <span class="comment">! This avoids deallocation</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      obc%segment%v_values_needed = .true.</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <span class="keywordflow">elseif</span> (trim(action_str(a_loop)) == <span class="stringliteral">&#39;SIMPLE_TAN&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      obc%segment(l_seg)%specified_tan = .true.</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, setup_v_point_obc: &quot;</span>//&amp;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                     <span class="stringliteral">&quot;String &#39;&quot;</span>//trim(action_str(a_loop))//<span class="stringliteral">&quot;&#39; not understood.&quot;</span>)</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordflow">if</span> (obc%segment(l_seg)%nudged .or. obc%segment(l_seg)%nudged_tan) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      <span class="keyword">write</span>(segment_param_str(1:43),<span class="stringliteral">&quot;(&#39;OBC_SEGMENT_&#39;,i3.3,&#39;_VELOCITY_NUDGING_TIMESCALES&#39;)&quot;</span>) l_seg</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      <span class="keyword">allocate</span>(tnudge(2))</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      <span class="keyword">call </span>get_param(pf, mdl, segment_param_str(1:43), tnudge, &amp;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                     <span class="stringliteral">&quot;Timescales in days for nudging along a segment, &quot;</span>//&amp;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                     <span class="stringliteral">&quot;for inflow, then outflow. Setting both to zero should &quot;</span>//&amp;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                     <span class="stringliteral">&quot;behave like SIMPLE obcs for the baroclinic velocities.&quot;</span>, &amp;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                     fail_if_missing=.true., default=0., units=<span class="stringliteral">&quot;days&quot;</span>, scale=86400.0*us%s_to_T)</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      obc%segment(l_seg)%Velocity_nudging_timescale_in = tnudge(1)</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      obc%segment(l_seg)%Velocity_nudging_timescale_out = tnudge(2)</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      <span class="keyword">deallocate</span>(tnudge)</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160; </div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="keywordflow">  enddo</span> <span class="comment">! a_loop</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160; </div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  <span class="keywordflow">if</span> (j_obc&lt;=g%HI%JsdB+1 .or. j_obc&gt;=g%HI%JedB-1) <span class="keywordflow">return</span> <span class="comment">! Boundary is not on tile</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="keywordflow">if</span> (ie_obc&lt;=g%HI%IsdB .or. is_obc&gt;=g%HI%IedB) <span class="keywordflow">return</span> <span class="comment">! Segment is not on tile</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160; </div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  obc%segment(l_seg)%on_pe = .true.</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  obc%segment(l_seg)%is_N_or_S = .true.</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  <span class="keywordflow">do</span> i=g%HI%isd, g%HI%ied</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="keywordflow">if</span> (i&gt;is_obc .and. i&lt;=ie_obc) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      obc%segnum_v(i,j_obc) = l_seg</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  obc%segment(l_seg)%Is_obc = is_obc</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  obc%segment(l_seg)%Ie_obc = ie_obc</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  obc%segment(l_seg)%Js_obc = j_obc</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  obc%segment(l_seg)%Je_obc = j_obc</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  <span class="keyword">call </span>allocate_obc_segment_data(obc, obc%segment(l_seg))</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160; </div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  <span class="keywordflow">if</span> (obc%segment(l_seg)%oblique .and.  obc%segment(l_seg)%radiation) &amp;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;         <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;MOM_open_boundary.F90, setup_v_point_obc: \n&quot;</span>//&amp;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;         <span class="stringliteral">&quot;Orlanski and Oblique OBC options cannot be used together on one segment.&quot;</span>)</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160; </div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="keywordflow">if</span> (obc%segment(l_seg)%u_values_needed .or. obc%segment(l_seg)%v_values_needed .or. &amp;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      obc%segment(l_seg)%t_values_needed .or. obc%segment(l_seg)%s_values_needed .or. &amp;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;      obc%segment(l_seg)%z_values_needed .or. obc%segment(l_seg)%g_values_needed) &amp;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    obc%segment(l_seg)%values_needed = .true.</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l03171">allocate_obc_segment_data()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00303">mdl</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00063">obc_direction_n</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00064">obc_direction_s</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01129">parse_segment_str()</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00799">setup_segment_indices()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l00317">open_boundary_config()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a706dd2fb2049757b3b76bf8b481e735c_cgraph.svg" width="100%" height="504"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a706dd2fb2049757b3b76bf8b481e735c_icgraph.svg" width="368" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a8d2c8b028b9fc7d65f17155497a0487d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d2c8b028b9fc7d65f17155497a0487d">&#9670;&nbsp;</a></span>update_obc_segment_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::update_obc_segment_data </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(thermo_var_ptrs), intent(in)&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed,  g %ke), intent(inout)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the OBC values on the segments. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Ocean grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Ocean vertical grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tv</td><td>Thermodynamics structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">h</td><td>Thickness [m] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>Model time </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l03401">3401</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(in)</span>    :: G<span class="comment">    !&lt; Ocean grid structure</span></div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type),                   <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">   !&lt;  Ocean vertical grid structure</span></div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),                     <span class="keywordtype">intent(in)</span>    :: US<span class="comment">   !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),                      <span class="keywordtype">pointer</span>       :: OBC<span class="comment">  !&lt; Open boundary structure</span></div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;  <span class="keywordtype">type</span>(thermo_var_ptrs),                     <span class="keywordtype">intent(in)</span>    :: tv<span class="comment">   !&lt; Thermodynamics structure</span></div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G), SZK_(G))</span>, <span class="keywordtype">intent(inout)</span> :: h<span class="comment">    !&lt; Thickness [m]</span></div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;  <span class="keywordtype">type</span>(time_type),                           <span class="keywordtype">intent(in)</span>    :: Time<span class="comment"> !&lt; Model time</span></div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, is, ie, js, je, isd, ied, jsd, jed</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;  <span class="keywordtype">integer</span> :: IsdB, IedB, JsdB, JedB, n, m, nz</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;set_OBC_segment_data&quot;</span> <span class="comment">! This subroutine&#39;s name.</span></div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;  <span class="keywordtype">character(len=200)</span> :: filename, OBC_file, inputdir <span class="comment">! Strings for file/path</span></div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment =&gt; null()</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(4)</span> :: siz,siz2</div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;<span class="keywordtype">  real</span> :: sumh <span class="comment">! column sum of thicknesses [m]</span></div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;  <span class="keywordtype">integer</span> :: ni_seg, nj_seg  <span class="comment">! number of src gridpoints along the segments</span></div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;  <span class="keywordtype">integer</span> :: i2, j2          <span class="comment">! indices for referencing local domain array</span></div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;  <span class="keywordtype">integer</span> :: is_obc, ie_obc, js_obc, je_obc  <span class="comment">! segment indices within local domain</span></div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;  <span class="keywordtype">integer</span> :: ishift, jshift  <span class="comment">! offsets for staggered locations</span></div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">pointer</span> :: seg_vel =&gt; null()  <span class="comment">! pointer to segment velocity array</span></div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">pointer</span> :: seg_trans =&gt; null()  <span class="comment">! pointer to segment transport array</span></div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">allocatable</span> :: tmp_buffer</div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: h_stack</div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;  <span class="keywordtype">integer</span> :: is_obc2, js_obc2</div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;<span class="keywordtype">  real</span> :: net_H_src, net_H_int, scl_fac</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">pointer</span>, <span class="keywordtype">dimension(:,:)</span>   :: normal_trans_bt=&gt;null() <span class="comment">! barotropic transport</span></div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160; </div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;  isd = g%isd ; ied = g%ied ; jsd = g%jsd ; jed = g%jed</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;  isdb = g%IsdB ; iedb = g%IedB ; jsdb = g%JsdB ; jedb = g%JedB</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;  nz=g%ke</div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160; </div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;  <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(obc)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160; </div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;  <span class="keywordflow">do</span> n = 1, obc%number_of_segments</div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;    segment =&gt; obc%segment(n)</div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160; </div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;    <span class="keywordflow">if</span> (.not. segment%on_pe) cycle <span class="comment">! continue to next segment if not in computational domain</span></div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160; </div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;    ni_seg = segment%ie_obc-segment%is_obc+1</div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;    nj_seg = segment%je_obc-segment%js_obc+1</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;    is_obc = max(segment%is_obc,isd-1)</div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;    ie_obc = min(segment%ie_obc,ied)</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;    js_obc = max(segment%js_obc,jsd-1)</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;    je_obc = min(segment%je_obc,jed)</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160; </div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;<span class="comment">! Calculate auxiliary fields at staggered locations.</span></div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;<span class="comment">! Segment indices are on q points:</span></div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;<span class="comment">!       |-----------|------------|-----------|-----------|  J_obc</span></div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;<span class="comment">!     Is_obc                                          Ie_obc</span></div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;<span class="comment">! i2 has to start at Is_obc+1 and end at Ie_obc.</span></div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;<span class="comment">! j2 is J_obc and jshift has to be +1 at both the north and south.</span></div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160; </div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;     <span class="comment">! calculate auxiliary fields at staggered locations</span></div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;    ishift=0;jshift=0</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;    <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;      <span class="keyword">allocate</span>(normal_trans_bt(segment%HI%IsdB:segment%HI%IedB,segment%HI%jsd:segment%HI%jed))</div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;      normal_trans_bt(:,:)=0.0</div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;      <span class="keywordflow">if</span> (segment%direction == obc_direction_w) ishift=1</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;      i=segment%HI%IsdB</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;      <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;        segment%Cg(i,j) = sqrt(gv%g_prime(1)*g%bathyT(i+ishift,j))</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;        segment%Htot(i,j)=0.0</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;          segment%h(i,j,k) = h(i+ishift,j,k)</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;          segment%Htot(i,j)=segment%Htot(i,j)+segment%h(i,j,k)</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;    else<span class="comment">! (segment%direction == OBC_DIRECTION_N .or. segment%direction == OBC_DIRECTION_S)</span></div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;      <span class="keyword">allocate</span>(normal_trans_bt(segment%HI%isd:segment%HI%ied,segment%HI%JsdB:segment%HI%JedB))</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;      normal_trans_bt(:,:)=0.0</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;      <span class="keywordflow">if</span> (segment%direction == obc_direction_s) jshift=1</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;      j=segment%HI%JsdB</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;      <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;        segment%Cg(i,j) = sqrt(gv%g_prime(1)*g%bathyT(i,j+jshift))</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;        segment%Htot(i,j)=0.0</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;        <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;          segment%h(i,j,k) = h(i,j+jshift,k)</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;          segment%Htot(i,j)=segment%Htot(i,j)+segment%h(i,j,k)</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160; </div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;    <span class="keyword">allocate</span>(h_stack(g%ke))</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;    h_stack(:) = 0.0</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;    <span class="keywordflow">do</span> m = 1,segment%num_fields</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;      <span class="keywordflow">if</span> (segment%field(m)%fid &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;        siz(1)=<span class="keyword">size</span>(segment%field(m)%buffer_src,1)</div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;        siz(2)=<span class="keyword">size</span>(segment%field(m)%buffer_src,2)</div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;        siz(3)=<span class="keyword">size</span>(segment%field(m)%buffer_src,3)</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;        <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(segment%field(m)%buffer_dst)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;          <span class="keywordflow">if</span> (siz(3) /= segment%field(m)%nk_src) <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&#39;nk_src inconsistency&#39;</span>)</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;          <span class="keywordflow">if</span> (segment%field(m)%nk_src &gt; 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;            <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DVDX&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc:ie_obc,js_obc:je_obc,g%ke))</div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc:ie_obc,js_obc+1:je_obc,g%ke))</div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%bt_vel(is_obc:ie_obc,js_obc+1:je_obc))</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;                segment%field(m)%bt_vel(:,:)=0.0</div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DUDY&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc:ie_obc,js_obc:je_obc,g%ke))</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc+1:ie_obc,js_obc:je_obc,g%ke))</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%bt_vel(is_obc+1:ie_obc,js_obc:je_obc))</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;                segment%field(m)%bt_vel(:,:)=0.0</div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;            <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DVDX&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc:ie_obc,js_obc:je_obc,1))</div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc:ie_obc,js_obc+1:je_obc,1))</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%bt_vel(is_obc:ie_obc,js_obc+1:je_obc))</div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;                segment%field(m)%bt_vel(:,:)=0.0</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DUDY&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc:ie_obc,js_obc:je_obc,1))</div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc+1:ie_obc,js_obc:je_obc,1))</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;                <span class="keyword">allocate</span>(segment%field(m)%bt_vel(is_obc+1:ie_obc,js_obc:je_obc))</div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;                segment%field(m)%bt_vel(:,:)=0.0</div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;          segment%field(m)%buffer_dst(:,:,:)=0.0</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;        <span class="comment">! read source data interpolated to the current model time</span></div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;        <span class="keywordflow">if</span> (siz(1)==1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;          <span class="keywordflow">if</span> (obc%brushcutter_mode) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;            <span class="keyword">allocate</span>(tmp_buffer(1,nj_seg*2-1,segment%field(m)%nk_src))  <span class="comment">! segment data is currrently on supergrid</span></div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;            <span class="keyword">allocate</span>(tmp_buffer(1,nj_seg,segment%field(m)%nk_src))  <span class="comment">! segment data is currrently on supergrid</span></div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;          <span class="keywordflow">if</span> (obc%brushcutter_mode) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;            <span class="keyword">allocate</span>(tmp_buffer(ni_seg*2-1,1,segment%field(m)%nk_src))  <span class="comment">! segment data is currrently on supergrid</span></div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;            <span class="keyword">allocate</span>(tmp_buffer(ni_seg,1,segment%field(m)%nk_src))  <span class="comment">! segment data is currrently on supergrid</span></div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160; </div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;        <span class="keyword">call </span>time_interp_external(segment%field(m)%fid,time, tmp_buffer)</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;        <span class="keywordflow">if</span> (obc%brushcutter_mode) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;          <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;            <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DVDX&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;              segment%field(m)%buffer_src(is_obc,:,:) = &amp;</div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;                  tmp_buffer(1,2*(js_obc+g%jdg_offset)+1:2*(je_obc+g%jdg_offset)+1:2,:)</div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;              segment%field(m)%buffer_src(is_obc,:,:) = &amp;</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;                  tmp_buffer(1,2*(js_obc+g%jdg_offset)+1:2*(je_obc+g%jdg_offset):2,:)</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;            <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DUDY&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;              segment%field(m)%buffer_src(:,js_obc,:) = &amp;</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;                  tmp_buffer(2*(is_obc+g%idg_offset)+1:2*(ie_obc+g%idg_offset)+1:2,1,:)</div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;              segment%field(m)%buffer_src(:,js_obc,:) = &amp;</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;                  tmp_buffer(2*(is_obc+g%idg_offset)+1:2*(ie_obc+g%idg_offset):2,1,:)</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;          <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;            <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DVDX&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;              segment%field(m)%buffer_src(is_obc,:,:)=tmp_buffer(1,js_obc+g%jdg_offset+1:je_obc+g%jdg_offset+1,:)</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;              segment%field(m)%buffer_src(is_obc,:,:)=tmp_buffer(1,js_obc+g%jdg_offset+1:je_obc+g%jdg_offset,:)</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;            <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DUDY&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;              segment%field(m)%buffer_src(:,js_obc,:)=tmp_buffer(is_obc+g%idg_offset+1:ie_obc+g%idg_offset+1,1,:)</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;              segment%field(m)%buffer_src(:,js_obc,:)=tmp_buffer(is_obc+g%idg_offset+1:ie_obc+g%idg_offset,1,:)</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;        <span class="keywordflow">if</span> (segment%field(m)%nk_src &gt; 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;          <span class="keyword">call </span>time_interp_external(segment%field(m)%fid_dz,time, tmp_buffer)</div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;          <span class="keywordflow">if</span> (obc%brushcutter_mode) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;            <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DVDX&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;                segment%field(m)%dz_src(is_obc,:,:) = &amp;</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;                    tmp_buffer(1,2*(js_obc+g%jdg_offset)+1:2*(je_obc+g%jdg_offset)+1:2,:)</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;                segment%field(m)%dz_src(is_obc,:,:) = &amp;</div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;                    tmp_buffer(1,2*(js_obc+g%jdg_offset)+1:2*(je_obc+g%jdg_offset):2,:)</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DUDY&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;                segment%field(m)%dz_src(:,js_obc,:) = &amp;</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;                    tmp_buffer(2*(is_obc+g%idg_offset)+1:2*(ie_obc+g%idg_offset)+1:2,1,:)</div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;                segment%field(m)%dz_src(:,js_obc,:) = &amp;</div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;                    tmp_buffer(2*(is_obc+g%idg_offset)+1:2*(ie_obc+g%idg_offset):2,1,:)</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;            <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DVDX&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;                segment%field(m)%dz_src(is_obc,:,:)=tmp_buffer(1,js_obc+g%jdg_offset+1:je_obc+g%jdg_offset+1,:)</div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;                segment%field(m)%dz_src(is_obc,:,:)=tmp_buffer(1,js_obc+g%jdg_offset+1:je_obc+g%jdg_offset,:)</div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;              <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DUDY&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;                segment%field(m)%dz_src(:,js_obc,:)=tmp_buffer(is_obc+g%idg_offset+1:ie_obc+g%idg_offset+1,1,:)</div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;                segment%field(m)%dz_src(:,js_obc,:)=tmp_buffer(is_obc+g%idg_offset+1:ie_obc+g%idg_offset,1,:)</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160; </div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;          <span class="keyword">call </span>adjustsegmentetatofitbathymetry(g,gv,us,segment,m)</div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160; </div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;          <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;            ishift=1</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;            <span class="keywordflow">if</span> (segment%direction == obc_direction_e) ishift=0</div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;            i=is_obc</div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;            <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DVDX&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;              <span class="comment">! Do q points for the whole segment</span></div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;              <span class="keywordflow">do</span> j=max(js_obc,jsd),min(je_obc,jed-1)</div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;                <span class="comment">! Using the h remapping approach</span></div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;                <span class="comment">! Pretty sure we need to check for source/target grid consistency here</span></div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;                segment%field(m)%buffer_dst(i,j,:)=0.0  <span class="comment">! initialize remap destination buffer</span></div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;                <span class="keywordflow">if</span> (g%mask2dCu(i,j)&gt;0. .and. g%mask2dCu(i,j+1)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;                  h_stack(:) = 0.5*(h(i+ishift,j,:) + h(i+ishift,j+1,:))</div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;                  <span class="keyword">call </span>remapping_core_h(obc%remap_CS, &amp;</div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;                       segment%field(m)%nk_src,segment%field(m)%dz_src(i,j,:), &amp;</div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;                       segment%field(m)%buffer_src(i,j,:), &amp;</div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;                       g%ke, h_stack, segment%field(m)%buffer_dst(i,j,:))</div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;                <span class="keywordflow">elseif</span> (g%mask2dCu(i,j)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;                  h_stack(:) = h(i+ishift,j,:)</div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;                  <span class="keyword">call </span>remapping_core_h(obc%remap_CS, &amp;</div>
<div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;                       segment%field(m)%nk_src,segment%field(m)%dz_src(i,j,:), &amp;</div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;                       segment%field(m)%buffer_src(i,j,:), &amp;</div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;                       g%ke, h_stack, segment%field(m)%buffer_dst(i,j,:))</div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;                <span class="keywordflow">elseif</span> (g%mask2dCu(i,j+1)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;                  h_stack(:) = h(i+ishift,j+1,:)</div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;                  <span class="keyword">call </span>remapping_core_h(obc%remap_CS, &amp;</div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;                       segment%field(m)%nk_src,segment%field(m)%dz_src(i,j,:), &amp;</div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;                       segment%field(m)%buffer_src(i,j,:), &amp;</div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;                       g%ke, h_stack, segment%field(m)%buffer_dst(i,j,:))</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;<span class="keywordflow">                endif</span></div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;              <span class="keywordflow">do</span> j=js_obc+1,je_obc</div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;                <span class="comment">! Using the h remapping approach</span></div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;                <span class="comment">! Pretty sure we need to check for source/target grid consistency here</span></div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;                segment%field(m)%buffer_dst(i,j,:)=0.0  <span class="comment">! initialize remap destination buffer</span></div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;                <span class="keywordflow">if</span> (g%mask2dCu(i,j)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;                  net_h_src = sum( segment%field(m)%dz_src(i,j,:) )</div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;                  net_h_int = sum( h(i+ishift,j,:) )</div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;                  scl_fac = net_h_int / net_h_src</div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;                  <span class="keyword">call </span>remapping_core_h(obc%remap_CS, &amp;</div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;                       segment%field(m)%nk_src, scl_fac*segment%field(m)%dz_src(i,j,:), &amp;</div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;                       segment%field(m)%buffer_src(i,j,:), &amp;</div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;                       g%ke, h(i+ishift,j,:), segment%field(m)%buffer_dst(i,j,:))</div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;<span class="keywordflow">                endif</span></div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;            jshift=1</div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;            <span class="keywordflow">if</span> (segment%direction == obc_direction_n) jshift=0</div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;            j=js_obc</div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;            <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span> .or. segment%field(m)%name == <span class="stringliteral">&#39;DUDY&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;              <span class="comment">! Do q points for the whole segment</span></div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;              <span class="keywordflow">do</span> i=max(is_obc,isd),min(ie_obc,ied-1)</div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;                segment%field(m)%buffer_dst(i,j,:)=0.0  <span class="comment">! initialize remap destination buffer</span></div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;                <span class="keywordflow">if</span> (g%mask2dCv(i,j)&gt;0. .and. g%mask2dCv(i+1,j)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;              <span class="comment">! Using the h remapping approach</span></div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;              <span class="comment">! Pretty sure we need to check for source/target grid consistency here</span></div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;                  h_stack(:) = 0.5*(h(i,j+jshift,:) + h(i+1,j+jshift,:))</div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;                  <span class="keyword">call </span>remapping_core_h(obc%remap_CS, &amp;</div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;                       segment%field(m)%nk_src,segment%field(m)%dz_src(i,j,:), &amp;</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;                       segment%field(m)%buffer_src(i,j,:), &amp;</div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;                       g%ke, h_stack, segment%field(m)%buffer_dst(i,j,:))</div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;                <span class="keywordflow">elseif</span> (g%mask2dCv(i,j)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;                  h_stack(:) = h(i,j+jshift,:)</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;                  <span class="keyword">call </span>remapping_core_h(obc%remap_CS, &amp;</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;                       segment%field(m)%nk_src,segment%field(m)%dz_src(i,j,:), &amp;</div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;                       segment%field(m)%buffer_src(i,j,:), &amp;</div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;                       g%ke, h_stack, segment%field(m)%buffer_dst(i,j,:))</div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;                <span class="keywordflow">elseif</span> (g%mask2dCv(i+1,j)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;                  h_stack(:) = h(i+1,j+jshift,:)</div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;                  <span class="keyword">call </span>remapping_core_h(obc%remap_CS, &amp;</div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;                       segment%field(m)%nk_src,segment%field(m)%dz_src(i,j,:), &amp;</div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;                       segment%field(m)%buffer_src(i,j,:), &amp;</div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;                       g%ke, h_stack, segment%field(m)%buffer_dst(i,j,:))</div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;<span class="keywordflow">                endif</span></div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;              <span class="keywordflow">do</span> i=is_obc+1,ie_obc</div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;              <span class="comment">! Using the h remapping approach</span></div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;              <span class="comment">! Pretty sure we need to check for source/target grid consistency here</span></div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;                segment%field(m)%buffer_dst(i,j,:)=0.0  <span class="comment">! initialize remap destination buffer</span></div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;                <span class="keywordflow">if</span> (g%mask2dCv(i,j)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;                  net_h_src = sum( segment%field(m)%dz_src(i,j,:) )</div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;                  net_h_int = sum( h(i,j+jshift,:) )</div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;                  scl_fac = net_h_int / net_h_src</div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;                  <span class="keyword">call </span>remapping_core_h(obc%remap_CS, &amp;</div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;                       segment%field(m)%nk_src,segment%field(m)%dz_src(i,j,:), &amp;</div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;                       segment%field(m)%buffer_src(i,j,:), &amp;</div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;                       g%ke, h(i,j+jshift,:), segment%field(m)%buffer_dst(i,j,:))</div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;<span class="keywordflow">                endif</span></div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;        <span class="keywordflow">else</span>  <span class="comment">! 2d data</span></div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;          segment%field(m)%buffer_dst(:,:,1) = segment%field(m)%buffer_src(:,:,1)  <span class="comment">! initialize remap destination buffer</span></div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;        <span class="keyword">deallocate</span>(tmp_buffer)</div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;      <span class="keywordflow">else</span> <span class="comment">! fid &lt;= 0 (Uniform value)</span></div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;        <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(segment%field(m)%buffer_dst)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;          <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;            <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc:ie_obc,js_obc:je_obc,g%ke))</div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%bt_vel(is_obc:ie_obc,js_obc:je_obc))</div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;            <span class="keywordflow">elseif</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc:ie_obc,js_obc+1:je_obc,g%ke))</div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%bt_vel(is_obc:ie_obc,js_obc+1:je_obc))</div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;            <span class="keywordflow">elseif</span> (segment%field(m)%name == <span class="stringliteral">&#39;DVDX&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc:ie_obc,js_obc:je_obc,g%ke))</div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;            <span class="keywordflow">elseif</span> (segment%field(m)%name == <span class="stringliteral">&#39;SSH&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc:ie_obc,js_obc:je_obc,1))</div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc:ie_obc,js_obc+1:je_obc,g%ke))</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;            <span class="keywordflow">if</span> (segment%field(m)%name == <span class="stringliteral">&#39;U&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc:ie_obc,js_obc:je_obc,g%ke))</div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%bt_vel(is_obc:ie_obc,js_obc:je_obc))</div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;            <span class="keywordflow">elseif</span> (segment%field(m)%name == <span class="stringliteral">&#39;V&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc+1:ie_obc,js_obc:je_obc,g%ke))</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%bt_vel(is_obc+1:ie_obc,js_obc:je_obc))</div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;            <span class="keywordflow">elseif</span> (segment%field(m)%name == <span class="stringliteral">&#39;DUDY&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc:ie_obc,js_obc:je_obc,g%ke))</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;            <span class="keywordflow">elseif</span> (segment%field(m)%name == <span class="stringliteral">&#39;SSH&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc:ie_obc,js_obc:je_obc,1))</div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;              <span class="keyword">allocate</span>(segment%field(m)%buffer_dst(is_obc+1:ie_obc,js_obc:je_obc,g%ke))</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;          segment%field(m)%buffer_dst(:,:,:) = segment%field(m)%value</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;          <span class="keywordflow">if</span> (trim(segment%field(m)%name) == <span class="stringliteral">&#39;U&#39;</span> .or. trim(segment%field(m)%name) == <span class="stringliteral">&#39;V&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;            segment%field(m)%bt_vel(:,:) = segment%field(m)%value</div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160; </div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;      <span class="keywordflow">if</span> (trim(segment%field(m)%name) == <span class="stringliteral">&#39;U&#39;</span> .or. trim(segment%field(m)%name) == <span class="stringliteral">&#39;V&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;        <span class="keywordflow">if</span> (segment%field(m)%fid&gt;0) <span class="keywordflow">then</span> <span class="comment">! calculate external BT velocity and transport if needed</span></div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;          <span class="keywordflow">if</span> (trim(segment%field(m)%name) == <span class="stringliteral">&#39;U&#39;</span> .and. segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;            i=is_obc</div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;            <span class="keywordflow">do</span> j=js_obc+1,je_obc</div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;              normal_trans_bt(i,j) = 0.0</div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;              <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;                segment%normal_vel(i,j,k) = us%m_s_to_L_T*segment%field(m)%buffer_dst(i,j,k)</div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;                segment%normal_trans(i,j,k) = us%m_s_to_L_T*segment%field(m)%buffer_dst(i,j,k)*segment%h(i,j,k) * &amp;</div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;                          g%dyCu(i,j)</div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;                normal_trans_bt(i,j) = normal_trans_bt(i,j) + segment%normal_trans(i,j,k)</div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;              segment%normal_vel_bt(i,j) = normal_trans_bt(i,j) / (max(segment%Htot(i,j),1.e-12) * g%dyCu(i,j))</div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;              <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%nudged_normal_vel)) segment%nudged_normal_vel(i,j,:) = segment%normal_vel(i,j,:)</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;<span class="keywordflow">            enddo</span></div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;          <span class="keywordflow">elseif</span> (trim(segment%field(m)%name) == <span class="stringliteral">&#39;V&#39;</span> .and. segment%is_N_or_S) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;            j=js_obc</div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;            <span class="keywordflow">do</span> i=is_obc+1,ie_obc</div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;              normal_trans_bt(i,j) = 0.0</div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;              <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;                segment%normal_vel(i,j,k) = us%m_s_to_L_T*segment%field(m)%buffer_dst(i,j,k)</div>
<div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;                segment%normal_trans(i,j,k) = us%m_s_to_L_T*segment%field(m)%buffer_dst(i,j,k)*segment%h(i,j,k) * &amp;</div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;                          g%dxCv(i,j)</div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;                normal_trans_bt(i,j) = normal_trans_bt(i,j) + segment%normal_trans(i,j,k)</div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;              segment%normal_vel_bt(i,j) = normal_trans_bt(i,j) / (max(segment%Htot(i,j),1.e-12) * g%dxCv(i,j))</div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;              <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%nudged_normal_vel)) segment%nudged_normal_vel(i,j,:) = segment%normal_vel(i,j,:)</div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;<span class="keywordflow">            enddo</span></div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;          <span class="keywordflow">elseif</span> (trim(segment%field(m)%name) == <span class="stringliteral">&#39;V&#39;</span> .and. segment%is_E_or_W .and. &amp;</div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;                  <span class="keyword">associated</span>(segment%tangential_vel)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;            i=is_obc</div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;            <span class="keywordflow">do</span> j=js_obc,je_obc</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;              <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;                segment%tangential_vel(i,j,k) = us%m_s_to_L_T*segment%field(m)%buffer_dst(i,j,k)</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;              <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%nudged_tangential_vel)) &amp;</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;                segment%nudged_tangential_vel(i,j,:) = segment%tangential_vel(i,j,:)</div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;<span class="keywordflow">            enddo</span></div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;          <span class="keywordflow">elseif</span> (trim(segment%field(m)%name) == <span class="stringliteral">&#39;U&#39;</span> .and. segment%is_N_or_S .and. &amp;</div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;                  <span class="keyword">associated</span>(segment%tangential_vel)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;            j=js_obc</div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;            <span class="keywordflow">do</span> i=is_obc,ie_obc</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;              <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;                segment%tangential_vel(i,j,k) = us%m_s_to_L_T*segment%field(m)%buffer_dst(i,j,k)</div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;              <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%nudged_tangential_vel)) &amp;</div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;                segment%nudged_tangential_vel(i,j,:) = segment%tangential_vel(i,j,:)</div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;<span class="keywordflow">            enddo</span></div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;          <span class="keywordflow">elseif</span> (trim(segment%field(m)%name) == <span class="stringliteral">&#39;DVDX&#39;</span> .and. segment%is_E_or_W .and. &amp;</div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;                  <span class="keyword">associated</span>(segment%tangential_grad)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;            i=is_obc</div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;            <span class="keywordflow">do</span> j=js_obc,je_obc</div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;              <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;                segment%tangential_grad(i,j,k) = us%T_to_s*segment%field(m)%buffer_dst(i,j,k)</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;<span class="keywordflow">            enddo</span></div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;          <span class="keywordflow">elseif</span> (trim(segment%field(m)%name) == <span class="stringliteral">&#39;DUDY&#39;</span> .and. segment%is_N_or_S .and. &amp;</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;                  <span class="keyword">associated</span>(segment%tangential_grad)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;            j=js_obc</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;            <span class="keywordflow">do</span> i=is_obc,ie_obc</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;              <span class="keywordflow">do</span> k=1,g%ke</div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;                segment%tangential_grad(i,j,k) = us%T_to_s*segment%field(m)%buffer_dst(i,j,k)</div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;<span class="keywordflow">            enddo</span></div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160; </div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;      <span class="comment">! from this point on, data are entirely on segments - will</span></div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;      <span class="comment">! write all segment loops as 2d loops.</span></div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;      <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;        js_obc2 = js_obc+1</div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;        is_obc2 = is_obc</div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;        js_obc2 = js_obc</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;        is_obc2 = is_obc+1</div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;      <span class="keywordflow">if</span> (segment%is_N_or_S) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;        is_obc2 = is_obc+1</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;        js_obc2 = js_obc</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;        is_obc2 = is_obc</div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;        js_obc2 = js_obc+1</div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160; </div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;      <span class="keywordflow">if</span> (trim(segment%field(m)%name) == <span class="stringliteral">&#39;SSH&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;        <span class="keywordflow">do</span> j=js_obc2,je_obc</div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;          <span class="keywordflow">do</span> i=is_obc2,ie_obc</div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;            segment%eta(i,j) = segment%field(m)%buffer_dst(i,j,1)</div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160; </div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;      <span class="keywordflow">if</span> (trim(segment%field(m)%name) == <span class="stringliteral">&#39;TEMP&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%field(m)%buffer_dst)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;          <span class="keywordflow">do</span> k=1,nz; <span class="keywordflow">do</span> j=js_obc2, je_obc; <span class="keywordflow">do</span> i=is_obc2,ie_obc</div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;            segment%tr_Reg%Tr(1)%t(i,j,k) = segment%field(m)%buffer_dst(i,j,k)</div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;<span class="keywordflow">          enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;          <span class="keywordflow">if</span> (.not. segment%tr_Reg%Tr(1)%is_initialized) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;            <span class="comment">! if the tracer reservoir has not yet been initialized, then set to external value.</span></div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;            <span class="keywordflow">do</span> k=1,nz; <span class="keywordflow">do</span> j=js_obc2, je_obc; <span class="keywordflow">do</span> i=is_obc2,ie_obc</div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;              segment%tr_Reg%Tr(1)%tres(i,j,k) = segment%tr_Reg%Tr(1)%t(i,j,k)</div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;<span class="keywordflow">            enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;            segment%tr_Reg%Tr(1)%is_initialized=.true.</div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;          segment%tr_Reg%Tr(1)%OBC_inflow_conc = segment%field(m)%value</div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;      <span class="keywordflow">elseif</span> (trim(segment%field(m)%name) == <span class="stringliteral">&#39;SALT&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%field(m)%buffer_dst)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;          <span class="keywordflow">do</span> k=1,nz; <span class="keywordflow">do</span> j=js_obc2, je_obc; <span class="keywordflow">do</span> i=is_obc2,ie_obc</div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;            segment%tr_Reg%Tr(2)%t(i,j,k) = segment%field(m)%buffer_dst(i,j,k)</div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;<span class="keywordflow">          enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;          <span class="keywordflow">if</span> (.not. segment%tr_Reg%Tr(2)%is_initialized) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;            <span class="comment">!if the tracer reservoir has not yet been initialized, then set to external value.</span></div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;            <span class="keywordflow">do</span> k=1,nz; <span class="keywordflow">do</span> j=js_obc2, je_obc; <span class="keywordflow">do</span> i=is_obc2,ie_obc</div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;              segment%tr_Reg%Tr(2)%tres(i,j,k) = segment%tr_Reg%Tr(2)%t(i,j,k)</div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;<span class="keywordflow">            enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;            segment%tr_Reg%Tr(2)%is_initialized=.true.</div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;          segment%tr_Reg%Tr(2)%OBC_inflow_conc = segment%field(m)%value</div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160; </div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;<span class="keywordflow">    enddo</span> <span class="comment">! end field loop</span></div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;    <span class="keyword">deallocate</span>(h_stack)</div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;    <span class="keyword">deallocate</span>(normal_trans_bt)</div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160; </div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;<span class="keywordflow">  enddo</span> <span class="comment">! end segment loop</span></div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l04593">adjustsegmentetatofitbathymetry()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00065">obc_direction_e</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00063">obc_direction_n</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00064">obc_direction_s</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00066">obc_direction_w</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__state__initialization_8F90_source.html#l00125">mom_state_initialization::mom_initialize_state()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a8d2c8b028b9fc7d65f17155497a0487d_cgraph.svg" width="450" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a8d2c8b028b9fc7d65f17155497a0487d_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a230cf67375352c9d55b4330180d35d7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a230cf67375352c9d55b4330180d35d7c">&#9670;&nbsp;</a></span>update_segment_tracer_reservoirs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_open_boundary::update_segment_tracer_reservoirs </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szib_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>uhr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szjb_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>vhr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),szk_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__open__boundary_1_1ocean__obc__type.html">ocean_obc_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OBC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(tracer_registry_type), pointer&#160;</td>
          <td class="paramname"><em>Reg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the OBC tracer reservoirs after the tracers have been updated. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>Ocean vertical grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">uhr</td><td>accumulated volume/mass flux through the zonal face [H L2 ~&gt; m3 or kg] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vhr</td><td>accumulated volume/mass flux through the meridional face [H L2 ~&gt; m3 or kg] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>layer thickness after advection [H ~&gt; m or kg m-2] </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">obc</td><td>Open boundary structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>time increment [T ~&gt; s] </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">reg</td><td>pointer to tracer registry </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l04513">4513</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                     <span class="keywordtype">intent(in)</span> :: G<span class="comment">   !&lt; The ocean&#39;s grid structure</span></div>
<div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type),                   <span class="keywordtype">intent(in)</span> :: GV<span class="comment">  !&lt;  Ocean vertical grid structure</span></div>
<div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span> :: uhr<span class="comment"> !&lt; accumulated volume/mass flux through</span></div>
<div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;<span class="comment">                                                               !! the zonal face [H L2 ~&gt; m3 or kg]</span></div>
<div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span>, <span class="keywordtype">intent(in)</span> :: vhr<span class="comment"> !&lt; accumulated volume/mass flux through</span></div>
<div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;<span class="comment">                                                               !! the meridional face [H L2 ~&gt; m3 or kg]</span></div>
<div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>,  <span class="keywordtype">intent(in)</span> :: h<span class="comment">   !&lt; layer thickness after advection</span></div>
<div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;<span class="comment">                                                               !! [H ~&gt; m or kg m-2]</span></div>
<div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;  <span class="keywordtype">type</span>(ocean_OBC_type),                      <span class="keywordtype">pointer</span>    :: OBC<span class="comment"> !&lt; Open boundary structure</span></div>
<div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;<span class="keywordtype">  real</span>,                                      <span class="keywordtype">intent(in)</span> :: dt<span class="comment">  !&lt; time increment [T ~&gt; s]</span></div>
<div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type),                <span class="keywordtype">pointer</span>    :: Reg<span class="comment"> !&lt; pointer to tracer registry</span></div>
<div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;  <span class="keywordtype">type</span>(OBC_segment_type), <span class="keywordtype">pointer</span> :: segment=&gt;null()</div>
<div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;<span class="keywordtype">  real</span> :: u_L_in, u_L_out <span class="comment">! The zonal distance moved in or out of a cell [L ~&gt; m]</span></div>
<div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;<span class="keywordtype">  real</span> :: v_L_in, v_L_out <span class="comment">! The meridional distance moved in or out of a cell [L ~&gt; m]</span></div>
<div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;<span class="keywordtype">  real</span> :: fac1            <span class="comment">! The denominator of the expression for tracer updates [nondim]</span></div>
<div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, m, n, ntr, nz</div>
<div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;  <span class="keywordtype">integer</span> :: ishift, idir, jshift, jdir</div>
<div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160; </div>
<div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;  nz = gv%ke</div>
<div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;  ntr = reg%ntr</div>
<div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc)) <span class="keywordflow">then</span> ; <span class="keywordflow">if</span> (obc%OBC_pe) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> n=1,obc%number_of_segments</div>
<div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;    segment=&gt;obc%segment(n)</div>
<div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;    <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(segment%tr_Reg)) cycle</div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;    <span class="keywordflow">if</span> (segment%is_E_or_W) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;      <span class="keywordflow">do</span> j=segment%HI%jsd,segment%HI%jed</div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;        i = segment%HI%IsdB</div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;        <span class="comment">! ishift+I corresponds to the nearest interior tracer cell index</span></div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;        <span class="comment">! idir switches the sign of the flow so that positive is into the reservoir</span></div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;        <span class="keywordflow">if</span> (segment%direction == obc_direction_w) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;          ishift = 1 ; idir = -1</div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;          ishift = 0 ; idir = 1</div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;        <span class="comment">! Update the reservoir tracer concentration implicitly using a Backward-Euler timestep</span></div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;        <span class="keywordflow">do</span> m=1,ntr ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%tr_Reg%Tr(m)%tres)) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;          u_l_out = max(0.0, (idir*uhr(i,j,k))*segment%Tr_InvLscale_out / (h(i+ishift,j,k)*g%dyCu(i,j)))</div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;          u_l_in  = min(0.0, (idir*uhr(i,j,k))*segment%Tr_InvLscale_in  / (h(i+ishift,j,k)*g%dyCu(i,j)))</div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;          fac1 = 1.0 + (u_l_out-u_l_in)</div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;          segment%tr_Reg%Tr(m)%tres(i,j,k) = (1.0/fac1)*(segment%tr_Reg%Tr(m)%tres(i,j,k) + &amp;</div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;                            (u_l_out*reg%Tr(m)%t(i+ishift,j,k) - &amp;</div>
<div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;                             u_l_in*segment%tr_Reg%Tr(m)%t(i,j,k)))</div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc%tres_x)) obc%tres_x(i,j,k,m) = segment%tr_Reg%Tr(m)%tres(i,j,k)</div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> endif</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;      <span class="keywordflow">do</span> i=segment%HI%isd,segment%HI%ied</div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;        j = segment%HI%JsdB</div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;        <span class="comment">! jshift+J corresponds to the nearest interior tracer cell index</span></div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;        <span class="comment">! jdir switches the sign of the flow so that positive is into the reservoir</span></div>
<div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;        <span class="keywordflow">if</span> (segment%direction == obc_direction_s) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;          jshift = 1 ; jdir = -1</div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;          jshift = 0 ; jdir = 1</div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;        <span class="comment">! Update the reservoir tracer concentration implicitly using a Backward-Euler timestep</span></div>
<div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;        <span class="keywordflow">do</span> m=1,ntr ; <span class="keywordflow">if</span> (<span class="keyword">associated</span>(segment%tr_Reg%Tr(m)%tres)) <span class="keywordflow">then</span> ; <span class="keywordflow">do</span> k=1,nz</div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;          v_l_out = max(0.0, (jdir*vhr(i,j,k))*segment%Tr_InvLscale_out / (h(i,j+jshift,k)*g%dxCv(i,j)))</div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;          v_l_in  = min(0.0, (jdir*vhr(i,j,k))*segment%Tr_InvLscale_in  / (h(i,j+jshift,k)*g%dxCv(i,j)))</div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;          fac1 = 1.0 + (v_l_out-v_l_in)</div>
<div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;          segment%tr_Reg%Tr(m)%tres(i,j,k) = (1.0/fac1)*(segment%tr_Reg%Tr(m)%tres(i,j,k) + &amp;</div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;                            (v_l_out*reg%Tr(m)%t(i,j+jshift,k) - &amp;</div>
<div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;                             v_l_in*segment%tr_Reg%Tr(m)%t(i,j,k)))</div>
<div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(obc%tres_y)) obc%tres_y(i,j,k,m) = segment%tr_Reg%Tr(m)%tres(i,j,k)</div>
<div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;<span class="keywordflow">        enddo</span> ;<span class="keywordflow"> endif</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> endif</span> ;<span class="keywordflow"> endif</span></div>
<div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__open__boundary_8F90_source.html#l00064">obc_direction_s</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00066">obc_direction_w</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM_8F90_source.html#l01060">mom::step_mom_tracer_dyn()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__open__boundary_a230cf67375352c9d55b4330180d35d7c_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ad6193d2825ef41d066e20706754a0d68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6193d2825ef41d066e20706754a0d68">&#9670;&nbsp;</a></span>id_clock_pass</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer mom_open_boundary::id_clock_pass</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A CPU time clock. </p>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00301">301</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="keywordtype">integer</span> :: id_clock_pass<span class="comment"> !&lt; A CPU time clock</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l01479">open_boundary_init()</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l01788">radiation_open_bdry_conds()</a>.</p>

</div>
</div>
<a id="a6997b7b50a4afe32b14fd61ba858254f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6997b7b50a4afe32b14fd61ba858254f">&#9670;&nbsp;</a></span>max_obc_fields</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter mom_open_boundary::max_obc_fields = 100</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum number of data fields needed for OBC segments. </p>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00067">67</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>         :: MAX_OBC_FIELDS = 100<span class="comment">  !&lt; Maximum number of data fields needed for OBC segments</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="aafc1b36aca40a894743f1565f4f9d152"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aafc1b36aca40a894743f1565f4f9d152">&#9670;&nbsp;</a></span>mdl</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=40) mom_open_boundary::mdl = &quot;MOM_open_boundary&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This module's name. </p>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00303">303</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">character(len=40)  :: mdl = &quot;MOM_open_boundary&quot; !&lt; This module&#39;s name.</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l00541">initialize_segment_data()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l04183">mask_outside_obcs()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00317">open_boundary_config()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01332">parse_for_tracer_reservoirs()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l03981">segment_tracer_registry_init()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00858">setup_u_point_obc()</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l00994">setup_v_point_obc()</a>.</p>

</div>
</div>
<a id="a876256dbb0556d7e04cdf091f1744b65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a876256dbb0556d7e04cdf091f1744b65">&#9670;&nbsp;</a></span>obc_direction_e</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter, public mom_open_boundary::obc_direction_e = 300</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicates the boundary is an effective eastern boundary. </p>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00065">65</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>, <span class="keywordtype">public</span> :: OBC_DIRECTION_E = 300<span class="comment"> !&lt; Indicates the boundary is an effective eastern boundary</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l02966">gradient_at_q_points()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l04183">mask_outside_obcs()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01639">open_boundary_impose_land_mask()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01594">open_boundary_impose_normal_slope()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l03357">open_boundary_test_extern_h()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l03314">open_boundary_test_extern_uv()</a>, <a class="el" href="MOM__continuity__PPM_8F90_source.html#l01810">mom_continuity_ppm::ppm_reconstruction_x()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01788">radiation_open_bdry_conds()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l03090">set_tracer_data()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00858">setup_u_point_obc()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l03401">update_obc_segment_data()</a>, <a class="el" href="MOM__sum__output_8F90_source.html#l00304">mom_sum_output::write_energy()</a>, <a class="el" href="MOM__continuity__PPM_8F90_source.html#l00580">mom_continuity_ppm::zonal_face_thickness()</a>, <a class="el" href="MOM__continuity__PPM_8F90_source.html#l00503">mom_continuity_ppm::zonal_flux_layer()</a>, and <a class="el" href="MOM__continuity__PPM_8F90_source.html#l00213">mom_continuity_ppm::zonal_mass_flux()</a>.</p>

</div>
</div>
<a id="a6ace8760d7fa465a59d8cbc3340a5b5e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ace8760d7fa465a59d8cbc3340a5b5e">&#9670;&nbsp;</a></span>obc_direction_n</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter, public mom_open_boundary::obc_direction_n = 100</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicates the boundary is an effective northern boundary. </p>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00063">63</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>, <span class="keywordtype">public</span> :: OBC_DIRECTION_N = 100<span class="comment"> !&lt; Indicates the boundary is an effective northern boundary</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__barotropic_8F90_source.html#l02381">mom_barotropic::apply_velocity_obcs()</a>, <a class="el" href="MOM__barotropic_8F90_source.html#l02762">mom_barotropic::btcalc()</a>, <a class="el" href="MOM__barotropic_8F90_source.html#l00388">mom_barotropic::btstep()</a>, <a class="el" href="MOM__CoriolisAdv_8F90_source.html#l00112">mom_coriolisadv::coradcalc()</a>, <a class="el" href="MOM__vert__friction_8F90_source.html#l01039">mom_vert_friction::find_coupling_coef()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l02966">gradient_at_q_points()</a>, <a class="el" href="MOM__hor__visc_8F90_source.html#l00207">mom_hor_visc::horizontal_viscosity()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l04183">mask_outside_obcs()</a>, <a class="el" href="MOM__continuity__PPM_8F90_source.html#l01379">mom_continuity_ppm::merid_face_thickness()</a>, <a class="el" href="MOM__continuity__PPM_8F90_source.html#l01298">mom_continuity_ppm::merid_flux_layer()</a>, <a class="el" href="MOM__continuity__PPM_8F90_source.html#l01014">mom_continuity_ppm::meridional_mass_flux()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01594">open_boundary_impose_normal_slope()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l03357">open_boundary_test_extern_h()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l03314">open_boundary_test_extern_uv()</a>, <a class="el" href="MOM__continuity__PPM_8F90_source.html#l01949">mom_continuity_ppm::ppm_reconstruction_y()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01788">radiation_open_bdry_conds()</a>, <a class="el" href="MOM__ALE_8F90_source.html#l00748">mom_ale::remap_all_state_vars()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l03090">set_tracer_data()</a>, <a class="el" href="MOM__barotropic_8F90_source.html#l02557">mom_barotropic::set_up_bt_obc()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00994">setup_v_point_obc()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l03401">update_obc_segment_data()</a>, <a class="el" href="MOM__vert__friction_8F90_source.html#l00571">mom_vert_friction::vertvisc_coef()</a>, and <a class="el" href="MOM__sum__output_8F90_source.html#l00304">mom_sum_output::write_energy()</a>.</p>

</div>
</div>
<a id="a29aee121a765fc751bd1c21adf80af10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29aee121a765fc751bd1c21adf80af10">&#9670;&nbsp;</a></span>obc_direction_s</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter, public mom_open_boundary::obc_direction_s = 200</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicates the boundary is an effective southern boundary. </p>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00064">64</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>, <span class="keywordtype">public</span> :: OBC_DIRECTION_S = 200<span class="comment"> !&lt; Indicates the boundary is an effective southern boundary</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__barotropic_8F90_source.html#l02381">mom_barotropic::apply_velocity_obcs()</a>, <a class="el" href="MOM__barotropic_8F90_source.html#l02762">mom_barotropic::btcalc()</a>, <a class="el" href="MOM__barotropic_8F90_source.html#l00388">mom_barotropic::btstep()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l04122">fill_temp_salt_segments()</a>, <a class="el" href="MOM__vert__friction_8F90_source.html#l01039">mom_vert_friction::find_coupling_coef()</a>, <a class="el" href="MOM__hor__visc_8F90_source.html#l00207">mom_hor_visc::horizontal_viscosity()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l04183">mask_outside_obcs()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01639">open_boundary_impose_land_mask()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01594">open_boundary_impose_normal_slope()</a>, <a class="el" href="MOM__continuity__PPM_8F90_source.html#l01949">mom_continuity_ppm::ppm_reconstruction_y()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01788">radiation_open_bdry_conds()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l03090">set_tracer_data()</a>, <a class="el" href="MOM__barotropic_8F90_source.html#l02557">mom_barotropic::set_up_bt_obc()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00994">setup_v_point_obc()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l03401">update_obc_segment_data()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l04513">update_segment_tracer_reservoirs()</a>, <a class="el" href="MOM__vert__friction_8F90_source.html#l00571">mom_vert_friction::vertvisc_coef()</a>, and <a class="el" href="MOM__sum__output_8F90_source.html#l00304">mom_sum_output::write_energy()</a>.</p>

</div>
</div>
<a id="a015e27a65957919ea3cd67767b8f26f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a015e27a65957919ea3cd67767b8f26f7">&#9670;&nbsp;</a></span>obc_direction_w</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter, public mom_open_boundary::obc_direction_w = 400</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicates the boundary is an effective western boundary. </p>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00066">66</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>, <span class="keywordtype">public</span> :: OBC_DIRECTION_W = 400<span class="comment"> !&lt; Indicates the boundary is an effective western boundary</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l04122">fill_temp_salt_segments()</a>, <a class="el" href="MOM__vert__friction_8F90_source.html#l01039">mom_vert_friction::find_coupling_coef()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l04183">mask_outside_obcs()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01639">open_boundary_impose_land_mask()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01594">open_boundary_impose_normal_slope()</a>, <a class="el" href="MOM__continuity__PPM_8F90_source.html#l01810">mom_continuity_ppm::ppm_reconstruction_x()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l01788">radiation_open_bdry_conds()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l03090">set_tracer_data()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l00858">setup_u_point_obc()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l03401">update_obc_segment_data()</a>, <a class="el" href="MOM__open__boundary_8F90_source.html#l04513">update_segment_tracer_reservoirs()</a>, <a class="el" href="MOM__vert__friction_8F90_source.html#l00571">mom_vert_friction::vertvisc_coef()</a>, and <a class="el" href="MOM__sum__output_8F90_source.html#l00304">mom_sum_output::write_energy()</a>.</p>

</div>
</div>
<a id="aab15bba6b94442339da4ea4dcb35811d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab15bba6b94442339da4ea4dcb35811d">&#9670;&nbsp;</a></span>obc_flather</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter, public mom_open_boundary::obc_flather = 3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicates the use of a Flather open boundary. </p>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00061">61</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>, <span class="keywordtype">public</span> :: OBC_FLATHER =  3<span class="comment">  !&lt; Indicates the use of a Flather open boundary</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1dd4294ac05ea337431a26395003325f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1dd4294ac05ea337431a26395003325f">&#9670;&nbsp;</a></span>obc_none</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter, public mom_open_boundary::obc_none = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicates the use of no open boundary. </p>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00058">58</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>, <span class="keywordtype">public</span> :: OBC_NONE = 0<span class="comment">      !&lt; Indicates the use of no open boundary</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__open__boundary_8F90_source.html#l00317">open_boundary_config()</a>, and <a class="el" href="MOM__open__boundary_8F90_source.html#l01639">open_boundary_impose_land_mask()</a>.</p>

</div>
</div>
<a id="a8f7b9f941c542c5bcddb75de5fa8e38e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f7b9f941c542c5bcddb75de5fa8e38e">&#9670;&nbsp;</a></span>obc_radiation</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter, public mom_open_boundary::obc_radiation = 4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicates the use of a radiation open boundary. </p>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00062">62</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>, <span class="keywordtype">public</span> :: OBC_RADIATION = 4<span class="comment"> !&lt; Indicates the use of a radiation open boundary</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad14f75b62184f667bb07c0f31b633c7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad14f75b62184f667bb07c0f31b633c7c">&#9670;&nbsp;</a></span>obc_simple</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter, public mom_open_boundary::obc_simple = 1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicates the use of a simple inflow open boundary. </p>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00059">59</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>, <span class="keywordtype">public</span> :: OBC_SIMPLE = 1<span class="comment">    !&lt; Indicates the use of a simple inflow open boundary</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a59020084f9aa725ff55812572cabe6e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59020084f9aa725ff55812572cabe6e6">&#9670;&nbsp;</a></span>obc_wall</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter, public mom_open_boundary::obc_wall = 2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicates the use of a closed wall. </p>

<p class="definition">Definition at line <a class="el" href="MOM__open__boundary_8F90_source.html#l00060">60</a> of file <a class="el" href="MOM__open__boundary_8F90_source.html">MOM_open_boundary.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>, <span class="keywordtype">public</span> :: OBC_WALL = 2<span class="comment">      !&lt; Indicates the use of a closed wall</span></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aMOM__open__boundary_8F90_html_a0793b1a5746e6ead6bff50c3a52cae90"><div class="ttname"><a href="MOM__open__boundary_8F90.html#a0793b1a5746e6ead6bff50c3a52cae90">interpret_int_expr</a></div><div class="ttdeci">integer function interpret_int_expr(string, imax)</div><div class="ttdef"><b>Definition:</b> <a href="MOM__open__boundary_8F90_source.html#l01214">MOM_open_boundary.F90:1214</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemom__open__boundary.html">mom_open_boundary</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
