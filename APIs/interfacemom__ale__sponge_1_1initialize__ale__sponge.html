<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_ale_sponge::initialize_ale_sponge Interface Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('interfacemom__ale__sponge_1_1initialize__ale__sponge.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pri-methods">Private functions</a> &#124;
<a href="interfacemom__ale__sponge_1_1initialize__ale__sponge-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">mom_ale_sponge::initialize_ale_sponge Interface Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Ddetermine the number of points which are within sponges in this computational domain. </p>
<p>Only points that have positive values of Iresttime and which mask2dT indicates are ocean points are included in the sponges. It also stores the target interface heights. </p>

<p class="definition">Definition at line <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00048">48</a> of file <a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a>.</p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private functions</h2></td></tr>
<tr class="memitem:a463cd22c6fdd61d2e0918bb6c830c570"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interfacemom__ale__sponge_1_1initialize__ale__sponge.html#a463cd22c6fdd61d2e0918bb6c830c570">initialize_ale_sponge_fixed</a> (Iresttime, G, param_file, CS, data_h, nz_data)</td></tr>
<tr class="memdesc:a463cd22c6fdd61d2e0918bb6c830c570"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine determines the number of points which are within sponges in this computational domain. Only points that have positive values of Iresttime and which mask2dT indicates are ocean points are included in the sponges. It also stores the target interface heights.  <a href="interfacemom__ale__sponge_1_1initialize__ale__sponge.html#a463cd22c6fdd61d2e0918bb6c830c570">More...</a><br /></td></tr>
<tr class="separator:a463cd22c6fdd61d2e0918bb6c830c570"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11a5638d0ed823f984ff4dbdfdc8f354"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interfacemom__ale__sponge_1_1initialize__ale__sponge.html#a11a5638d0ed823f984ff4dbdfdc8f354">initialize_ale_sponge_varying</a> (Iresttime, G, param_file, CS)</td></tr>
<tr class="memdesc:a11a5638d0ed823f984ff4dbdfdc8f354"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine determines the number of points which are to be restoref in the computational domain. Only points that have positive values of Iresttime and which mask2dT indicates are ocean points are included in the sponges.  <a href="interfacemom__ale__sponge_1_1initialize__ale__sponge.html#a11a5638d0ed823f984ff4dbdfdc8f354">More...</a><br /></td></tr>
<tr class="separator:a11a5638d0ed823f984ff4dbdfdc8f354"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Functions and subroutines</h2>
<a id="a463cd22c6fdd61d2e0918bb6c830c570"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a463cd22c6fdd61d2e0918bb6c830c570">&#9670;&nbsp;</a></span>initialize_ale_sponge_fixed()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_ale_sponge::initialize_ale_sponge::initialize_ale_sponge_fixed </td>
          <td>(</td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g)), intent(in)&#160;</td>
          <td class="paramname"><em>Iresttime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ale__sponge_1_1ale__sponge__cs.html">ale_sponge_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(szi_(g),szj_(g),nz_data), intent(in)&#160;</td>
          <td class="paramname"><em>data_h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nz_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This subroutine determines the number of points which are within sponges in this computational domain. Only points that have positive values of Iresttime and which mask2dT indicates are ocean points are included in the sponges. It also stores the target interface heights. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nz_data</td><td>The total number of sponge input layers. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">iresttime</td><td>The inverse of the restoring time [s-1]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure indicating the open file to parse for model parameter values. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>A pointer that is set to point to the control structure for this module (in/out). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data_h</td><td>The thicknesses of the sponge input layers [H ~&gt; m or kg m-2]. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00141">141</a> of file <a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),            <span class="keywordtype">intent(in)</span> :: G<span class="comment"> !&lt; The ocean&#39;s grid structure.</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordtype">integer</span>,                          <span class="keywordtype">intent(in)</span> :: nz_data<span class="comment"> !&lt; The total number of sponge input layers.</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>, <span class="keywordtype">intent(in)</span> :: Iresttime<span class="comment"> !&lt; The inverse of the restoring time [s-1].</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordtype">type</span>(param_file_type),            <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; A structure indicating the open file</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">                                                             !! to parse for model parameter values.</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordtype">type</span>(ALE_sponge_CS),              <span class="keywordtype">pointer</span>    :: CS<span class="comment"> !&lt; A pointer that is set to point to the control</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">                                                     !! structure for this module (in/out).</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),nz_data)</span>, <span class="keywordtype">intent(in)</span> :: data_h<span class="comment"> !&lt; The thicknesses of the sponge</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">                                                     !! input layers [H ~&gt; m or kg m-2].</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;MOM_sponge&quot;</span>  <span class="comment">! This module&#39;s name.</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordtype">logical</span> :: use_sponge</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: data_hu<span class="comment"> !&lt; thickness at u points [H ~&gt; m or kg m-2]</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:,:)</span> :: data_hv<span class="comment"> !&lt; thickness at v points [H ~&gt; m or kg m-2]</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:)</span> :: Iresttime_u<span class="comment"> !&lt; inverse of the restoring time at u points [s-1]</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:)</span> :: Iresttime_v<span class="comment"> !&lt; inverse of the restoring time at v points [s-1]</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordtype">logical</span> :: bndExtrapolation = .true. <span class="comment">! If true, extrapolate boundaries</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, col, total_sponge_cols, total_sponge_cols_u, total_sponge_cols_v</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordtype">character(len=10)</span>  :: remapScheme</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;initialize_sponge called with an associated &quot;</span>// &amp;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                            <span class="stringliteral">&quot;control structure.&quot;</span>)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">! Set default, read and log parameters</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="keyword">call </span>log_version(param_file, mdl, version, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE&quot;</span>, use_sponge, &amp;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                 <span class="stringliteral">&quot;If true, sponges may be applied anywhere in the domain. &quot;</span>//&amp;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                 <span class="stringliteral">&quot;The exact location and properties of those sponges are &quot;</span>//&amp;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                 <span class="stringliteral">&quot;specified from MOM_initialization.F90.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="keywordflow">if</span> (.not.use_sponge) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keyword">allocate</span>(cs)</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE_UV&quot;</span>, cs%sponge_uv, &amp;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                 <span class="stringliteral">&quot;Apply sponges in u and v, in addition to tracers.&quot;</span>, &amp;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                 default=.false.)</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;REMAPPING_SCHEME&quot;</span>, remapscheme, &amp;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                 <span class="stringliteral">&quot;This sets the reconstruction scheme used &quot;</span>//&amp;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                 <span class="stringliteral">&quot; for vertical remapping for all variables.&quot;</span>, &amp;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                 default=<span class="stringliteral">&quot;PLM&quot;</span>, do_not_log=.true.)</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;BOUNDARY_EXTRAPOLATION&quot;</span>, bndextrapolation, &amp;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                 <span class="stringliteral">&quot;When defined, a proper high-order reconstruction &quot;</span>//&amp;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                 <span class="stringliteral">&quot;scheme is used within boundary cells rather &quot;</span>//&amp;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                 <span class="stringliteral">&quot;than PCM. E.g., if PPM is used for remapping, a &quot;</span>//&amp;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                 <span class="stringliteral">&quot;PPM reconstruction will also be used within boundary cells.&quot;</span>, &amp;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                 default=.false., do_not_log=.true.)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  cs%time_varying_sponges = .false.</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  cs%nz = g%ke</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  cs%isc = g%isc ; cs%iec = g%iec ; cs%jsc = g%jsc ; cs%jec = g%jec</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  cs%isd = g%isd ; cs%ied = g%ied ; cs%jsd = g%jsd ; cs%jed = g%jed</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  cs%iscB = g%iscB ; cs%iecB = g%iecB; cs%jscB = g%jscB ; cs%jecB = g%jecB</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="comment">! number of columns to be restored</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  cs%num_col = 0 ; cs%fldno = 0</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">do</span> j=g%jsc,g%jec ; <span class="keywordflow">do</span> i=g%isc,g%iec</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">if</span> ((iresttime(i,j)&gt;0.0) .and. (g%mask2dT(i,j)&gt;0)) &amp;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      cs%num_col = cs%num_col + 1</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordflow">if</span> (cs%num_col &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keyword">allocate</span>(cs%Iresttime_col(cs%num_col)) ; cs%Iresttime_col = 0.0</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keyword">allocate</span>(cs%col_i(cs%num_col))         ; cs%col_i = 0</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keyword">allocate</span>(cs%col_j(cs%num_col))         ; cs%col_j = 0</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">! pass indices, restoring time to the CS structure</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    col = 1</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">do</span> j=g%jsc,g%jec ; <span class="keywordflow">do</span> i=g%isc,g%iec</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordflow">if</span> ((iresttime(i,j)&gt;0.0) .and. (g%mask2dT(i,j)&gt;0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        cs%col_i(col) = i ; cs%col_j(col) = j</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        cs%Iresttime_col(col) = g%US%T_to_s*iresttime(i,j)</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        col = col +1</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">! same for total number of arbritary layers and correspondent data</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    cs%nz_data = nz_data</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keyword">allocate</span>(cs%Ref_h%p(cs%nz_data,cs%num_col))</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">do</span> col=1,cs%num_col ; <span class="keywordflow">do</span> k=1,cs%nz_data</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      cs%Ref_h%p(k,col) = data_h(cs%col_i(col),cs%col_j(col),k)</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  total_sponge_cols = cs%num_col</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keyword">call </span>sum_across_pes(total_sponge_cols)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">! Call the constructor for remapping control structure</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="keyword">call </span>initialize_remapping(cs%remap_cs, remapscheme, boundary_extrapolation=bndextrapolation)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;!Total sponge columns at h points&quot;</span>, total_sponge_cols, &amp;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                 <span class="stringliteral">&quot;The total number of columns where sponges are applied at h points.&quot;</span>)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordflow">if</span> (cs%sponge_uv) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keyword">allocate</span>(data_hu(g%isdB:g%iedB,g%jsd:g%jed,nz_data)); data_hu(:,:,:)=0.0</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keyword">allocate</span>(data_hv(g%isd:g%ied,g%jsdB:g%jedB,nz_data)); data_hv(:,:,:)=0.0</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keyword">allocate</span>(iresttime_u(g%isdB:g%iedB,g%jsd:g%jed)); iresttime_u(:,:)=0.0</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keyword">allocate</span>(iresttime_v(g%isd:g%ied,g%jsdB:g%jedB)); iresttime_v(:,:)=0.0</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">! u points</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    cs%num_col_u = 0 ; <span class="comment">!CS%fldno_u = 0</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">do</span> j=cs%jsc,cs%jec; <span class="keywordflow">do</span> i=cs%iscB,cs%iecB</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;       data_hu(i,j,:) = 0.5 * (data_h(i,j,:) + data_h(i+1,j,:))</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;       iresttime_u(i,j) = 0.5 * (iresttime(i,j) + iresttime(i+1,j))</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;       <span class="keywordflow">if</span> ((iresttime_u(i,j)&gt;0.0) .and. (g%mask2dCu(i,j)&gt;0)) &amp;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;          cs%num_col_u = cs%num_col_u + 1</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">if</span> (cs%num_col_u &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;       <span class="keyword">allocate</span>(cs%Iresttime_col_u(cs%num_col_u)) ; cs%Iresttime_col_u = 0.0</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;       <span class="keyword">allocate</span>(cs%col_i_u(cs%num_col_u))         ; cs%col_i_u = 0</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;       <span class="keyword">allocate</span>(cs%col_j_u(cs%num_col_u))         ; cs%col_j_u = 0</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;       <span class="comment">! pass indices, restoring time to the CS structure</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;       col = 1</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;       <span class="keywordflow">do</span> j=cs%jsc,cs%jec ; <span class="keywordflow">do</span> i=cs%iscB,cs%iecB</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;         <span class="keywordflow">if</span> ((iresttime_u(i,j)&gt;0.0) .and. (g%mask2dCu(i,j)&gt;0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;           cs%col_i_u(col) = i ; cs%col_j_u(col) = j</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;           cs%Iresttime_col_u(col) = g%US%T_to_s*iresttime_u(i,j)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;           col = col +1</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="keywordflow">       enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;       <span class="comment">! same for total number of arbritary layers and correspondent data</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;       <span class="keyword">allocate</span>(cs%Ref_hu%p(cs%nz_data,cs%num_col_u))</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;       <span class="keywordflow">do</span> col=1,cs%num_col_u ; <span class="keywordflow">do</span> k=1,cs%nz_data</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;         cs%Ref_hu%p(k,col) = data_hu(cs%col_i_u(col),cs%col_j_u(col),k)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="keywordflow">       enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    total_sponge_cols_u = cs%num_col_u</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keyword">call </span>sum_across_pes(total_sponge_cols_u)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;!Total sponge columns at u points&quot;</span>, total_sponge_cols_u, &amp;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <span class="stringliteral">&quot;The total number of columns where sponges are applied at u points.&quot;</span>)</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">! v points</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    cs%num_col_v = 0 ; <span class="comment">!CS%fldno_v = 0</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">do</span> j=cs%jscB,cs%jecB; <span class="keywordflow">do</span> i=cs%isc,cs%iec</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      data_hv(i,j,:) = 0.5 * (data_h(i,j,:) + data_h(i,j+1,:))</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      iresttime_v(i,j) = 0.5 * (iresttime(i,j) + iresttime(i,j+1))</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keywordflow">if</span> ((iresttime_v(i,j)&gt;0.0) .and. (g%mask2dCv(i,j)&gt;0)) &amp;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        cs%num_col_v = cs%num_col_v + 1</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span> (cs%num_col_v &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keyword">allocate</span>(cs%Iresttime_col_v(cs%num_col_v)) ; cs%Iresttime_col_v = 0.0</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="keyword">allocate</span>(cs%col_i_v(cs%num_col_v))         ; cs%col_i_v = 0</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="keyword">allocate</span>(cs%col_j_v(cs%num_col_v))         ; cs%col_j_v = 0</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="comment">! pass indices, restoring time to the CS structure</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      col = 1</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="keywordflow">do</span> j=cs%jscB,cs%jecB ; <span class="keywordflow">do</span> i=cs%isc,cs%iec</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">if</span> ((iresttime_v(i,j)&gt;0.0) .and. (g%mask2dCv(i,j)&gt;0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;          cs%col_i_v(col) = i ; cs%col_j_v(col) = j</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;          cs%Iresttime_col_v(col) = g%US%T_to_s*iresttime_v(i,j)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;          col = col +1</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="comment">! same for total number of arbritary layers and correspondent data</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keyword">allocate</span>(cs%Ref_hv%p(cs%nz_data,cs%num_col_v))</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">do</span> col=1,cs%num_col_v ; <span class="keywordflow">do</span> k=1,cs%nz_data</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        cs%Ref_hv%p(k,col) = data_hv(cs%col_i_v(col),cs%col_j_v(col),k)</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    total_sponge_cols_v = cs%num_col_v</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keyword">call </span>sum_across_pes(total_sponge_cols_v)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;!Total sponge columns at v points&quot;</span>, total_sponge_cols_v, &amp;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                 <span class="stringliteral">&quot;The total number of columns where sponges are applied at v points.&quot;</span>)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="a11a5638d0ed823f984ff4dbdfdc8f354"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11a5638d0ed823f984ff4dbdfdc8f354">&#9670;&nbsp;</a></span>initialize_ale_sponge_varying()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_ale_sponge::initialize_ale_sponge::initialize_ale_sponge_varying </td>
          <td>(</td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed), intent(in)&#160;</td>
          <td class="paramname"><em>Iresttime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ale__sponge_1_1ale__sponge__cs.html">ale_sponge_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This subroutine determines the number of points which are to be restoref in the computational domain. Only points that have positive values of Iresttime and which mask2dT indicates are ocean points are included in the sponges. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>The ocean's grid structure. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">iresttime</td><td>The inverse of the restoring time [s-1]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>A structure indicating the open file to parse for model parameter values. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>A pointer that is set to point to the control structure for this module (in/out). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__ALE__sponge_8F90_source.html#l00376">376</a> of file <a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),            <span class="keywordtype">intent(in)</span> :: G<span class="comment"> !&lt; The ocean&#39;s grid structure.</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>, <span class="keywordtype">intent(in)</span> :: Iresttime<span class="comment"> !&lt; The inverse of the restoring time [s-1].</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordtype">type</span>(param_file_type),            <span class="keywordtype">intent(in)</span> :: param_file<span class="comment"> !&lt; A structure indicating the open file to parse</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">                                                             !! for model parameter values.</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordtype">type</span>(ALE_sponge_CS),              <span class="keywordtype">pointer</span>    :: CS<span class="comment"> !&lt; A pointer that is set to point to the control</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">                                                     !! structure for this module (in/out).</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160; </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;MOM_sponge&quot;</span>  <span class="comment">! This module&#39;s name.</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keywordtype">logical</span> :: use_sponge</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:)</span> :: Iresttime_u<span class="comment"> !&lt; inverse of the restoring time at u points [s-1]</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:,:)</span> :: Iresttime_v<span class="comment"> !&lt; inverse of the restoring time at v points [s-1]</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordtype">logical</span> :: bndExtrapolation = .true. <span class="comment">! If true, extrapolate boundaries</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordtype">logical</span> :: spongeDataOngrid = .false.</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordtype">integer</span> :: i, j, k, col, total_sponge_cols, total_sponge_cols_u, total_sponge_cols_v</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordtype">character(len=10)</span>  :: remapScheme</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(cs)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;initialize_sponge called with an associated &quot;</span>// &amp;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                            <span class="stringliteral">&quot;control structure.&quot;</span>)</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">! Set default, read and log parameters</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keyword">call </span>log_version(param_file, mdl, version, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE&quot;</span>, use_sponge, &amp;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                 <span class="stringliteral">&quot;If true, sponges may be applied anywhere in the domain. &quot;</span>//&amp;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                 <span class="stringliteral">&quot;The exact location and properties of those sponges are &quot;</span>//&amp;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                 <span class="stringliteral">&quot;specified from MOM_initialization.F90.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="keywordflow">if</span> (.not.use_sponge) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keyword">allocate</span>(cs)</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE_UV&quot;</span>, cs%sponge_uv, &amp;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                 <span class="stringliteral">&quot;Apply sponges in u and v, in addition to tracers.&quot;</span>, &amp;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                 default=.false.)</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;REMAPPING_SCHEME&quot;</span>, remapscheme, &amp;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                 <span class="stringliteral">&quot;This sets the reconstruction scheme used &quot;</span>//&amp;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                 <span class="stringliteral">&quot; for vertical remapping for all variables.&quot;</span>, &amp;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                 default=<span class="stringliteral">&quot;PLM&quot;</span>, do_not_log=.true.)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;BOUNDARY_EXTRAPOLATION&quot;</span>, bndextrapolation, &amp;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                 <span class="stringliteral">&quot;When defined, a proper high-order reconstruction &quot;</span>//&amp;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                 <span class="stringliteral">&quot;scheme is used within boundary cells rather &quot;</span>//&amp;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                 <span class="stringliteral">&quot;than PCM. E.g., if PPM is used for remapping, a &quot;</span>//&amp;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                 <span class="stringliteral">&quot;PPM reconstruction will also be used within boundary cells.&quot;</span>, &amp;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                 default=.false., do_not_log=.true.)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SPONGE_DATA_ONGRID&quot;</span>, cs%spongeDataOngrid, &amp;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                 <span class="stringliteral">&quot;When defined, the incoming sponge data are &quot;</span>//&amp;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                 <span class="stringliteral">&quot;assumed to be on the model grid &quot;</span> , &amp;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                 default=.false.)</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  cs%time_varying_sponges = .true.</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  cs%nz = g%ke</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  cs%isc = g%isc ; cs%iec = g%iec ; cs%jsc = g%jsc ; cs%jec = g%jec</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  cs%isd = g%isd ; cs%ied = g%ied ; cs%jsd = g%jsd ; cs%jed = g%jed</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  cs%iscB = g%iscB ; cs%iecB = g%iecB; cs%jscB = g%jscB ; cs%jecB = g%jecB</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="comment">! number of columns to be restored</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  cs%num_col = 0 ; cs%fldno = 0</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordflow">do</span> j=g%jsc,g%jec ; <span class="keywordflow">do</span> i=g%isc,g%iec</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">if</span> ((iresttime(i,j)&gt;0.0) .and. (g%mask2dT(i,j)&gt;0)) &amp;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      cs%num_col = cs%num_col + 1</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="keywordflow">  enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordflow">if</span> (cs%num_col &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keyword">allocate</span>(cs%Iresttime_col(cs%num_col)) ; cs%Iresttime_col = 0.0</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keyword">allocate</span>(cs%col_i(cs%num_col))         ; cs%col_i = 0</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keyword">allocate</span>(cs%col_j(cs%num_col))         ; cs%col_j = 0</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">! pass indices, restoring time to the CS structure</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    col = 1</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">do</span> j=g%jsc,g%jec ; <span class="keywordflow">do</span> i=g%isc,g%iec</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordflow">if</span> ((iresttime(i,j)&gt;0.0) .and. (g%mask2dT(i,j)&gt;0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        cs%col_i(col) = i ; cs%col_j(col) = j</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        cs%Iresttime_col(col) = g%US%T_to_s*iresttime(i,j)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        col = col +1</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  total_sponge_cols = cs%num_col</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keyword">call </span>sum_across_pes(total_sponge_cols)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">! Call the constructor for remapping control structure</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keyword">call </span>initialize_remapping(cs%remap_cs, remapscheme, boundary_extrapolation=bndextrapolation)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;!Total sponge columns at h points&quot;</span>, total_sponge_cols, &amp;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                 <span class="stringliteral">&quot;The total number of columns where sponges are applied at h points.&quot;</span>)</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordflow">if</span> (cs%sponge_uv) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keyword">allocate</span>(iresttime_u(g%isdB:g%iedB,g%jsd:g%jed)); iresttime_u(:,:)=0.0</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keyword">allocate</span>(iresttime_v(g%isd:g%ied,g%jsdB:g%jedB)); iresttime_v(:,:)=0.0</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="comment">! u points</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    cs%num_col_u = 0 ; <span class="comment">!CS%fldno_u = 0</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">do</span> j=cs%jsc,cs%jec; <span class="keywordflow">do</span> i=cs%iscB,cs%iecB</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      iresttime_u(i,j) = 0.5 * (iresttime(i,j) + iresttime(i+1,j))</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keywordflow">if</span> ((iresttime_u(i,j)&gt;0.0) .and. (g%mask2dCu(i,j)&gt;0)) &amp;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        cs%num_col_u = cs%num_col_u + 1</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">if</span> (cs%num_col_u &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <span class="keyword">allocate</span>(cs%Iresttime_col_u(cs%num_col_u)) ; cs%Iresttime_col_u = 0.0</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <span class="keyword">allocate</span>(cs%col_i_u(cs%num_col_u))         ; cs%col_i_u = 0</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keyword">allocate</span>(cs%col_j_u(cs%num_col_u))         ; cs%col_j_u = 0</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="comment">! pass indices, restoring time to the CS structure</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      col = 1</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="keywordflow">do</span> j=cs%jsc,cs%jec ; <span class="keywordflow">do</span> i=cs%iscB,cs%iecB</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">if</span> ((iresttime_u(i,j)&gt;0.0) .and. (g%mask2dCu(i,j)&gt;0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;          cs%col_i_u(col) = i ; cs%col_j_u(col) = j</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;          cs%Iresttime_col_u(col) = g%US%T_to_s*iresttime_u(i,j)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;          col = col +1</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <span class="comment">! same for total number of arbritary layers and correspondent data</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    total_sponge_cols_u = cs%num_col_u</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keyword">call </span>sum_across_pes(total_sponge_cols_u)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;!Total sponge columns at u points&quot;</span>, total_sponge_cols_u, &amp;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                <span class="stringliteral">&quot;The total number of columns where sponges are applied at u points.&quot;</span>)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="comment">! v points</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    cs%num_col_v = 0 ; <span class="comment">!CS%fldno_v = 0</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">do</span> j=cs%jscB,cs%jecB; <span class="keywordflow">do</span> i=cs%isc,cs%iec</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      iresttime_v(i,j) = 0.5 * (iresttime(i,j) + iresttime(i,j+1))</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <span class="keywordflow">if</span> ((iresttime_v(i,j)&gt;0.0) .and. (g%mask2dCv(i,j)&gt;0)) &amp;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        cs%num_col_v = cs%num_col_v + 1</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">if</span> (cs%num_col_v &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="keyword">allocate</span>(cs%Iresttime_col_v(cs%num_col_v)) ; cs%Iresttime_col_v = 0.0</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="keyword">allocate</span>(cs%col_i_v(cs%num_col_v))         ; cs%col_i_v = 0</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="keyword">allocate</span>(cs%col_j_v(cs%num_col_v))         ; cs%col_j_v = 0</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="comment">! pass indices, restoring time to the CS structure</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      col = 1</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="keywordflow">do</span> j=cs%jscB,cs%jecB ; <span class="keywordflow">do</span> i=cs%isc,cs%iec</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">if</span> ((iresttime_v(i,j)&gt;0.0) .and. (g%mask2dCv(i,j)&gt;0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;          cs%col_i_v(col) = i ; cs%col_j_v(col) = j</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;          cs%Iresttime_col_v(col) = g%US%T_to_s*iresttime_v(i,j)</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;          col = col +1</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    total_sponge_cols_v = cs%num_col_v</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keyword">call </span>sum_across_pes(total_sponge_cols_v)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keyword">call </span>log_param(param_file, mdl, <span class="stringliteral">&quot;!Total sponge columns at v points&quot;</span>, total_sponge_cols_v, &amp;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                <span class="stringliteral">&quot;The total number of columns where sponges are applied at v points.&quot;</span>)</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this interface was generated from the following file:<ul>
<li>/glade/work/altuntas/cesm.sandboxes/cesm2_2_alpha_X_mom/components/mom/MOM6/src/parameterizations/vertical/<a class="el" href="MOM__ALE__sponge_8F90_source.html">MOM_ALE_sponge.F90</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemom__ale__sponge.html">mom_ale_sponge</a></li><li class="navelem"><a class="el" href="interfacemom__ale__sponge_1_1initialize__ale__sponge.html">initialize_ale_sponge</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
