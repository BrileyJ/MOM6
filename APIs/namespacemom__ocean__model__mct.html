<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_ocean_model_mct Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespacemom__ocean__model__mct.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">mom_ocean_model_mct Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Top-level module for the MOM6 ocean model in coupled mode. </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__ocean__model__mct_1_1ocean__public__type.html">ocean_public_type</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">This type is used for communication with other components via the FMS coupler. The element names and types can be changed only with great deliberation, hence the persistnce of things like the cutsy element name "avg_kount".  <a href="structmom__ocean__model__mct_1_1ocean__public__type.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__ocean__model__mct_1_1ocean__state__type.html">ocean_state_type</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The <a class="el" href="structmom__ocean__model__mct_1_1ocean__state__type.html" title="The ocean_state_type contains all information about the state of the ocean, with a format that is pri...">ocean_state_type</a> contains all information about the state of the ocean, with a format that is private so it can be readily changed without disrupting other coupled components.  <a href="structmom__ocean__model__mct_1_1ocean__state__type.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ab85c4a8f30fcf7782a514a3fc66165a2"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ocean__model__mct.html#ab85c4a8f30fcf7782a514a3fc66165a2">ocean_model_init</a> (Ocean_sfc, OS, Time_init, Time_in, gas_fields_ocn, input_restart_file)</td></tr>
<tr class="memdesc:ab85c4a8f30fcf7782a514a3fc66165a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">ocean_model_init initializes the ocean model, including registering fields for restarts and reading restart files if appropriate.  <a href="namespacemom__ocean__model__mct.html#ab85c4a8f30fcf7782a514a3fc66165a2">More...</a><br /></td></tr>
<tr class="separator:ab85c4a8f30fcf7782a514a3fc66165a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a422ba42ca07c0bf28ec5113aba4f1e96"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ocean__model__mct.html#a422ba42ca07c0bf28ec5113aba4f1e96">update_ocean_model</a> (Ice_ocean_boundary, OS, Ocean_sfc, time_start_update, Ocean_coupling_time_step, update_dyn, update_thermo, Ocn_fluxes_used)</td></tr>
<tr class="memdesc:a422ba42ca07c0bf28ec5113aba4f1e96"><td class="mdescLeft">&#160;</td><td class="mdescRight">update_ocean_model uses the forcing in Ice_ocean_boundary to advance the ocean model's state from the input value of Ocean_state (which must be for time time_start_update) for a time interval of Ocean_coupling_time_step, returning the publicly visible ocean surface properties in Ocean_sfc and storing the new ocean properties in Ocean_state.  <a href="namespacemom__ocean__model__mct.html#a422ba42ca07c0bf28ec5113aba4f1e96">More...</a><br /></td></tr>
<tr class="separator:a422ba42ca07c0bf28ec5113aba4f1e96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb431f3c4f9de3b5f06acdb92428eeb2"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ocean__model__mct.html#adb431f3c4f9de3b5f06acdb92428eeb2">ocean_model_restart</a> (OS, timestamp, restartname)</td></tr>
<tr class="memdesc:adb431f3c4f9de3b5f06acdb92428eeb2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine writes out the ocean model restart file.  <a href="namespacemom__ocean__model__mct.html#adb431f3c4f9de3b5f06acdb92428eeb2">More...</a><br /></td></tr>
<tr class="separator:adb431f3c4f9de3b5f06acdb92428eeb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae300e0e875156247557b71dd922a4365"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ocean__model__mct.html#ae300e0e875156247557b71dd922a4365">ocean_model_end</a> (Ocean_sfc, Ocean_state, Time)</td></tr>
<tr class="memdesc:ae300e0e875156247557b71dd922a4365"><td class="mdescLeft">&#160;</td><td class="mdescRight">ocean_model_end terminates the model run, saving the ocean state in a restart and deallocating any data associated with the ocean.  <a href="namespacemom__ocean__model__mct.html#ae300e0e875156247557b71dd922a4365">More...</a><br /></td></tr>
<tr class="separator:ae300e0e875156247557b71dd922a4365"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf771d5306cc54b49fd8221a38415e07"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ocean__model__mct.html#acf771d5306cc54b49fd8221a38415e07">ocean_model_save_restart</a> (OS, Time, directory, filename_suffix)</td></tr>
<tr class="memdesc:acf771d5306cc54b49fd8221a38415e07"><td class="mdescLeft">&#160;</td><td class="mdescRight">ocean_model_save_restart causes restart files associated with the ocean to be written out.  <a href="namespacemom__ocean__model__mct.html#acf771d5306cc54b49fd8221a38415e07">More...</a><br /></td></tr>
<tr class="separator:acf771d5306cc54b49fd8221a38415e07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dad6b3de8f05507324e79e397238abc"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ocean__model__mct.html#a5dad6b3de8f05507324e79e397238abc">initialize_ocean_public_type</a> (input_domain, Ocean_sfc, diag, maskmap, gas_fields_ocn)</td></tr>
<tr class="memdesc:a5dad6b3de8f05507324e79e397238abc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the public ocean type.  <a href="namespacemom__ocean__model__mct.html#a5dad6b3de8f05507324e79e397238abc">More...</a><br /></td></tr>
<tr class="separator:a5dad6b3de8f05507324e79e397238abc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafb1d4da55ede89a37e651944c52b187"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ocean__model__mct.html#aafb1d4da55ede89a37e651944c52b187">convert_state_to_ocean_type</a> (sfc_state, Ocean_sfc, G, US, patm, press_to_z)</td></tr>
<tr class="memdesc:aafb1d4da55ede89a37e651944c52b187"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine translates the coupler's ocean_data_type into MOM's surface state variable. This may eventually be folded into the MOM code that calculates the surface state in the first place. Note the offset in the arrays because the ocean_data_type has no halo points in its arrays and always uses absolute indicies.  <a href="namespacemom__ocean__model__mct.html#aafb1d4da55ede89a37e651944c52b187">More...</a><br /></td></tr>
<tr class="separator:aafb1d4da55ede89a37e651944c52b187"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9974d833c3841e52263348f33cb9bba1"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ocean__model__mct.html#a9974d833c3841e52263348f33cb9bba1">ocean_model_init_sfc</a> (OS, Ocean_sfc)</td></tr>
<tr class="memdesc:a9974d833c3841e52263348f33cb9bba1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine extracts the surface properties from the ocean's internal state and stores them in the ocean type returned to the calling ice model. It has to be separate from the ocean_initialization call because the coupler module allocates the space for some of these variables.  <a href="namespacemom__ocean__model__mct.html#a9974d833c3841e52263348f33cb9bba1">More...</a><br /></td></tr>
<tr class="separator:a9974d833c3841e52263348f33cb9bba1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8515d789e0bf3e772b3e78d6e5754cb"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ocean__model__mct.html#aa8515d789e0bf3e772b3e78d6e5754cb">ocean_model_flux_init</a> (OS, verbosity)</td></tr>
<tr class="memdesc:aa8515d789e0bf3e772b3e78d6e5754cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">ocean_model_flux_init is used to initialize properties of the air-sea fluxes as determined by various run-time parameters. It can be called from non-ocean PEs, or PEs that have not yet been initialzed, and it can safely be called multiple times.  <a href="namespacemom__ocean__model__mct.html#aa8515d789e0bf3e772b3e78d6e5754cb">More...</a><br /></td></tr>
<tr class="separator:aa8515d789e0bf3e772b3e78d6e5754cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af453e38e57801cebcc7145c370c30f28"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ocean__model__mct.html#af453e38e57801cebcc7145c370c30f28">ocean_stock_pe</a> (OS, index, value, time_index)</td></tr>
<tr class="memdesc:af453e38e57801cebcc7145c370c30f28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ocean_stock_pe - returns the integrated stocks of heat, water, etc. for conservation checks. Because of the way FMS is coded, only the root PE has the integrated amount, while all other PEs get 0.  <a href="namespacemom__ocean__model__mct.html#af453e38e57801cebcc7145c370c30f28">More...</a><br /></td></tr>
<tr class="separator:af453e38e57801cebcc7145c370c30f28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2c455dca4cdd74e1a2906f91bdf4aba"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ocean__model__mct.html#af2c455dca4cdd74e1a2906f91bdf4aba">ocean_public_type_chksum</a> (id, timestep, ocn)</td></tr>
<tr class="memdesc:af2c455dca4cdd74e1a2906f91bdf4aba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write out FMS-format checsums on fields from the ocean surface state.  <a href="namespacemom__ocean__model__mct.html#af2c455dca4cdd74e1a2906f91bdf4aba">More...</a><br /></td></tr>
<tr class="separator:af2c455dca4cdd74e1a2906f91bdf4aba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdb908c5ba40ef3fc13b15dfca08aaf8"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__ocean__model__mct.html#afdb908c5ba40ef3fc13b15dfca08aaf8">get_ocean_grid</a> (OS, Gridp)</td></tr>
<tr class="separator:afdb908c5ba40ef3fc13b15dfca08aaf8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="aafb1d4da55ede89a37e651944c52b187"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aafb1d4da55ede89a37e651944c52b187">&#9670;&nbsp;</a></span>convert_state_to_ocean_type()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_ocean_model_mct::convert_state_to_ocean_type </td>
          <td>(</td>
          <td class="paramtype">type(surface), intent(inout)&#160;</td>
          <td class="paramname"><em>sfc_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__public__type.html">ocean_public_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>Ocean_sfc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:), intent(in), optional&#160;</td>
          <td class="paramname"><em>patm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>press_to_z</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine translates the coupler's ocean_data_type into MOM's surface state variable. This may eventually be folded into the MOM code that calculates the surface state in the first place. Note the offset in the arrays because the ocean_data_type has no halo points in its arrays and always uses absolute indicies. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">sfc_state</td><td>A structure containing fields that describe the surface state of the ocean. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ocean_sfc</td><td>A structure containing various publicly </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>The ocean's grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">patm</td><td>The pressure at the ocean surface, in Pa. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">press_to_z</td><td>A conversion factor between pressure and ocean depth in m, usually 1/(rho_0*g), in m Pa-1. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00844">844</a> of file <a class="el" href="mom__ocean__model__mct_8F90_source.html">mom_ocean_model_mct.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keywordtype">type</span>(surface),         <span class="keywordtype">intent(inout)</span> :: sfc_state<span class="comment"> !&lt; A structure containing fields that</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">                                               !! describe the surface state of the ocean.</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="keywordtype">type</span>(ocean_public_type), &amp;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                 <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: Ocean_sfc<span class="comment"> !&lt; A structure containing various publicly</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">                                               !! visible ocean surface fields, whose elements</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">                                               !! have their data set here.</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type), <span class="keywordtype">intent(inout)</span> :: G<span class="comment">    !&lt; The ocean&#39;s grid structure</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),   <span class="keywordtype">intent(in)</span>  :: US<span class="comment">   !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="keywordtype">  real</span>,        <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: patm(:,:)<span class="comment">  !&lt; The pressure at the ocean surface, in Pa.</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="keywordtype">  real</span>,        <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: press_to_z<span class="comment"> !&lt; A conversion factor between pressure and</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">                                               !! ocean depth in m, usually 1/(rho_0*g), in m Pa-1.</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; </div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="keywordtype">  real</span> :: IgR0</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="keywordtype">character(len=48)</span>  :: val_str</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordtype">integer</span> :: isc_bnd, iec_bnd, jsc_bnd, jec_bnd</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordtype">integer</span> :: i, j, i0, j0, is, ie, js, je</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160; </div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  is = g%isc ; ie = g%iec ; js = g%jsc ; je = g%jec</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="keyword">call </span>pass_vector(sfc_state%u,sfc_state%v,g%Domain)</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160; </div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="keyword">call </span>mpp_get_compute_domain(ocean_sfc%Domain, isc_bnd, iec_bnd, &amp;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                              jsc_bnd, jec_bnd)</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(patm)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="comment">! Check that the inidicies in patm are (isc_bnd:iec_bnd,jsc_bnd:jec_bnd).</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keywordflow">if</span> (.not.<span class="keyword">present</span>(press_to_z)) <span class="keyword">call </span>mom_error(fatal, &amp;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="stringliteral">&#39;convert_state_to_ocean_type: press_to_z must be present if patm is.&#39;</span>)</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160; </div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  i0 = is - isc_bnd ; j0 = js - jsc_bnd</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keywordflow">if</span> (sfc_state%T_is_conT) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="comment">! Convert the surface T from conservative T to potential T.</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="keywordflow">do</span> j=jsc_bnd,jec_bnd ; <span class="keywordflow">do</span> i=isc_bnd,iec_bnd</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      ocean_sfc%t_surf(i,j) = gsw_pt_from_ct(sfc_state%SSS(i+i0,j+j0), &amp;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                               sfc_state%SST(i+i0,j+j0)) + celsius_kelvin_offset</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordflow">do</span> j=jsc_bnd,jec_bnd ; <span class="keywordflow">do</span> i=isc_bnd,iec_bnd</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      ocean_sfc%t_surf(i,j) = sfc_state%SST(i+i0,j+j0) + celsius_kelvin_offset</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="keywordflow">if</span> (sfc_state%S_is_absS) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="comment">! Convert the surface S from absolute salinity to practical salinity.</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="keywordflow">do</span> j=jsc_bnd,jec_bnd ; <span class="keywordflow">do</span> i=isc_bnd,iec_bnd</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      ocean_sfc%s_surf(i,j) = gsw_sp_from_sr(sfc_state%SSS(i+i0,j+j0))</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordflow">do</span> j=jsc_bnd,jec_bnd ; <span class="keywordflow">do</span> i=isc_bnd,iec_bnd</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      ocean_sfc%s_surf(i,j) = sfc_state%SSS(i+i0,j+j0)</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(patm)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keywordflow">do</span> j=jsc_bnd,jec_bnd ; <span class="keywordflow">do</span> i=isc_bnd,iec_bnd</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      ocean_sfc%sea_lev(i,j) = sfc_state%sea_lev(i+i0,j+j0) + patm(i,j) * press_to_z</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      ocean_sfc%area(i,j) = us%L_to_m**2*g%areaT(i+i0,j+j0)</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keywordflow">do</span> j=jsc_bnd,jec_bnd ; <span class="keywordflow">do</span> i=isc_bnd,iec_bnd</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      ocean_sfc%sea_lev(i,j) = sfc_state%sea_lev(i+i0,j+j0)</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      ocean_sfc%area(i,j) = us%L_to_m**2*g%areaT(i+i0,j+j0)</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160; </div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(sfc_state%frazil)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordflow">do</span> j=jsc_bnd,jec_bnd ; <span class="keywordflow">do</span> i=isc_bnd,iec_bnd</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      ocean_sfc%frazil(i,j) = sfc_state%frazil(i+i0,j+j0)</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160; </div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(sfc_state%melt_potential)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <span class="keywordflow">do</span> j=jsc_bnd,jec_bnd ; <span class="keywordflow">do</span> i=isc_bnd,iec_bnd</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      ocean_sfc%melt_potential(i,j) = sfc_state%melt_potential(i+i0,j+j0)</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160; </div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(sfc_state%Hml)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <span class="keywordflow">do</span> j=jsc_bnd,jec_bnd ; <span class="keywordflow">do</span> i=isc_bnd,iec_bnd</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      ocean_sfc%OBLD(i,j) = sfc_state%Hml(i+i0,j+j0)</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160; </div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="keywordflow">if</span> (ocean_sfc%stagger == agrid) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordflow">do</span> j=jsc_bnd,jec_bnd ; <span class="keywordflow">do</span> i=isc_bnd,iec_bnd</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      ocean_sfc%u_surf(i,j) = g%mask2dT(i+i0,j+j0) * &amp;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                0.5*(sfc_state%u(i+i0,j+j0)+sfc_state%u(i-1+i0,j+j0))</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      ocean_sfc%v_surf(i,j) = g%mask2dT(i+i0,j+j0) * &amp;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                0.5*(sfc_state%v(i+i0,j+j0)+sfc_state%v(i+i0,j-1+j0))</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <span class="keywordflow">elseif</span> (ocean_sfc%stagger == bgrid_ne) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordflow">do</span> j=jsc_bnd,jec_bnd ; <span class="keywordflow">do</span> i=isc_bnd,iec_bnd</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      ocean_sfc%u_surf(i,j) = g%mask2dBu(i+i0,j+j0) * &amp;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                0.5*(sfc_state%u(i+i0,j+j0)+sfc_state%u(i+i0,j+j0+1))</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      ocean_sfc%v_surf(i,j) = g%mask2dBu(i+i0,j+j0) * &amp;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                0.5*(sfc_state%v(i+i0,j+j0)+sfc_state%v(i+i0+1,j+j0))</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="keywordflow">elseif</span> (ocean_sfc%stagger == cgrid_ne) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordflow">do</span> j=jsc_bnd,jec_bnd ; <span class="keywordflow">do</span> i=isc_bnd,iec_bnd</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      ocean_sfc%u_surf(i,j) = g%mask2dCu(i+i0,j+j0)*sfc_state%u(i+i0,j+j0)</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      ocean_sfc%v_surf(i,j) = g%mask2dCv(i+i0,j+j0)*sfc_state%v(i+i0,j+j0)</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keyword">write</span>(val_str, <span class="stringliteral">&#39;(I8)&#39;</span>) ocean_sfc%stagger</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;convert_state_to_ocean_type: &quot;</span>//&amp;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <span class="stringliteral">&quot;Ocean_sfc%stagger has the unrecognized value of &quot;</span>//trim(val_str))</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160; </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="keywordflow">if</span> (coupler_type_initialized(sfc_state%tr_fields)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <span class="keywordflow">if</span> (.not.coupler_type_initialized(ocean_sfc%fields)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;convert_state_to_ocean_type: &quot;</span>//&amp;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;               <span class="stringliteral">&quot;Ocean_sfc%fields has not been initialized.&quot;</span>)</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="keyword">call </span>coupler_type_copy_data(sfc_state%tr_fields, ocean_sfc%fields)</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__constants_8F90_source.html#l00011">mom_constants::celsius_kelvin_offset</a>.</p>

<p class="reference">Referenced by <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00224">ocean_model_init()</a>, <a class="el" href="ocn__comp__mct_8F90_source.html#l00744">ocn_comp_mct::ocean_model_init_sfc()</a>, <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00966">ocean_model_init_sfc()</a>, and <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00425">update_ocean_model()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__ocean__model__mct_aafb1d4da55ede89a37e651944c52b187_icgraph.svg" width="666" height="248"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="afdb908c5ba40ef3fc13b15dfca08aaf8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdb908c5ba40ef3fc13b15dfca08aaf8">&#9670;&nbsp;</a></span>get_ocean_grid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_ocean_model_mct::get_ocean_grid </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__state__type.html">ocean_state_type</a>)&#160;</td>
          <td class="paramname"><em>OS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), pointer&#160;</td>
          <td class="paramname"><em>Gridp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mom__ocean__model__mct_8F90_source.html#l01073">1073</a> of file <a class="el" href="mom__ocean__model__mct_8F90_source.html">mom_ocean_model_mct.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  <span class="comment">! Obtain the ocean grid.</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  <span class="keywordtype">type</span>(ocean_state_type) :: OS</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type) , <span class="keywordtype">pointer</span> :: Gridp</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160; </div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  gridp =&gt; os%grid</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="keywordflow">return</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5dad6b3de8f05507324e79e397238abc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5dad6b3de8f05507324e79e397238abc">&#9670;&nbsp;</a></span>initialize_ocean_public_type()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_ocean_model_mct::initialize_ocean_public_type </td>
          <td>(</td>
          <td class="paramtype">type(domain2d), intent(in)&#160;</td>
          <td class="paramname"><em>input_domain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__public__type.html">ocean_public_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>Ocean_sfc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diag_ctrl), intent(in)&#160;</td>
          <td class="paramname"><em>diag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, dimension(:,:), intent(in), optional&#160;</td>
          <td class="paramname"><em>maskmap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(coupler_1d_bc_type), intent(in), optional&#160;</td>
          <td class="paramname"><em>gas_fields_ocn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the public ocean type. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">input_domain</td><td>The ocean model domain description </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ocean_sfc</td><td>A structure containing various publicly visible ocean surface properties after initialization, whose elements are allocated here. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">diag</td><td>A structure that regulates diagnsotic output </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">maskmap</td><td>A mask indicating which virtual processors </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gas_fields_ocn</td><td>If present, this type describes the </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00783">783</a> of file <a class="el" href="mom__ocean__model__mct_8F90_source.html">mom_ocean_model_mct.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="keywordtype">type</span>(domain2D),          <span class="keywordtype">intent(in)</span>    :: input_domain<span class="comment"> !&lt; The ocean model domain description</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <span class="keywordtype">type</span>(ocean_public_type), <span class="keywordtype">intent(inout)</span> :: Ocean_sfc<span class="comment"> !&lt; A structure containing various publicly</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="comment">                                !! visible ocean surface properties after initialization, whose</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment">                                !! elements are allocated here.</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl),         <span class="keywordtype">intent(in)</span>    :: diag<span class="comment">  !&lt; A structure that regulates diagnsotic output</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">dimension(:,:)</span>, &amp;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                 <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: maskmap<span class="comment"> !&lt; A mask indicating which virtual processors</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">                                              !! are actually in use.  If missing, all are used.</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordtype">type</span>(coupler_1d_bc_type), &amp;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                 <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: gas_fields_ocn<span class="comment"> !&lt; If present, this type describes the</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">                                              !! ocean and surface-ice fields that will participate</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">                                              !! in the calculation of additional gas or other</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment">                                              !! tracer fluxes.</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keywordtype">integer</span> :: xsz, ysz, layout(2)</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="comment">! ice-ocean-boundary fields are always allocated using absolute indicies</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="comment">! and have no halos.</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="keywordtype">integer</span> :: isc, iec, jsc, jec</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160; </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <span class="keyword">call </span>mpp_get_layout(input_domain,layout)</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="keyword">call </span>mpp_get_global_domain(input_domain, xsize=xsz, ysize=ysz)</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keywordflow">if</span>(<span class="keyword">PRESENT</span>(maskmap)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="keyword">call </span>mpp_define_domains((/1,xsz,1,ysz/),layout,ocean_sfc%Domain, maskmap=maskmap)</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keyword">call </span>mpp_define_domains((/1,xsz,1,ysz/),layout,ocean_sfc%Domain)</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="keyword">call </span>mpp_get_compute_domain(ocean_sfc%Domain, isc, iec, jsc, jec)</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160; </div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="keyword">allocate</span> (ocean_sfc%t_surf (isc:iec,jsc:jec), &amp;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            ocean_sfc%s_surf (isc:iec,jsc:jec), &amp;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            ocean_sfc%u_surf (isc:iec,jsc:jec), &amp;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            ocean_sfc%v_surf (isc:iec,jsc:jec), &amp;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            ocean_sfc%sea_lev(isc:iec,jsc:jec), &amp;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            ocean_sfc%area   (isc:iec,jsc:jec), &amp;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            ocean_sfc%OBLD   (isc:iec,jsc:jec), &amp;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            ocean_sfc%melt_potential(isc:iec,jsc:jec), &amp;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            ocean_sfc%frazil (isc:iec,jsc:jec))</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160; </div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  ocean_sfc%t_surf  = 0.0  <span class="comment">! time averaged sst (Kelvin) passed to atmosphere/ice model</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  ocean_sfc%s_surf  = 0.0  <span class="comment">! time averaged sss (psu) passed to atmosphere/ice models</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  ocean_sfc%u_surf  = 0.0  <span class="comment">! time averaged u-current (m/sec) passed to atmosphere/ice models</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  ocean_sfc%v_surf  = 0.0  <span class="comment">! time averaged v-current (m/sec)  passed to atmosphere/ice models</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  ocean_sfc%sea_lev = 0.0  <span class="comment">! time averaged thickness of top model grid cell (m) plus patm/rho0/grav</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  ocean_sfc%frazil  = 0.0  <span class="comment">! time accumulated frazil (J/m^2) passed to ice model</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  ocean_sfc%melt_potential  = 0.0  <span class="comment">! time accumulated melt potential (J/m^2) passed to ice model</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  ocean_sfc%OBLD    = 0.0  <span class="comment">! ocean boundary layer depth, in m</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  ocean_sfc%area    = 0.0</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  ocean_sfc%axes    = diag%axesT1%handles <span class="comment">!diag axes to be used by coupler tracer flux diagnostics</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160; </div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(gas_fields_ocn)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keyword">call </span>coupler_type_spawn(gas_fields_ocn, ocean_sfc%fields, (/isc,isc,iec,iec/), &amp;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                              (/jsc,jsc,jec,jec/), suffix = <span class="stringliteral">&#39;_ocn&#39;</span>, as_needed=.true.)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00224">ocean_model_init()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__ocean__model__mct_a5dad6b3de8f05507324e79e397238abc_icgraph.svg" width="415" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ae300e0e875156247557b71dd922a4365"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae300e0e875156247557b71dd922a4365">&#9670;&nbsp;</a></span>ocean_model_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_ocean_model_mct::ocean_model_end </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__public__type.html">ocean_public_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>Ocean_sfc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__state__type.html">ocean_state_type</a>), pointer&#160;</td>
          <td class="paramname"><em>Ocean_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ocean_model_end terminates the model run, saving the ocean state in a restart and deallocating any data associated with the ocean. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ocean_sfc</td><td>An <a class="el" href="structmom__ocean__model__mct_1_1ocean__public__type.html" title="This type is used for communication with other components via the FMS coupler. The element names and ...">ocean_public_type</a> structure that is to be deallocated upon termination. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">ocean_state</td><td>A pointer to the structure containing the internal ocean state to be deallocated upon termination. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>The model time, used for writing restarts. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00729">729</a> of file <a class="el" href="mom__ocean__model__mct_8F90_source.html">mom_ocean_model_mct.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="keywordtype">type</span>(ocean_public_type), <span class="keywordtype">intent(inout)</span> :: Ocean_sfc<span class="comment">   !&lt; An ocean_public_type structure that is</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">                                                        !! to be deallocated upon termination.</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <span class="keywordtype">type</span>(ocean_state_type),  <span class="keywordtype">pointer</span>       :: Ocean_state<span class="comment"> !&lt; A pointer to the structure containing</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment">                                                        !! the internal ocean state to be deallocated</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment">                                                        !! upon termination.</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="keywordtype">type</span>(time_type),         <span class="keywordtype">intent(in)</span>    :: Time<span class="comment">        !&lt; The model time, used for writing restarts.</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="keyword">call </span>ocean_model_save_restart(ocean_state, time)</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="keyword">call </span>diag_mediator_end(time, ocean_state%diag, end_diag_manager=.true.)</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="comment">! print time stats</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keyword">call </span>mom_infra_end</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="keyword">call </span>mom_end(ocean_state%MOM_CSp)</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <span class="keywordflow">if</span> (ocean_state%use_ice_shelf) <span class="keyword">call </span>ice_shelf_end(ocean_state%Ice_shelf_CSp)</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__diag__mediator_8F90_source.html#l03299">mom_diag_mediator::diag_mediator_end()</a>, <a class="el" href="MOM__ice__shelf_8F90_source.html#l01744">mom_ice_shelf::ice_shelf_end()</a>, and <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00747">ocean_model_save_restart()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__ocean__model__mct_ae300e0e875156247557b71dd922a4365_cgraph.svg" width="100%" height="574"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="aa8515d789e0bf3e772b3e78d6e5754cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8515d789e0bf3e772b3e78d6e5754cb">&#9670;&nbsp;</a></span>ocean_model_flux_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_ocean_model_mct::ocean_model_flux_init </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__state__type.html">ocean_state_type</a>), optional, pointer&#160;</td>
          <td class="paramname"><em>OS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional&#160;</td>
          <td class="paramname"><em>verbosity</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ocean_model_flux_init is used to initialize properties of the air-sea fluxes as determined by various run-time parameters. It can be called from non-ocean PEs, or PEs that have not yet been initialzed, and it can safely be called multiple times. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">os</td><td>An optional pointer to the ocean state, used to figure out if this is an ocean PE that has already been initialized. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">verbosity</td><td>A 0-9 integer indicating a level of verbosity. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00987">987</a> of file <a class="el" href="mom__ocean__model__mct_8F90_source.html">mom_ocean_model_mct.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keywordtype">type</span>(ocean_state_type), <span class="keywordtype">optional</span>, <span class="keywordtype">pointer</span> :: OS<span class="comment">  !&lt; An optional pointer to the ocean state,</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">                                             !! used to figure out if this is an ocean PE that</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment">                                             !! has already been initialized.</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: verbosity<span class="comment"> !&lt; A 0-9 integer indicating a level of verbosity.</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160; </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="keywordtype">logical</span> :: OS_is_set</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="keywordtype">integer</span> :: verbose</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160; </div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  os_is_set = .false. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(os)) os_is_set = <span class="keyword">associated</span>(os)</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160; </div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="comment">! Use this to control the verbosity of output; consider rethinking this logic later.</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  verbose = 5 ; <span class="keywordflow">if</span> (os_is_set) verbose = 3</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(verbosity)) verbose = verbosity</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160; </div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="keyword">call </span>call_tracer_flux_init(verbosity=verbose)</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__tracer__flow__control_8F90_source.html#l00117">mom_tracer_flow_control::call_tracer_flux_init()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__ocean__model__mct_aa8515d789e0bf3e772b3e78d6e5754cb_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ab85c4a8f30fcf7782a514a3fc66165a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab85c4a8f30fcf7782a514a3fc66165a2">&#9670;&nbsp;</a></span>ocean_model_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_ocean_model_mct::ocean_model_init </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__public__type.html">ocean_public_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>Ocean_sfc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__state__type.html">ocean_state_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Time_init</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Time_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(coupler_1d_bc_type), intent(in), optional&#160;</td>
          <td class="paramname"><em>gas_fields_ocn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in), optional&#160;</td>
          <td class="paramname"><em>input_restart_file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ocean_model_init initializes the ocean model, including registering fields for restarts and reading restart files if appropriate. </p>
<p>This subroutine initializes both the ocean state and the ocean surface type. Because of the way that indicies and domains are handled, Ocean_sfc must have been used in a previous call to initialize_ocean_type. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ocean_sfc</td><td>A structure containing various publicly </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">os</td><td>A structure whose internal contents are private to ocean_model_mod that may be used to contain all information about the ocean's interior state. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time_init</td><td>The start time for the coupled model's calendar </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time_in</td><td>The time at which to initialize the ocean model. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gas_fields_ocn</td><td>If present, this type describes the </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">input_restart_file</td><td>If present, name of restart file to read </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00224">224</a> of file <a class="el" href="mom__ocean__model__mct_8F90_source.html">mom_ocean_model_mct.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordtype">type</span>(ocean_public_type), <span class="keywordtype">target</span>, &amp;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                       <span class="keywordtype">intent(inout)</span> :: Ocean_sfc<span class="comment"> !&lt; A structure containing various publicly</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">                                !! visible ocean surface properties after initialization,</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">                                !! the data in this type is intent out.</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordtype">type</span>(ocean_state_type), <span class="keywordtype">pointer</span>    :: OS<span class="comment">        !&lt; A structure whose internal</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">                                !! contents are private to ocean_model_mod that may be used to</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">                                !! contain all information about the ocean&#39;s interior state.</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordtype">type</span>(time_type),     <span class="keywordtype">intent(in)</span>    :: Time_init<span class="comment"> !&lt; The start time for the coupled model&#39;s calendar</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordtype">type</span>(time_type),     <span class="keywordtype">intent(in)</span>    :: Time_in<span class="comment">   !&lt; The time at which to initialize the ocean model.</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordtype">type</span>(coupler_1d_bc_type), &amp;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;             <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: gas_fields_ocn<span class="comment"> !&lt; If present, this type describes the</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">                                              !! ocean and surface-ice fields that will participate</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">                                              !! in the calculation of additional gas or other</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">                                              !! tracer fluxes, and can be used to spawn related</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">                                              !! internal variables in the ice model.</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: input_restart_file<span class="comment"> !&lt; If present, name of restart file to read</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="keywordtype">  real</span> :: Rho0        <span class="comment">! The Boussinesq ocean density, in kg m-3.</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="keywordtype">  real</span> :: G_Earth     <span class="comment">! The gravitational acceleration in m s-2.</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="keywordtype">  real</span> :: HFrz<span class="comment">        !&lt; If HFrz &gt; 0 (m), melt potential will be computed.</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">                      !! The actual depth over which melt potential is computed will</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">                      !! min(HFrz, OBLD), where OBLD is the boundary layer depth.</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">                      !! If HFrz &lt;= 0 (default), melt potential will not be computed.</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordtype">logical</span> :: use_melt_pot<span class="comment">!&lt; If true, allocate melt_potential array</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">! This include declares and sets the variable &quot;version&quot;.</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="preprocessor">#include &quot;version_variable.h&quot;</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="preprocessor"></span>  <span class="keywordtype">character(len=40)</span>  :: mdl = <span class="stringliteral">&quot;ocean_model_init&quot;</span>  <span class="comment">! This module&#39;s name.</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordtype">character(len=48)</span>  :: stagger</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordtype">integer</span> :: secs, days</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordtype">type</span>(param_file_type) :: param_file<span class="comment"> !&lt; A structure to parse for run-time parameters</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordtype">logical</span> :: use_temperature</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keyword">call </span>calltree_enter(<span class="stringliteral">&quot;ocean_model_init(), MOM_ocean_model_mct.F90&quot;</span>)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(os)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;ocean_model_init called with an associated &quot;</span>// &amp;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                    <span class="stringliteral">&quot;ocean_state_type structure. Model is already initialized.&quot;</span>)</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keyword">allocate</span>(os)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  os%is_ocean_pe = ocean_sfc%is_ocean_pe</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordflow">if</span> (.not.os%is_ocean_pe) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  os%Time = time_in</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keyword">call </span>initialize_mom(os%Time, time_init, param_file, os%dirs, os%MOM_CSp, &amp;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                      os%restart_CSp, time_in, offline_tracer_mode=os%offline_tracer_mode, &amp;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                      input_restart_file=input_restart_file, &amp;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                      diag_ptr=os%diag, count_calls=.true.)</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keyword">call </span>get_mom_state_elements(os%MOM_CSp, g=os%grid, gv=os%GV, us=os%US, c_p=os%C_p, &amp;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                              use_temp=use_temperature)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  os%fluxes%C_p = os%C_p</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="comment">! Read all relevant parameters and write them to the model log.</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keyword">call </span>log_version(param_file, mdl, version, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;SINGLE_STEPPING_CALL&quot;</span>, os%single_step_call, &amp;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                 <span class="stringliteral">&quot;If true, advance the state of MOM with a single step &quot;</span>//&amp;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                 <span class="stringliteral">&quot;including both dynamics and thermodynamics.  If false, &quot;</span>//&amp;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                 <span class="stringliteral">&quot;the two phases are advanced with separate calls.&quot;</span>, default=.true.)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;DT&quot;</span>, os%dt, &amp;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                 <span class="stringliteral">&quot;The (baroclinic) dynamics time step.  The time-step that &quot;</span>//&amp;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                 <span class="stringliteral">&quot;is actually used will be an integer fraction of the &quot;</span>//&amp;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                 <span class="stringliteral">&quot;forcing time-step.&quot;</span>, units=<span class="stringliteral">&quot;s&quot;</span>, fail_if_missing=.true.)</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;DT_THERM&quot;</span>, os%dt_therm, &amp;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                 <span class="stringliteral">&quot;The thermodynamic and tracer advection time step. &quot;</span>//&amp;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                 <span class="stringliteral">&quot;Ideally DT_THERM should be an integer multiple of DT &quot;</span>//&amp;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                 <span class="stringliteral">&quot;and less than the forcing or coupling time-step, unless &quot;</span>//&amp;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                 <span class="stringliteral">&quot;THERMO_SPANS_COUPLING is true, in which case DT_THERM &quot;</span>//&amp;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                 <span class="stringliteral">&quot;can be an integer multiple of the coupling timestep.  By &quot;</span>//&amp;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                 <span class="stringliteral">&quot;default DT_THERM is set to DT.&quot;</span>, units=<span class="stringliteral">&quot;s&quot;</span>, default=os%dt)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keyword">call </span>get_param(param_file, <span class="stringliteral">&quot;MOM&quot;</span>, <span class="stringliteral">&quot;THERMO_SPANS_COUPLING&quot;</span>, os%thermo_spans_coupling, &amp;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                 <span class="stringliteral">&quot;If true, the MOM will take thermodynamic and tracer &quot;</span>//&amp;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                 <span class="stringliteral">&quot;timesteps that can be longer than the coupling timestep. &quot;</span>//&amp;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                 <span class="stringliteral">&quot;The actual thermodynamic timestep that is used in this &quot;</span>//&amp;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                 <span class="stringliteral">&quot;case is the largest integer multiple of the coupling &quot;</span>//&amp;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                 <span class="stringliteral">&quot;timestep that is less than or equal to DT_THERM.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;DIABATIC_FIRST&quot;</span>, os%diabatic_first, &amp;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                 <span class="stringliteral">&quot;If true, apply diabatic and thermodynamic processes, &quot;</span>//&amp;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                 <span class="stringliteral">&quot;including buoyancy forcing and mass gain or loss, &quot;</span>//&amp;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                 <span class="stringliteral">&quot;before stepping the dynamics forward.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;RESTART_CONTROL&quot;</span>, os%Restart_control, &amp;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                 <span class="stringliteral">&quot;An integer whose bits encode which restart files are &quot;</span>//&amp;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                 <span class="stringliteral">&quot;written. Add 2 (bit 1) for a time-stamped file, and odd &quot;</span>//&amp;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                 <span class="stringliteral">&quot;(bit 0) for a non-time-stamped file.  A restart file &quot;</span>//&amp;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                 <span class="stringliteral">&quot;will be saved at the end of the run segment for any &quot;</span>//&amp;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                 <span class="stringliteral">&quot;non-negative value.&quot;</span>, default=1)</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;OCEAN_SURFACE_STAGGER&quot;</span>, stagger, &amp;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                 <span class="stringliteral">&quot;A case-insensitive character string to indicate the &quot;</span>//&amp;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                 <span class="stringliteral">&quot;staggering of the surface velocity field that is &quot;</span>//&amp;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                 <span class="stringliteral">&quot;returned to the coupler.  Valid values include &quot;</span>//&amp;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                 <span class="stringliteral">&quot;&#39;A&#39;, &#39;B&#39;, or &#39;C&#39;.&quot;</span>, default=<span class="stringliteral">&quot;C&quot;</span>)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordflow">if</span> (uppercase(stagger(1:1)) == <span class="stringliteral">&#39;A&#39;</span>) <span class="keywordflow">then</span> ; ocean_sfc%stagger = agrid</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordflow">elseif</span> (uppercase(stagger(1:1)) == <span class="stringliteral">&#39;B&#39;</span>) <span class="keywordflow">then</span> ; ocean_sfc%stagger = bgrid_ne</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordflow">elseif</span> (uppercase(stagger(1:1)) == <span class="stringliteral">&#39;C&#39;</span>) <span class="keywordflow">then</span> ; ocean_sfc%stagger = cgrid_ne</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="keywordflow">else</span> ; <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;ocean_model_init: OCEAN_SURFACE_STAGGER = &quot;</span>// &amp;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                        trim(stagger)//<span class="stringliteral">&quot; is invalid.&quot;</span>) ;<span class="keywordflow"> endif</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;RESTORE_SALINITY&quot;</span>,os%restore_salinity, &amp;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                 <span class="stringliteral">&quot;If true, the coupled driver will add a globally-balanced &quot;</span>//&amp;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                 <span class="stringliteral">&quot;fresh-water flux that drives sea-surface salinity &quot;</span>//&amp;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                 <span class="stringliteral">&quot;toward specified values.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;RESTORE_TEMPERATURE&quot;</span>,os%restore_temp, &amp;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                 <span class="stringliteral">&quot;If true, the coupled driver will add a &quot;</span>//&amp;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                 <span class="stringliteral">&quot;heat flux that drives sea-surface temperature &quot;</span>//&amp;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                 <span class="stringliteral">&quot;toward specified values.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;RHO_0&quot;</span>, rho0, &amp;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                 <span class="stringliteral">&quot;The mean ocean density used with BOUSSINESQ true to &quot;</span>//&amp;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                 <span class="stringliteral">&quot;calculate accelerations and the mass for conservation &quot;</span>//&amp;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                 <span class="stringliteral">&quot;properties, or with BOUSSINSEQ false to convert some &quot;</span>//&amp;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                 <span class="stringliteral">&quot;parameters from vertical units of m to kg m-2.&quot;</span>, &amp;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                 units=<span class="stringliteral">&quot;kg m-3&quot;</span>, default=1035.0)</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;G_EARTH&quot;</span>, g_earth, &amp;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                 <span class="stringliteral">&quot;The gravitational acceleration of the Earth.&quot;</span>, &amp;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                 units=<span class="stringliteral">&quot;m s-2&quot;</span>, default = 9.80)</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;ICE_SHELF&quot;</span>,  os%use_ice_shelf, &amp;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                 <span class="stringliteral">&quot;If true, enables the ice shelf model.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;ICEBERGS_APPLY_RIGID_BOUNDARY&quot;</span>,  os%icebergs_alter_ocean, &amp;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                 <span class="stringliteral">&quot;If true, allows icebergs to change boundary condition felt by ocean&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  os%press_to_z = 1.0/(rho0*g_earth)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;HFREEZE&quot;</span>, hfrz, &amp;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                 <span class="stringliteral">&quot;If HFREEZE &gt; 0, melt potential will be computed. The actual depth &quot;</span>//&amp;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                 <span class="stringliteral">&quot;over which melt potential is computed will be min(HFREEZE, OBLD), &quot;</span>//&amp;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                 <span class="stringliteral">&quot;where OBLD is the boundary layer depth. If HFREEZE &lt;= 0 (default), &quot;</span>//&amp;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                 <span class="stringliteral">&quot;melt potential will not be computed.&quot;</span>, units=<span class="stringliteral">&quot;m&quot;</span>, default=-1.0, do_not_log=.true.)</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keywordflow">if</span> (hfrz .gt. 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    use_melt_pot=.true.</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    use_melt_pot=.false.</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="comment">!   Consider using a run-time flag to determine whether to do the diagnostic</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="comment">! vertical integrals, since the related 3-d sums are not negligible in cost.</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keyword">call </span>allocate_surface_state(os%sfc_state, os%grid, use_temperature, &amp;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                              do_integrals=.true., gas_fields_ocn=gas_fields_ocn, use_meltpot=use_melt_pot)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keyword">call </span>surface_forcing_init(time_in, os%grid, os%US, param_file, os%diag, &amp;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                            os%forcing_CSp, os%restore_salinity, os%restore_temp)</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="keywordflow">if</span> (os%use_ice_shelf)  <span class="keywordflow">then</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keyword">call </span>initialize_ice_shelf(param_file, os%grid, os%Time, os%ice_shelf_CSp, &amp;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                              os%diag, os%forces, os%fluxes)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordflow">if</span> (os%icebergs_alter_ocean)  <span class="keywordflow">then</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keyword">call </span>marine_ice_init(os%Time, os%grid, param_file, os%diag, os%marine_ice_CSp)</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span> (.not. os%use_ice_shelf) &amp;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="keyword">call </span>allocate_forcing_type(os%grid, os%fluxes, shelf=.true.)</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;USE_WAVES&quot;</span>, os%Use_Waves, &amp;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;       <span class="stringliteral">&quot;If true, enables surface wave modules.&quot;</span>, default=.false.)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordflow">if</span> (os%use_waves) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keyword">call </span>mom_wave_interface_init(os%Time, os%grid, os%GV, os%US, param_file, os%Waves, os%diag)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keyword">call </span>mom_wave_interface_init_lite(param_file)</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">associated</span>(os%grid%Domain%maskmap)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keyword">call </span>initialize_ocean_public_type(os%grid%Domain%mpp_domain, ocean_sfc, &amp;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                                      os%diag, maskmap=os%grid%Domain%maskmap, &amp;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                                      gas_fields_ocn=gas_fields_ocn)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keyword">call </span>initialize_ocean_public_type(os%grid%Domain%mpp_domain, ocean_sfc, &amp;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                                      os%diag, gas_fields_ocn=gas_fields_ocn)</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="comment">! This call can only occur here if the coupler_bc_type variables have been</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="comment">! initialized already using the information from gas_fields_ocn.</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(gas_fields_ocn)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keyword">call </span>coupler_type_set_diags(ocean_sfc%fields, <span class="stringliteral">&quot;ocean_sfc&quot;</span>, &amp;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                                ocean_sfc%axes(1:2), time_in)</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keyword">call </span>extract_surface_state(os%MOM_CSp, os%sfc_state)</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keyword">call </span>convert_state_to_ocean_type(os%sfc_state, ocean_sfc, os%grid, os%US)</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keyword">call </span>close_param_file(param_file)</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keyword">call </span>diag_mediator_close_registration(os%diag)</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keywordflow">if</span> (is_root_pe()) &amp;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keyword">write</span>(*,<span class="stringliteral">&#39;(/12x,a/)&#39;</span>) <span class="stringliteral">&#39;======== COMPLETED MOM INITIALIZATION ========&#39;</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keyword">call </span>calltree_leave(<span class="stringliteral">&quot;ocean_model_init(&quot;</span>)</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__error__handler_8F90_source.html#l00130">mom_error_handler::calltree_enter()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00151">mom_error_handler::calltree_leave()</a>, <a class="el" href="MOM__file__parser_8F90_source.html#l00242">mom_file_parser::close_param_file()</a>, <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00844">convert_state_to_ocean_type()</a>, <a class="el" href="MOM__diag__mediator_8F90_source.html#l03284">mom_diag_mediator::diag_mediator_close_registration()</a>, <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00783">initialize_ocean_public_type()</a>, <a class="el" href="MOM__marine__ice_8F90_source.html#l00181">mom_marine_ice::marine_ice_init()</a>, <a class="el" href="MOM__wave__interface_8F90_source.html#l00410">mom_wave_interface::mom_wave_interface_init_lite()</a>, and <a class="el" href="MOM__string__functions_8F90_source.html#l00042">mom_string_functions::uppercase()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__ocean__model__mct_ab85c4a8f30fcf7782a514a3fc66165a2_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a9974d833c3841e52263348f33cb9bba1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9974d833c3841e52263348f33cb9bba1">&#9670;&nbsp;</a></span>ocean_model_init_sfc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_ocean_model_mct::ocean_model_init_sfc </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__state__type.html">ocean_state_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__public__type.html">ocean_public_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>Ocean_sfc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine extracts the surface properties from the ocean's internal state and stores them in the ocean type returned to the calling ice model. It has to be separate from the ocean_initialization call because the coupler module allocates the space for some of these variables. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">os</td><td>The structure with the complete ocean state </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ocean_sfc</td><td>A structure containing various publicly visible ocean surface properties after initialization, whose elements have their data set here. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00966">966</a> of file <a class="el" href="mom__ocean__model__mct_8F90_source.html">mom_ocean_model_mct.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordtype">type</span>(ocean_state_type),  <span class="keywordtype">pointer</span>       :: OS<span class="comment">  !&lt; The structure with the complete ocean state</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <span class="keywordtype">type</span>(ocean_public_type), <span class="keywordtype">intent(inout)</span> :: Ocean_sfc<span class="comment"> !&lt; A structure containing various publicly</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">                                !! visible ocean surface properties after initialization, whose</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">                                !! elements have their data set here.</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keywordtype">integer</span> :: is, ie, js, je</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160; </div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  is = os%grid%isc ; ie = os%grid%iec ; js = os%grid%jsc ; je = os%grid%jec</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="keyword">call </span>coupler_type_spawn(ocean_sfc%fields, os%sfc_state%tr_fields, &amp;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                          (/is,is,ie,ie/), (/js,js,je,je/), as_needed=.true.)</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160; </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <span class="keyword">call </span>extract_surface_state(os%MOM_CSp, os%sfc_state)</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160; </div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="keyword">call </span>convert_state_to_ocean_type(os%sfc_state, ocean_sfc, os%grid, os%US)</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00844">convert_state_to_ocean_type()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__ocean__model__mct_a9974d833c3841e52263348f33cb9bba1_cgraph.svg" width="424" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="adb431f3c4f9de3b5f06acdb92428eeb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb431f3c4f9de3b5f06acdb92428eeb2">&#9670;&nbsp;</a></span>ocean_model_restart()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_ocean_model_mct::ocean_model_restart </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__state__type.html">ocean_state_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in), optional&#160;</td>
          <td class="paramname"><em>timestamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in), optional&#160;</td>
          <td class="paramname"><em>restartname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine writes out the ocean model restart file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">os</td><td>A pointer to the structure containing the internal ocean state being saved to a restart file </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">timestamp</td><td>An optional timestamp string that should be prepended to the file name. (Currently this is unused.) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">restartname</td><td>Name of restart file to use This option distinguishes the cesm interface from the non-cesm interface </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00677">677</a> of file <a class="el" href="mom__ocean__model__mct_8F90_source.html">mom_ocean_model_mct.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keywordtype">type</span>(ocean_state_type),     <span class="keywordtype">pointer</span>    :: OS<span class="comment"> !&lt; A pointer to the structure containing the</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment">                                               !! internal ocean state being saved to a restart file</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: timestamp<span class="comment"> !&lt; An optional timestamp string that should be</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">                                               !! prepended to the file name. (Currently this is unused.)</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: restartname<span class="comment"> !&lt; Name of restart file to use</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">                                               !! This option distinguishes the cesm interface from the</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">                                               !! non-cesm interface</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="keywordflow">if</span> (.not.mom_state_is_synchronized(os%MOM_CSp)) &amp;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;End of MOM_main reached with inconsistent &quot;</span>//&amp;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;         <span class="stringliteral">&quot;dynamics and advective times.  Additional restart fields &quot;</span>//&amp;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;         <span class="stringliteral">&quot;that have not been coded yet would be required for reproducibility.&quot;</span>)</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordflow">if</span> (.not.os%fluxes%fluxes_used) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;ocean_model_restart &quot;</span>//&amp;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="stringliteral">&quot;was called with unused buoyancy fluxes.  For conservation, the ocean &quot;</span>//&amp;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="stringliteral">&quot;restart files can only be created after the buoyancy forcing is applied.&quot;</span>)</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(restartname)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;     <span class="keyword">call </span>save_restart(os%dirs%restart_output_dir, os%Time, os%grid, &amp;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;          os%restart_CSp, gv=os%GV, filename=restartname)</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;     <span class="keyword">call </span>forcing_save_restart(os%forcing_CSp, os%grid, os%Time, &amp;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;          os%dirs%restart_output_dir) <span class="comment">! Is this needed?</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;     <span class="keywordflow">if</span> (os%use_ice_shelf) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="keyword">call </span>ice_shelf_save_restart(os%Ice_shelf_CSp, os%Time, &amp;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;             os%dirs%restart_output_dir)</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;     <span class="keywordflow">if</span> (btest(os%Restart_control,1)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <span class="keyword">call </span>save_restart(os%dirs%restart_output_dir, os%Time, os%grid, &amp;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;             os%restart_CSp, .true., gv=os%GV)</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="keyword">call </span>forcing_save_restart(os%forcing_CSp, os%grid, os%Time, &amp;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;             os%dirs%restart_output_dir, .true.)</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="keywordflow">if</span> (os%use_ice_shelf) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;           <span class="keyword">call </span>ice_shelf_save_restart(os%Ice_shelf_CSp, os%Time, os%dirs%restart_output_dir, .true.)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;     <span class="keywordflow">if</span> (btest(os%Restart_control,0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <span class="keyword">call </span>save_restart(os%dirs%restart_output_dir, os%Time, os%grid, &amp;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;             os%restart_CSp, gv=os%GV)</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="keyword">call </span>forcing_save_restart(os%forcing_CSp, os%grid, os%Time, &amp;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;             os%dirs%restart_output_dir)</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="keywordflow">if</span> (os%use_ice_shelf) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;           <span class="keyword">call </span>ice_shelf_save_restart(os%Ice_shelf_CSp, os%Time, os%dirs%restart_output_dir)</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="keywordflow">     endif</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="keywordflow">  end if</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mom__surface__forcing__mct_8F90_source.html#l00988">mom_surface_forcing_mct::forcing_save_restart()</a>, <a class="el" href="MOM__ice__shelf_8F90_source.html#l01721">mom_ice_shelf::ice_shelf_save_restart()</a>, and <a class="el" href="MOM__restart_8F90_source.html#l00781">mom_restart::save_restart()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__ocean__model__mct_adb431f3c4f9de3b5f06acdb92428eeb2_cgraph.svg" width="100%" height="449"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="acf771d5306cc54b49fd8221a38415e07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf771d5306cc54b49fd8221a38415e07">&#9670;&nbsp;</a></span>ocean_model_save_restart()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_ocean_model_mct::ocean_model_save_restart </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__state__type.html">ocean_state_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in), optional&#160;</td>
          <td class="paramname"><em>directory</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in), optional&#160;</td>
          <td class="paramname"><em>filename_suffix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ocean_model_save_restart causes restart files associated with the ocean to be written out. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">os</td><td>A pointer to the structure containing the internal ocean state (in). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>The model time at this call, needed for mpp_write calls. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">directory</td><td>An optional directory into which to write these restart files. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">filename_suffix</td><td>An optional suffix (e.g., a time-stamp) to append to the restart file names. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00747">747</a> of file <a class="el" href="mom__ocean__model__mct_8F90_source.html">mom_ocean_model_mct.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="keywordtype">type</span>(ocean_state_type),     <span class="keywordtype">pointer</span>    :: OS<span class="comment">  !&lt; A pointer to the structure containing the</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment">                                                !! internal ocean state (in).</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="keywordtype">type</span>(time_type),            <span class="keywordtype">intent(in)</span> :: Time<span class="comment"> !&lt; The model time at this call, needed for mpp_write calls.</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: directory<span class="comment">  !&lt;  An optional directory into which to</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">                                                !! write these restart files.</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span> :: filename_suffix<span class="comment"> !&lt; An optional suffix (e.g., a time-stamp)</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="comment">                                                !! to append to the restart file names.</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment">! Note: This is a new routine - it will need to exist for the new incremental</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">!   checkpointing.  It will also be called by ocean_model_end, giving the same</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">!   restart behavior as now in FMS.</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="keywordtype">character(len=200)</span> :: restart_dir</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="keywordflow">if</span> (.not.mom_state_is_synchronized(os%MOM_CSp)) &amp;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;ocean_model_save_restart called with inconsistent &quot;</span>//&amp;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;         <span class="stringliteral">&quot;dynamics and advective times.  Additional restart fields &quot;</span>//&amp;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;         <span class="stringliteral">&quot;that have not been coded yet would be required for reproducibility.&quot;</span>)</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <span class="keywordflow">if</span> (.not.os%fluxes%fluxes_used) <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;ocean_model_save_restart &quot;</span>//&amp;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;       <span class="stringliteral">&quot;was called with unused buoyancy fluxes.  For conservation, the ocean &quot;</span>//&amp;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;       <span class="stringliteral">&quot;restart files can only be created after the buoyancy forcing is applied.&quot;</span>)</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">present</span>(directory)) <span class="keywordflow">then</span> ; restart_dir = directory</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keywordflow">else</span> ; restart_dir = os%dirs%restart_output_dir ;<span class="keywordflow"> endif</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="keyword">call </span>save_restart(restart_dir, time, os%grid, os%restart_CSp, gv=os%GV)</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <span class="keyword">call </span>forcing_save_restart(os%forcing_CSp, os%grid, time, restart_dir)</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="keywordflow">if</span> (os%use_ice_shelf) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keyword">call </span>ice_shelf_save_restart(os%Ice_shelf_CSp, os%Time, os%dirs%restart_output_dir)</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="mom__surface__forcing__mct_8F90_source.html#l00988">mom_surface_forcing_mct::forcing_save_restart()</a>, <a class="el" href="MOM__ice__shelf_8F90_source.html#l01721">mom_ice_shelf::ice_shelf_save_restart()</a>, and <a class="el" href="MOM__restart_8F90_source.html#l00781">mom_restart::save_restart()</a>.</p>

<p class="reference">Referenced by <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00729">ocean_model_end()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__ocean__model__mct_acf771d5306cc54b49fd8221a38415e07_cgraph.svg" width="100%" height="449"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__ocean__model__mct_acf771d5306cc54b49fd8221a38415e07_icgraph.svg" width="410" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="af2c455dca4cdd74e1a2906f91bdf4aba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2c455dca4cdd74e1a2906f91bdf4aba">&#9670;&nbsp;</a></span>ocean_public_type_chksum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_ocean_model_mct::ocean_public_type_chksum </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>timestep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__public__type.html">ocean_public_type</a>), intent(in)&#160;</td>
          <td class="paramname"><em>ocn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write out FMS-format checsums on fields from the ocean surface state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">id</td><td>An identifying string for this call </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">timestep</td><td>The number of elapsed timesteps </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ocn</td><td>A structure containing various publicly visible ocean surface fields. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__ocean__model__mct_8F90_source.html#l01049">1049</a> of file <a class="el" href="mom__ocean__model__mct_8F90_source.html">mom_ocean_model_mct.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160; </div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <span class="keywordtype">character(len=*)</span>,        <span class="keywordtype">intent(in)</span> :: id<span class="comment">  !&lt; An identifying string for this call</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="keywordtype">integer</span>,                 <span class="keywordtype">intent(in)</span> :: timestep<span class="comment"> !&lt; The number of elapsed timesteps</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <span class="keywordtype">type</span>(ocean_public_type), <span class="keywordtype">intent(in)</span> :: ocn<span class="comment"> !&lt; A structure containing various publicly</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">                                             !! visible ocean surface fields.</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  <span class="keywordtype">integer</span> :: n, m, outunit</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160; </div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  outunit = stdout()</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160; </div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  <span class="keyword">write</span>(outunit,*) <span class="stringliteral">&quot;BEGIN CHECKSUM(ocean_type):: &quot;</span>, id, timestep</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  <span class="keyword">write</span>(outunit,100) <span class="stringliteral">&#39;ocean%t_surf   &#39;</span>,mpp_chksum(ocn%t_surf )</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <span class="keyword">write</span>(outunit,100) <span class="stringliteral">&#39;ocean%s_surf   &#39;</span>,mpp_chksum(ocn%s_surf )</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <span class="keyword">write</span>(outunit,100) <span class="stringliteral">&#39;ocean%u_surf   &#39;</span>,mpp_chksum(ocn%u_surf )</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  <span class="keyword">write</span>(outunit,100) <span class="stringliteral">&#39;ocean%v_surf   &#39;</span>,mpp_chksum(ocn%v_surf )</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  <span class="keyword">write</span>(outunit,100) <span class="stringliteral">&#39;ocean%sea_lev  &#39;</span>,mpp_chksum(ocn%sea_lev)</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="keyword">write</span>(outunit,100) <span class="stringliteral">&#39;ocean%frazil   &#39;</span>,mpp_chksum(ocn%frazil )</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="keyword">write</span>(outunit,100) <span class="stringliteral">&#39;ocean%melt_potential  &#39;</span>,mpp_chksum(ocn%melt_potential)</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160; </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <span class="keyword">call </span>coupler_type_write_chksums(ocn%fields, outunit, <span class="stringliteral">&#39;ocean%&#39;</span>)</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;100 <span class="keyword">FORMAT</span>(<span class="stringliteral">&quot;   CHECKSUM::&quot;</span>,a20,<span class="stringliteral">&quot; = &quot;</span>,z20)</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160; </div>
</div><!-- fragment -->
</div>
</div>
<a id="af453e38e57801cebcc7145c370c30f28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af453e38e57801cebcc7145c370c30f28">&#9670;&nbsp;</a></span>ocean_stock_pe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_ocean_model_mct::ocean_stock_pe </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__state__type.html">ocean_state_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional&#160;</td>
          <td class="paramname"><em>time_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Ocean_stock_pe - returns the integrated stocks of heat, water, etc. for conservation checks. Because of the way FMS is coded, only the root PE has the integrated amount, while all other PEs get 0. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">os</td><td>A structure containing the internal ocean state. The data in OS is intent in. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">index</td><td>The stock index for the quantity of interest. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">value</td><td>Sum returned for the conservation quantity of interest. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time_index</td><td>An unused optional argument, present only for interfacial compatibility with other models. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__ocean__model__mct_8F90_source.html#l01009">1009</a> of file <a class="el" href="mom__ocean__model__mct_8F90_source.html">mom_ocean_model_mct.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="keywordtype">use </span>stock_constants_mod, <span class="keywordtype">only</span> : istock_water, istock_heat,istock_salt</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <span class="keywordtype">type</span>(ocean_state_type), <span class="keywordtype">pointer</span>     :: OS<span class="comment">         !&lt; A structure containing the internal ocean state.</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">                                                    !! The data in OS is intent in.</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="keywordtype">integer</span>,                <span class="keywordtype">intent(in)</span>  :: index<span class="comment">      !&lt; The stock index for the quantity of interest.</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="keywordtype">  real</span>,                   <span class="keywordtype">intent(out)</span> :: <span class="keywordtype">value</span><span class="comment">      !&lt; Sum returned for the conservation quantity of interest.</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <span class="keywordtype">integer</span>,      <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>  :: time_index<span class="comment"> !&lt; An unused optional argument, present only for</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">                                                    !! interfacial compatibility with other models.</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">! Arguments: OS - A structure containing the internal ocean state.</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment">!  (in)      index - Index of conservation quantity of interest.</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">!  (in)      value -  Sum returned for the conservation quantity of interest.</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">!  (in,opt)  time_index - Index for time level to use if this is necessary.</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160; </div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="keywordtype">  real</span> :: salt</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160; </div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="keywordtype">value</span> = 0.0</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(os)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="keywordflow">if</span> (.not.os%is_ocean_pe) <span class="keywordflow">return</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160; </div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="keywordflow">select case</span> (index)</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <span class="keywordflow">case</span> (istock_water)  <span class="comment">! Return the mass of fresh water in the ocean in kg.</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <span class="keywordflow">if</span> (os%GV%Boussinesq) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        <span class="keyword">call </span>get_ocean_stocks(os%MOM_CSp, mass=<span class="keywordtype">value</span>, on_pe_only=.true.)</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      <span class="keywordflow">else</span>  <span class="comment">! In non-Boussinesq mode, the mass of salt needs to be subtracted.</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        <span class="keyword">call </span>get_ocean_stocks(os%MOM_CSp, mass=<span class="keywordtype">value</span>, salt=salt, on_pe_only=.true.)</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        <span class="keywordtype">value</span> = <span class="keywordtype">value</span> - salt</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keywordflow">case</span> (istock_heat)  <span class="comment">! Return the heat content of the ocean in J.</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      <span class="keyword">call </span>get_ocean_stocks(os%MOM_CSp, heat=<span class="keywordtype">value</span>, on_pe_only=.true.)</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="keywordflow">case</span> (istock_salt)  <span class="comment">! Return the mass of the salt in the ocean in kg.</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;       <span class="keyword">call </span>get_ocean_stocks(os%MOM_CSp, salt=<span class="keywordtype">value</span>, on_pe_only=.true.)</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="keywordflow">    case default</span> ; <span class="keywordtype">value</span> = 0.0</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="keywordflow">  end select</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="comment">! If the FMS coupler is changed so that Ocean_stock_PE is only called on</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <span class="comment">! ocean PEs, uncomment the following and eliminate the on_PE_only flags above.</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="comment">!  if (.not.is_root_pe()) value = 0.0</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM_8F90_source.html#l03115">mom::get_ocean_stocks()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__ocean__model__mct_af453e38e57801cebcc7145c370c30f28_cgraph.svg" width="587" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a422ba42ca07c0bf28ec5113aba4f1e96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a422ba42ca07c0bf28ec5113aba4f1e96">&#9670;&nbsp;</a></span>update_ocean_model()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_ocean_model_mct::update_ocean_model </td>
          <td>(</td>
          <td class="paramtype">type(ice_ocean_boundary_type), intent(in)&#160;</td>
          <td class="paramname"><em>Ice_ocean_boundary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__state__type.html">ocean_state_type</a>), pointer&#160;</td>
          <td class="paramname"><em>OS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__ocean__model__mct_1_1ocean__public__type.html">ocean_public_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>Ocean_sfc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>time_start_update</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(time_type), intent(in)&#160;</td>
          <td class="paramname"><em>Ocean_coupling_time_step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>update_dyn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>update_thermo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional&#160;</td>
          <td class="paramname"><em>Ocn_fluxes_used</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>update_ocean_model uses the forcing in Ice_ocean_boundary to advance the ocean model's state from the input value of Ocean_state (which must be for time time_start_update) for a time interval of Ocean_coupling_time_step, returning the publicly visible ocean surface properties in Ocean_sfc and storing the new ocean properties in Ocean_state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ice_ocean_boundary</td><td>A structure containing the </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">os</td><td>A pointer to a private structure containing </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ocean_sfc</td><td>A structure containing all the </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time_start_update</td><td>The time at the beginning of the update step. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ocean_coupling_time_step</td><td>The amount of time over which to advance the ocean. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">update_dyn</td><td>If present and false, do not do updates due to the ocean dynamics. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">update_thermo</td><td>If present and false, do not do updates due to the ocean thermodynamics or remapping. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ocn_fluxes_used</td><td>If present, this indicates whether the cumulative thermodynamic fluxes from the ocean, like frazil, have been used and should be reset. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00425">425</a> of file <a class="el" href="mom__ocean__model__mct_8F90_source.html">mom_ocean_model_mct.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordtype">type</span>(ice_ocean_boundary_type), &amp;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                     <span class="keywordtype">intent(in)</span>    :: Ice_ocean_boundary<span class="comment"> !&lt; A structure containing the</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">                                              !! various forcing fields coming from the ice.</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="keywordtype">type</span>(ocean_state_type), &amp;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                     <span class="keywordtype">pointer</span>       :: OS<span class="comment">      !&lt; A pointer to a private structure containing</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">                                              !! the internal ocean state.</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordtype">type</span>(ocean_public_type), &amp;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                     <span class="keywordtype">intent(inout)</span> :: Ocean_sfc<span class="comment"> !&lt; A structure containing all the</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">                                              !! publicly visible ocean surface fields after</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">                                              !! a coupling time step.  The data in this type is</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">                                              !! intent out.</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <span class="keywordtype">type</span>(time_type),   <span class="keywordtype">intent(in)</span>    :: time_start_update<span class="comment">  !&lt; The time at the beginning of the update step.</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <span class="keywordtype">type</span>(time_type),   <span class="keywordtype">intent(in)</span>    :: Ocean_coupling_time_step<span class="comment"> !&lt; The amount of time over</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">                                              !! which to advance the ocean.</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: update_dyn<span class="comment"> !&lt; If present and false, do not do updates</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">                                              !! due to the ocean dynamics.</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: update_thermo<span class="comment"> !&lt; If present and false, do not do updates</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">                                              !! due to the ocean thermodynamics or remapping.</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">intent(in)</span>    :: Ocn_fluxes_used<span class="comment"> !&lt; If present, this indicates whether the</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">                                              !! cumulative thermodynamic fluxes from the ocean,</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">                                              !! like frazil, have been used and should be reset.</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordtype">type</span>(time_type) :: Master_time <span class="comment">! This allows step_MOM to temporarily change</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                                 <span class="comment">! the time that is seen by internal modules.</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordtype">type</span>(time_type) :: Time1       <span class="comment">! The value of the ocean model&#39;s time at the</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                                 <span class="comment">! start of a call to step_MOM.</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordtype">integer</span> :: index_bnds(4)       <span class="comment">! The computational domain index bounds in the</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                                 <span class="comment">! ice-ocean boundary type.</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="keywordtype">  real</span> :: weight          <span class="comment">! Flux accumulation weight</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="keywordtype">  real</span> :: dt_coupling     <span class="comment">! The coupling time step in seconds.</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="keywordtype">integer</span> :: nts          <span class="comment">! The number of baroclinic dynamics time steps</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                          <span class="comment">! within dt_coupling.</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="keywordtype">  real</span> :: dt_therm        <span class="comment">! A limited and quantized version of OS%dt_therm (sec)</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="keywordtype">  real</span> :: dt_dyn          <span class="comment">! The dynamics time step in sec.</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="keywordtype">  real</span> :: dtdia           <span class="comment">! The diabatic time step in sec.</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="keywordtype">  real</span> :: t_elapsed_seg   <span class="comment">! The elapsed time in this update segment, in s.</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordtype">integer</span> :: n, n_max, n_last_thermo</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordtype">type</span>(time_type) :: Time2  <span class="comment">! A temporary time.</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keywordtype">logical</span> :: thermo_does_span_coupling <span class="comment">! If true, thermodynamic forcing spans</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                                       <span class="comment">! multiple dynamic timesteps.</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keywordtype">logical</span> :: do_dyn       <span class="comment">! If true, step the ocean dynamics and transport.</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordtype">logical</span> :: do_thermo    <span class="comment">! If true, step the ocean thermodynamics.</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordtype">logical</span> :: step_thermo           <span class="comment">! If true, take a thermodynamic step.</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordtype">integer</span> :: secs, days</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keywordtype">integer</span> :: is, ie, js, je</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keyword">call </span>calltree_enter(<span class="stringliteral">&quot;update_ocean_model(), MOM_ocean_model_mct.F90&quot;</span>)</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="keyword">call </span>get_time(ocean_coupling_time_step, secs, days)</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  dt_coupling = 86400.0*real(days) + real(secs)</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordflow">if</span> (time_start_update /= os%Time) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keyword">call </span>mom_error(warning, <span class="stringliteral">&quot;update_ocean_model: internal clock does not &quot;</span>//&amp;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                            <span class="stringliteral">&quot;agree with time_start_update argument.&quot;</span>)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="keywordflow">if</span> (.not.<span class="keyword">associated</span>(os)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;update_ocean_model called with an unassociated &quot;</span>// &amp;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                    <span class="stringliteral">&quot;ocean_state_type structure. ocean_model_init must be &quot;</span>//  &amp;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                    <span class="stringliteral">&quot;called first to allocate this structure.&quot;</span>)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160; </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  do_dyn = .true. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(update_dyn)) do_dyn = update_dyn</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  do_thermo = .true. ; <span class="keywordflow">if</span> (<span class="keyword">present</span>(update_thermo)) do_thermo = update_thermo</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="comment">! This is benign but not necessary if ocean_model_init_sfc was called or if</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="comment">! OS%sfc_state%tr_fields was spawned in ocean_model_init.  Consider removing it.</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  is = os%grid%isc ; ie = os%grid%iec ; js = os%grid%jsc ; je = os%grid%jec</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keyword">call </span>coupler_type_spawn(ocean_sfc%fields, os%sfc_state%tr_fields, &amp;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                          (/is,is,ie,ie/), (/js,js,je,je/), as_needed=.true.)</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160; </div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="comment">! Translate Ice_ocean_boundary into fluxes.</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keyword">call </span>mpp_get_compute_domain(ocean_sfc%Domain, index_bnds(1), index_bnds(2), &amp;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                              index_bnds(3), index_bnds(4))</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  weight = 1.0</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keyword">call </span>convert_iob_to_forces(ice_ocean_boundary, os%forces, index_bnds, os%Time, &amp;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                             os%grid, os%US, os%forcing_CSp)</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keywordflow">if</span> (os%fluxes%fluxes_used) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="comment">! GMM, is enable_averaging needed now?</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keyword">call </span>enable_averaging(dt_coupling, os%Time + ocean_coupling_time_step, os%diag)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">if</span> (do_thermo) &amp;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="keyword">call </span>convert_iob_to_fluxes(ice_ocean_boundary, os%fluxes, index_bnds, os%Time, dt_coupling, &amp;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                               os%grid, os%US, os%forcing_CSp, os%sfc_state, &amp;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                               os%restore_salinity, os%restore_temp)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="comment">! Add ice shelf fluxes</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">if</span> (os%use_ice_shelf) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordflow">if</span> (do_thermo) &amp;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="keyword">call </span>shelf_calc_flux(os%sfc_state, os%fluxes, os%Time, dt_coupling, os%Ice_shelf_CSp)</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="keywordflow">if</span> (do_dyn) &amp;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keyword">call </span>add_shelf_forces(os%grid, os%US, os%Ice_shelf_CSp, os%forces)</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">if</span> (os%icebergs_alter_ocean)  <span class="keywordflow">then</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">if</span> (do_dyn) &amp;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keyword">call </span>iceberg_forces(os%grid, os%forces, os%use_ice_shelf, &amp;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                            os%sfc_state, dt_coupling, os%marine_ice_CSp)</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <span class="keywordflow">if</span> (do_thermo) &amp;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keyword">call </span>iceberg_fluxes(os%grid, os%US, os%fluxes, os%use_ice_shelf, &amp;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                          os%sfc_state, dt_coupling, os%marine_ice_CSp)</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="comment">! Fields that exist in both the forcing and mech_forcing types must be copied.</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keyword">call </span>copy_common_forcing_fields(os%forces, os%fluxes, os%grid)</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="preprocessor">#ifdef _USE_GENERIC_TRACER</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="preprocessor"></span>    <span class="keyword">call </span>enable_averaging(dt_coupling, os%Time + ocean_coupling_time_step, os%diag) <span class="comment">!Is this needed?</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keyword">call </span>mom_generic_tracer_fluxes_accumulate(os%fluxes, weight) <span class="comment">!here weight=1, just saving the current fluxes</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    os%flux_tmp%C_p = os%fluxes%C_p</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">if</span> (do_thermo) &amp;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keyword">call </span>convert_iob_to_fluxes(ice_ocean_boundary, os%flux_tmp, index_bnds, os%Time, dt_coupling, &amp;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                               os%grid, os%US, os%forcing_CSp, os%sfc_state, os%restore_salinity,os%restore_temp)</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160; </div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordflow">if</span> (os%use_ice_shelf) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">if</span> (do_thermo) &amp;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="keyword">call </span>shelf_calc_flux(os%sfc_state, os%flux_tmp, os%Time, dt_coupling, os%Ice_shelf_CSp)</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <span class="keywordflow">if</span> (do_dyn) &amp;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="keyword">call </span>add_shelf_forces(os%grid, os%US, os%Ice_shelf_CSp, os%forces)</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">if</span> (os%icebergs_alter_ocean)  <span class="keywordflow">then</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="keywordflow">if</span> (do_dyn) &amp;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="keyword">call </span>iceberg_forces(os%grid, os%forces, os%use_ice_shelf, &amp;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                            os%sfc_state, dt_coupling, os%marine_ice_CSp)</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="keywordflow">if</span> (do_thermo) &amp;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keyword">call </span>iceberg_fluxes(os%grid, os%US, os%flux_tmp, os%use_ice_shelf, &amp;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                          os%sfc_state, dt_coupling, os%marine_ice_CSp)</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160; </div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keyword">call </span>forcing_accumulate(os%flux_tmp, os%forces, os%fluxes, os%grid, weight)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160; </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="comment">! Some of the fields that exist in both the forcing and mech_forcing types</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="comment">! (e.g., ustar) are time-averages must be copied back to the forces type.</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keyword">call </span>copy_back_forcing_fields(os%fluxes, os%forces, os%grid)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="preprocessor">#ifdef _USE_GENERIC_TRACER</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="preprocessor"></span>    <span class="keyword">call </span>mom_generic_tracer_fluxes_accumulate(os%flux_tmp, weight) <span class="comment">!weight of the current flux in the running average</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="preprocessor"></span><span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160; </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="keyword">call </span>set_derived_forcing_fields(os%forces, os%fluxes, os%grid, os%US, os%GV%Rho0)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="keyword">call </span>set_net_mass_forcing(os%fluxes, os%forces, os%grid, os%US)</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keywordflow">if</span> (os%use_waves) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keyword">call </span>update_surface_waves(os%grid, os%GV, os%US, os%time, ocean_coupling_time_step, os%waves)</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <span class="keywordflow">if</span> (os%nstep==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keyword">call </span>finish_mom_initialization(os%Time, os%dirs, os%MOM_CSp, os%restart_CSp)</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="keyword">call </span>disable_averaging(os%diag)</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  master_time = os%Time ; time1 = os%Time</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keywordflow">if</span>(os%offline_tracer_mode) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keyword">call </span>step_offline(os%forces, os%fluxes, os%sfc_state, time1, dt_coupling, os%MOM_CSp)</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="keywordflow">elseif</span> ((.not.do_thermo) .or. (.not.do_dyn)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="comment">! The call sequence is being orchestrated from outside of update_ocean_model.</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keyword">call </span>step_mom(os%forces, os%fluxes, os%sfc_state, time1, dt_coupling, os%MOM_CSp, &amp;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                  waves=os%Waves, do_dynamics=do_thermo, do_thermodynamics=do_dyn, &amp;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                  reset_therm=ocn_fluxes_used)</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <span class="keywordflow">elseif</span> (os%single_step_call) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keyword">call </span>step_mom(os%forces, os%fluxes, os%sfc_state, time1, dt_coupling, os%MOM_CSp, waves=os%Waves)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    n_max = 1 ; <span class="keywordflow">if</span> (dt_coupling &gt; os%dt) n_max = ceiling(dt_coupling/os%dt - 0.001)</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    dt_dyn = dt_coupling / real(n_max)</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    thermo_does_span_coupling = (os%thermo_spans_coupling .and. &amp;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                (os%dt_therm &gt; 1.5*dt_coupling))</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordflow">if</span> (thermo_does_span_coupling) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      dt_therm = dt_coupling * floor(os%dt_therm / dt_coupling + 0.001)</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      nts = floor(dt_therm/dt_dyn + 0.001)</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      nts = max(1,min(n_max,floor(os%dt_therm/dt_dyn + 0.001)))</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      n_last_thermo = 0</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    time2 = time1 ; t_elapsed_seg = 0.0</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordflow">do</span> n=1,n_max</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      <span class="keywordflow">if</span> (os%diabatic_first) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">if</span> (thermo_does_span_coupling) <span class="keyword">call </span>mom_error(fatal, &amp;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <span class="stringliteral">&quot;MOM is not yet set up to have restarts that work with &quot;</span>//&amp;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="stringliteral">&quot;THERMO_SPANS_COUPLING and DIABATIC_FIRST.&quot;</span>)</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="keywordflow">if</span> (modulo(n-1,nts)==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;          dtdia = dt_dyn*min(nts,n_max-(n-1))</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;          <span class="keyword">call </span>step_mom(os%forces, os%fluxes, os%sfc_state, time2, dtdia, os%MOM_CSp, &amp;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                        waves=os%Waves, do_dynamics=.false., do_thermodynamics=.true., &amp;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                        start_cycle=(n==1), end_cycle=.false., cycle_length=dt_coupling)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="keyword">call </span>step_mom(os%forces, os%fluxes, os%sfc_state, time2, dt_dyn, os%MOM_CSp, &amp;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                      waves=os%Waves, do_dynamics=.true., do_thermodynamics=.false., &amp;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                      start_cycle=.false., end_cycle=(n==n_max), cycle_length=dt_coupling)</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="keyword">call </span>step_mom(os%forces, os%fluxes, os%sfc_state, time2, dt_dyn, os%MOM_CSp, &amp;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                      waves=os%Waves, do_dynamics=.true., do_thermodynamics=.false., &amp;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                      start_cycle=(n==1), end_cycle=.false., cycle_length=dt_coupling)</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160; </div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        step_thermo = .false.</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">if</span> (thermo_does_span_coupling) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;          dtdia = dt_therm</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;          step_thermo = mom_state_is_synchronized(os%MOM_CSp, adv_dyn=.true.)</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">elseif</span> ((modulo(n,nts)==0) .or. (n==n_max)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;          dtdia = dt_dyn*(n - n_last_thermo)</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;          n_last_thermo = n</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;          step_thermo = .true.</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="keywordflow">if</span> (step_thermo) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;          <span class="comment">! Back up Time2 to the start of the thermodynamic segment.</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;          time2 = time2 - set_time(int(floor((dtdia - dt_dyn) + 0.5)))</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;          <span class="keyword">call </span>step_mom(os%forces, os%fluxes, os%sfc_state, time2, dtdia, os%MOM_CSp, &amp;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                        waves=os%Waves, do_dynamics=.false., do_thermodynamics=.true., &amp;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                        start_cycle=.false., end_cycle=(n==n_max), cycle_length=dt_coupling)</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      t_elapsed_seg = t_elapsed_seg + dt_dyn</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      time2 = time1 + set_time(int(floor(t_elapsed_seg + 0.5)))</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160; </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  os%Time = master_time + ocean_coupling_time_step</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  os%nstep = os%nstep + 1</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="keyword">call </span>mech_forcing_diags(os%forces, dt_coupling, os%grid, os%Time, os%diag, os%forcing_CSp%handles)</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="keywordflow">if</span> (os%fluxes%fluxes_used) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keyword">call </span>forcing_diagnostics(os%fluxes, os%sfc_state, os%grid, os%US, os%Time, os%diag, os%forcing_CSp%handles)</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">! Translate state into Ocean.</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">!  call convert_state_to_ocean_type(OS%sfc_state, Ocean_sfc, OS%grid, &amp;</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment">!                                   Ice_ocean_boundary%p, OS%press_to_z)</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <span class="keyword">call </span>convert_state_to_ocean_type(os%sfc_state, ocean_sfc, os%grid, os%US)</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="keyword">call </span>coupler_type_send_data(ocean_sfc%fields, os%Time)</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <span class="keyword">call </span>calltree_leave(<span class="stringliteral">&quot;update_ocean_model()&quot;</span>)</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__ice__shelf_8F90_source.html#l00760">mom_ice_shelf::add_shelf_forces()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00130">mom_error_handler::calltree_enter()</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00151">mom_error_handler::calltree_leave()</a>, <a class="el" href="mom__ocean__model__mct_8F90_source.html#l00844">convert_state_to_ocean_type()</a>, <a class="el" href="MOM__forcing__type_8F90_source.html#l02238">mom_forcing_type::forcing_diagnostics()</a>, <a class="el" href="MOM__marine__ice_8F90_source.html#l00108">mom_marine_ice::iceberg_fluxes()</a>, <a class="el" href="MOM__marine__ice_8F90_source.html#l00047">mom_marine_ice::iceberg_forces()</a>, <a class="el" href="MOM__forcing__type_8F90_source.html#l02201">mom_forcing_type::mech_forcing_diags()</a>, <a class="el" href="MOM_8F90_source.html#l01310">mom::step_offline()</a>, and <a class="el" href="MOM__wave__interface_8F90_source.html#l00437">mom_wave_interface::update_surface_waves()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__ocean__model__mct_a422ba42ca07c0bf28ec5113aba4f1e96_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemom__ocean__model__mct.html">mom_ocean_model_mct</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
